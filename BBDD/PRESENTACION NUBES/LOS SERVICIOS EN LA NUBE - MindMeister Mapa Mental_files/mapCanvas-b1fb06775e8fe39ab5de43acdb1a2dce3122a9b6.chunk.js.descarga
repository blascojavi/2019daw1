/*! For license information please see mapCanvas-b1fb06775e8fe39ab5de43acdb1a2dce3122a9b6.chunk.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[200,2,6,7,15,16,17,18,19,31,32,56,57,63,65,66,69,75,76,79,82,83,84,86,90,91,92,93,94,106,109,113,114,116,117,118,119,124,125,126,127,129,130,131,132,134,135,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,164,169,170,173,174,175,176,177,180,181,213,218,222],{"+29S":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var Poller={initialize:function(e){Modernizr.websockets&&e?(console.log("Poller#initialize - trying websockets"),MM.utils.loadScript("http://"+document.location.hostname+":9000/faye/client.js",this.initializeSocket.bind(this)),console.log("Poller#initialize - after loadScriptN")):(this.resetInterval(),this.pollHandler=this.poll.bind(this),this.schedulePoll())},initializeSocket:function initializeSocket(){console.log("Poller#initialize - Enabling websockets, disabling polling"),this.socket=new Faye.Client("http://"+document.location.hostname+":9000/faye"),console.log("Poller#initialize - Subscribing");var subscription=this.socket.subscribe("/map/"+tree.root.id,(function(message){eval(message)}));subscription.callback((function(){console.log("Subscription is now active")}))},schedulePoll:function(){App.config.shareMode===App.MULTI||App.config.linkShare?this.resetInterval():"undefined"===typeof Presentation||Presentation.on||this.interval<20&&(this.interval=1.1*this.interval),setTimeout(this.pollHandler,1e3*this.interval)},poll:function(){ServerConnection.poll(),this.socket||this.schedulePoll()},resetInterval:function(){this.interval=App.config.POLL_INTERVAL}};__webpack_exports__.default=Poller},"+c3t":function(e,t,n){"use strict";n.r(t);var i,o,s,r,a,l=n("sEfC"),c=n.n(l),d=n("TxdS"),h=n("4AML"),u=n("rJb1"),p=function(){var e=this,t=this.getValue();if(!this.el._listener.node.isRoot()&&-1!==t.indexOf("\n")&&r){var n=[new Element("a",{href:"#",id:"btn_menu_split",tabindex:0}).update(I18n.t("js.split"))];(function(e){return/\n\s/.test(e)})(t)&&n.push(new Element("a",{href:"#",id:"btn_menu_split_tree",tabindex:0}).update(I18n.t("js.split_into_tree"))),d.default.showCustom(n,{opener:this.el,noKeymap:!0,onClose:function(){a=!1,e.title.focus()}})}else a=!1},f=function(e){if(e){var t=h.default.getPlainClipboardData(e);m.call(this,t),Event.stop(e)}},m=function(e){a=!0,h.default.isPastingTopics(e)?h.default.onPasteTopics(e):(h.default.simulatePaste(e),p.call(this))},g=function(e){!a&&r&&null!==this.el._listener&&this.el._listener.dcontent.toSelected(e,!0,!0)},v=function(){canvas.scrollToElement(this.el,null,!0,!0),b.call(this)},y=function(){return{x:this.el.getWidth()-this.nodeWidth,y:this.title.getHeight()-this.titleHeight}},_=function(e){var t=this,n=e.match(function(e){e=Object.assign({strict:!0},e);var t="(?:(?:[a-z]+:)?//)".concat(e.strict?"":"?"),n="(?:".concat(t,"|www\\.)").concat("(?:\\S+(?::\\S*)?@)?","(?:localhost|").concat("(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)").concat("(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",")").concat("(?::\\d{2,5})?").concat('(?:[/?#][^\\s"]*)?');return e.exact?new RegExp("(?:^".concat(n,"$)"),"i"):new RegExp(n,"ig")}());if(n&&n.length>0){var i=n[0];if(users.selfUser.anonymous)return;u.a.get("expand_links",(function(e){e&&e.value&&t.el._listener.node.generateThumb(i,{onSuccess:function(){e.new&&Message.show(I18n.t("js.generate_thumbnail",{url_start:'<a href="#" onclick="MM.ui.dialogs.dialogPreferences(); return false;">',url_end:"</a>"}),Message.NOTICE,15)}})}))}},b=function(){var e=this.el._listener;Math.abs(this.widthAtLastLineDraw-this.el.getWidth())>5&&(e.node.isRoot()?(App.config.layout.name===App.Layouts.LeftAligned.name?e.translateChildNodes({x:-(this.el.getWidth()-this.widthAtLastLineDraw),y:0},App.Layouts.orientation.left):e.translateChildNodes({x:this.el.getWidth()-this.widthAtLastLineDraw,y:0},App.Layouts.orientation.right),e.redrawBoundaries()):(e.rc.redrawLines(!0),App.config.layout.name===App.Layouts.OrgChart.name&&(e.rc.translateOrgChildNodes(e.rc.vnode.dcontainer.el.getWidth()-this.containerWidthAtLastDraw),this.containerWidthAtLastDraw=e.rc.vnode.dcontainer.el.getWidth())),this.widthAtLastLineDraw=this.el.getWidth()),Math.abs(this.titleHeight-this.title.getHeight())>1&&(e.node.isRoot()?e.redrawBoundaries():e.rc&&(e.rc.redrawLines(!0),this.titleHeight=this.title.getHeight()))},w=function(){var e=this;i=f.bindAsEventListener(this),o=g.bindAsEventListener(this),s=c()(v.bindAsEventListener(this),100),this.title.observe("keyup",s),this.title.observe("paste",i),setTimeout((function(){return e.title.observe("blur",o)}),0),this.simulateNodePasteCallback=function(t){m.call(e,t.memo.clipboardData)},App.subscribe(CustomEvents.SIMULATE_TOPIC_PASTED,this.simulateNodePasteCallback)},C=function(){this.title.stopObserving("paste",i),this.title.stopObserving("blur",o),this.title.stopObserving("keyup",s),s.cancel(),App.unsubscribe(CustomEvents.SIMULATE_TOPIC_PASTED,this.simulateNodePasteCallback)},x={enterEditMode:function(){var e;if(!r&&(r=!0,a=!1,this.disableDragging&&this.disableDragging(),this.title.setAttribute("contenteditable","true"),this.el.addClassName("editing"),this.titleHeight=this.title.getHeight(),this.titleWidth=this.title.getWidth()+1,this.widthAtLastLineDraw=this.el.getWidth(),this.nodeWidth=this.el.getWidth(),-1!==this.title.innerHTML.indexOf('<br class="js-automatic-break ">')||this.titleWidth>270?(this.title.textContent=this.getValue(),this.title.setStyle({"max-width":this.titleWidth+"px"})):this.title.setStyle({"max-width":"270px"}),this.title.focus(),w.apply(this),canvas.__onStartEdit(),e=this.title,window.getSelection().selectAllChildren(e),this.getResizer({className:this.el.className,style:{borderImage:"",borderStyle:"",border:"none"}}),show(App.resizer),!this.el._listener.node.isRoot()&&(this.containerWidthAtLastDraw=this.el._listener.rc.vnode.dcontainer.el.getWidth(),App.config.layout.name===App.Layouts.Aligned.name&&this.el._listener.rc.orientation===App.Layouts.orientation.left))){var t=$("tk_map"),n=t.offsetLeft;t.style.left="auto",t.style.right="calc(100% - "+(n+t.offsetWidth)+"px)"}},getValue:function(){var e=this.title.innerHTML.replace(/&nbsp;|<br class="js-automatic-break ">/g," ").replace(/<br>/g,"\n").safeUnescapeHTML();return this.el._listener.node.normalizeWhitespaces(e).trim()},setValue:function(e){r&&(this.title.textContent=e)},getWrappedValue:function(){var e=this.title.getWidth()+1,t=parseFloat(window.getComputedStyle(App.resizer).getPropertyValue("padding-left"));return e+=parseFloat(window.getComputedStyle(App.resizer).getPropertyValue("padding-right"))+t+6,this.insertWraps(this.getValue(),e)},commit:function(){var e={x:0,y:0};this.el._listener.node.isRoot()||this.el._listener.rc.orientation===App.Layouts.orientation.left&&(e=y.call(this));var t=this.getWrappedValue();t!==this.el._listener.node.getTitle(!0)?(this.el._listener.node.commitEdit(t,[-e.x,-e.y],this._editingAction,this.el._listener.node.isFloating()),_.call(this,this.getValue())):0===this.el._listener.node.getTitle().length&&0===t.length?this.el._listener.node.parent.__onRemoveChild(this.el._listener.node):this.updateTitle()},leaveEditMode:function(e){if(r){if(r=!1,a=!1,this.el._listener.rc&&App.config.layout.name===App.Layouts.Aligned.name&&this.el._listener.rc.orientation===App.Layouts.orientation.left){var t=$("tk_map"),n=t.offsetLeft;t.style.left=n+"px",t.style.right="auto"}e&&this.getValue().length>0?this.commit():0===this.el._listener.node.getTitle().length?this.el._listener.node.parent.__onRemoveChild(this.el._listener.node):this.updateTitle(),this.enableDragging&&this.enableDragging(),this.title.style.removeProperty("max-width"),this.title.setAttribute("contenteditable","false"),this.el.removeClassName("editing"),this.title.blur(),MM.utils.clearSelection(),C.call(this),canvas.__onStopEdit(),this.el._listener.refreshLayout()}},setCursor:function(e,t){var n=window.getSelection(),i=document.createRange(),o=this.title.childNodes[0];i.setStart(o,e),i.setEnd(o,t),n.removeAllRanges(),n.addRange(i)}};t.default=x},"+c4W":function(e,t,n){var i=n("711d"),o=n("4/ic"),s=n("9ggG"),r=n("9Nap");e.exports=function(e){return s(e)?i(r(e)):o(e)}},"/9aa":function(e,t,n){function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n("NykK"),s=n("ExA7"),r="[object Symbol]";e.exports=function(e){return"symbol"==i(e)||s(e)&&o(e)==r}},"/Fw/":function(e,t,n){e.exports=n.p+"ce89a0f6a13a86dfe2875097a1c0a403.png"},"/K9o":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n("AGWK"),o=n("PiLb"),s=n("0qNx");function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?c(e):t}(this,l(n).call(this,e))).loadImage=t.loadImage.bind(c(t)),t.onImageLoaded=t.onImageLoaded.bind(c(t)),t.state={loaded:!1},t}var h,u,p;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,t),h=n,(u=[{key:"loadImage",value:function(){o.a.add({image:{src:this.props.image},onLoad:this.onImageLoaded})}},{key:"onImageLoaded",value:function(){this.setState({loaded:!0})}},{key:"componentDidMount",value:function(){setTimeout(this.waypoint._handleScroll.bind(this.waypoint),250)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.image!==this.props.image&&(this.setState({loaded:!1}),o.a.add({image:{src:e.image},onLoad:this.onImageLoaded}))}},{key:"componentWillUnmount",value:function(){this.state.loaded||o.a.remove({src:this.props.image})}},{key:"render",value:function(){var t=this,n=this.props,o=n.className,r=n.width,a=n.height,l=n.placeholder,c=n.image;return this.state.loaded?e.createElement("img",{className:o,src:c}):e.createElement("div",{className:"p-r ".concat(o," w-").concat(r," h-").concat(a)},e.createElement(s.a,{ref:function(e){return t.waypoint=e},onEnter:this.loadImage}),l||e.createElement(i.a,{size:"24",opts:{className:"mr-15 h-a-center"}}))}}])&&a(h.prototype,u),p&&a(h,p),n}(e.Component)}).call(this,n("q1tI"))},"/kAC":function(e,t,n){var i=n("3cYt")({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=i},"0JQy":function(e,t){var n="[\\ud800-\\udfff]",i="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",o="\\ud83c[\\udffb-\\udfff]",s="[^\\ud800-\\udfff]",r="(?:\\ud83c[\\udde6-\\uddff]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",l="(?:"+i+"|"+o+")"+"?",c="[\\ufe0e\\ufe0f]?"+l+("(?:\\u200d(?:"+[s,r,a].join("|")+")[\\ufe0e\\ufe0f]?"+l+")*"),d="(?:"+[s+i+"?",i,r,a,n].join("|")+")",h=RegExp(o+"(?="+o+")|"+d+c,"g");e.exports=function(e){return e.match(h)||[]}},"0ZTe":function(e,t,n){var i=n("wy8a"),o=n("quyA"),s=n("Em2t"),r=n("dt0z");e.exports=function(e){return function(t){t=r(t);var n=o(t)?s(t):void 0,a=n?n[0]:t.charAt(0),l=n?i(n,1).join(""):t.slice(1);return a[e]()+l}}},"0qNx":function(e,t,n){"use strict";(function(e,i){var o=n("17x9"),s=n.n(o);function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h="above",u="inside",p="below",f="invisible",m={threshold:s.a.number,onEnter:s.a.func,onLeave:s.a.func,onPositionChange:s.a.func,fireOnRapidScroll:s.a.bool,scrollableAncestor:s.a.any},g=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?c(e):t}(this,l(n).call(this,e)))._handleScroll=t._handleScroll.bind(c(t)),t}var o,s,f;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,t),o=n,(s=[{key:"UNSAFE_componentWillMount",value:function(){if(this.props.scrollableParent)throw new Error("The `scrollableParent` prop has changed name to `scrollableAncestor`.")}},{key:"componentDidMount",value:function(){n.getWindow()&&(this.scrollableAncestor=this._findScrollableAncestor(),this.scrollableAncestor.addEventListener("scroll",this._handleScroll))}},{key:"componentDidUpdate",value:function(){n.getWindow()&&this._handleScroll(null)}},{key:"componentWillUnmount",value:function(){n.getWindow()&&(this.scrollableAncestor&&this.scrollableAncestor.removeEventListener("scroll",this._handleScroll),window.removeEventListener("resize",this._handleScroll))}},{key:"_findScrollableAncestor",value:function(){if(this.props.scrollableAncestor)return this.props.scrollableAncestor;for(var e=i.findDOMNode(this);e.parentNode;)if((e=e.parentNode)!==document&&e!==document.documentElement){var t=window.getComputedStyle(e),n=t.getPropertyValue("overflow-y")||t.getPropertyValue("overflow");if("auto"===n||"scroll"===n)return e}return window}},{key:"_handleScroll",value:function(e){var t=this._currentPosition(),n=this._previousPosition||null;if(this._previousPosition=t,n!==t){var i={currentPosition:t,previousPosition:n,event:e};this.props.onPositionChange.call(this,i),t===u?this.props.onEnter.call(this,i):n===u&&this.props.onLeave.call(this,i);var o=n===p&&t===h,s=n===h&&t===p;this.props.fireOnRapidScroll&&(o||s)&&(this.props.onEnter.call(this,{currentPosition:t,previousPosition:n,event:e}),this.props.onLeave.call(this,{currentPosition:t,previousPosition:u,event:e}))}}},{key:"_currentPosition",value:function(){var e,t,o=i.findDOMNode(this).getBoundingClientRect().top;this.scrollableAncestor===window?(e=window.innerHeight,t=0):(e=this.scrollableAncestor.offsetHeight,t=i.findDOMNode(this.scrollableAncestor).getBoundingClientRect().top);var s=e*this.props.threshold,r=t+e;return 0===e?n.invisible:t<=o+s&&o-s<=r?n.inside:r<o-s?n.below:o+s<t?n.above:n.invisible}},{key:"render",value:function(){return e.createElement("span",{style:{fontSize:0}})}}])&&a(o.prototype,s),f&&a(o,f),n}(e.Component);g.propTypes=m,g.above=h,g.below=p,g.inside=u,g.invisible=f,g.getWindow=function(){if("undefined"!==typeof window)return window},g.defaultProps={threshold:0,onEnter:function(){},onLeave:function(){},onPositionChange:function(){},fireOnRapidScroll:!0},g.displayName="Waypoint",t.a=g}).call(this,n("q1tI"),n("i8i4"))},"0s9k":function(e,t,n){"use strict";n.r(t);var i,o=n("sEfC");function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=!1,l=!1,c=n.n(o)()((function(){a=!1}),250),d=function(e){var t=e.metaKey||e.ctrlKey||e.shiftKey||e.altKey;l=a?l&&t:t,a=!0,c();var n=Event.wheel(e,i.container);if(l)var o=-(n.deltaY||n.deltaX)>=1?1:-1;else if(MM.ua.touchEvents())o=e.scale>=1?1:-1;"undefined"!==typeof o?i.onZoom(e,o):MM.ua.isPlatform("Macintosh")&&i.onScroll(e,n)};t.default={init:function(e){i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(n,!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({container:document.body,onZoom:function(){return null},onScroll:function(){return null}},e)},enable:function(){i.container.observe(MM.ua.getEvent().mousewheel,d)},disable:function(){c.cancel(),i.container.stopObserving(MM.ua.getEvent().mousewheel,d)}}},"16Al":function(e,t,n){"use strict";var i=n("WbBG");function o(){}function s(){}s.resetWarningCache=o,e.exports=function(){function e(e,t,n,o,s,r){if(r!==i){var a=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw a.name="Invariant Violation",a}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:o};return n.PropTypes=n,n}},"17x9":function(e,t,n){e.exports=n("16Al")()},"1Hvr":function(e,t,n){"use strict";n.r(t);var i=n("nyiR"),o=n("zYya");t.default=Class.create({el:null,pos:null,arrindex:null,connection:null,initialize:function(e,t,n){this.arrindex=t,this.connection=n,this.pos=e,this.uid=this.connection.raphael_id,this.el||(this.el=new Element("div",{id:"connection_handler_".concat(this.uid,"_").concat(this.arrindex),className:"connection_handle",width:"20px",height:"20px"})),canvas.el.appendChild(this.el),this.draggable=new Draggable(this.el,{onStart:this._onStart.bind(this),onDrag:this._onDrag.bind(this),onEnd:this._onEnd.bind(this),starteffect:!1,endeffect:!1,revert:this._onRevert.bind(this),reverteffect:this._onRevertUpdate.bind(this)}),Event.observe(this.el,"mousedown",this._onMouseDown.bind(this)),this.move(e),this.hide(),this.mouseStartX=0,this.mouseStartY=0,this.dx=0,this.dy=0,this.revertPrevPos=e,this.firstdrag=!0,this.revertX=0,this.revertY=0},getElementAndRootPositions:function(){var e={x:parseInt(this.el.style.left)+parseInt(this.el.getAttribute("width"))/2,y:parseInt(this.el.style.top)+parseInt(this.el.getAttribute("height"))/2},t=i.Graphics.connectionstack.get(this.uid)[0].attrs.path,n=i.Graphics.connectionstack.get(this.uid)[1][4].attrs.path;return[e,{x:t[0][1],y:t[0][2]},{x:n[3][1],y:n[3][2]}]},getElementRadius:function(){return parseInt(Math.sqrt(Math.pow(parseInt(this.el.getAttribute("width"))/2,2)+Math.pow(parseInt(this.el.getAttribute("height"))/2,2)))},getDistance:function(e,t){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},RaphaelHandler:function(e,t){i.Graphics.connectionstack.get(this.uid)[1][this.arrindex].update(e,t)},RaphaelHandlerAbsolute:function(e,t){i.Graphics.connectionstack.get(this.uid)[1][this.arrindex].updateAbsolute(e,t)},saveControlPointPositions:function(e,t){var n=i.Graphics.connectionstack.get(this.uid)[1],s=i.Graphics.connectionstack.get(this.uid)[0].attr("stroke"),r=n[2].attrs.cx,a=n[2].attrs.cy,l=n[3].attrs.cx,c=n[3].attrs.cy;this.connection.setProperties({cp_from_x:parseInt(r-e.x),cp_from_y:parseInt(a-e.y),cp_to_x:parseInt(l-t.x),cp_to_y:parseInt(c-t.y),cp_scale_x:parseInt(t.x-e.x),cp_scale_y:parseInt(t.y-e.y),color:s?s.substr(1):o.DEFAULT_COLOR})},_onMouseDown:function(e){this.dragging=!0,App.connectionPopover&&App.connectionPopover.close(),Event.observeOnce(document,"mouseup",this._onMouseUp.bind(this))},_onMouseUp:function(){this.dragging=!1},_onStart:function(e,t){canvas.disableScrollByDrag(),this.mouseStartX=Event.pointerX(t),this.mouseStartY=Event.pointerY(t)},_onDrag:function(e,t){var n,o=this.getElementAndRootPositions(),s=o[0],r=o[1],a=o[2],l=this.getElementRadius();2==this.arrindex&&(n=this.getDistance(s,r)),3==this.arrindex&&(n=this.getDistance(s,a)),n<i.Graphics.connectionstack.get(this.uid)[2][0].attrs.r+l?(2==this.arrindex&&i.Graphics.connectionstack.get(this.uid)[2][0].show(),3==this.arrindex&&i.Graphics.connectionstack.get(this.uid)[2][1].show()):(2==this.arrindex&&i.Graphics.connectionstack.get(this.uid)[2][0].hide(),3==this.arrindex&&i.Graphics.connectionstack.get(this.uid)[2][1].hide()),this.dx=Event.pointerX(t)-this.mouseStartX,this.dy=Event.pointerY(t)-this.mouseStartY,this.RaphaelHandlerAbsolute(s.x,s.y),this.mouseStartX+=this.dx,this.mouseStartY+=this.dy,this.firstdrag&&(this.revertX+=this.dx,this.revertY+=this.dy)},_onEnd:function(e,t){canvas.enableScrollByDrag();var n=this.getElementAndRootPositions()[0];this.RaphaelHandlerAbsolute(n.x,n.y),this.mouseStartX=0,this.mouseStartY=0,this.dx=0,this.dy=0},_onRevert:function(e){var t,n=this.getElementAndRootPositions(),o=n[0],s=n[1],r=n[2],a=this.getElementRadius();return 2==this.arrindex&&(t=this.getDistance(o,s)),3==this.arrindex&&(t=this.getDistance(o,r)),t>i.Graphics.connectionstack.get(this.uid)[2][0].attrs.r+a?(this.revertPrevPos=o,this.firstdrag=!1,this.saveControlPointPositions(s,r),!1):(i.Graphics.connectionstack.get(this.uid)[2][0].hide(),i.Graphics.connectionstack.get(this.uid)[2][1].hide(),!0)},_onRevertUpdate:function(e,t,n){this.move(this.revertPrevPos),this.firstdrag?(this.RaphaelHandler(-this.revertX,-this.revertY),this.revertX=0,this.revertY=0,this.firstdrag=!0):(this.RaphaelHandler(-n,-t),this.firstdrag=!1)},move:function(e){this.el.style.left=e.x-parseInt(this.el.getAttribute("width"))/2+"px",this.el.style.top=e.y-parseInt(this.el.getAttribute("height"))/2+"px"},hide:function(){this.el.addClassName("hidden")},show:function(){this.el.removeClassName("hidden")},destroy:function(){Element.discard(this.el),this.connection=this.pos=null}})},"1aen":function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("8dLz"),r=n("rJb1"),a=Class.create(o.default,{initialize:function($super,e,t){$super("colors",e,t)},load:function($super){var e=this;this.list=this.el.select("div")[0],this.renderColors(),this.initTabs(),r.a.get("colors_widget_tab",(function(t){e.selectTab(t?t.value:e.tabs[0])})),$super()},initTabs:function(){this.tabs=["color","backgroundColor"],this.tabs.each(function(e){Element.bindOnClick(mm$("btn-"+e.toLowerCase()),this.selectTab.bind(this,e))}.bind(this))},selectTab:function(e){this.selectedTab!==e&&this.tabs.include(e)&&(this.selectedTab&&removeClassName(mm$("btn-"+this.selectedTab.toLowerCase()),"selected"),this.selectedTab=e,r.a.save({name:"colors_widget_tab",value:this.selectedTab}),addClassName(mm$("btn-"+this.selectedTab.toLowerCase()),"selected"),this.onSelectNode())},setValue:function(e){canvas.onSetStyle(this.selectedTab,e)},renderColors:function(t){e.render(i.createElement(s.a,{selectedColor:t,onItemClick:this.setValue.bind(this)}),this.list)},onSelectNode:function(){if(canvas.selected){var e=canvas.selected.node.currentStyle();this.renderColors(e[this.selectedTab])}}});t.default=a}.call(this,n("i8i4"),n("q1tI"))},"1tAg":function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("8dLz"),r=n("ERGR"),a=n("2L+8"),l=n("39z+"),c=n("syde"),d=(n("xV1c"),[10,12,14,18]),h={left:"text-left-aligned",right:"text-right-aligned",center:"text-centered",justify:"text-justify"},u="000000",p=12,f=Class.create(o.default,{initialize:function($super,e,t){$super("notes",e,t),this.field=$("note_content"),this.blurListener=this.onBlur.bind(this),this.keymap=new MM.utils.KeyMap(this.field,"notes_keymap",[{key:MM.utils.KeyEvent.TAB,stopEvent:!0,fn:function(){return MM.utils.replaceSelection("\t")}},{key:"s",ctrl:!0,fn:this.onBlur.bind(this)}]),this.keymap.disable(),Element.bindOnClick("btn_removenote",this.removeNote.bind(this)),Element.bindOnClick("btn_autonote",this.getAutoNote.bind(this)),Element.bindOnClick("btn_dlg_notes_widget",this.showDialog.bind(this)),this.state={color:u}},load:function($super){this.initCE(),$super()},focus:function(){this.show(!0),this.field.focus()},onFocus:function(){_Event.observeBlur(this.field,this.blurListener),this.keymap.enable(),canvas.removeFocus()},onBlur:function(){_Event.stopObservingBlur(this.field,this.blurListener),this.field.blur(),this.keymap.disable(),canvas.addFocus(),this.save(this.getValue())},initCE:function(){this.field.contentEditable=!0,this.field.observe("focus",this.onFocus.bind(this))},showDialog:function(e){var t=this;e&&e.stop(),this.shown||(this.shown=!0,canvas.removeFocus(),n.e(224).then(n.t.bind(null,"qVCM",7)).then((function(e){window.Quill=e.default,MM.ui.dialogs.show("notes_widget",{controller:"dialog",dlg_name:"notes_widget",width:590,noHelp:!0,onComplete:t.setupDialogContent.bind(t,canvas.selected.node.note),onDestroy:function(){clearTimeout(t.selectionTimeout),t.selectionTimeout=null,t.shown=!1,t.editor_dlg=null,t.sizePopover.destroy(),t.sizePopover=null,t.alignPopover.destroy(),t.alignPopover=null,t.colorPopover.destroy(),t.colorPopover=null,MM.ui.ToolTips.destroyTouchSafe(t.tooltips),t.tooltips=null,canvas.addFocus()}})})))},setupDialogContent:function(e){if(mm$("notes_header").innerHTML=e?I18n.t("js.edit_note"):I18n.t("js.add_note"),this.initEditor(),this.buildPopovers(),this.tooltips=MM.ui.ToolTips.touchSafe({el:this.editor_dlg.modules.toolbar.container}),e){this.editor_dlg.root.innerHTML="";var t=new Element("div").update(e);t.firstChild.tagName||(t=new Element("div").update(t.outerHTML)),t.childElements().each(function(e){setTimeout(function(){this.editor_dlg.root.appendChild(e)}.bind(this),100)}.bind(this))}this.selectionTimeout=setTimeout(this.setEditorDlgSelection.bind(this),400)},initEditor:function(){this.editor_dlg=new Quill("#node_content_dlg",{modules:{toolbar:{container:"#notes_toolbar"},"link-tooltip":{template:'<span class="title" style="margin-right: 5px;">'+I18n.t("js.visit_url")+':</span><a href="#" class="url" target="_blank"></a><input class="input" type="text"><span style="margin: 0 5px;">-</span><a href="#" class="change">'+I18n.t("js.change")+'</a><a href="#" class="done">'+I18n.t("js.done")+"</a>"},"image-tooltip":{template:'<input class="input" type="textbox"><div class="preview"><span>'+I18n.t("js.preview")+'</span></div><a href="#" class="cancel">'+I18n.t("js.cancel")+'</a><a href="#" class="insert">'+I18n.t("js.insert")+"</a>"}},theme:"snow"}),this.initEditorListeners(),this.pasteManager=this.editor_dlg.getModule("paste-manager"),this.switchModeBtn=mm$("btn_switch_mode"),this.renderSwitchButton(),this.switchModeBtn.observe("click",this.onSwitchMode.bind(this)),mm$("btn_erase").observe("click",this.removeFormat.bind(this))},initEditorListeners:function(){this.editor_dlg.on("text-change",this.onTextChange.bind(this)),this.editor_dlg.on("selection-change",this.onSelectionChange.bind(this))},onTextChange:function(e,t){if(this.getDialogValue().length>65e3&&MM.ui.dialogs.showError(I18n.t("js.note_is_too_long")),!this.pasteManager.plainText){var n=this.editor_dlg.getSelection();n&&this.updateAlignBtn(n)}},onSelectionChange:function(e){if(!this.pasteManager.plainText&&e){var t=this.editor_dlg.getContents(e.end-1,e.end);if(t&&t.ops.length>0){var n=t.ops[0].attributes,i="";if(n.color)n.color.split(",").each((function(e){e=parseInt(e.replace(/[^\d]/g,"")).toString(16),i+=e.length>1?e:"0"+e}));else i=u;this.updateFontColorBtn(i),this.updateFontSizeBtn(n.size)}this.updateAlignBtn(e)}},buildPopovers:function(){var t=this;this.colorPopover=new l.c("color",{onShow:function(){e.render(i.createElement(s.a,{selectedColor:t.state.color,onItemClick:t.changeFontColor.bind(t)}),t.colorPopover.widgetContainer)}}),this.sizePopover=new l.c("size"),e.render(i.createElement(r.a,{items:d.map((function(e){return{label:i.createElement("span",{className:"fs-"+e},e,"pt"),onClick:t.changeFontSize.bind(t,e)}}))}),this.sizePopover.widgetContainer),this.alignPopover=new l.c("align"),e.render(i.createElement(r.a,{items:Object.keys(h).map((function(e){return{icon:i.createElement(a.a,{opts:{name:h[e],size:18,consize:20,color:"blue",classes:"h-a-center",parentClasses:"p-r mr-8px"}}),label:I18n.t("js.text_alignment."+e),onClick:t.changeAlignment.bind(t,e)}}))}),this.alignPopover.widgetContainer)},_getSelection:function(){return this.editor_dlg.focus(),this.editor_dlg.getSelection()},changeFontSize:function(e){var t=this._getSelection(),n=e+"px";this.editor_dlg.prepareFormat("size",n),t&&t.end>t.start&&this.editor_dlg.formatText(t.start,t.end,"size",n),this.updateFontSizeBtn(e)},changeAlignment:function(e){var t=this._getSelection();this.editor_dlg.formatLine(t,"align",e,"user"),this.updateAlignBtn(t,e)},removeNote:function(){this.saveFromValue(""),f.cache.autonote={id:null}},getAutoNote:function(){f.cache.autonote.id==canvas.selected.node.id&&f.cache.autonote.title==canvas.selected.node.title&&f.cache.autonote.items.length>1?(f.cache.autonote.items.shift(),this.saveFromValue(f.cache.autonote.items[0].content)):(ServerConnection.autoNote({query:canvas.selected.node.title},this.setAutoNote.bind(this)),$("btn_autonote").addClassName("fx-wiggle fx-infinite fx-none")),Amplitude.logEvent("wunder_note")},setAutoNote:function(e){$("btn_autonote").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),e.error||0===e.items.length?Message.show(I18n.t("js.no_auto_note_found_for_topic"),Message.INFO):(f.cache.autonote={id:canvas.selected.node.id,title:canvas.selected.node.title,items:e.items},this.saveFromValue(e.items[0].content))},getValue:function(){return this.field.innerHTML},getDialogValue:function(){return this.pasteManager.plainText?this.editor_dlg.getText().escapeHTML():this.editor_dlg.getHTML()},save:function(e){canvas.selected.node.note!==e&&(App.trigger(CustomEvents.NOTE_CHANGED),"<br>"===e&&(e=""),canvas.onSetProperty("note",e,{onOk:Windows.close.bind(Windows,"notes_widget")}))},saveFromValue:function(e){"<p>&nbsp;</p>"===e&&(e=""),this.setValue(e),this.save(e)},saveFromDialog:function(){this.saveFromValue(this.getDialogValue())},setValue:function(e){this.field&&(this.field.innerHTML=e.replace(/\n/g,"<br/>"))},onSelectNode:function(){this.setValue(canvas.selected.node.note||"")},setEditorDlgSelection:function(e){e=Object.extend({start:0,end:0},e),setTimeout(this.editor_dlg.setSelection.bind(this.editor_dlg,e.start,e.end),0)},onSwitchMode:function(e){e.stop();var t=this._getSelection();if(this.pasteManager.plainText)this.doSwitchMode(!1,t);else{if(this.editor_dlg.getText().trim().empty())return void this.doSwitchMode(!0,t);Dialog.confirm("<h2>"+I18n.t("js.convert_to_plain_text")+"</h2><p>"+I18n.t("js.convert_to_plain_text_information")+"</p>",{okLabel:I18n.t("js.si"),cancelLabel:I18n.t("js.njet"),ok:function(){this.doSwitchMode(!0,t),Dialog.closeInfo()}.bind(this),cancel:this.setEditorDlgSelection.bind(this,t),windowParameters:{width:270}})}},doSwitchMode:function(e,t){this.pasteManager.plainText=e;var n=mm$("notes_toolbar");e?(this.editor_dlg.setContents([{value:this.editor_dlg.getText().replace(/<br\/>/g,"\n")}]),addClassName(n,"h-hidden"),n.style.opacity=0,this.switchModeBtn.innerHTML=I18n.t("js.switch_to_formatted_text")):(removeClassName(n,"h-hidden"),new Effect.Opacity(n,{from:0,to:1,duration:.5}),this.switchModeBtn.innerHTML=I18n.t("js.switch_to_plain_text")),this.renderSwitchButton(),this.setEditorDlgSelection(t)},renderSwitchButton:function(){this.switchModeBtn.innerHTML=this.pasteManager.plainText?MM.ui.icon({name:"copy",size:20,parentClasses:"h-iblock mr-5px",color:"grey500"})+I18n.t("js.switch_to_formatted_text"):MM.ui.icon({name:"file-format-generic",size:20,parentClasses:"h-iblock mr-5px"})+I18n.t("js.switch_to_plain_text")},changeFontColor:function(e){var t="rgb("+parseInt(e.substring(0,2),16)+", "+parseInt(e.substring(2,4),16)+", "+parseInt(e.substring(4,6),16)+")",n=this._getSelection();this.editor_dlg.prepareFormat("color",t),n&&n.end>n.start&&this.editor_dlg.formatText(n.start,n.end,"color",t),this.updateFontColorBtn(e)},removeFormat:function(e){e.stop();var t=this._getSelection(),n=this.editor_dlg.getText(t.start,t.end);this.editor_dlg.deleteText(t.start,t.end),this.editor_dlg.insertText(t.start,n)},updateAlignBtn:function(e,t){if(!t){var n=this.editor_dlg.editor.doc.findLineAt(e.end)[0];t=n&&n.formats.align?n.formats.align:"left"}this.alignPopover.opener.update(MM.ui.icon({name:h[t],size:18,consize:18,color:"blue"}))},updateFontSizeBtn:function(e){e=parseInt(e),!isNaN(e)&&d.include(e)||(e=p),this.sizePopover.field.update(e+"pt")},updateFontColorBtn:function(e){e=c.COLORS.include(e)?e:u,this.state.color!==e&&(this.state.color=e,mm$("btn_color_bg").style.backgroundColor="#"+this.state.color)}});f.cache={autonote:{id:null}},t.default=f}.call(this,n("i8i4"),n("q1tI"))},"2Dbh":function(e,t,n){"use strict";var i=n("Ddwv"),o=n.n(i);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var a=function(e){e.preventDefault(),e.stopPropagation(),MM.ui.dialogs.dialogBrowserFeatureSupport({chrome:{version:43},firefox:{version:41},safari:{version:10},opera:{version:30},ie:{}})};t.a=function(e,t){t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(n,!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({rel:I18n.t("js.copied")},t);var n=new o.a(e,t);return n.on("success",(function(e){e.clearSelection();var n=e.trigger.textContent;t.target?n!==t.rel&&(e.trigger.textContent=t.rel,setTimeout((function(){e.trigger.textContent=n}),1e3)):t.onSuccess&&t.onSuccess()})),n.on("error",(function(e){if(t.target){var n=e.trigger,i=MM.ua.isPlatform("Macintosh")?"&#8984;":"CTRL",o=n.textContent,s="Press "+i+"-C to copy";o!==s&&(n.innerHTML=s,Event.observeOnce(t.target(),"blur",(function(){n.textContent=o})))}else t.text()&&function(e){var t=MM.ua.isPlatform("Macintosh")?"&#8984;":"CTRL",n="copy-input-"+(new Date).getTime(),i="copy-hint-"+(new Date).getTime();Dialog.alert("<h2>"+I18n.t("js.copying_not_supported")+"</h2><p>"+I18n.t("js.your_browser_does_not_support_this_feature")+" "+I18n.t("js.please_select_the_field_below_and_use_s_for_copying",{v0:"<kbd>"+t+"</kbd> + <kbd>C</kbd>"})+'</p><div column><p><input type="text" id="'+n+'" class="w-100%" onclick="this.select();" readonly value="'+e+'" /></p><p class="fs-s c-grey500">'+I18n.t("js.hint")+": "+I18n.t("js.click_here_for_supported_browsers",{v0:'<a href="#" id="'+i+'">',v1:"</a>"})+"</p></div>",{buttonClass:"button default",okLabel:I18n.t("js.done_lower").capitalize(),windowParameters:{width:400,onShow:function(){mm$(n).select(),mm$(i).onclick=a}}})}(t.text())})),n}},"2L+8":function(e,t,n){"use strict";(function(e){function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",(function(){return l}));var l=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?r(e):t}(this,s(n).call(this,e)))._handleClick=t._handleClick.bind(r(t)),t._handleMouseDown=t._handleMouseDown.bind(r(t)),t}var l,c,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(n,t),l=n,(c=[{key:"_handleClick",value:function(e){this.props.onClick&&(e.preventDefault(),e.stopPropagation(),this.props.onClick(e))}},{key:"_handleMouseDown",value:function(e){this.props.onMouseDown&&(e.preventDefault(),e.stopPropagation(),this.props.onMouseDown(e))}},{key:"render",value:function(){return e.createElement("div",{id:this.props.id,style:this.props.style,className:this.props.className,title:this.props.title,onClick:this._handleClick,onMouseDown:this._handleMouseDown,dangerouslySetInnerHTML:{__html:MM.ui.icon(this.props.opts)}})}}])&&o(l.prototype,c),d&&o(l,d),n}(e.Component)}).call(this,n("q1tI"))},"2ajD":function(e,t){e.exports=function(e){return e!==e}},"347H":function(e,t,n){"use strict";n.r(t),function(e){var i=n("S/+i"),o=n("2L+8"),s=n("0qNx");function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var h=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=l(this,c(n).call(this,e))).state={selectedIcons:[]},t}var r,h,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}(n,t),r=n,(h=[{key:"update",value:function(e){var t=this;this.state.selectedIcons.map((function(e){t[e.fullName()].setState({selected:!1})})),e.map((function(e){t[e.fullName()].setState({selected:!0})})),this.setState({selectedIcons:e})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){var t=this,n=Icon.allInSection(this.props.library,this.props.section).map((function(n,o){return e.createElement(i.default,{ref:function(e){return t[n.fullName()]=e},className:"lib_"+Icon.sectionToString(n.library,n.section),icon:n,index:o,key:"iconWidgets_expanded_"+n.id,onSelectIcon:t.props.onSelectIcon})}));return e.createElement("div",{id:"lib_"+this.props.name},e.createElement(s.a,{onEnter:function(e){e.previousPosition;var n=e.currentPosition;e.event,n===s.a.inside&&setTimeout((function(){t.props.onScrollTo(t.props.name)}),50)},onLeave:function(e){e.previousPosition;var n=e.currentPosition;e.event,n===s.a.below&&t.props.onScrollTo(t.props.prevName)}}),e.createElement("div",{className:"mt-10 ml-18 pb-0 h-flex-row"},e.createElement(o.a,{className:"mr-14",opts:{name:this.props.icon,color:"grey500",size:this.props.iconSize,clickable:!1}}),e.createElement("span",{className:"fw-medium"},I18n.t("js.icons.library."+this.props.name))),e.createElement("div",{className:"h-flex-grid icon-grid grid g-7 p-10 pt-5"},n))}}])&&a(r.prototype,h),u&&a(r,u),n}(e.Component);t.default=h}.call(this,n("q1tI"))},"39z+":function(e,t,n){"use strict";function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"c",(function(){return r}));var o=Class.create({initialize:function(e,t){this.options=Object.extend({showEffect:Effect.Appear,hideEffect:Effect.Fade,closeOnSelect:!0,autoClose:!0,autoPositioning:!0,observeEvent:"click",offset:[0,0],useEffects:!0,propagateEvents:!1,noKeymap:!1},t),this.parent=this.options.parent||$("popover_"+e),this.arrow=new Element("span",{class:"arrow"}),this.parent.insert(this.arrow),this.opener=this.options.opener||$("btn_"+e),this.field=$("fld_"+e),hasClassName(this.parent,"loading")&&(this.loadingSpinner=MM.ui.LoadingSpinner(48),this.parent.insert(this.loadingSpinner)),o.all.push(this),this.options.useEffects&&(this.parent.style.opacity=0),this.keymap=new MM.utils.KeyMap(document,"keymap_"+this.parent.id,[{key:MM.utils.KeyEvent.ESC,fn:this.close.bind(this)}]),this.keymap.disable(),this.opener&&"none"!=this.options.observeEvent&&(this.openerListener=this.togglePopover.bindAsEventListener(this),this.opener.observe(this.options.observeEvent,this.openerListener))},togglePopover:function(e){this.parent.visible()?this.close(e):this.show(e)},show:function(e){clearTimeout(this.closeTimeout);var t=!0;if(this.options.onBeforeShow){var n=this.options.onBeforeShow(e);t="undefined"===typeof n||n}if(t){if(this.opener){if(this.opener.className.indexOf("disabled")>-1)return;this.opener.addClassName("active")}this.field&&this.field.addClassName("selected"),this.parent.show(),e&&e.stop&&e.stop(),this.options.autoClose&&(o.closeOpenPopover(e,this),o.opened.push(this)),this.options.onShow&&this.options.onShow(),this.focusCanvasOnClose=!1,this.options.noKeymap||("undefined"!==typeof canvas&&canvas&&canvas.hasFocus&&(canvas.removeFocus(),this.focusCanvasOnClose=!0),this.keymap.enable()),document.observe("click",this.clickListener),"mouseover"==this.options.observeEvent&&this.opener.observe("mouseout",this.openerListener),UI.Registry.add(this),UI.Registry.notify(this,"show"),this.options.useEffects&&(this.parent.style.opacity=1)}},close:function(e){var t=this;this.opener&&this.opener.className.indexOf("tk_label")<0&&this.opener.removeClassName("active"),this.field&&this.field.removeClassName("selected"),this.keymap&&this.keymap.disable(),o.remove(this,this.focusCanvasOnClose),this.options.useEffects?(this.parent.style.opacity=0,this.closeTimeout=setTimeout((function(){return t.doClose()}),300)):this.doClose(),e&&e.stop&&e.stop(),this.options.onClose&&this.options.onClose(),document.stopObserving("click",this.clickListener),UI.Registry.notify(this,"hide"),UI.Registry.remove(this)},doClose:function(){this.parent.hide(),this.parent._clearAbove&&this.parent.removeClassName("above"),this.options.onHide&&this.options.onHide()},dispose:function(){"none"!=this.options.observeEvent&&(this.opener.stopObserving("mouseout",this.openerListener),this.opener.stopObserving("click",this.openerListener)),document.stopObserving("click",this.clickListener)},register:function(){this.opener.observe(this.options.observeEvent,this.openerListener),"mouseover"==this.options.observeEvent&&this.opener.observe("mouseout",this.openerListener)},onResize:function(){this.sizeAndPosition()},sizeAndPosition:function(e){MM.ui.positionPopover(this,{correction:e})},hasDataHandler:function(e){if(this.isInPopover(e))return"false"===getDataSet(e,"handler")||this.hasDataHandler(e.parentNode)},isInPopover:function(e){for(;e.parentNode&&e.id!=this.parent.id;)e=e.parentNode;return e.id==this.parent.id},isOpener:function(e){if(!this.opener)return!1;for(;e.parentNode&&e!=this.opener;)e=e.parentNode;return e.id==this.opener.id},onDocumentClick:function(e){var t=Event.element(e);if("path"!=t.tagName&&"shape"!=t.tagName)if((this.isInPopover(t)||this.isOpener(t))&&("input"!=t.tagName.toLowerCase()||t.type&&"text"==t.type)){if(!this.hasDataHandler(t)){this.handler&&e.stop();var n=null;if(this.popover)n=this.popover.isPopoverEntry(t);else if(this.popovers){n=null;for(var i=this.popovers.length;i>0&&!n;)i--,n=this.popovers[i].isPopoverEntry(t)}return n?(this.options.closeOnSelect&&this.close(e),n):null}this.close()}else this.close()},destroy:function(){this.dispose(),this.keymap&&(this.keymap.disable(),this.keymap=null),this.arrow.remove(),o.all.remove(this)}});o.opened=[],o.closeOpenPopover=function(e,t){var n=o.getLastOpened();n&&(n._close?n._close():n.isInPopover(t.parent)||n.close(e))},o.getLastOpened=function(){return o.opened[o.opened.length-1]},o.all=[],o.remove=function(e,t){o.opened=o.opened.without(e),t&&"undefined"!==typeof canvas&&canvas&&0===o.opened.length&&canvas.addFocus()},o.get=function(e){return o.all.detect((function(t){return t.parent.id=="popover_"+e}))};var s=Class.create(o,{initialize:function($super,e,t,n){$super(e,n),this.handler=t,this.popover=new a(this.parent,this.handler,this.options),n&&n.multiselect&&(this.popover.multiselect=!0),this.clickListener=this.onDocumentClick.bindAsEventListener(this),this.keymap.addBinding([{key:MM.utils.KeyEvent.ENTER,fn:this.onKeySelect.bindAsEventListener(this)},{key:MM.utils.KeyEvent.UP,fn:this.onKeyNavigate.bind(this,-1)},{key:MM.utils.KeyEvent.DOWN,fn:this.onKeyNavigate.bind(this,1)}])},addElements:function(e){this.loadingSpinner&&this.loadingSpinner.remove(),this.popover.addElements(e)},removeElements:function(){this.popover.removeElements(),this.index=-1},loadElements:function(e,t){this.popover.loadElements(e,t)},getElements:function(){return this.popover.elements},onDocumentClick:function($super,e){var t=$super(e);t&&!this.options.propagateEvents&&this.popover.onElementClicked(t,e)&&e&&e.stop()},show:function($super,e){$super(e),this.clearKeySelection()},close:function($super,e){$super(e)},onKeySelect:function(e){if(-1!=this.index&&this.handler){var t=this.getElements()[this.index].firstChild;if(!t||hasClassName(t,"disabled"))return;this.handler(t.id,e),this.options.closeOnSelect&&this.close(e)}e&&Event.stop(e)},onKeyNavigate:function(e){var t=this.getElements().findAll((function(e){return _Element.visible(e)}));t[this.index]&&(removeClassName(t[this.index],"selected"),removeClassName(t[this.index],"key-selected")),this.index+=e,this.index<0?this.index=t.length-1:this.index>t.length-1&&(this.index=0),t[this.index]&&(hasClassName(t[this.index],"js-noselect")?this.onKeyNavigate(e):(addClassName(t[this.index],"selected"),addClassName(t[this.index],"key-selected"),this.popover.scrollToElement(t[this.index])))},clearKeySelection:function(){this.getElements().each((function(e){hasClassName(e,"key-selected")&&(removeClassName(e,"selected"),removeClassName(e,"key-selected"))})),this.index=-1}}),r=(Class.create(s,{initialize:function($super,e,t,n){this.onSelectElement=t,$super(e,this.onSelect.bind(this),n)},onSelect:function(e){this.onSelectElement&&this.onSelectElement(e),this.select(e)},select:function(e){var t=$(e).clone(!0);t.id="",(this.opener.select("span").length>0?this.opener.select("span")[0]:this.opener).update(t)}}),Class.create(o,{initialize:function($super,e,t){$super(e,t),this.clickListener=this.onDocumentClick.bindAsEventListener(this),this.widgetContainer=new Element("div"),this.parent.appendChild(this.widgetContainer)},onDocumentClick:function(e){if(o.getLastOpened()===this){var t=Event.element(e);Element.ancestors(t).include(this.parent)&&!e.closePopover||this.close()}}})),a=Class.create({multiselect:!1,initialize:function(e,t,n){this.parent=e,this.handler=t,this.options=n,this.elements=[]},loadElements:function(e,t){new Ajax.Request(e,{onSuccess:function(e){var n=e.responseText.evalJSON();this.addElements(n),this.parent.removeClassName("loading"),t&&t()}.bind(this)})},parseElements:function(){this.list=this.parent.select("ul")[0],this.listContainer=this.list.parentNode,this.elements=this.list.select("li")},addElements:function(e){this.listContainer=this.listContainer||new Element("div"),this.list=this.list||new Element("ul"),this.listContainer.appendChild(this.list),this.parent.appendChild(this.listContainer);for(var t=0,n=e.length;t<n;t++)this.addElement(e[t]);this.parent.hasClassName("submenus")&&this.bindSubItems(),this.setupItemTooltips()},addElement:function(e){var t=new Element("li");Object.isElement(e)?t.appendChild(e):t.update(e),this.elements.push(t),this.list.appendChild(t),hasClassName(t.firstDescendant(),"js-noselect")&&addClassName(t,"js-noselect")},moveElement:function(e){this.parent.insert(e,{bottom:this.parent}),e.show()},removeElements:function(){this.list&&(this.list.remove(),this.list=null,this.listContainer.remove(),this.listContainer=null,this.elements=[],this.tooltips&&(MM.ui.ToolTips.destroyTouchSafe(this.tooltips),this.tooltips=null))},removeElement:function(e){for(var t=0;t<this.list.childElements().length&&this.list.childElements()[t].firstDescendant().id!=e;)t++;t<this.list.childElements().length&&this.list.childElements()[t].remove()},onElementClicked:function(e,t){return!!hasClassName(e,"disabled")||"object"==i(e)&&"input"!==e.tagName.toLowerCase()&&(this.parent.hasClassName("menu")||(this.multiselect?-1!=e.parentNode.className.indexOf("selected")?removeClassName(e.parentNode,"selected"):addClassName(e.parentNode,"selected"):(this.elements.each((function(e){removeClassName(e,"selected")})),addClassName(e.parentNode,"selected"))),this.handler&&this.handler(e.id,t),!0)},setTitle:function(e,t){var n=new Element("div",{class:"header "+(t||"")});t&&(n.className=t+" ib"),n.update(e),this.parent.insert({top:n})},setTextContent:function(e){var t=new Element("p");t.update(e),this.parent.appendChild(t)},isPopoverEntry:function(e){if(this.elements.length>0){for(;e.parentNode&&"LI"!=e.parentNode.tagName;)e=e.parentNode;return e.parentNode&&(-1!=this.elements.indexOf(e.parentNode)||this.isSubItemEntry(e.parentNode))?e:null}if(Element.ancestors(e).include(this.parent))return e},isSubItemEntry:function(e){return e.parentNode.hasClassName("popover")},bindSubItems:function(){this.parent.select("li > a").each(function(e){e.observe("mouseover",this.onHoverItem.bind(this,e))}.bind(this))},onHoverItem:function(e){if(-1==e.className.indexOf("disabled")&&(this.parent.select("ul.submenu").each((function(t){t.descendantOf(e)||e.descendantOf(t)||t.hide()})),hasClassName(e,"subitem"))){var t=e.getWidth(),n=e.down(".submenu");n.setStyle({top:"-1px",left:t-2+"px"}).show(!0),Element.cumulativeOffset(n)[0]+n.getWidth()>MM.ui.page.width&&n.setStyle({left:2-n.getWidth()+"px"})}},scrollToElement:function(e){e.offsetTop+e.getHeight()>this.list.getHeight()?this.list.scrollTop=e.offsetTop+e.getHeight()-this.list.getHeight():e.offsetTop<this.list.scrollTop&&(this.list.scrollTop=e.offsetTop)},setupItemTooltips:function(){if(this.options.tooltips){var e=Object.extend({el:this.list},this.options.tooltips);this.tooltips=MM.ui.ToolTips.touchSafe(e)}}})},"3L66":function(e,t,n){var i=n("MMmD"),o=n("ExA7");e.exports=function(e){return o(e)&&i(e)}},"3Uto":function(e,t,n){"use strict";n.r(t);var i=n("mbwg"),o=n("vpdt"),s=n("4AML"),r=function(e){var t=s.default.getPlainClipboardData(e);s.default.simulatePaste(t),Event.stop(e)},a=function(e,t){var n=t?e.escapeHTML():e;return EmojiArea.getHTMLContent(n)},l=function(e,t){var n=e.createdAt,i=e.id,o=e.text,s=e.user,r=new Element("div",{id:"comment_".concat(i),className:"comment_line mb-15".concat(i<0?" unsaved":"")});return r.innerHTML='<div row class="align-items-start">'+s.getAvatar("large mr-8")+'<div column grow><div row class="comment_date">'+n.ago(!0)+function(e){return e.isEdited()?'<span class="ml-5" title="'+I18n.t("js.edited")+": "+e.updatedAt.ago(!0)+'">'+MM.ui.icon({name:"pen",size:8,color:"grey500",clickable:!1})+"<span>":""}(e)+'</div><p class="mb-5px">'+I18n.t("js.said",{v0:s.displayname})+'</p><textarea id="edit_comment_'+i+'_textarea" style="display: none;">'+function(e,t){var n=e.gsub(/\\n/,"\n");return t?n.escapeHTML():n}(o,t)+'</textarea><div class="h-flex-row comment p-10 h-flex-start"><div id="edit_comment_'+i+'" class="h-flex-grow">'+a(o,t)+'</div><a id="edit_comment_opener_'+i+'" class="p-5 comment_edit"><div class="icon"></div></a></div><div class="icon_container hidden"><div row><div class="h-flex-grow"><a id="edit_comment_'+i+'_emoji" class="icon-svg h-iblock" data-icon="smiley-face" data-size="24" data-color="grey500" href="#"></a></div><input id="edit_comment_'+i+'_cancel" type="button" class="button mh-10" value="'+I18n.t("js.cancel")+'" tabindex="-1" onclick="sideBar.comments.cancelEditing(event); return false;"/><input id="edit_comment_'+i+'_commit" type="button" class="button default" value="'+I18n.t("js.save")+'" tabindex="-1" onclick="sideBar.comments.onCommit(event); return false;"/></div></div></div></div>',r},c=Class.create(i.default,{expandable:!0,animationShow:CSS.translate({x:"0",y:0}),animationHide:CSS.translate({x:"100%",y:0}),animationFunction:"ease",initialize:function($super,e,t){$super("comments",e,t),this.commentEditors=[],["new_comment","new_comment_expanded"].each(function(e){var t=new EmojiArea(mm$("".concat(e,"_textarea")),{editor:mm$(e)});t.editor.observe("focus",this.onFocus.bind(this)),t.editor.observe("blur",this.onBlur.bind(this)),t.editor.observe("paste",r),this.commentEditors.push(t)}.bind(this)),Element.bindOnClick("expand_comments",this.expand.bind(this)),Element.bindOnClick("vote_count",this.expand.bind(this)),mm$("filter_votes_expanded").onchange=this.filter.bind(this);var n=MM.utils.KeyEvent;this.keymap=new MM.utils.KeyMap(document,"comments_keymap",[{key:n.ESC,stopEvent:!1,handler:this.cancelEditing.bind(this),withEvent:!0},{key:n.ENTER,notShift:!0,handler:this.onCommit.bind(this),withEvent:!0},{key:n.TAB,stopEvent:!0,handler:function(){return MM.utils.replaceSelection("\t")}}]),this.keymap.disable(),this.popover=new Popover("commentsmenu",this.doEditActions.bind(this),{offset:[14,20]}),$$("div.vote.like").each(function(e){e.observe("click",this.onVote.bindAsEventListener(this,IdeaVote.UP))}.bind(this)),$$("div.vote.unlike").each(function(e){e.observe("click",this.onVote.bindAsEventListener(this,IdeaVote.DOWN))}.bind(this))},onVote:function(e,t){e.preventDefault(),e.stopPropagation(),canvas.onSetVote(t)},getEditActionsElements:function(e){var t=[];return e.user.id===users.selfUser.id&&t.push(new Element("a",{href:"#",id:"comment_edit"}).update(I18n.t("js.edit"))),t.push(new Element("a",{href:"#",id:"comment_delete"}).update(I18n.t("js.delete"))),t},doEditActions:function(e){var t=this.popover.opener,n=parseInt(t.id.replace("edit_comment_opener_",""));if(!n||"number"!==typeof n)return!1;switch(e){case"comment_edit":this.edit(n);break;case"comment_delete":var i=o.default.get(n);canvas.selected.node.removeComment(i)}return!1},onSelectNode:function(){if(this.expanded){mm$("all_comments").innerHTML="";var e=canvas.selected.node.comments.concat(canvas.selected.node.votes);e.sort((function(e,t){return(e instanceof o.default?e.createdAt:e.voted_at)-(t instanceof o.default?t.createdAt:t.voted_at)})),e.each(function(e){e instanceof o.default?(e.read=!0,this.addCommentLine(e)):e instanceof IdeaVote&&this.addVoteLine(e)}.bind(this))}canvas.selected.node._listener.__onSetProperty("comments",!0),this.updateCommentCount(),this.updateVotesBar()},onAddComment:function(e){canvas.selected.node.comments.indexOf(e)<0||(this.addCommentLine(e,e.isUnsaved()),this.updateCommentCount())},onEditComment:function(e){if(!(canvas.selected.node.comments.indexOf(e)<0)){var t=mm$("comment_"+e.id);if(t){var n=e.user.id===users.selfUser.id;t.replace(l(e,n)),n&&addClassName(mm$("comment_"+e.id),"unsaved"),this.bindCommentOpener(e)}else this.addCommentLine(e);this.updateCommentCount()}},onRemoveComment:function(e){var t=mm$("comment_"+e.id);t&&new Effect.SlideUp("comment_"+e.id,{duration:.5,afterFinish:function(){remove(t)}}),this.updateCommentCount()},onFocus:function(e){var t=this.affectedEditor(e);t&&(canvas.removeFocus(),this.keymap.enable(),addClassName(t.editor,"active"))},onBlur:function(e){canvas.addFocus(),this.keymap.disable(),MM.utils.clearSelection();var t=this.affectedEditor(e);t&&removeClassName(t.editor,"active")},onCommit:function(e){var t=this.affectedEditor(e);if(t){var n=t.editor,i=t.textarea,s=i.value.replace(/\s+$/,"");if(""!==s){var r=null;n.id.match("edit_comment_")&&(r=parseInt(n.id.replace("edit_comment_",""))),"number"!==typeof r&&(r=--o.default.uncommitedId);var a=o.default.get(r);n.blur();var l=[];a?a.text!==s&&(l.push(new EditCommentChange({idea_id:canvas.selected.node.id,type:"EditComment",new_data:{idea_comment_id:a.id,text:s},old_data:{idea_comment_id:a.id,text:a.text}})),this.commentEditors=this.commentEditors.without(t)):(n.innerHTML="",i.value="",l.push(new AddCommentChange({idea_id:canvas.selected.node.id,type:"AddComment",new_data:{text:s,user_id:users.selfUser.id,idea_id:canvas.selected.node.id,id:r}}))),l.length>0&&(addClassName(mm$("comment_"+r),"unsaved"),ChangeList.layoutAlteringChangeset(l))}}},edit:function(e){var t=o.default.get(e);if(t&&t.user.id===users.selfUser.id){this.removeUnsavedOverlay(t),mm$("popover_edit_comment_"+e+"_emoji")||mm$("comments_expanded").insert(new Element("div",{id:"popover_edit_comment_"+e+"_emoji",className:"popover sections emoji_menu"}));var n=new EmojiArea(mm$("edit_comment_"+e+"_textarea"),{editor:mm$("edit_comment_"+e),menuOpener:mm$("comment_"+e+"_emoji")});n.editor.observe("focus",this.onFocus.bind(this)),n.editor.observe("blur",this.onBlur.bind(this)),n.editor.observe("paste",r),this.commentEditors.push(n),n.editor.focus(),removeClassName(mm$("comment_".concat(t.id)).select(".icon_container")[0],"hidden");var i=document.createRange();i.selectNodeContents(n.editor),MM.utils.addSelection(i)}},cancelEditing:function(e){var t=this.affectedEditor(e);if(t){var n=t.editor,i=t.textarea,s=t.menu;n.blur();var l=parseInt(n.id.replace("edit_comment_","")),c=o.default.get(l);if(c){this.removeUnsavedOverlay(c),n.setAttribute("contenteditable","false"),n.innerHTML=a(c.text,!0).gsub(/\n/,"<br/>");var d=$("comment_".concat(c.id));d&&addClassName(d.select(".icon_container")[0],"hidden"),n.stopObserving("focus"),n.stopObserving("blur"),n.stopObserving("paste",r),i.value=c.text,removeClassName(n,"active"),s.dispose(),MM.utils.clearSelection(),this.commentEditors=this.commentEditors.without(t)}}},onCommentAdded:function(e,t){var n=mm$("comment_"+t);n&&(n.id="comment_"+e.id,mm$("edit_comment_"+t).id="edit_comment_"+e.id,mm$("edit_comment_"+e.id).innerHTML=a(e.text,!1),mm$("edit_comment_"+t+"_textarea").id="edit_comment_"+e.id+"_textarea",mm$("edit_comment_opener_"+t).id="edit_comment_opener_"+e.id,mm$("edit_comment_"+t+"_emoji").id="edit_comment_"+e.id+"_emoji",mm$("edit_comment_"+t+"_commit").id="edit_comment_"+e.id+"_commit",this.removeUnsavedOverlay(e))},onCommentEdited:function(e){mm$("comment_"+e.id)&&(mm$("edit_comment_"+e.id).innerHTML=a(e.text,!1),this.removeUnsavedOverlay(e))},updateCommentCount:function(){var e=canvas.selected.node.comments.length;0===e?(mm$("expand_comments").innerHTML="",hide(mm$("expand_comments")),MM.ui.disableButton("expand_comments")):(mm$("expand_comments").innerHTML=e>1?I18n.t("js.comments",{v0:e}):I18n.t("js.comment",{v0:e}),show(mm$("expand_comments")),MM.ui.enableButton("expand_comments"))},addCommentLine:function(e,t){var n=mm$("all_comments");n.insertBefore(l(e,t),n.firstChild),this.bindCommentOpener(e)},bindCommentOpener:function(e){var t=mm$("edit_comment_opener_"+e.id);t&&(t.onclick=function(){this.popover.opener=t,this.popover.visible||(this.popover.removeElements(),this.popover.addElements(this.getEditActionsElements(e))),this.popover.togglePopover(),this.popover.sizeAndPosition()}.bind(this))},onAddVote:function(e){canvas.selected.node.votes.indexOf(e)<0||(this.addVoteLine(e,!0),this.updateVotesBar(!0))},onEditVote:function(e){if(!(canvas.selected.node.votes.indexOf(e)<0)){var t=mm$("vote_"+e.user.id+"_"+e.idea_id);t?t.replace(this.voteLine(e)):this.addVoteLine(e),this.updateVotesBar(!0)}},onRemoveVote:function(e){var t=mm$("vote_"+e.user.id+"_"+e.idea_id);t&&remove(t),this.updateVotesBar(!0)},updateVotesBar:function(e){var t=canvas.selected.node.votes.length,n=IdeaVote.getByVote(canvas.selected.node,IdeaVote.DOWN).length,i=IdeaVote.get(canvas.selected.node,users.selfUser.id),o=t+(1===t?" "+I18n.t("js.vote"):" "+I18n.t("js.votes"));($$("#votes .vote, #votes_expanded .vote").each((function(e){removeClassName(e,"active")})),i&&i.user.id===users.selfUser.id)&&(i.vote>0?$$("#votes .vote.like, #votes_expanded .vote.like"):$$("#votes .vote.unlike, #votes_expanded .vote.unlike")).each((function(e){addClassName(e,"active")}));IdeaVote.maxVotes>0&&($$(".vote_progress_bar.orange").each(function(t){this.redrawVotesBar(t,n,e)}.bind(this)),$$(".vote_progress_bar.green").each(function(n){this.redrawVotesBar(n,t,e)}.bind(this))),mm$("vote_count").innerHTML=o,mm$("vote_count_expanded").innerHTML=o,mm$("filter_votes_expanded").checked&&this.updateFilterView()},redrawVotesBar:function(e,t,n){n?addClassName(e,"animated"):removeClassName(e,"animated"),e.style.width=t/IdeaVote.maxVotes*100+"%"},addVoteLine:function(e){var t=mm$("all_comments");t.insertBefore(this.voteLine(e),t.firstChild)},voteLine:function(e){var t=new Element("div",{id:"vote_"+e.user.id+"_"+e.idea_id,className:"votes_widget h-flex-row align-items-start mb-25"});return t.innerHTML='<div class="w-40">'+e.user.getAvatar("large")+'</div><div column grow><span class="comment_date">'+e.voted_at.ago(!0)+"</span><span>"+I18n.t("js.voted",{v0:e.user.displayname})+"</span></div>"+MM.ui.icon({name:"like",size:16,consize:28,classes:"h-a-center",parentClasses:"h-cd p-r vote active"+(e.vote===IdeaVote.UP?" like":" unlike")}),t},removeUnsavedOverlay:function(e){removeClassName(mm$("comment_"+e.id),"unsaved")},filter:function(){mm$("filter_votes_expanded").checked?this.updateFilterView():this.removeFilterView()},updateFilterView:function(){var e=tree.root.defaultStyle().fontSize;tree.root.eachChild(function(t){if(t.votes.length>0){var n=IdeaVote.getByVote(t,IdeaVote.UP).length,i=t.votes.length-n,o=e+(n>0?e*(n/IdeaVote.maxVotes):0)-(i>0?e*(i/IdeaVote.maxVotes):0);t._listener.dcontent.el.style.fontSize=(o>0?o:50)+"%",t._listener.dcontent.el.style.opacity<1&&(t._listener.dcontent.el.style.opacity=1)}else t._listener.dcontent.el.style.opacity=.5,t._listener.dcontent.el.style.fontSize=e+"%";t._listener.refreshLayout(),t.isRootC()?t._listener.rc.redrawRootLine():t.isRoot()&&canvas.root.reposition()}.bind(this))},removeFilterView:function(){tree.root.eachChild(function(e){e.style?Style.applyToElement(e.style,e._listener.dcontent.el):Style.removeFromElement(e._listener.dcontent.el),e._listener.dcontent.el.style.opacity=1,e._listener.refreshLayout(),e.isRootC()?e._listener.rc.redrawRootLine():e.isRoot()&&canvas.root.reposition()}.bind(this))},affectedEditor:function(e){if(e.target)return this.commentEditors.detect((function(t){return e.target.id===t.editor.id||e.target.id==="".concat(t.editor.id,"_commit")||e.target.id==="".concat(t.editor.id,"_cancel")}))}});t.default=c},"3WX/":function(e,t,n){var i=n("ut/Y"),o=n("oKwy"),s=n("d8FT");e.exports=function(e,t){return s(e,o(i(t)))}},"3cYt":function(e,t){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},"3cgG":function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("ClT6"),s=n("mbwg"),r=n("lLo4"),a=n("2L+8"),l=n("V0xI");function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(l){o=!0,s=l}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var d=Class.create(s.default,{initialize:function($super,e,t){$super("attachments",e,t),this.dropzone=mm$("file_dropzone"),this.list=mm$("attachment_list"),Modernizr.draganddrop?(addClassName(this.el,"droppable"),this.enableFileDrop()):hide(this.dropzone)},show:function($super,e){l.a.init({onPick:this.onDropboxAttach.bind(this)}),$super(e),this.visible&&this.buildPopover()},buildPopover:function(){var t=this,n=["local-file","dropbox","google-drive","evernote"];ServerData.isLoggedIn&&ServerData.user.unilogin&&n.push("skoletube"),e.render(i.createElement(r.a,{className:"ph-10 pt-15",onShow:function(){return App.trigger(CustomEvents.FILE_UPLOAD)},opener:i.createElement(a.a,{className:"tooltip",title:I18n.t("js.add_file")+"...",opts:{name:"plus",size:16,color:"blue"}})},i.createElement("div",{className:"h-flex-row"},n.map((function(e,n){return i.createElement("div",{key:n,className:"mh-10 h-flex-column align-items-center ws-nowrap h-cp",onClick:t.onPopoverSelect.bind(t,e)},i.createElement(a.a,{className:"rad-15px h-overflow",opts:{name:"service-".concat(e),size:60}}),i.createElement("div",{className:"fs-s mt-8"},I18n.t("js.from_"+e.gsub("-","_"))))})))),mm$("attachments-menu-container"))},onPopoverSelect:function(e){var t=this;if(GeneralPopover.closeOpenPopover(),App.hasFeature("attachments"))switch(e){case"local-file":var i=new Element("input",{type:"file",multiple:"multiple"});i.onchange=function(){return t.upload(i.files,!0)},i.click();break;case"google-drive":MM.ui.googlePicker.create();break;case"dropbox":l.a.create();break;case"evernote":MM.ui.dialogs.show("upload_evernote",{controller:"dialog",width:350,noHelp:!0});break;case"skoletube":Promise.all([n.e(24).then(n.bind(null,"A0kH")),n.e(14).then(n.bind(null,"2lpU"))]).then((function(e){var n=c(e,1)[0];t.skoletubeSearch=n.default,t.skoletubeSearch.init({onAttach:t.uploadFromUrl.bind(t)}),t.skoletubeSearch.showDialog()}))}else MM.ui.dialogs.dialogUpgrade({feature:"map_attachments",s:"map_".concat(App.config.map_id)})},updateListing:function(){var e=canvas.selected.node;this.list.innerHTML="",e.attachments.each(function(e){this.addAttachmentName(e)}.bind(this)),!Modernizr.draganddrop||e.attachments.length>0?hide(this.dropzone):show(this.dropzone)},reset:function(e){this.toUploadAttachments=[],this.failedAttachments=[],this.toUploadAttachmentsSize=e||0},beforeUpload:function(){_Element.visible(this.dropzone)&&hide(this.dropzone)},upload:function(e,t,n){if(App.hasFeature("attachments")){if(canvas.selected&&e&&0!==e.length){this.reset();var i="";n=n?Array.isArray(n)?n:[n]:canvas.getSelectedNodes(),this.beforeUpload();for(var o=0,s=e.length;o<s;o++){var r=e[o];if(t)var a=this.createProgressBar();var l=MM.utils.File.uploadAttachmentFile(n,r,{onProgress:this.updateProgress.bind(this,a),timeoutDelay:60,onTimeOut:this.onAttachmentFailed.bind(this,n,r,a),successCallback:this.onFileUploadSuccessful.bind(this,a),errorCallback:this.onFileUploadFailed.bind(this,a,r,n)});l&&l.error?(a&&Element.remove(a),i+=(i?"<br />":"")+l.error):this.toUploadAttachmentsSize++}return i&&Message.show(i,Message.ERROR),mm$("attachment_file")&&(mm$("attachment_file").value=""),this.toUploadAttachmentsSize}}else MM.ui.dialogs.dialogUpgrade({feature:"map_attachments",s:"map_".concat(App.config.map_id)})},uploadFromUrl:function(e){canvas.selected?(this.reset(e.length),e.each(function(e){var t=e.name+(e.extension?"."+e.extension:"");this.uploadExternalFile("generic_files/upload_from_url",e,{requestHeaders:{"X-File-Name":t.replace(/[^\x00-\xff]/g,"?")},parameters:{attachment_url:e.url,attachment_name:e.name,attachment_extension:e.extension}})}.bind(this))):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},tryAddAttachment:function(e){this.toUploadAttachmentsSize===this.toUploadAttachments.length+this.failedAttachments.length&&(Tree.utils.addAttachments(this.toUploadAttachments,e),this.showFailedAttachmentsMessage(),this.reset(),App.trigger(CustomEvents.ATTACHMENT_UPLOADED))},onFileUploadSuccessful:function(e,t,n){this.addAttachment(n,new o.default(t),e)},onFileUploadFailed:function(e,t,n){this.onAttachmentFailed(n,t,e)},addAttachment:function(e,t,n){this.changeProgressId(n,t),this.toUploadAttachments.push(t),this.tryAddAttachment(e)},onAttachmentFailed:function(e,t,n){n&&Element.remove(n),this.failedAttachments.push(t),this.tryAddAttachment(e)},showFailedAttachmentsMessage:function(){if(0!==this.failedAttachments.length){var e="<br/>"+this.failedAttachments.map((function(e){return e.name})).join("<br/>");Message.show(I18n.t("js.the_following_files_failed_s",{v0:e}),Message.ERROR,5)}},onAddAttachment:function(e){this.removeProgress(e),this.addAttachmentName(e)},addAttachmentName:function(e){if(canvas.selected.node.attachments.find((function(t){return t.id===e.id}))){var t=new Element("div",{id:"attachment_".concat(e.id),className:"h-flex-row mb-5 h-hover-parent p-r"}),n=new Element("a",{id:"remove_".concat(t.id),href:"#",className:"h-show-on-hover p-a ar-0",title:I18n.t("js.remove_attachment")}).insert(MM.ui.icon({name:"closer",size:12})),i=new Element("a",{href:"#",className:"ellipsis maxw-90% ml-10 c-grey500",title:e.size.toHumanSize(1)}).update(e.filename);i.onclick=function(){return App.ui.Preview.showPopup(e.id,canvas.selected.node.id)},n.onclick=function(){return canvas.selected.node.removeAttachment(e),!1},t.insert(MM.ui.icon({name:"file-format-".concat(e.getFileType()),size:20})),t.appendChild(i),t.appendChild(n),this.list.appendChild(t)}},onRemoveAttachment:function(e){var t=mm$("attachment_"+e.id);t&&(Element.remove(t),0===canvas.selected.node.attachments.length&&show(this.dropzone))},createProgressBar:function(){var e=new Element("progress",{min:0,max:100,value:0});return this.list.appendChild(e),e},changeProgressId:function(e,t){e&&(e.id=this.createProgressBarId(t))},createProgressBarId:function(e){return"attachment_progress_"+e.id},updateProgress:function(e,t){e&&(t-=5)>e.value&&(e.value=t)},removeProgress:function(e){var t=mm$(this.createProgressBarId(e));t&&Element.remove(t)},onSelectNode:function(){this.updateListing()},enableFileDrop:function(){this.el.addEventListener("dragover",(function(e){e.preventDefault()}),!1),this.el.addEventListener("drop",this.onFileDrop.bind(this),!1)},onFileDrop:function(e){var t=e.dataTransfer;if(t.files&&t.files.length>0){var n=t.files;this.upload(n,!0)}e.stopPropagation(),e.preventDefault()},onDropboxAttach:function(e){this.reset(1),this.uploadExternalFile("/external/dropbox/attachment",e,{parameters:{file:e.link,name:e.name}})},onGoogleDriveAttach:function(e){this.reset(1),this.uploadExternalFile("/external/drive/attachment",e,{parameters:{file_id:e.id}})},onEvernoteAttach:function(e,t){this.reset(1),this.uploadExternalFile("/external/evernote/attachment",e||t,{parameters:{guid:e.guid,business:t}})},uploadExternalFile:function(e,t,n){this.beforeUpload();var i=this.createProgressBar(),o=canvas.getSelectedNodes();n=Object.extend({onProgress:function(e){e.lengthComputable&&this.updateProgress(i,100*e.loaded/e.total)}.bind(this),successCallback:this.onFileUploadSuccessful.bind(this,i),errorCallback:this.onFileUploadFailed.bind(this,i,t,o)},n);MM.utils.File.uploadAttachment(o,e,n)},onSkoletubeLogin:function(){MM.external.Skoletube.Groups&&MM.external.Skoletube.Groups.load("attachments",this.skoletubeSearch.doSearch.bind(this.skoletubeSearch))},onCancelSkoletubeLogin:function(){MM.ui.dialogs.close("skoletubelogin"),MM.ui.dialogs.close("upload_skoletube")}});t.default=d}.call(this,n("i8i4"),n("q1tI"))},"4/ic":function(e,t,n){var i=n("ZWtO");e.exports=function(e){return function(t){return i(t,e)}}},"44Ds":function(e,t,n){var i=n("e4Nc"),o="Expected a function";function s(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(o);var n=function n(){var i=arguments,o=t?t.apply(this,i):i[0],s=n.cache;if(s.has(o))return s.get(o);var r=e.apply(this,i);return n.cache=s.set(o,r)||s,r};return n.cache=new(s.Cache||i),n}s.Cache=i,e.exports=s},"4AML":function(e,t,n){"use strict";n.r(t);var i=n("PYYe"),o=n.n(i),s=n("TxdS"),r=n("CJ9X"),a={init:function(){MM.ua.isMobile||(this._pasteGhost||this.__createPasteGhost(),this.setupPastingAreaListener=this.setupPastingArea.bind(this),this.onCopyHandlerListener=this.onCopyHandler.bind(this),this.onCutHandlerListener=this.onCutHandler.bind(this),this.onPasteHandlerListener=this.onPasteHandler.bind(this))},enable:function(){MM.ua.isMobile||(document.observe("keydown",this.setupPastingAreaListener),document.observe("copy",this.onCopyHandlerListener),document.observe("cut",this.onCutHandlerListener),document.observe("paste",this.onPasteHandlerListener))},disable:function(){MM.ua.isMobile||(document.stopObserving("keydown",this.setupPastingAreaListener),document.stopObserving("copy",this.onCopyHandlerListener),document.stopObserving("cut",this.onCutHandlerListener),document.stopObserving("paste",this.onPasteHandlerListener))},setupPastingArea:function(e){var t=e.target.tagName;!canvas.hasFocus||!canvas.selected||canvas.selected.dcontent.isEditing()||["LABEL","INPUT"].indexOf(t)>=0||(this._pasteGhost.focus(),this._pasteGhost.innerHTML=" ",window.getSelection().selectAllChildren(this._pasteGhost))},onCopyHandler:function(e){canvas.hasFocus&&canvas.selected&&!canvas.selected.dcontent.isEditing()&&(this.onCopy(e),e.stop())},onCutHandler:function(e){canvas.hasFocus&&canvas.selected&&!canvas.selected.dcontent.isEditing()&&(this.onCut(e),e.stop())},onPasteHandler:function(e){var t=this;if(canvas.hasFocus&&canvas.selected&&!canvas.selected.dcontent.isEditing()){var n=e.clipboardData||window.clipboardData,i=n.items;if(n.types&&n.types.indexOf&&n.types.indexOf("public.tiff")>=0&&n.types.indexOf("public.url")>=0)return e.stop(),Message.show(I18n.t("js.feature_not_supported_in_this_browser",{browsers:"Google Chrome, Firefox, Opera "+I18n.t("js.or")+" Internet Explorer"}),Message.INFO);if(i){for(var o=0,s=i.length;o<s;o++){var r=i[o];if(r.type.indexOf("image")>=0){this.__onBeforePasteImage(r.getAsFile());break}if("text/plain"===r.type){this.onPaste(e);break}}e.stop()}else setTimeout((function(){t._pasteGhost.select("p").length>0&&function(e){for(var t=e.select("p"),n="",i=0,o=t.length;i<o;i++)n+=t[i].textContent+"\n";e.innerHTML=n}(t._pasteGhost);var n=t._pasteGhost.childNodes[0];if(n)switch(n.nodeName){case"IMG":case MM.ua.isBrowser("Safari")?"A":"":var i=n.src||n.href;if(e.stop(),i.indexOf("webkit-fake-url")>=0)return Message.show(I18n.t("js.feature_not_supported_in_this_browser",{browsers:"Google Chrome, Firefox, Opera "+I18n.t("js.or")+" Internet Explorer"}),Message.INFO);t.__pasteImageFromBase64(i)||t.__checkPastedImageUrl(i);break;default:t.onPaste(e),e.stop()}}),0)}},onCut:function(e){if(!canvas.selected)return Message.show(I18n.t("js.must_select_something_first"),Message.NOTICE);var t=canvas.allSelected.without(canvas.root);if(0===t.length)return Message.show(I18n.t("js.cant_cut_root_node"),Message.NOTICE);this.__resetCutTopics(),this.cut=t.map((function(e){return e.node.id})),this.setClipboardData(e,this.__createClipboardDataString(t)),t.each((function(e){new Effect.Opacity(e.dcontainer.el,{from:1,to:.5})}))},onCopy:function(e){if(!canvas.selected)return Message.show(I18n.t("js.must_select_something_first"),Message.NOTICE);this.__resetCutTopics(),this.setClipboardData(e,this.__createClipboardDataString(canvas.allSelected))},onPaste:function(e){if(!canvas.selected)return Message.show(I18n.t("js.must_select_destination"),Message.NOTICE),!1;var t=this.getClipboardData(e);if(t.empty())return Message.show(I18n.t("js.pasted_invalid_content"),Message.WARNING),!1;if(this.isPastingTopics(t))this.onPasteTopics(t);else{if(sideBar&&sideBar.videos){var n=Object(r.checkLink)(t);if(n.video&&n.source)return void sideBar.videos.createVideoFromLink(n,function(e){Tree.utils.setVideo(e,canvas.allSelected.map((function(e){return e.node}))),canvas.highlightTopics()}.bind(this))}if(this.__pasteImageFromBase64(t))return;if(t.toLink()!==t)return void this.__checkPastedImageUrl(t);canvas.onAdd(),App.trigger(CustomEvents.SIMULATE_TOPIC_PASTED,{clipboardData:t})}},isPastingTopics:function(e){return/mm_id:\s+(-)?\d+/.test(e)},onPasteTopics:function(e){var t=!1,n=[];if(e.replace(/^(x|c)(.*)/,function(e,n,i){return t="x"===n,i.replace(/mm_id:\s+/g,"")}.bind(this)).split(",").map((function(e){e=parseInt(e),isNaN(e)||n.push(e)})),this.cut=t&&n.length>0?n:null,0===n.length)return Message.show(t?I18n.t("js.node_cut_unavailable"):I18n.t("js.node_copied_unavailable"),Message.NOTICE),!1;this.pasteTopics(n)},pasteTopics:function(e){var t=!e.any((function(e){return!tree.root.getVisibleChild(e)})),n=canvas.selected.node;if(!t)return this.cut&&Message.show(I18n.t("js.please_note_manually_delete_topics_in_original_map"),Message.NOTICE),ServerConnection.copyExternal(n.id,e);var i=e.map((function(e){return tree.root.getChild(e)}));if(this.cut){var o=[];i.each((function(e){new Effect.Opacity(e._listener.dcontainer.el,{from:.5,to:1}),n.isChildOrSelf(e)?Message.show(I18n.t("js.cant_paste_in_same_tree"),Message.WARNING):n.equals(e.parent)?Message.show(I18n.t("js.ambiguos_action"),Message.WARNING):o.push(e)})),Tree.utils.moveNodes(o,n,n.isRoot()?0:n.children.length)}else this.doPasteTopics(i)},doPasteTopics:function(e){var t=canvas.allSelected.map((function(e){return e.node.id>=0?e.node:e.node.parent}));Tree.utils.copyNodes(e,t),App.trigger(CustomEvents.TOPICS_COPIED,{callback:function(){var e=tree.root.getChild(tree.uncommitedId+1);e&&e._listener.select()}})},onPasteImage:function(e){if(this.tmpCopiedImg){var t={images:[],files:[]};switch(e){case"image":t.images.push(this.tmpCopiedImg);break;case"attachment":t.files.push(this.tmpCopiedImg)}canvas.onFileDrop(canvas.selected.node,t),this.tmpCopiedImg=null}},onPasteStyle:function(){if(this._copied)if(this._copied.length>1)Message.show(I18n.t("js.please_copy_only_one_topic"),Message.NOTICE);else{var e=tree.root.getChild(this._copied[0]);if(e){var t=canvas.allSelected.map((function(e){return e.node}));Tree.utils.setFullStyle(e.currentStyle(),t)}else Message.show(I18n.t("js.node_copied_unavailable"),Message.NOTICE)}},getClipboardData:function(e){var t="";return e.clipboardData&&(t=e.clipboardData.getData("text/plain")),(t.empty()?this._pasteGhost.innerHTML.replace(/<br>/g,"\n").unescapeHTML():t).trim()},getPlainClipboardData:function(e){var t="";return e.clipboardData?t=e.clipboardData.getData("text/plain"):window.clipboardData&&(t=window.clipboardData.getData("Text")),t},setClipboardData:function(e,t){e.clipboardData?e.clipboardData.setData("text/plain",t):window.clipboardData&&window.clipboardData.setData("Text",t)},simulatePaste:function(e){var t=document.createTextNode(e),n=window.getSelection(),i=n.getRangeAt(0);i.deleteContents(),i.insertNode(t),i.setStartAfter(t),n.removeAllRanges(),n.addRange(i)},execCommand:function(e,t){if(!(["copy","cut"].indexOf(e)<0)){t=t||{};var n=!1;try{n=document.execCommand(e)}catch(i){}finally{!n&&t.onError&&t.onError()}}},__createPasteGhost:function(){this._pasteGhost=new Element("div",{id:"paste_ghost"}),this._pasteGhost.contentEditable=!0,document.body.appendChild(this._pasteGhost)},__createClipboardDataString:function(e){this._copied=[];var t=[];return e.each(function(e){var n=e.node.id;this._copied.push(n),t.push("mm_id: "+n)}.bind(this)),(this.cut?"x":"c")+t.join(",")},__resetCutTopics:function(){this.cut&&(this.cut.each((function(e){var t=tree.root.getVisibleChild(e);t&&t._listener.dcontainer.el.getStyle("opacity")<1&&new Effect.Opacity(t._listener.dcontainer.el,{from:.5,to:1})})),this.cut=null)},__pasteImageFromBase64:function(e){if(/^data:image\/(png|jpg|jpeg|gif);base64,/.test(e)){for(var t=e.split(","),n=atob(t[1]),i=t[0].split(";")[0].split(":")[1],o=new ArrayBuffer(n.length),s=new Uint8Array(o),r=0;r<n.length;r++)s[r]=n.charCodeAt(r);return this.__onBeforePasteImage(new Blob([o],{type:i})),!0}},__checkPastedImageUrl:function(e){var t=function(t){if(sideBar&&sideBar.images&&t){var i=new Element("canvas");i.width=n.width,i.height=n.height,i.getContext("2d").drawImage(n,0,0,n.width,n.height),this.__pasteImageFromBase64(i.toDataURL("image/png"))}else Tree.utils.setProperty("link",e,canvas.allSelected.map((function(e){return e.node}))),canvas.highlightTopics(),sideBar&&sideBar.links&&sideBar.links.onSelectNode()}.bind(this),n=new Image;n.onerror=n.onabort=t.bind(this,!1),n.onload=t.bind(this,!0),n.src="/images/download_url?url=".concat(o()(e))},__onBeforePasteImage:function(e){e&&(e.name||(e.name="image.".concat(e.type?e.type.split("/")[1]:"png")),this.tmpCopiedImg=e,s.default.showCustom([new Element("a",{href:"#",id:"btn_menu_copy_as_image"}).update(I18n.t("js.paste_as_image")),new Element("a",{href:"#",id:"btn_menu_copy_as_attachment"}).update(I18n.t("js.paste_as_attachment"))],{opener:canvas.selected.dcontent.el}))}};t.default=a},"4qC0":function(e,t,n){var i=n("NykK"),o=n("Z0cm"),s=n("ExA7"),r="[object String]";e.exports=function(e){return"string"==typeof e||!o(e)&&s(e)&&i(e)==r}},"4sDh":function(e,t,n){var i=n("4uTw"),o=n("03A+"),s=n("Z0cm"),r=n("wJg7"),a=n("shjB"),l=n("9Nap");e.exports=function(e,t,n){for(var c=-1,d=(t=i(t,e)).length,h=!1;++c<d;){var u=l(t[c]);if(!(h=null!=e&&n(e,u)))break;e=e[u]}return h||++c!=d?h:!!(d=null==e?0:e.length)&&a(d)&&r(u,d)&&(s(e)||o(e))}},"4tVC":function(e,t,n){"use strict";n.r(t),n.d(t,"GoogleSearch",(function(){return i})),n.d(t,"GoogleWebSearch",(function(){return o}));var i=Class.create({type:null,supported:["ImageSearch","WebSearch"],requestLimit:4,requestLimitCookie:"google_cse",initialize:function(e){if(this.engineId="production"===ServerData.env||"production_new"===ServerData.env?"015429506454637695210:3pbowazuebg":"007810728781113314522:euuaxd-rpc8",this.apiKey="production"===ServerData.env||"production_new"===ServerData.env?"AIzaSyBwCN1sb2dpT-LTh40UrJb48dC1sIYU9Xo":"AIzaSyDHKj0GxzU5NdnIpCVzO1Bbgyy7CfOCK6k",!(e.type&&this.supported.indexOf(e.type)>-1))throw"Unsupported or missing Google Search Engine";this.type=e.type,this.options=Object.extend({resultCount:20,maxResults:60},e);var t=parseInt(MM.utils.getCookie(this.requestLimitCookie));this.index=1,this.results=[],this.requestCount=isNaN(t)?0:t},query:function(e,t,n){if(e){if(n=n||{},this.options.limitRequests&&this.requestCount>=this.requestLimit)return this.queryText=null,this.searchComplete(this.results,n.onComplete),void MM.ui.dialogs.dialogUpgrade({feature:"map_google_cse",s:"map_".concat(App.config.map_id)});var i={q:e,alt:"json",cx:this.engineId,key:this.apiKey,start:n.index||1};"ImageSearch"===this.type&&(i.searchType="image");var o="https://www.googleapis.com/customsearch/v1?"+(Object.toQueryString(i)+(t?"&fields="+t:"")),s=new XMLHttpRequest;MM.utils.setCookie(this.requestLimitCookie,++this.requestCount,1),s.open("GET",o,!0),s.onreadystatechange=function(){if(4===s.readyState){var t=JSON.parse(s.responseText);if(200===s.status){this.results=this.results.concat(t.items||[]);var i=t.queries.nextPage;i&&(this.index=i[0].startIndex),i&&this.results.length<this.options.resultCount&&!this.options.disablePages?(n.index=this.index,this.query(e,n)):this.searchComplete(this.results,n.onComplete)}else t.error&&403===t.error.code&&new Ajax.Request("/images/notify_google_rate"),Windows.windows.length>0?MM.ui.dialogs.showError(I18n.t("js.s_could_not_be_contacted",{v0:"Google"})):Message.show(I18n.t("js.s_could_not_be_contacted",{v0:"Google"}),Message.ERROR),n.onError&&n.onError()}}.bind(this),s.send()}},searchComplete:function(e,t){this.results=[],t&&t(e)}}),o=Class.create(i,{initialize:function($super,e){$super(Object.extend({type:"WebSearch"},e))},query:function($super,e,t){var n=encodeURIComponent("queries,items")+"("+encodeURIComponent("title,link,snippet")+")";this.queryText=e,$super(e,n,t)},searchComplete:function($super,e,t){$super(e=e.collect((function(e){return{title:e.title,link:e.link,description:e.snippet}})),t)}})},"4uTw":function(e,t,n){var i=n("Z0cm"),o=n("9ggG"),s=n("GNiM"),r=n("dt0z");e.exports=function(e,t){return i(e)?e:o(e,t)?[e]:s(r(e))}},"5ehg":function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("dYE5"),r=n("P2n3"),a=n("HmSg"),l=n("CJ9X"),c=n("rJb1"),d=Class.create(o.default,{sources:["url","youtube","vimeo","dailymotion"],resultCount:10,initialize:function($super,e,t){var i=this;$super("videos",e,t),ServerData.isLoggedIn&&ServerData.user.unilogin?n.e(14).then(n.bind(null,"2lpU")).then((function(){i.sources.push("skoletube"),i.initSearchers()})):this.initSearchers()},initSearchers:function(){this.sources.without("url").each(function(e){this[e+"Search"]=new r.default({searcher:e,onItemSelect:this.selectVideo.bind(this),ui:!1,onSearch:function(){this.unselectVideo(this.selectedVideo),MM.ui.disableButton("btn_set_video")}.bind(this),caching:"skoletube"!==e})}.bind(this))},load:function($super){Element.bindOnClick("btn_remove_video",this.removeVideo.bind(this)),Element.bindOnClick("btn_auto_video",this.setAutoVideo.bind(this)),Element.bindOnClick("btn_dlg_videolibrary",this.dialogVideoSearch.bind(this)),mm$("btn_dlg_videolibrary").update(I18n.t("js.browse_videos")),$super()},setAutoVideo:function(){canvas.selected?($("btn_auto_video").addClassName("fx-wiggle fx-infinite fx-none"),canvas.allSelected.each(function(e){this.youtubeSearch.query(e.node.getSingleLineTitle(),{per_page:1,onComplete:this.doSetAutoVideo.bind(this,e.node)})}.bind(this)),Amplitude.logEvent("wunder_video")):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},doSetAutoVideo:function(e,t){if(t.length>0){var n=new s.default({url:this.youtubeSearch.options.embedURL+t[0].url,source:"youtube",size:{width:320,height:200},title:t[0].title});canvas.onSetVideo(n,e)}else Message.show(I18n.t("js.no_auto_video_found_for_topic"),Message.NOTICE);$("btn_auto_video").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),this.youtubeSearch.search.queryText=null},removeVideo:function(){canvas.selected?canvas.onSetVideo():Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},dialogVideoSearch:function(){var e=this;canvas.removeFocus(),MM.ui.dialogs.show("video_search",{dlg_name:"video_search",width:710,keymap:new MM.utils.KeyMap(document,"video_search_keymap",[]),onComplete:this.onDialogShow.bind(this),onClose:function(){return e.clearResults()}})},onDialogShow:function(){var e=this;this.searchField=mm$("url_field"),this.searchField.observe("keyup",this._onKeyUp.bind(this)),this.sources.without("url").each(function(e){var t=this[e+"Search"];t.ui=!0,t.options.element=mm$(e+"_field"),t.observeSearchField()}.bind(this)),c.a.get("video_searcher",(function(t){e._renderSourceDropdown(t?t.value.toLowerCase():"youtube")}))},_renderSourceDropdown:function(t){e.render(i.createElement(a.a,{sources:this.sources,selectedSource:t||"youtube",onChange:this.setPopoverValue.bind(this)}),mm$("btn-source-container"))},setPopoverValue:function(e){if(e){var t={youtube:"YouTube",vimeo:"Vimeo",dailymotion:"Dailymotion",url:"URL"}[e.value]||e.value;c.a.save({name:"video_searcher",value:t}),this.updateVideoSource(e.value)}},_onKeyUp:function(){var e=mm$("url_videos"),t=Object(l.checkLink)(this.searchField.value);if(t.video&&t.source){var n=this[t.source+"Search"].options.embedURL+t.video;n!==this.videoURL&&(MM.ui.disableButton("btn_set_video"),this.pasteURL=this.searchField.value,this.videoURL=n,e.update(MM.ui.LoadingSpinner(48)),this.createVideoFromLink(t,function(t){this.selectedVideo=t,e.update(this.selectedVideo.getElement()),MM.ui.enableButton("btn_set_video")}.bind(this)))}else MM.ui.disableButton("btn_set_video"),this.videoURL=null,this.selectedVideo=null,e.textContent=ServerData.isLoggedIn&&ServerData.user.unilogin?I18n.t("js.invalid_video_url_skoletube"):I18n.t("js.invalid_video_url")},updateVideoSource:function(e){var t=this.activeSource||e;if(this.hideSearcher(t),this.activeSource=e,this.showSearcher(e),"url"===e)this.searchField.value=this.pasteURL||"";else{var n=this[t+"Search"],i=this[this.activeSource+"Search"].options.element;n?i.value=n.options.element.value||canvas.selected.node.getSingleLineTitle():i.value||(i.value=canvas.selected.node.getSingleLineTitle()),ServerData.isLoggedIn&&ServerData.user.unilogin&&"skoletube"===e&&!MM.external.Skoletube.Groups.skoletubeGroups?MM.external.Skoletube.Groups.load("videos",this.searchSkoletube.bind(this)):this.search()}},search:function(e){var t=this[this.activeSource+"Search"],n=t.options.element.value;n||!t.options.caching?t.query(n,Object.extend({per_page:this.resultCount},e)):this.showMessage(I18n.t("js.no_video_was_found"))},searchSkoletube:function(e){this.search({group_id:e.toString()})},selectVideo:function(e,t){t.stop(),this.unselectVideo(this.selectedVideo),this.selectedVideo=e,addClassName(this.selectedVideo.el.parentNode,"selected"),MM.ui.enableButton("btn_set_video")},unselectVideo:function(e){e&&e.el.parentNode&&removeClassName(e.el.parentNode,"selected"),this.selectedVideo=null},showMessage:function(e){mm$("video_message").update(e),Effect.Appear("video_message",{duration:2}),setTimeout((function(){Effect.Fade("video_message",{duration:1})}),4e3)},addVideo:function(){this.selectedVideo?(canvas.onSetVideo(this.selectedVideo),Windows.close("video_search")):this.showMessage(I18n.t("js.no_video_selected"))},clearResults:function(){this.sources.without("url").each(function(e){this[e+"Search"].destroy()}.bind(this)),this.pasteURL=null,this.videoURL=null,this.selectedVideo=null,ServerData.isLoggedIn&&ServerData.user.unilogin&&MM.external.Skoletube.Groups.destroy(),canvas.addFocus()},onSelectNode:function(){var e=canvas.selected.node;this.updateVideoContent(e.idea_video)},updateVideoContent:function(e){var t=mm$("video_source");e?(removeClassName(mm$("videos_content"),"o-30"),t.innerHTML=MM.ui.icon({name:"service-"+e.source,size:22,clickable:!1,parentClasses:"h-a-center rad-100%"}),mm$("title_video").textContent=e.title.truncate(50)):(addClassName(mm$("videos_content"),"o-30"),t.innerHTML=MM.ui.icon({name:"play",size:16,color:"grey500",parentClasses:"h-a-center js-add-image"}),mm$("title_video").textContent=I18n.t("js.no_video"),Element.bindOnClick(t.select(".js-add-image")[0],this.dialogVideoSearch.bind(this)))},createVideoFromLink:function(e,t){var n=this[e.source+"Search"],i=new s.default({url:n.options.embedURL+e.video,source:e.source,size:{width:480,height:272}}),o="skoletube"===e.source?e.url:e.video.split(/[#?]/)[0];n.search.queryVideoDetails(o,{fields:["title"],onComplete:function(e){i.title=e.length>0?e[0].title:I18n.t("js.unknown_video"),t&&t(i)}.bind(this)})},showSearcher:function(e){show(mm$(e+"_search")),show(mm$(e+"_videos"))},hideSearcher:function(e){hide(mm$(e+"_search")),hide(mm$(e+"_videos"))},onSkoletubeLogin:function(){this.updateVideoSource("skoletube"),this.skoletubeSearch.search.queryText="",MM.external.Skoletube.Groups.load("videos",this.searchSkoletube.bind(this))},onCancelSkoletubeLogin:function(){MM.ui.dialogs.close("skoletubelogin"),this.skoletubeSearch.search.queryText="",this._renderSourceDropdown("youtube")}});t.default=d}.call(this,n("i8i4"),n("q1tI"))},"6acW":function(e,t,n){var i=n("dt0z"),o=n("gQMU");e.exports=function(e){return o(i(e).toLowerCase())}},"6qam":function(e,t){e.exports=function(e){return null===e}},"6r2b":function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var i=n("Y+p1"),o=n.n(i),s=n("ERGR"),r=n("rW35");function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f={left:{left:0,transform:"translateX(-100%)"},right:{right:0,transform:"translateX(100%)"}},m=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=d(this,h(n).call(this,e))).state={orientation:e.orientation},t}var i,a,m;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,t),i=n,(a=[{key:"shouldComponentUpdate",value:function(e,t){return!o()(this.state,t)}},{key:"componentDidMount",value:function(){var e=this.container.getBoundingClientRect(),t=document.body.getBoundingClientRect(),n=UI.Registry.viewportOffset,i=this.state.orientation;e.left+e.width<t.width-n.right?i="right":e.left-e.width>n.left&&(i="left"),this.setState({orientation:i})}},{key:"render",value:function(){var t=this,n=this.props,i=n.padding,o=n.selectable,a=n.items,c=this.state.orientation,d=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(n,!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({top:-i},f[c]);return e.createElement("div",{ref:function(e){return t.container=e},className:"bg-white popover sections rad-5 p-a pv-".concat(i),style:d},e.createElement(r.a,null,e.createElement(s.a,{selectable:o,items:a})))}}])&&c(i.prototype,a),m&&c(i,m),n}(e.Component);p(m,"defaultProps",{orientation:"right",padding:15})}).call(this,n("q1tI"))},"711d":function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},"7Ix3":function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},"7XaY":function(e,t,n){"use strict";n.r(t);var i=n("nyiR"),o=Class.create({vnode:null,angle:null,orientation:null,graphics:null,initialize:function(e){this.vnode=e,this.graphics=this.graphics||new i.VGraphics(this)},getOrientation:function(){return this.vnode.node.pos[0]>0?App.Layouts.orientation.right:App.Layouts.orientation.left},paint:function(e){return App.config.layout.paintRootChild(this,e)},domCoords:function(){return Math.offset(this.vnode.node.pos,Math.negativeOffset(canvas.getCenter(),this.vnode.dcontent.pos))},reposition:function(e){App.config.layout.repositionRootChild(this,e)},refreshLayout:function(){App.config.layout.refreshRootChildLayout(this)},calculateLinePoints:function(){this.vnode.eachChild((function(e){e.calculateLinePoints(),e.offsetLinePoints()}),!0)},redrawLines:function(e){this.vnode.node.pos&&!tree.notPainted&&this.graphics&&(this.calculateLinePoints(),this.redrawBoundaries(),this.graphics.redrawLines(),tree.readyForConnections&&this.redrawConnections(e))},redrawRootLine:function(e,t){this.calculateLinePoints(),this.graphics.redrawRootLine(e,t),"live"!==e&&tree.readyForConnections&&this.redrawConnections()},redrawBoundaries:function(){this.vnode.eachChild((function(e){e.node.boundary&&(e.node.isVisible()?e.node.boundary.view.redraw():e.node.boundary.view.destroy())}))},translateBoundaries:function(e){this.vnode.eachChild((function(t){t.node.boundary&&t.node.isVisible()&&t.node.boundary.view.translate(e)}))},translateOrgChildNodes:function(e){this.redrawRootLine();for(var t=this.vnode.node.getNextSibling();t;)t._listener.rc.redrawRootLine(),t._listener.rc.translateBoundaries({x:e,y:0}),t._listener.rc.graphics.childrenPath.translate(e,0),t=t.getNextSibling()},redrawConnections:function(e){this.vnode.eachChild((function(t){e&&!t.isVisible()||t.node.connections.forEach((function(e){e.isDrawable()&&e.view.redraw()}))}))},destroyLines:function(){this.graphics&&(this.graphics.destroy(),this.graphics=null)},destroy:function(){this.destroyLines(),this.vnode=null}});t.default=o},"7tbW":function(e,t,n){var i=n("LGYb");e.exports=function(e){return e&&e.length?i(e):[]}},"88Gu":function(e,t){var n=800,i=16,o=Date.now;e.exports=function(e){var t=0,s=0;return function(){var r=o(),a=i-(r-s);if(s=r,a>0){if(++t>=n)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},"8dLz":function(e,t,n){"use strict";(function(e){var i=n("Y1fO"),o=n("syde");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=a(this,l(n).call(this,e))).state={selectedColor:t.props.selectedColor},t}var s,d,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,t),s=n,(d=[{key:"_handleClick",value:function(e){this.setState({selectedColor:e}),this.props.onItemClick&&this.props.onItemClick(e)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({selectedColor:e.selectedColor})}},{key:"render",value:function(){var t=this;return e.createElement(i.a,{elementsInRow:this.props.elementsInRow,items:o.COLORS.map((function(n){return{element:e.createElement("span",{style:{backgroundColor:"#"+n}}),className:"color"+(t.state.selectedColor===n?" selected":""),onClick:function(){return t._handleClick(n)}}}))})}}])&&r(s.prototype,d),h&&r(s,h),n}(e.Component);d.defaultProps={elementsInRow:8},t.a=d}).call(this,n("q1tI"))},"9Nap":function(e,t,n){var i=n("/9aa"),o=1/0;e.exports=function(e){if("string"==typeof e||i(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}},"9ggG":function(e,t,n){function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n("Z0cm"),s=n("/9aa"),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(o(e))return!1;var n=i(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!s(e))||(a.test(e)||!r.test(e)||null!=t&&e in Object(t))}},A4Hc:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("7tbW"),s=n.n(o),r=n("TYy9"),a=n.n(r),l=n("zqxM"),c=n.n(l),d=n("xkGU"),h=n.n(d),u=n("Te9D"),p=n.n(u),f=n("2L+8"),m=n("HKtW"),g=n("ERGR"),v=n("39z+"),y=n("I8na");function _(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C={all:"search",idea:"idea-caption",author:"user",task:"checkmark",icons:"lib-emoji-people"},x=["ja","zh","ko"].indexOf(I18n.currentLocale())>=0?1:3,S=function(){},k=function(e){var t=e.title,n=e.searchText;return t.toLowerCase().indexOf(n)>=0},A=function(e){var t=e.task,n=e.searchText;return t&&t.resource&&t.resource.name.toLowerCase().indexOf(n)>=0},E=function(e){var t=e.userId,n=e.searchText,i=users?users.findByID(t,!0):null;return i&&i.name&&i.name.toLowerCase().indexOf(n)>=0},M=function(e){var t=mm$("filtericon_".concat(e));t&&removeClassName(t.parentNode,"selected")},I={icons:[],selectableIcons:[],results:[],type:"all",init:function(t,n){var o=this;this.toggledOpen=[],this.openerMarked=[],this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({onFocus:S,onBlur:S},n),this.popover=new v.c("filter"),this._updatePopoverOpener("all"),e.render(i.createElement(g.a,{items:Object.keys(C).map((function(e){return{icon:i.createElement(f.a,{opts:{name:C[e],size:12,consize:12,color:"grey500",classes:"h-a-center",parentClasses:"p-r mr-8"}}),label:I18n.t("js.filter_".concat(e)),onClick:o.setPanelValue.bind(o,e)}}))}),this.popover.widgetContainer),this.searchField=new y.a(t,{onChange:this.doFilterText.bind(this),onFocus:this.onFocus.bind(this),onBlur:this.onBlur.bind(this),onClear:this.clear.bind(this)}),this.keymap=new MM.utils.KeyMap(document,"fld_filter",[{key:MM.utils.KeyEvent.ESC,stopEvent:!1,fn:function(){o.clear(),"icons"!==o.type&&o.searchField.blur()}}]),this.keymap.disable(),Element.bindOnClick("btn_search_previous",this.goToResult.bind(this,-1)),Element.bindOnClick("btn_search_next",this.goToResult.bind(this,1)),App.subscribe(CustomEvents.ICON_CHANGED,this.onNodeIconChange.bind(this))},onFocus:function(){this.keymap.enable(),this.options.onFocus()},onBlur:function(){this.keymap.disable(),this.options.onBlur()},isActive:function(){return hasClassName(mm$("map_header"),"is-filtered")},setText:function(e){this.searchField.field.value=e,this.searchField.update(),this.doFilterText()},clear:function(){this.icons.forEach((function(e){return M(e.fullName())})),this.icons=[],this.renderPopover(),this.clearText()},clearText:function(e){e&&e.stop(),this.searchField.clear(),this.unmarkResults(),this.clearResults(),this.unblurMap(),this.results=[],canvas.scrollToNode(canvas.selected)},doFilter:function(){var e=this;this.unmarkResults(),this.results=[],this.currentIndex=0;var t=this.searchField.getValue();0!==t.length||"icons"===this.type?(this._treeNodes().forEach((function(n){("icons"===e.type?!!e._hasIcons()&&0===c()(e.icons,n.icons).length:function(e){var t=e.node,n=e.searchType,i=e.searchText,o=!1;switch(n){case"all":o=k({title:t.getSingleLineTitle(),searchText:i})||A({task:t.task,searchText:i})||function(e){var t=e.note,n=e.searchText;return t&&t.toLowerCase().indexOf(n)>=0}({note:t.note,searchText:i})||E({userId:t.modifiedBy,searchText:i});break;case"idea":o=k({title:t.getSingleLineTitle(),searchText:i});break;case"author":o=E({userId:t.modifiedBy,searchText:i});break;case"task":o=A({task:t.task,searchText:i})}return o}({node:n,searchType:e.type,searchText:t.toLowerCase()}))?(e.results.push(n.id),n._listener.unBlur()):n._listener.blur()})),this.blurMap(),this.updateResults(),this.markResults(),0===this.results.length?canvas.scrollToNode(canvas.selected):this.goToResult(0)):this.updateResults()},updateResults:function(){var e=mm$("msg_filter");this.results.length>0?(e.innerHTML=1===this.results.length?I18n.t("js.match"):I18n.t("js.matches",{v0:this.results.length}),show(mm$("btn_search_previous")),show(mm$("btn_search_next"))):(e.innerHTML=I18n.t("js.no_matches_found"),hide(mm$("btn_search_previous")),hide(mm$("btn_search_next"))),show(e),addClassName(mm$("map_header"),"is-filtered"),this.keymap.enable()},clearResults:function(){var e=mm$("msg_filter");e.innerHTML="",hide(e),hide(mm$("btn_search_previous")),hide(mm$("btn_search_next")),removeClassName(mm$("map_header"),"is-filtered"),this.keymap.disable()},goToResult:function(e){var t=this.toggledOpen;if(0!==this.results.length){this.currentIndex=this.currentIndex+e,this.currentIndex>=this.results.length&&(this.currentIndex=0),this.currentIndex<0&&(this.currentIndex=this.results.length-1);for(var n=tree.getNodes()[this.results[this.currentIndex]],i=[],o=n.parent;o;)i.push(o),o=o.parent;for(var s=0,r=(t=t.diff(i,(function(e,t){return e==t}))).length;s<r;s++)t[s].closed||t[s].toggleClosed(!0);for(s=0,r=i.length;s<r;s++)i[s].closed&&(i[s].toggleClosed(!0),this.toggledOpen.push(i[s]));var a=n._listener.dcontent.el;if(canvas.centerOnElement(a),0!==e){var l=n.currentStyle()&&n.currentStyle().backgroundColor?"#"+n.currentStyle().backgroundColor:"transparent";new Effect.Highlight(a,{restorecolor:l,duration:2})}}},unmarkResults:function(){this.toggledOpen.filter((function(e){return!e.closed})).forEach((function(e){return e.toggleClosed(!0)}));var e=tree.getNodes();this.results.forEach(function(t){var n=e[t];n&&n._highlighted&&this.unHighlightNode(n)}.bind(this)),this.openerMarked.forEach((function(e){return removeClassName(e._listener.dopener.el,"highlighted")}))},blurMap:function(){$("graphics_container").style.opacity="0.1"},unblurMap:function(){this._treeNodes().forEach((function(e){return e._listener.unBlur()})),$("graphics_container").style.opacity="1"},markResults:function(){this.openerMarked=[];var e=tree.getNodes();this.results.forEach(function(t){var n=e[t];if(n){var i=n.getVisibleParent();i!==n&&(addClassName(i._listener.dopener.el,"highlighted"),this.openerMarked.push(i)),this.highlightNode(n)}}.bind(this))},highlightNode:function(e){var t=this.searchField.getValue().toLowerCase();if(""!==t){var n=e._listener.dcontent.title;n.update(e.getTitleWithLinks(!0)),h()(n.childNodes,(function(e){var i=e.textContent,o=i.gsub("\n"," ").toLowerCase().match(RegExp.escape(t));if(o){var s=o.index,r=s+t.length,a=p()(i.substring(0,s)+"<em>"+i.substring(s,r)+"</em>"+i.substring(r,i.length)).replace(/&lt;(\/?em)&gt;/g,"<$1>");e.nodeType===Node.TEXT_NODE?(n.insertBefore(new Element("span").update(a),e),n.removeChild(e)):e.innerHTML=a}})),e._highlighted=!0}},unHighlightNode:function(e){e._listener.dcontent.title.update(e.getTitleWithLinks()),e._highlighted=null},getMapIcons:function(){return s()(a()(this._treeNodes().map((function(e){return e.icons}))))},filterIcons:function(){hasClassName(this.searchField.parent,"active")||addClassName(this.searchField.parent,"active"),this.buildIcons(),this.doFilter()},buildIcons:function(){var e=this,t=mm$("icons_filter");if(t.innerHTML="",this.mapIcons=this.getMapIcons(),this.selectableIcons.length<5&&(this.selectableIcons=_(this.icons.slice(0,Math.min(this.icons.length,5))),this.icons.length<5)){var n,i=c()(this.mapIcons,this.selectableIcons);(n=this.selectableIcons).push.apply(n,_(i.slice(0,5-this.selectableIcons.length)))}this.selectableIcons.forEach((function(n){var i=new Element("a",{href:"#",className:"h-flex-row justify-center item ".concat(e._isIconSelected(n)?"selected":"")}),o=n.getElement();o.id="filtericon_".concat(n.fullName()),o.className="s-20px",i.appendChild(o),t.appendChild(i),o.observe("click",e.onToggleIcon.bindAsEventListener(e,n))})),this.renderPopover()},renderPopover:function(){var t=this,n=c()(this.mapIcons,this.selectableIcons);if(n.length>0){var o=n.map((function(e){return{name:e.fullName(),className:"lib_".concat(Icon.sectionToString(e.library,e.section)," ").concat(t._isIconSelected(e)?"selected":""),element:i.createElement("span",{style:{backgroundPosition:"0 ".concat(24*-e.getSpritePosition(),"px")}})}})),s=GeneralPopover.get("filtericon")||new v.c("filtericon");e.render(i.createElement(m.a,{className:"icon-grid",emojis:o,elementsInRow:Math.min(8,o.length),onSelect:function(e){return t.toggleIcon(Icon.get(e))}}),s.widgetContainer),$("btn_filtericon").show()}else $("btn_filtericon").hide()},onToggleIcon:function(e,t){Event.stop(e),this.toggleIcon(t)},toggleIcon:function(e){var t=this,n=e.fullName();this._isIconSelected(e)?(this._removeIcon(e),M(n),this.selectableIcons=this.selectableIcons.filter((function(e){return t._isIconSelected(e)})).slice(0,5)):(this._addIcon(e),this.selectableIcons.include(e)||(this.selectableIcons=this.icons.reverse().slice(0,5)),function(e){var t=mm$("filtericon_".concat(e));t&&addClassName(t.parentNode,"selected")}(n)),this.filterIcons()},onNodeIconChange:function(){if("icons"===this.type){var e=c()(this.mapIcons,this.getMapIcons())[0];e&&(this._isIconSelected(e)&&this._removeIcon(e),this._isIconSelectable(e)&&this._removeSelectableIcon(e)),this.isActive()?this.filterIcons():this.buildIcons()}},setPanelValue:function(e){var t=this,n=this.type;this.type=e,this._updatePopoverOpener(e),"icons"===e?(hide(this.searchField.field),show(mm$("grd_filter")),this.unblurMap(),this.filterIcons()):("icons"===n&&(hide(mm$("grd_filter")),show(this.searchField.field)),this.doFilterText(),setTimeout((function(){return t.activate()}),0))},activate:function(){this.searchField.field.select()},doFilterText:function(){var e=this.searchField.getValue();e.length>=x?this.doFilter():0===e.length&&this.clearText()},_addIcon:function(e){this.icons.push(e)},_removeIcon:function(e){this.icons=this.icons.reject((function(t){return t.equals(e)}))},_removeSelectableIcon:function(e){this.selectableIcons=this.selectableIcons.reject((function(t){return t.equals(e)}))},_hasIcons:function(){return this.icons.length>0},_isIconSelected:function(e){return this.icons.include(e)},_isIconSelectable:function(e){return this.selectableIcons.include(e)},_updatePopoverOpener:function(e){var t=MM.ui.icon({name:C[e],size:14,color:"grey300"}),n=MM.ui.icon({name:"triangle",size:9,color:"grey300"});this.popover.opener.innerHTML=t+n},_treeNodes:function(){return Object.values(tree.getNodes())}};t.default=I}.call(this,n("i8i4"),n("q1tI"))},AGWK:function(e,t,n){"use strict";(function(e){var n=function(t){var n=t.className,i=t.size,o=t.opts;return e.createElement("div",{className:n,dangerouslySetInnerHTML:{__html:MM.ui.LoadingSpinner(i,o).outerHTML}})};n.defaultProps={className:""},t.a=n}).call(this,n("q1tI"))},AJqD:function(e,t,n){"use strict";(function(e){var i=n("Y+p1"),o=n.n(i),s=n("lLo4");function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function l(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=u(this,p(n).call(this,e))).state=t._initState(t.props),t}var i,r,m;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(n,t),i=n,(r=[{key:"_initState",value:function(e){var t=this._getAllItems(e.children);return{selected:e.selected||t[0],items:t}}},{key:"_getItems",value:function(){var e=this;return this.state.items.map((function(t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{onClick:e._onSelect.bind(e,t),selected:e.props.showSelectedState&&t.value===e.state.selected.value})}))}},{key:"_onSelect",value:function(e,t){e&&!o()(this.state.selected,e)&&(this.setState({selected:e}),this.props.onChange(e))}},{key:"_getAllItems",value:function(t){var n=this,i=[];return e.Children.forEach(t,(function(e){e.props&&(i=[].concat(l(i),l(e.props.items||[]),l(n._getAllItems(e.props.children))))})),i}},{key:"UNSAFE_componentWillMount",value:function(){var e=this.state.selected;this.props.onChange(e)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this._initState(e);this.setState(t)}},{key:"renderChildren",value:function(t){var n=this;return e.Children.map(t,(function(t){var i={};return t.props.items&&(i={items:n._getItems()}),i.children=n.renderChildren(t.props.children),e.cloneElement(t,i)}))}},{key:"render",value:function(){var t=this.state.selected,n=this.renderChildren(this.props.children),i=(t.className,a(t,["className"])),o=e.cloneElement(this.props.opener,i);return e.createElement("div",{className:"h-flex-row"},e.createElement(s.a,{position:this.props.position,className:"sections "+this.props.className,opener:o,canAutoPosition:this.props.canAutoPosition},n))}}])&&h(i.prototype,r),m&&h(i,m),n}(e.Component);m.defaultProps={position:"bottom",className:"",canAutoPosition:!1,showSelectedState:!0,onChange:function(){}},t.a=m}).call(this,n("q1tI"))},AP2z:function(e,t,n){var i=n("nmnc"),o=Object.prototype,s=o.hasOwnProperty,r=o.toString,a=i?i.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),n=e[a];try{e[a]=void 0;var i=!0}catch(l){}var o=r.call(e);return i&&(t?e[a]=n:delete e[a]),o}},Avrk:function(e,t,n){"use strict";n.r(t);var i=n("L0S0"),o=n("A4Hc"),s=n("qgXT"),r=Class.create({el:null,root:null,mode:null,NAV:!0,EDIT:!1,initialize:function(){Event.observe(this.container,"scroll",(function(){GeneralPopover.getLastOpened()&&GeneralPopover.getLastOpened().sizeAndPosition()}))},hasMapFeature:function(e){return this.features.indexOf(e)>=0},initEditMode:function(){this.navigationMode(),this._navigationKeyMap?this._navigationKeyMap.enable():this._navigationKeyMap=new MM.utils.KeyMap(document,"navigation_keymap",[]),this._editKeyMap?this._editKeyMap.enable():this._editKeyMap=new MM.utils.KeyMap(document,"edit_keymap",[])},initViewOnlyMode:function(){this.navigationMode(),this._viewOnlyKeyMap?this._viewOnlyKeyMap.enable():this._viewOnlyKeyMap=new MM.utils.KeyMap(document,"viewonly_keymap",[]),this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable()},disableEditMode:function(){},disableViewOnlyMode:function(){},enableViewOnlyMode:function(e){e.initViewOnlyMode(),e.children.each(function(e){this.enableViewOnlyMode(e)}.bind(this))},enableEditMode:function(e){e.initEditMode(),e.children.each(function(e){this.enableEditMode(e)}.bind(this))},postLoad:function(){},buildFromModel:function(){this.root=new i.default(tree.root),tree.root._listener=this.root,this.root.buildFromModel()},destroy:function(){this.removeFocus(),this.root.destroy(),this.el.innerHTML=""},__onStartEdit:function(){this.editMode()},__onStopEdit:function(){this.navigationMode()},editMode:function(){this.mode!=this.EDIT&&(this.mode=this.EDIT)},navigationMode:function(){this.mode!=this.NAV&&(this.mode=this.NAV)},addFocus:function(){Windows.focusedWindow||(App.config.editable&&App.config.currentlyEditable?this.mode==this.EDIT&&this._editKeyMap?(this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap.enable()):this._navigationKeyMap&&(this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap.enable()):this._viewOnlyKeyMap&&(this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this._viewOnlyKeyMap.enable()),App.ui.Footer&&"slideshow"===App.ui.Footer.activeBar&&App.ui.SlideShow&&App.ui.SlideShow.keyMap&&!Presentation.on&&App.ui.SlideShow.keyMap.enable(),MM.ua.isBrowser("Internet Explorer")||this.el.focus(),"undefined"!=typeof o.default&&o.default.searchField&&o.default.searchField.field.blur&&o.default.searchField.field.blur(),this.hasFocus=!0)},removeFocus:function(){this.mode=null,App.config.editable&&App.config.currentlyEditable?(this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.disable()):this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),App.ui.Footer&&"slideshow"===App.ui.Footer.activeBar&&"undefined"!=typeof App.ui.SlideShow&&App.ui.SlideShow.keyMap.disable(),this.hasFocus=!1},onToggleFullscreen:function(){s.a.toggle()},onShowDialog:function(e){sideBar&&sideBar[e].showDialog()},onUndo:function(){ServerConnection.isPending()||(App.config.shareMode===App.MULTI?Message.show(I18n.t("js.undo_in_collaboration_mode"),Message.NOTICE,8):(MM.ui.enableButton("btn_redo"),ServerConnection.undo())),App.trigger(CustomEvents.UNDO)},onRedo:function(){App.config.shareMode==App.MULTI||ServerConnection.isPending()||(App.config.shareMode===App.MULTI?Message.show(I18n.t("js.redo_in_collaboration_mode"),Message.NOTICE,8):(MM.ui.enableButton("btn_undo"),ServerConnection.redo()))},onToggleSidebar:function(){sideBar&&sideBar.toggle(!0)},toEditMode:function(){if(this.root&&this.enableEditMode(this.root),this.initEditMode(),this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.enable(),"undefined"!==typeof canvas&&canvas){var e;if(canvas.selected&&document.body.contains(canvas.selected.dcontent.el))e=canvas.selected;else if(App.config.targetId){var t=tree.root.getChild(App.config.targetId);e=t&&t._listener?t._listener:canvas.root}else e=canvas.root;e&&e.dcontent&&e.select()}},toViewMode:function(){this.root&&this.enableViewOnlyMode(this.root),this.disableEditMode(),this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this.initViewOnlyMode()}});t.default=r},Aw6l:function(e,t,n){"use strict";(function(e){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(t){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o(this,s(n).apply(this,arguments))}var a,l,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(n,t),a=n,(l=[{key:"_initTooltip",value:function(){this.tooltip=MM.ui.ToolTips.touchSafe({el:this.el})}},{key:"componentDidMount",value:function(){this._initTooltip()}},{key:"componentDidUpdate",value:function(){this._initTooltip()}},{key:"componentWillUnmount",value:function(){MM.ui.ToolTips.destroyTouchSafe(this.tooltip)}},{key:"render",value:function(){var t=this,n=this.props.user.getAvatar(this.props.className,this.props.fullSize,this.props.tooltip);return e.createElement("div",{ref:function(e){return t.el=e},dangerouslySetInnerHTML:{__html:n}})}}])&&i(a.prototype,l),c&&i(a,c),n}(e.Component);t.a=a}).call(this,n("q1tI"))},B01C:function(e,t,n){"use strict";n.r(t);var i=n("4tVC"),o=n("yQ/X"),s=n("C9l9"),r=n("Qh5C"),a=Class.create(i.GoogleSearch,{initialize:function($super,e){$super(Object.extend({type:"ImageSearch"},e))},query:function($super,e,t){var n=encodeURIComponent("queries,items")+"("+encodeURIComponent("link,image")+"("+encodeURIComponent("contextLink,width,height,thumbnailHeight,thumbnailLink,thumbnailWidth")+"))";this.queryText=e,$super(e,n,t)},queryMore:function(e){e=Object.extend({index:this.index},e),this.query(this.queryText,e)},searchComplete:function($super,e,t){$super(e=e.collect((function(e){return{url:e.link,contextUrl:e.image.contextLink,thumbnailUrl:e.image.thumbnailLink,width:e.image.width,height:e.image.height}})),t)}}),l=Class.create({api_key:"645bbd974574d9fb4092f88e4bd5531f",initialize:function(e){this.options=e||{}},query:function(e,t){var n=mm$("iconfinder_script");n&&document.body.removeChild(n),(n=document.createElement("script")).id="iconfinder_script",n.src=document.location.protocol+"//www.iconfinder.com/json/search/?q="+e+"&c=30&p=0&min=48&max=128&api_key="+this.api_key+"&callback=sideBar.images.iconFinderSearch.search.searchComplete",document.body.appendChild(n),this.queryText=e,this.callback=t.onComplete},searchComplete:function(e){var t=e.searchresults.icons;this.callback&&(e=t?t.collect((function(e){return{url:e.image,width:e.size,height:e.size}})):[],this.callback(e))}}),c=Class.create(s.default,{initialize:function($super,e){switch($super(e),this.options=Object.extend({type:"imgs"},this.options),this.options.searcher){case"google":this.search=new a(this.options.searcherOpts);break;case"iconfinder":this.search=new l(this.options.searcherOpts);break;case"skoletube":this.search=new r.default(this.options.searcherOpts)}},onSearchStarted:function($super){$super();var e=this.options.searcher+"_"+this.options.type;$(e).select(".no_elements")[0]&&($(e).select(".no_elements")[0].innerHTML=""),mm$(e+"_show_more")&&hide(mm$(e+"_show_more"))},updateItemListInfo:function(){var e=this.options.searcher+"_"+this.options.type;if(this.ui){$(e).select(".no_elements")[0]&&$(e).select(".no_elements")[0].update(I18n.t("js.images_d",{v0:this.items.length}));var t=$(e+"_show_more");if(t){var n=t.select(".loading-spinner-12")[0];n&&n.remove(),this.items.length<this.search.options.maxResults?t.onclick=function(e){e.stop(),this.queryMore(t)}.bind(this):(t.onclick=null,t.href="https://www.google.com/images?q="+this.search.queryText),show(t)}}},insertListElement:function(e,t){o.default.insertIntoLibrary(this.options.searcher,e,t)},onNoResultsFound:function(){if(this.options.handler)this.options.handler([]);else if(this.ui){var e=this.options.searcher+"_"+this.options.type;$(e).select(".no_elements")[0]&&$(e).select(".no_elements")[0].update(I18n.t("js.no_images")),addClassName(mm$(e+"_container"),"empty"),mm$(e+"_container").update('<div class="w-100% fs-m">'+I18n.t("js.no_image_was_found")+"</div>")}}});t.default=c},BiGR:function(e,t,n){var i=n("nmnc"),o=n("03A+"),s=n("Z0cm"),r=i?i.isConcatSpreadable:void 0;e.exports=function(e){return s(e)||o(e)||!!(r&&e&&e[r])}},C9DP:function(e,t,n){"use strict";n.r(t);var i=n("Ij8n"),o=n("YIZm"),s=n("L0S0"),r=n("J4oq"),a=n("ClT6"),l=n("vpdt"),c=n("z4/t"),d=n("dYE5"),h=(n("pddD"),n("ZlCP")),u=Class.create({change:null,initialize:function(e){this.change=e,this.change.id=u.id++},node:function(){return tree.root.getChild(this.change.idea_id)},execute:function(){},executeLocally:function(){return this.execute()},undo:function(){return this.execute(!0)},redo:function(){return this.execute()},handleResponse:MM.utils.empty,toJSON:function(){return this.change},_undo:function(e){return this.execute(!0,e)},_redo:function(e){return this.execute(!1,e)}});u.id=0;var p=Class.create(u,{undo:function(e){var t=tree.root.getChild(this.change.new_data.id);return!!t&&t.parent.__onHideChild(t,e)},_undo:function(e){var t=tree.root.getChild(this.change.new_data.id);if(t)t.parent.__onRemoveChild(t);else for(var n=[this.change.new_data].flatten(),i=0;i<n.size();i++){var o=n[i];new f({idea_id:o.idea_id,old_data:o.new_data}).execute(!1,e)}},redo:function(){var e=tree.root.getChild(this.change.new_data.id);return!!e&&e.parent.__onShowChild(e)},_redo:function(e){var t=tree.root.getChild(this.change.new_data.id);t?t.parent.__onShowChild(t):new p(this.change).execute(!1,e)},_executeSimple:function(e,t){var n=this.change.new_data;n.closed=n.closed&&n.closed.toBoolean?n.closed.toBoolean():n.closed||!1;var r=new i.default(n);if(n.id<=tree.uncommitedId&&(tree.uncommitedId=n.id-1),n.icon&&mapView.hasMapFeature("icons"))for(var l=n.icon.split(","),c=0,d=l.length;c<d;c++)Icon.fromFullName(l[c]);if(n.idea_image&&mapView.hasMapFeature("images")&&"undefined"!==typeof IdeaImage){var h=IdeaImage.get(n.idea_image.id);h||(h=new IdeaImage(n.idea_image)),r.idea_image=h}if(n.attachments&&mapView.hasMapFeature("attachments")&&n.attachments.length>0&&"undefined"!==typeof a.default)for(c=0,d=n.attachments.length;c<d;c++){var u=new a.default(n.attachments[c]);r.attachments.push(u)}if(n.parent){var p=tree.root.getChild(n.parent);if(p){if(r.parent=p,("undefined"===typeof r.pos||null===r.pos)&&r.parent.isRoot()){var f=App.config.layout.nextTopicPosition(r.parent);r.pos=f,this.change.new_data.pos=f}r._listener=new o.default(r);var m=t?p.__onAddChild(r,n.rank):p.__onAddChild(r,n.rank,n.modifiedBy);return canvas.liveUpdateHighlight(r),m}return!1}return tree.root=r,r._listener=new s.default(r),tree.root._listener.paint(),canvas.liveUpdateHighlight(r),!0},execute:function(e,t){var n=this.change.new_data,i=tree.root?tree.root.getChild(n.parent):null;if(i&&i.isRoot())return p.rootChild([this]);var o=this._executeSimple(e,t),s=tree.root?tree.root.getChild(n.id):null;return s&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(s),o},handleResponse:function(e){if(!e.error){var t=tree.root.getChild(this.change.new_data.id);t&&t.changeId(e.id),ServerConnection.fixQueuedChangesIds(this.change.new_data.id,e.id)}},executeLocally:MM.utils.empty});p.rootChild=function(e,t,n){if(!(e.length<=0)){var i=!0;tree.finishedInitialization||(tree.notPainted=!0);for(var o=0;o<e.length;o++)i=i&&e[o]._executeSimple(t,n);var s=tree.root.getChild(e[0].change.new_data.id);if(mapView.hasMapFeature("graphics")){if(App.config.layout.elasticLayout)var r=rectangleLayouter.update(s);s._listener.rc.paint(),tree.notPainted=!1,canvas.checkBounds(),App.config.layout.elasticLayout&&J.elasticLayoutChangeset(r)}return i}},p.toChangeArray=function(e,t){var n=[],i=e.new_data;if(t&&(e.idea_id=e.new_data.id=t),i.attachments&&i.attachments.length>0){for(var o=0,s=i.attachments.length;o<s;o++){var r=i.attachments[o];n.push(new M({idea_id:e.idea_id,type:"AddAttachment",new_data:{attachment_id:r.id,details:r}}))}i.attachments=[]}return i.idea_image&&(n.push(new D({idea_id:e.idea_id,type:"AddImage",new_data:{idea_image_id:i.idea_image.id,details:i.idea_image}})),i.idea_image=null),i.boundary&&(n.push(new W({idea_id:e.idea_id,type:"AddBoundary",new_data:i.boundary})),i.boundary=null),n.unshift(new p(e)),n};var f=Class.create(u,{undo:function(){var e=this.node();return!!e&&e.parent.__onShowChild(e)},_undo:function(e){for(var t=[],n=[],i=0,o=this.change.old_data.length;i<o;i++){(r=this.change.old_data[i]).type.include("Connection")?t.push(r):n.push(r)}var s=n.concat(t);for(i=0,o=s.length;i<o;i++){var r=s[i],a=new window[r.type+"Change"](r),l=a.change.new_data;"Insert"===r.type&&(l.modifiedAt=new Date(l.modifiedAt)),a.execute(!1,e)}},redo:function(){var e=this.node();return!!e&&e.parent.__onHideChild(e)},_redo:function(){var e=this.node();e&&e.parent.__onRemoveChild(e)},execute:function(e,t){var n=this.node();if(n){var i=t?n.parent.__onRemoveChild(n):n.parent.__onRemoveChild(n,this.change.user_id);return canvas.selected&&!canvas.selected.isVisible()&&users.selfUser&&this.change.user_id===users.selfUser.id&&canvas.scrollToNode(canvas.selected),i}return!1},executeLocally:function(){var e=this.node();e.parent.__onHideChild(e),canvas.selected&&!canvas.selected.isVisible()&&users.selfUser&&this.change.user_id===users.selfUser.id&&canvas.scrollToNode(canvas.selected)},handleResponse:function(e){if(!e.error){var t=this.node();t.parent.__onRemoveChild(t)}}}),m=f,g=Class.create(u,{execute:function(e,t){var n=this.node(),i=e?this.change.old_data:this.change.new_data;if(!n)return!1;var o=t?n.__onRename(i.title):n.__onRename(i.title,this.change.user_id);return canvas.liveUpdateHighlight(n),o}}),v=g,y=Class.create(u,{execute:function(e,t){var n=e?this.change.old_data:this.change.new_data,i=this.node(),o="NonPersistentReposition"===this.change.type;return!!i&&(t?i.__onReposition(n.pos,null,o):i.__onReposition(n.pos,this.change.user_id,o))}}),_=y,b=Class.create(u,{execute:function(e,t,n){var i=e?this.change.old_data:this.change.new_data,o=tree.root.getChild(i.parent),s=this.node();if(o&&s&&s.isInMapStructure()){if(t)var r=s.__onMove(o,i.rank,null,i.pos,n);else r=s.__onMove(o,i.rank,this.change.user_id,i.pos,n);return canvas.liveUpdateHighlight(s),r}return!1},undo:function(e){return this.execute(!0,e)},redo:function(e){return this.execute(!1,e)}}),w=Class.create(u,{execute:function(e,t){var n=this.node();if(!n)return!1;var i=e?this.change.old_data.icon:this.change.new_data.icon,o=t?n.__onSetIcon(i):n.__onSetIcon(i,this.change.user_id);return canvas.liveUpdateHighlight(n),o}}),C=Class.create(u,{execute:function(e,t){var n=this.node();if(!n)return!1;var i=e?this.change.old_data.style:this.change.new_data.style;i&&(i=new Style(i));var o=t?n.__onSetStyle(i):n.__onSetStyle(i,this.change.user_id);return canvas.liveUpdateHighlight(n),o}}),x=Class.create(u,{execute:function(e,t){var n=this.node();if(!n)return!1;var i=e?!!this.change.old_data&&this.change.old_data.floating:!!this.change.new_data&&this.change.new_data.floating,o=null;i&&(o=new c.default({floating:i}));var s=t?n.__onSetIdeaProperty(o):n.__onSetIdeaProperty(o,this.change.user_id);return canvas.liveUpdateHighlight(n),s}}),S=Class.create(u,{undo:function(e){var t=this.change.old_data[e],n=this.node();return!!n&&n.__onSetProperty(e,t)},execute:function(e,t,n){var i=this.node();if(!i)return!1;var o=t?this.change.old_data[e]:this.change.new_data[e],s=n?i.__onSetProperty(e,o):i.__onSetProperty(e,o,this.change.user_id);return canvas.liveUpdateHighlight(i),s}}),k=Class.create(S,{undo:function($super){return $super("note")},execute:function($super,e,t){return $super("note",e,t)},handleResponse:function(e){"undefined"!==typeof sideBar&&sideBar.onSelectNode()}}),A=Class.create(S,{undo:function($super){return $super("link")},execute:function($super,e,t){return $super("link",e,t)}}),E=Class.create(S,{undo:function($super){return $super("task")},execute:function($super,e,t){return $super("task",e,t)}}),M=Class.create(u,{execute:function(e,t){if(e)return new I({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var n=this.node();if(!n)return!1;var i=a.default.get(this.change.new_data.attachment_id);if(!i){var o=this.change.new_data.details;i=new a.default(o)}return t?n.__onAddAttachment(i):n.__onAddAttachment(i,this.change.user_id),"undefined"!==typeof sideBar&&sideBar&&sideBar.attachments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.attachments.onAddAttachment(i),canvas.liveUpdateHighlight(n),!0}}),I=Class.create(u,{execute:function(e,t){if(e)return new M({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var n=this.node();if(!n)return!1;var i=a.default.get(this.change.old_data.attachment_id);return t?n.__onRemoveAttachment(i):n.__onRemoveAttachment(i,this.change.user_id),"undefined"!==typeof sideBar&&sideBar&&sideBar.attachments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.attachments.onRemoveAttachment(i),canvas.liveUpdateHighlight(n),!0}}),O=Class.create(u,{execute:function(e,t){if(e)return new T({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var n=this.node();if(!n)return!1;var i=l.default.get(this.change.new_data.idea_comment_id);return i||(i=new l.default(this.change.new_data)),t?n.__onAddComment(i):n.__onAddComment(i,this.change.user_id),"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onAddComment(i),canvas.liveUpdateHighlight(n),!0},handleResponse:function(e){if(!e.error){var t=l.default.get(this.change.new_data.id);t&&(t.id=e.idea_comment_id,t.text=e.text,t.createdAt=new Date(e.created_at),t.updatedAt=new Date(e.created_at),"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&sideBar.comments.expanded&&sideBar.comments.onCommentAdded(t,this.change.new_data.id))}}}),P=Class.create(u,{execute:function(e,t){if(e)return new P({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var n=l.default.get(this.change.new_data.idea_comment_id);return n&&(n.update(this.change.new_data.text),"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onEditComment(n)),canvas.liveUpdateHighlight(this.node()),!0},handleResponse:function(e){if(!e.error){var t=l.default.get(this.change.new_data.idea_comment_id);t&&(t.updatedAt=new Date(e.updated_at),t.text=e.text,"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&sideBar.comments.expanded&&sideBar.comments.onCommentEdited(t))}}}),T=Class.create(u,{execute:function(e,t){if(e)return new O({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var n=this.node();if(!n)return!1;var i=this.change.old_data.idea_comment_id||this.change.old_data.id,o=l.default.get(i);return o&&(t?n.__onRemoveComment(o):n.__onRemoveComment(o,this.change.user_id),"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onRemoveComment(o)),canvas.liveUpdateHighlight(n),!0}}),L=Class.create(u,{execute:function(e,t){if(e)return new R({idea_id:this.change.idea_id,old_data:this.change.new_data,user:this.change.user}).execute();if("undefined"!=typeof this.change.new_data&&this.change.new_data){var n=this.node();if(!n)return!1;var i=IdeaVote.getChangeUser(this.change.new_data,this.change.user),o=IdeaVote.get(tree.root.getChild(this.change.idea_id),i.id);o||(o=new IdeaVote({idea_id:this.change.new_data.idea_id,user_id:i.id,vote:this.change.new_data.vote,voted_at:this.change.new_data.voted_at}));var s=t?n.__onAddVote(o):n.__onAddVote(o,this.change.user_id);return"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onAddVote(o),canvas.liveUpdateHighlight(n),s}}}),N=Class.create(u,{execute:function(e,t){if(e)return new N({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data,user:this.change.user}).execute();var n=this.node();if(!n)return!1;var i=IdeaVote.getChangeUser(this.change.new_data,this.change.user),o=IdeaVote.get(tree.root.getChild(this.change.idea_id),i.id);if(o){o.vote=this.change.new_data.vote,this.change.new_data.voted_at&&(o.voted_at=new Date(this.change.new_data.voted_at));var s=t?n.__onEditVote(o):n.__onEditVote(o,this.change.user_id);"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onEditVote(o)}return canvas.liveUpdateHighlight(n),s}}),R=Class.create(u,{execute:function(e,t){if(e)return new L({idea_id:this.change.idea_id,new_data:this.change.old_data,user:this.change.user}).execute();var n=this.node();if(!n)return!1;var i=IdeaVote.getChangeUser(this.change.old_data,this.change.user),o=IdeaVote.get(tree.root.getChild(this.change.idea_id),i.id),s=t?n.__onRemoveVote(o):n.__onRemoveVote(o,this.change.user_id);return"undefined"!==typeof sideBar&&sideBar&&sideBar.comments&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onRemoveVote(o),canvas.liveUpdateHighlight(n),s}}),D=Class.create(u,{execute:function(e,t){if(e)return new D({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();if("undefined"!=typeof this.change.new_data&&this.change.new_data){var n=IdeaImage.get(this.change.new_data.idea_image_id);if(!n&&this.change.new_data.details){var i=this.change.new_data.details;n=new IdeaImage(i)}var o=this.node();if(!o)return!1;o.idea_image=n;var s=t?o.__onAddImage():o.__onAddImage(this.change.user_id);return canvas.liveUpdateHighlight(o),s}},handleResponse:function(e){e.error||(e.idea_image&&(this.node().idea_image=new IdeaImage(e.idea_image),this.node().__onAddImage(this.change.user_id)),tree.root.getChild(e.idea_id).changeImageId(e.idea_image_id))}}),j=Class.create(u,{execute:function(e,t){if(e)return new D({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:{idea_image_id:null}}).execute();var n=IdeaImage.get(this.change.old_data.idea_image_id),i=this.node();if(!i)return!1;var o=t?i.__onRemoveImage(n):i.__onRemoveImage(n,this.change.user_id);return canvas.liveUpdateHighlight(i),o}}),B=Class.create(u,{execute:function(e,t){if(e)return new B({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var n=IdeaImage.get(this.change.new_data.idea_image_id),i=this.node();if(!i)return!1;n||(n=new IdeaImage(this.change.new_data.details),i.idea_image=n),n.size=[this.change.new_data.width,this.change.new_data.height];var o=t?i.__onResizeImage(n):i.__onResizeImage(n,this.change.user_id);return canvas.liveUpdateHighlight(i),o}}),z=Class.create(u,{execute:function(e,t){if(e)return new F({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var n=new h.default(this.change.new_data);if(n.from&&n.to){var i=t?n.from.__onAddConnection(n):n.from.__onAddConnection(n,this.change.user_id);return canvas.liveUpdateHighlight(this.node()),i}return!1}}),F=Class.create(u,{execute:function(e,t){if(e)return new z({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var n;n=this.change.old_data?h.default.get(this.change.old_data.from_id,this.change.old_data.to_id):h.default.get(this.change.new_data.from_id,this.change.new_data.to_id);var i=this.node();if(!i||!n)return!1;var o=t?i.__onRemoveConnection(n):i.__onRemoveConnection(n,this.change.user_id);return canvas.liveUpdateHighlight(i),o}}),V=Class.create(u,{execute:function(e,t){if(e)return new V({idea_id:this.change.idea_id,old_data:this.change.new_data,new_data:this.change.old_data}).execute();var n=h.default.get(this.change.new_data.from_id,this.change.new_data.to_id);return!!(n&&n.from&&n.to)&&n.__onSetProperties(this.change.new_data,t?void 0:this.change.user_id)}}),H=V,U=Class.create(u,{execute:function(e,t){if(e)return new $({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var n=this.node();if(!n)return!1;var i=new d.default(Object.extend(this.change.new_data,{idea_id:this.change.idea_id})),o=t?n.__onAddVideo(i):n.__onAddVideo(i,this.change.user_id);return canvas.liveUpdateHighlight(n),o}}),$=Class.create(u,{execute:function(e,t){if(e)return new U({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var n=this.node();if(!n)return!1;var i=t?n.__onRemoveVideo():n.__onRemoveVideo(this.change.user_id);return canvas.liveUpdateHighlight(n),i}}),q=Class.create(u,{execute:function(e,t){if(e)return new q({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var n=this.node();if(!n)return!1;var i=n.idea_video;i.url=this.change.new_data.url,i.title=this.change.new_data.title,i.updateSource();var o=t?n.__onAddVideo(i):n.__onAddVideo(i,this.change.user_id);return canvas.liveUpdateHighlight(n),o}}),W=Class.create(u,{execute:function(e,t){if(e)return new G({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var n=this.node();return!!n&&(n.boundary=new r.default(Object.extend(this.change.new_data,{idea_id:this.change.idea_id})),n.__onAddBoundary(),canvas.liveUpdateHighlight(n),!0)}}),G=Class.create(u,{execute:function(e,t){if(e)return new W({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var n=this.node();return!!n&&(n.__onRemoveBoundary(),canvas.liveUpdateHighlight(n),!0)}}),K=Class.create(u,{execute:function(e,t){if(e)return new K({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var n=this.node();if(!n)return!1;var i=n.boundary;return i&&(i.view.destroy(),i.style.update(this.change.new_data),n.__onAddBoundary(),canvas.liveUpdateHighlight(n)),!0}}),Y=Class.create(u,{execute:function(e,t){if(mapView.hasMapFeature("graphics")){if(e)return new Y({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var n=MapTheme.get(this.change.new_data.id);return n||(n=new MapTheme(this.change.new_data)),MapTheme.closeActivity(),n.id>0&&n.root_style&&n.root_children_style&&n.nodes_style&&(MapTheme.activity=new MM.ui.Activity(I18n.t("js.applying_theme"),{progress:!0,autoUpdate:!0,duration:2e4}),canvas.removeTheme(App.config.mapTheme),canvas.applyTheme(n),App.trigger(CustomEvents.THEME_CHANGED)),!0}},handleResponse:function(e){if(!e.error&&e.theme&&e.theme.id!==App.config.mapTheme.id){canvas.removeTheme(App.config.mapTheme);var t=MapTheme.get(e.theme.id);t||(t=new MapTheme(e.theme)),canvas.applyTheme(t),App.trigger(CustomEvents.THEME_CHANGED)}}}),Z=Class.create(u,{execute:function(e){var t=e?this.change.old_data:this.change.new_data;return canvas.__onSetMapProperties(t),!0}}),J=Class.create({changes:null,initialize:function(){this.changes=[]},getChange:function(e){for(var t=this.changes.length;t>0;){var n=this.changes[--t];if(n.change.id===e)return n}},toJSON:function(){return this.changes.collect((function(e){return e.toJSON()}))},toArray:function(){return this.changes},_do:function(e,t){for(var n=!0,i=0,o=this.changes.length;i<o;i++)n=n&&this.changes[i][e](t);return n},execute:function(e){return this._do("execute",e)},executeLocally:function(e){return this._do("executeLocally",e)},undo:function(e){for(var t=!0,n=this.changes.length;n--;)t=t&&this.changes[n].undo(e)},redo:function(e){return this._do("redo",e)},merge:function(e){this.changes=this.changes.concat(e.changes)},_doLayoutingChanges:function(e,t){if(0!==e.length)for(var n=0,i=e.length;n<i;n++){var o,s=e[n],r=s[1],a=Math.offset(s[0].pos,r);s[0].pos[0]===a[0]&&s[0].pos[1]===a[1]||(t=t||"NonPersistentReposition",(o=new window[t+"Change"]({idea_id:s[0].id,type:t,old_data:{pos:s[0].pos},new_data:{pos:a}})).execute(),this.changes.push(o))}},doAutoLayoutingChanges:function(){this._doLayoutingChanges(rectangleLayouter.autoLayout())},doAutoCondenseChanges:function(){this._doLayoutingChanges(rectangleLayouter.autoCondense(),"Reposition")},doAutoAlignedChanges:function(e){for(var t,n=canvas.root.children,i=canvas.getCenter(),o=0;o<n.length;o++){t=Math.negativeOffset(canvas.getNodeCanvasOffset(n[o]),i),e=e||"Reposition";var s=new window[e+"Change"]({idea_id:n[o].node.id,type:e,old_data:{pos:n[o].node.pos},new_data:{pos:t}});tree.notPainted=!0,s.execute(),tree.notPainted=!1,this.changes.push(s)}},doNodeLayoutingChanges:function(e){App.config.layout.autoAlign||e.isRoot()||this._doLayoutingChanges(rectangleLayouter.changeRectangleTidy(rectangleLayouter.getRectangle(e.getRootC())))},handleResponse:function(e){if(e.responses)for(var t=0,n=e.responses.length;t<n;t++){var i=e.responses[t];i.client_id&&this.getChange(i.client_id).handleResponse(i)}}});J.layoutAlteringChangeset=function(e){if(0!==e.length){var t=new J;t.changes=t.changes.concat(e),e.each((function(e){e.execute()})),App.config.layout.autoAlign||e.each((function(e){t.doNodeLayoutingChanges(e.node())})),ServerConnection.doChanges(t)}},J.autoLayoutChangeset=function(){if(!App.config.layout.autoAlign){var e=new J;return e.doAutoLayoutingChanges(),e}},J.elasticLayoutChangeset=function(e){e&&(J.lastElasticChangeset||(J.lastElasticChangeset=new J),J.lastElasticChangeset._doLayoutingChanges(e))},J.executeChangesGrouped=function(e,t){for(var n=[],i={},o=0;o<e.length;o++){var s=e[o];"Insert"===s.change.type?tree.root&&s.change.new_data.parent===tree.root.id?(p.rootChild(n),n=[s],i[s.change.new_data.id]=s.change.new_data.id):(n[0]&&n[0].change.new_data.id===i[s.change.new_data.parent]?n.push(s):(n[0]&&(p.rootChild(n),n=[]),s.execute(!1,t)),i[s.change.new_data.id]=i[s.change.new_data.parent]):(n.length>0&&(p.rootChild(n),n=[]),s.execute(!1,t))}n.length>0&&p.rootChild(n)},J.executeChanges=function(e){for(var t=!1,n=0,i=e.length;n<i;n++){var o=e[n];e[n]=new window[o.type+"Change"](o),e[n].new_data&&canvas.selected&&e[n].new_data.idea_id===canvas.selected.node.id&&(t=!0),"Insert"===o.type&&(o.new_data.modifiedAt=new Date(o.new_data.modifiedAt))}J.executeChangesGrouped(e,0===App.config.shareMode&&App.config.liveUpdate);var s=e[0]?e[0].change:null;if(App.config.liveUpdate&&s&&tree.finishedInitialization){var r=null;if("Insert"===s.type&&s.new_data&&s.new_data.id?r=s.new_data.id:s.idea_id&&(r=s.idea_id),r){var a=mm$(r.toString());a&&canvas.centerOnElement(a)}}"undefined"!==typeof sideBar&&sideBar&&("undefined"===typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&t&&sideBar.onSelectNode()},J.executeServerChanges=function(e){for(var t=[],n=[],i=0,o=e.length;i<o;i++){var s=e[i];s.type.include("Connection")?t.push(s):n.push(s)}tree.notPainted=!1,J.executeChanges(n),J.executeChanges(t),tree.notPainted||n.any((function(e){return"MapProperties"===e.type}))&&J.autoLayoutChangeset()},window.InsertChange=p,window.RemoveChange=f,window.DeleteChange=m,window.RenameChange=g,window.TitleChange=v,window.RepositionChange=y,window.NonPersistentRepositionChange=_,window.MoveChange=b,window.IconChange=w,window.TextStyleChange=C,window.IdeaPropertiesChange=x,window.PropertyChange=S,window.NoteChange=k,window.LinkChange=A,window.TaskChange=E,window.AddAttachmentChange=M,window.RemoveAttachmentChange=I,window.AddCommentChange=O,window.EditCommentChange=P,window.RemoveCommentChange=T,window.AddVoteChange=L,window.EditVoteChange=N,window.RemoveVoteChange=R,window.AddImageChange=D,window.RemoveImageChange=j,window.ResizeImageChange=B,window.AddConnectionChange=z,window.RemoveConnectionChange=F,window.ConnectionPropertiesChange=V,window.ChangeConnectionColorChange=H,window.AddVideoChange=U,window.RemoveVideoChange=$,window.EditVideoChange=q,window.AddBoundaryChange=W,window.RemoveBoundaryChange=G,window.EditBoundaryChange=K,window.MapThemeChange=Y,window.ChangeList=J,window.MapPropertiesChange=Z},C9l9:function(e,t,n){"use strict";n.r(t);var i=Class.create({searcher:null,items:[],initialize:function(e){this.options=Object.extend({onSearch:Prototype.emptyFunction,caching:!0},e),this.ui=!e.hasOwnProperty("ui")||e.ui,this.ui&&this.options.element&&this.observeSearchField()},observeSearchField:function(){this.options.keyMap=new MM.utils.KeyMap(document,this.options.searcher+"_"+this.options.type+"_keymap",[{key:MM.utils.KeyEvent.ENTER,fn:function(){this.options.element.value!=this.search.queryText&&(this.options.element.blur(),this.query(this.options.element.value))}.bind(this)},{key:MM.utils.KeyEvent.ESC,fn:function(){this.options.element.blur()}.bind(this)}]),this.options.keyMap.disable(),this.options.element.observe("focus",this.options.keyMap.enable.bind(this.options.keyMap)),this.options.element.observe("blur",this.options.keyMap.disable.bind(this.options.keyMap))},query:function(e,t){(this.options.element&&!e||this.search.queryText===e.toLowerCase())&&this.options.caching||(this.ui&&(this.options.element&&(this.options.element.value=e),this.onSearchStarted()),this.items=[],this.search.query(e.toLowerCase(),this.getDefaultCallbacks(t)))},queryMore:function(e){e.appendChild(MM.ui.LoadingSpinner(12,{className:"h-iblock ml-5"})),this.search.queryMore(this.getDefaultCallbacks())},getDefaultCallbacks:function(e){return Object.extend({onComplete:this.onSearchCompleted.bind(this),onError:this.onSearchError.bind(this)},e)},onSearchStarted:function(){this.options.loadingSpinner||(this.options.loadingSpinner=MM.ui.LoadingSpinner(64)),mm$(this.options.searcher+"_"+this.options.type+"_container").update(this.options.loadingSpinner),$(this.options.searcher+"_"+this.options.type).select(".paging")[0]&&$(this.options.searcher+"_"+this.options.type).select(".paging")[0].update(""),this.options.onSearch()},onSearchCompleted:function(e,t,n){if(this.__removeLoadingSpinner(),e.length>0){removeClassName(mm$(this.options.searcher+"_"+this.options.type+"_container"),"empty");for(var i=0,o=e.length;i<o;i++){var s=e[i];this.items.push(s),this.insertListElement(s,i)}this.updatePagination(t,n),this.updateItemListInfo&&this.updateItemListInfo(),this.options.handler&&this.options.handler(this.items)}else this.onNoResultsFound()},onSearchError:function(){this.__removeLoadingSpinner(),this.onNoResultsFound()},insertListElement:function(e,t){},updatePagination:function(e,t){if(i=$(this.options.searcher+"_"+this.options.type)){var n=i.select(".paging")[0];if(n&&e>1){n.innerHTML="";var i=new Element("div",{class:"l-table-col text-center"}),o=new Element("span",{class:"previous"}),s=new Element("span").update(I18n.t("js.page_d_of_d",{v0:t,v1:e})),r=new Element("span",{class:"next"});t>1&&o.update(I18n.t("js.previous")).observe("click",this.showPage.bind(this,t-1)),t<e&&r.update(I18n.t("js.next")).observe("click",this.showPage.bind(this,t+1)),n.appendChild(i.update(o)),n.appendChild(i.clone().update(s)),n.appendChild(i.clone().update(r))}}},showPage:function(e){isNaN(e)||e<=0||(this.onSearchStarted(),this.items=[],this.search.nextPage(e))},__removeLoadingSpinner:function(){this.ui&&this.options.loadingSpinner&&(this.options.loadingSpinner.remove(),this.options.loadingSpinner=null)}});t.default=i},CJ9X:function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(l){o=!0,s=l}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}n.r(t),n.d(t,"checkLink",(function(){return o})),n.d(t,"embeddedURLs",(function(){return s}));var o=function(e){var t,n,o=null,s=null;if((o=e.match(/(?:https?:\/\/(?:www\.)?|www\.|m\.|^)youtu(?:be\.com\/(?:.+)?(?:(?:watch(?:\?|\.+&))?v[\/=]|\/)|\.be\/)([a-zA-Z0-9_-]{11}).*/))&&11===o[1].length){s="youtube";var r=Object.toQueryString((t={start:0},(n=e.match(/([#&?](start|t|end)=\d+)/g))&&n.each((function(e){var n=i(e.match(/(\w+)=(\d+)/),3),o=n[1],s=n[2];"t"===o&&(o="start"),t[o]=s})),t));o="".concat(o[1],"?").concat(r)}else if(o=e.match(/(?:https?:\/\/(?:www\.)?|www\.|^).*vimeo.*(?:videos|video|channels(?:\/[a-zA-Z0-9]*)?|\.com)\/([\d]+)/))s="vimeo",o=o[1];else if(o=e.match(/(?:https?:\/\/(?:www\.)?|www\.|^).*dailymotion.com\/(?:embed\/)?(?:(?:video|hub)\/([^_]+))?[^#]*(?:#video=([^_&]+))?/)){s="dailymotion";for(var a=o.length-1;a>0&&void 0===o[a];a--);o=o[a]}else ServerData.isLoggedIn&&ServerData.user.unilogin&&(o=e.match(/(?:https?:\/\/(?:www\.)?|www\.|^).*(?:skoletube\.dk\/video\/)[\d]+\/([a-zA-Z0-9]{20})/))&&(s="skoletube",o=o[o.length-1]);return{video:o,source:s,url:e}},s={youtube:"//www.youtube.com/embed/",vimeo:"//player.vimeo.com/video/",dailymotion:"//www.dailymotion.com/embed/video/",skoletube:"//www.skoletube.dk/e/"}},CMye:function(e,t,n){var i=n("GoyQ");e.exports=function(e){return e===e&&!i(e)}},CO2j:function(e,t,n){"use strict";n.r(t);var i=n("Y+p1"),o=n.n(i),s=Class.create({color:null,fontSize:null,bold:!1,italic:!1,backgroundColor:null,boxStyle:2,borderColor:null,gradient:0,initialize:function(e){if(e){var t="string"===typeof e?s.parse(e):e;this.id=t.id||null,this.name=t.name||null,this.color=t.color,this.fontSize=t.fontSize,this.fonts=t.fonts.map((function(e){var t=Font.get(e.id);return t||(t=new Font(e)),t})),this.bold=t.bold,this.italic=t.italic,this.backgroundColor=""===t.backgroundColor?null:t.backgroundColor,this.boxStyle=t.boxStyle,this.borderColor=""===t.borderColor?null:t.borderColor,this.gradient=t.gradient,this.borderWidth="undefined"!==typeof t.borderWidth?t.borderWidth:0,this.boxShadow=t.boxShadow||!1}},equals:function(e){return!!e&&(s.color(this.color)===s.color(e.color)&&this.fontSize===e.fontSize&&o()(this.fonts,e.fonts)&&this.bold===e.bold&&this.italic===e.italic&&s.color(this.backgroundColor)===s.color(e.backgroundColor)&&this.boxStyle===e.boxStyle&&s.color(this.borderColor)===s.color(e.borderColor)&&this.gradient===e.gradient&&this.borderWidth===e.borderWidth&&this.boxShadow===e.boxShadow)},toJSON:function(){return{id:this.id,name:this.name,color:this.color,fontSize:this.fontSize,fonts:this.fonts.map((function(e){return e.toJSON()})),bold:this.bold,italic:this.italic,backgroundColor:this.backgroundColor,boxStyle:this.boxStyle,borderColor:this.borderColor,gradient:this.gradient,borderWidth:this.borderWidth,boxShadow:this.boxShadow}},hasExternalFonts:function(){return this.fonts.any((function(e){return e.isExternal()}))},externalFonts:function(){return this.fonts.findAll((function(e){return e.isExternal()}))}});s.parse=function(e){if(!Object.isString(e))return e;var t={color:null,fontSize:null,bold:!1,italic:!1,backgroundColor:null,boxStyle:null,borderColor:null,gradient:s.gradientNo};return e?(e.indexOf(",")>=0?(e=e.split(","),t.color=""!=e[0]&&e[0].match(/[a-z0-9]{6}/gi)?e[0]:null,t.fontSize=""!=e[1]?Number(e[1]):null,t.bold=1==Number(e[2]),t.italic=1==Number(e[3]),t.backgroundColor=e[4]&&""!=e[4]?e[4]:null,t.boxStyle=e[5]&&""!=e[5]?Number(e[5]):1,t.borderColor=e[6]&&""!=e[6]?e[6]:null,t.gradient=e[7]&&""!=e[7]?Number(e[7]):s.gradientNo):t.color=e.match(/[a-z0-9]{6}/gi)?e:null,t):t},s.applyFontToElement=function(e,t){if(e&&t){if(e.color&&(t.style.color="#"+e.color),e.fontSize){var n=110;switch(e.fontSize){case 100:n=110;break;case 120:n=135;break;case 150:n=170}t.style.fontSize=n+"%"}if(e.fonts&&e.fonts.length>0){var i=Font.fontFamilyString(e.fonts);t.style.fontFamily!==i&&(t.style.fontFamily=i,Font.loadExternal(e.externalFonts()))}else removeStyle(t,"font-family");t.style.fontWeight=e.bold?"bold":"normal",t.style.fontStyle=e.italic?"italic":"normal"}},s.applyToElement=function(e,t){e&&(s.applyFontToElement(e,t),e.backgroundColor?addGradientBg(t,e.backgroundColor,e.gradient):(t.style.backgroundImage="none",t.style.backgroundColor="transparent"),removeClassName(t,"round"),removeClassName(t,"vround"),removeClassName(t,"straight"),addClassName(t,"bordered"),e.boxStyle===s.boxRound?addClassName(t,"round"):e.boxStyle===s.boxVRound?addClassName(t,"vround"):addClassName(t,"straight"),e.borderWidth>0&&e.borderColor&&"null"!==e.borderColor?t.style.borderColor="#"+e.borderColor:t.style.borderColor="transparent",t.style.borderWidth=Math.max(e.borderWidth,1)+"px",removeClassName(t,"shadow"),removeClassName(t,"noshadow"),e.boxShadow?addClassName(t,"shadow"):addClassName(t,"noshadow"))},s.removeFontFromElement=function(e){removeStyle(e,"color"),removeStyle(e,"font-size"),removeStyle(e,"font-weight"),removeStyle(e,"font-style")},s.removeFromElement=function(e){s.removeFontFromElement(e),removeStyle(e,"background-color"),removeStyle(e,"border-color"),removeStyle(e,"background-image"),removeStyle(e,"border-width"),removeStyle(e,"margin"),removeStyle(e,"font-family"),removeClassName(e,"round"),removeClassName(e,"vround"),removeClassName(e,"straight"),removeClassName(e,"bordered"),removeClassName(e,"shadow"),removeClassName(e,"noshadow")},s.isCustom=function(e){return!!e.style&&!e.style.equals(s._default(e))},s._default=function(e){return e.isRoot()?App.config.mapTheme.root_style:e.parent&&e.parent.isRoot()?App.config.mapTheme.root_children_style:App.config.mapTheme.nodes_style},s.color=function(e){return e?e.toLowerCase():null},s.gradientNo=0,s.gradientLight=1,s.gradientStrong=2,s.gradientGlossy=3,s.boxStraight=0,s.boxRound=1,s.boxVRound=2,s.teamStyles=[],s.userBoundaryStyles=[],t.default=s},CW34:function(e,t,n){"use strict";(function(e){var i=n("2L+8");function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t){return!t||"object"!==o(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=r(this,a(n).call(this,e))).state={selected:t.props.selectedValue},t}var o,c,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),o=n,(c=[{key:"_handleClick",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.props.onSelect(e),this.setState({selected:e})}},{key:"componentDidMount",value:function(){this.tooltips=MM.ui.ToolTips.touchSafe({el:this.container})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.selectedValue&&this.props.selected!==e.selectedValue&&this.setState({selected:e.selectedValue})}},{key:"render",value:function(){var t=this;return e.createElement("div",{ref:function(e){return t.container=e},className:"h-flex-row "+this.props.className},[{name:"small",value:100,className:"m-0",iconSize:"10"},{name:"medium",value:120,className:null,iconSize:"16"},{name:"large",value:150,className:"m-0",iconSize:"20"}].map((function(n,o){var s="tooltip widget-button s-36 "+n.className+(t.state.selected===n.value?" selected":"");return e.createElement("a",{key:o,href:"#",className:s,title:I18n.t("js.text_size.".concat(n.name)),onClick:t._handleClick.bind(t,n.value)},e.createElement(i.a,{opts:{name:"text-size",size:n.iconSize}}))})))}}])&&s(o.prototype,c),d&&s(o,d),n}(e.Component);c.defaultProps={className:"",onSelect:function(){}},t.a=c}).call(this,n("q1tI"))},CZoQ:function(e,t){e.exports=function(e,t,n){for(var i=n-1,o=e.length;++i<o;)if(e[i]===t)return i;return-1}},ClT6:function(e,t,n){"use strict";n.r(t);var i=Class.create({id:null,filename:null,url:null,contentType:null,size:null,createdAt:null,owner:null,initialize:function(e){this.id=e.id,this.filename=e.filename,this.url=e.url,this.contentType=e.contentType,this.size=e.size,this.createdAt=e.createdAt,this.owner=e.owner,i.all.push(this)},equals:function(e){return this.id==e.id},isImage:function(e){return e?0===this.contentType.indexOf("image/"+e):App.config.fileTypes.image.include(this.contentType)},isSvg:function(){return 0===this.contentType.indexOf("image/svg")},isMusic:function(){return 0===this.contentType.indexOf("audio/")},isDocument:function(){return App.config.fileTypes.document.any(function(e){return this.filename.match("."+e+"$")}.bind(this))},isArchive:function(){return App.config.fileTypes.archive.any(function(e){return this.filename.match("."+e+"$")}.bind(this))},isHtml:function(){return App.config.fileTypes.html.include(this.contentType)},isEvernote:function(){return"application/evernote"===this.contentType},getFileType:function(){var e=this.contentType;if(e){if(/^image\/(jpeg|png|gif|bmp|svg|vnd.adobe.photoshop)/.test(e))return"image";if(/^text\/(html|css|x-java-source|java|x-c\+\+|yaml|xul)|^application\/(javascript|json|xml|(xhtml|xslt)\+xml)/.test(e))return"code";if(/^text\/(csv|tab)|^application\/(msword|vnd.openxmlformats\-|vnd.oasis.opendocument)/.test(e))return"text";if(/^audio\//.test(e))return"music";if(/^application\/(zip|x-.*zip.+|x-tar|.+-archive|.+-compressed|x-stuffitx?)/.test(e))return"archive";if(this.isEvernote())return"evernote"}var t=this.filename.replace(/^.+?(?:\.(\w+))?$/,"$1").toLowerCase();if(/^(png|jpe?g|gif|bmp|svg|psd|sketch|pages|jp2|jpx|jxr|webp)$/.test(t))return"image";if(/^(htm|x?html|js|json|s?css|coffee|cson|xml|xslt?|xul|yaml|java|rb|c|cpp|h|hpp|php\d?)$/.test(t))return"code";if(/^(txt|docx?|xlsx?|pdf|csv|tab|rtfd?|otf|ods|odg|odp|odf|md|markdown|ini|cfg)$/.test(t))return"text";if(/^(mp3|flac|ogg|oga|m4a|aiff|wav|aac|amr|wma|mpc)$/.test(t))return"music";if(/^(zip|tar|7z|rar|bzip2|iso|img|gz)/.test(t))return"archive";if(e){if(/^image\//.test(e))return"image";if(/^text\//.test(e))return"text"}return"generic"},isGoogleViewerSupported:function(){var e=this,t=["svg","eps","ps","ttf","xps","tiff","txt"].any((function(t){return e.filename.match("."+t+"$")}));return this.isImage("tif")||this.isDocument()||t},isBoxViewerSupported:function(){if(this.isEvernote())return!1;var e=this;return["as","as3","asm","bat","c","cc","cmake","cpp","cs","css","csv","cxx","diff","doc","docx","erb","gdoc","groovy","gsheet","h","haml","hh","htm","html","java","js","less","m","make","ml","mm","msg","ods","odt","pdf","php","pl","properties","py","rb","rtf","sass","scala","scm","script","sh","sml","sql","txt","vi","vim","wpd","xls","xlsm","xlsx","xml","xsd","xsl","yaml","odp","ppt","pptx","ai","bmp","gif","eps","jpeg","jpg","png","ps","psd","svg","tif","tiff","dcm","dicm","dicom","svs","tga","aac","aifc","aiff","amr","au","flac","m4a","mp3","ogg","ra","wav","wma","3g2","3gp","avi","m2v","m2ts","m4v","mkv","mov","mp4","mpeg","mpg","ogg","mts","qt","wmv","flv","f4v","swf","obj","stl","fbx","3ds","dae","ply"].any((function(t){return e.filename.match("."+t+"$")}))},downloadLink:function(){var e=this.url;return App.config.linkShare&&""!==App.config.linkShareToken&&(e+=(e.indexOf("?")>0?"&":"?")+"t="+App.config.linkShareToken),e},openAsDownload:function(){new Element("a",{href:this.downloadLink(),download:this.filename}).click()}});i.all=[],i.get=function(e){for(var t=i.all.length;t>0;)if(i.all[--t].id==e)return i.all[t];return null},i.dropWidget={getNode:function(e){if(!e.match)return canvas.selected.node;for(;e.parentNode&&(!e.className||!e.className.match(/(tk_label|tk_root)/));)e=e.parentNode;return e&&e.className&&e.className.match(/(tk_label|tk_root)/)?tree.root.getChild(parseInt(e.id)):canvas.selected.node},uploadImageUrl:function(e,t){MM.utils.File.uploadImage([e],{idea_image_url:t},{successCallback:function(e,t){Tree.utils.setImage(new IdeaImage(e),t)}})},uploadLink:function(e,t){Tree.utils.setProperty("link",t,[e]),e._listener.removeLoadingFromDrop(),sideBar&&sideBar.visible&&canvas.selected.node.id==e.id&&sideBar.links.onSelectNode()}},t.default=i},Ddwv:function(e,t,n){var i,o,s;function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}o=[e,n("YDNs"),n("wOJ8"),n("TiCD")],void 0===(s="function"===typeof(i=function(e,t,n,i){"use strict";var o=l(t),s=l(n),a=l(i);function l(e){return e&&e.__esModule?e:{default:e}}var c="function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},d=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),h=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==r(t)&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.resolveOptions(n),i.listenClick(e),i}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+r(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),d(t,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"===typeof e.action?e.action:this.defaultAction,this.target="function"===typeof e.target?e.target:this.defaultTarget,this.text="function"===typeof e.text?e.text:this.defaultText,this.container="object"===c(e.container)?e.container:document.body}},{key:"listenClick",value:function(e){var t=this;this.listener=(0,a.default)(e,"click",(function(e){return t.onClick(e)}))}},{key:"onClick",value:function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new o.default({action:this.action(t),target:this.target(t),text:this.text(t),container:this.container,trigger:t,emitter:this})}},{key:"defaultAction",value:function(e){return u("action",e)}},{key:"defaultTarget",value:function(e){var t=u("target",e);if(t)return document.querySelector(t)}},{key:"defaultText",value:function(e){return u("text",e)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],t="string"===typeof e?[e]:e,n=!!document.queryCommandSupported;return t.forEach((function(e){n=n&&!!document.queryCommandSupported(e)})),n}}]),t}(s.default);function u(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}e.exports=h})?i.apply(t,o):i)||(e.exports=s)},DzJC:function(e,t,n){var i=n("sEfC"),o=n("GoyQ"),s="Expected a function";e.exports=function(e,t,n){var r=!0,a=!0;if("function"!=typeof e)throw new TypeError(s);return o(n)&&(r="leading"in n?!!n.leading:r,a="trailing"in n?!!n.trailing:a),i(e,t,{leading:r,maxWait:t,trailing:a})}},EA7m:function(e,t,n){var i=n("zZ0H"),o=n("Ioao"),s=n("wclG");e.exports=function(e,t){return s(o(e,t,i),e+"")}},ERGR:function(e,t,n){"use strict";(function(e){var i=n("eQkx"),o=n("Pqld");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?l(e):t}(this,a(n).call(this,e))).state={items:e.items},t.onMouseLeave=t.onMouseLeave.bind(l(t)),t.onMouseEnter=t.onMouseEnter.bind(l(t)),t.unselectAll=t.unselectAll.bind(l(t)),t.updateSelection=t.updateSelection.bind(l(t)),t}var d,h,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,t),d=n,(h=[{key:"onMouseLeave",value:function(){this.props.onMouseLeave?this.props.onMouseLeave(-1):this.updateSelection(-1)}},{key:"onMouseEnter",value:function(e){this.props.onMouseEnter?this.props.onMouseEnter(e):this.updateSelection(e)}},{key:"unselectAll",value:function(){var e=this.state.items;return e[this.index]&&(e[this.index].highlighted=!1),e}},{key:"updateSelection",value:function(e){var t=this.unselectAll();this.index=e,t[this.index]&&(t[this.index].highlighted=!0),this.setState({allItems:t})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({items:e.items})}},{key:"render",value:function(){var t=this,n=this.props.indexStart||0;return e.createElement("div",{className:"widget-container list-widget ".concat(this.props.className)},this.props.header?e.createElement(o.a,this.props.header):null,this.state.items.map((function(o,s){return e.createElement(i.a,{key:s,icon:o.icon,label:o.label,className:o.className,isDisabled:o.isDisabled,style:o.style,onClick:o.onClick,closePopover:t.props.closePopoverOnItemClick,subMenu:o.subMenu,selected:o.selected,highlighted:o.highlighted,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave,enableParentKeyMap:t.props.enableParentKeyMap,disableParentKeyMap:t.props.disableParentKeyMap,index:n+s,backgroundColor:o.backgroundColor})})))}}])&&r(d.prototype,h),u&&r(d,u),n}(e.Component);d.defaultProps={className:"",closePopoverOnItemClick:!0},t.a=d}).call(this,n("q1tI"))},Em2t:function(e,t,n){var i=n("bahg"),o=n("quyA"),s=n("0JQy");e.exports=function(e){return o(e)?s(e):i(e)}},EwQA:function(e,t,n){var i=n("zZ0H");e.exports=function(e){return"function"==typeof e?e:i}},ExA7:function(e,t){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.exports=function(e){return null!=e&&"object"==n(e)}},FQ1s:function(e,t,n){(function(e){var n,i,o,s;function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}s=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var o=t[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t,n){var i,o;i=[n(1),n(3),n(4)],void 0===(o=function(e){return e}.apply(t,i))||(e.exports=o)},function(e,t,n){var i,o;i=[n(2)],void 0===(o=function(e){function t(i){if(t.is(i,"function"))return n?i():e.on("raphael.DOMload",i);if(t.is(i,P))return t._engine.create[f](t,i.splice(0,3+t.is(i[0],O))).add(i);var o=Array.prototype.slice.call(arguments,0);if(t.is(o[o.length-1],"function")){var s=o.pop();return n?s.call(t._engine.create[f](t,o)):e.on("raphael.DOMload",(function(){s.call(t._engine.create[f](t,o))}))}return t._engine.create[f](t,arguments)}t.version="2.2.0",t.eve=e;var n,i,o,s,a=/[, ]+/,l={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},c=/\{(\d+)\}/g,d="hasOwnProperty",h={doc:document,win:window},u={was:Object.prototype[d].call(h.win,"Raphael"),is:h.win.Raphael},p=function(){this.ca=this.customAttributes={}},f="apply",m="concat",g="ontouchstart"in h.win||h.win.DocumentTouch&&h.doc instanceof DocumentTouch,v="",y=" ",_=String,b="split",w="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[b](y),C={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},x=_.prototype.toLowerCase,S=Math,k=S.max,A=S.min,E=S.abs,M=S.pow,I=S.PI,O="number",P="array",T=Object.prototype.toString,L=(t._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),N={NaN:1,Infinity:1,"-Infinity":1},R=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,D=S.round,j=parseFloat,B=parseInt,z=_.prototype.toUpperCase,F=t._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},V=t._availableAnimAttrs={blur:O,"clip-rect":"csv",cx:O,cy:O,fill:"colour","fill-opacity":O,"font-size":O,height:O,opacity:O,path:"path",r:O,rx:O,ry:O,stroke:"colour","stroke-opacity":O,"stroke-width":O,transform:"transform",width:O,x:O,y:O},H=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,U={hs:1,rg:1},$=/,?([achlmqrstvxz]),?/gi,q=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,W=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,G=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,K=(t._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),Y=function(e,t){return j(e)-j(t)},Z=function(e){return e},J=t._rectPath=function(e,t,n,i,o){return o?[["M",e+o,t],["l",n-2*o,0],["a",o,o,0,0,1,o,o],["l",0,i-2*o],["a",o,o,0,0,1,-o,o],["l",2*o-n,0],["a",o,o,0,0,1,-o,-o],["l",0,2*o-i],["a",o,o,0,0,1,o,-o],["z"]]:[["M",e,t],["l",n,0],["l",0,i],["l",-n,0],["z"]]},X=function(e,t,n,i){return null==i&&(i=n),[["M",e,t],["m",0,-i],["a",n,i,0,1,1,0,2*i],["a",n,i,0,1,1,0,-2*i],["z"]]},Q=t._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return X(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return X(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return J(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return J(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return J(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return J(t.x,t.y,t.width,t.height)}},ee=t.mapPath=function(e,t){if(!t)return e;var n,i,o,s,r,a,l;for(o=0,r=(e=Me(e)).length;o<r;o++)for(s=1,a=(l=e[o]).length;s<a;s+=2)n=t.x(l[s],l[s+1]),i=t.y(l[s],l[s+1]),l[s]=n,l[s+1]=i;return e};if(t._g=h,t.type=h.win.SVGAngle||h.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==t.type){var te,ne=h.doc.createElement("div");if(ne.innerHTML='<v:shape adj="1"/>',(te=ne.firstChild).style.behavior="url(#default#VML)",!te||"object"!=r(te.adj))return t.type=v;ne=null}function ie(e){if("function"==typeof e||Object(e)!==e)return e;var t=new e.constructor;for(var n in e)e[d](n)&&"prototype"!==n&&(t[n]=ie(e[n]));return t}t.svg=!(t.vml="VML"==t.type),t._Paper=p,t.fn=i=p.prototype=t.prototype,t._id=0,t.is=function(e,t){return"finite"==(t=x.call(t))?!N[d](+e):"array"==t?e instanceof Array:"null"==t&&null===e||t==r(e)&&null!==e||"object"==t&&e===Object(e)||"array"==t&&Array.isArray&&Array.isArray(e)||T.call(e).slice(8,-1).toLowerCase()==t},t.angle=function(e,n,i,o,s,r){if(null==s){var a=e-i,l=n-o;return a||l?(180+180*S.atan2(-l,-a)/I+360)%360:0}return t.angle(e,n,s,r)-t.angle(i,o,s,r)},t.rad=function(e){return e%360*I/180},t.deg=function(e){return Math.round(180*e/I%360*1e3)/1e3},t.snapTo=function(e,n,i){if(i=t.is(i,"finite")?i:10,t.is(e,P)){for(var o=e.length;o--;)if(E(e[o]-n)<=i)return e[o]}else{var s=n%(e=+e);if(s<i)return n-s;if(s>e-i)return n-s+e}return n},t.createUUID=(o=/[xy]/g,s=function(e){var t=16*S.random()|0;return("x"==e?t:3&t|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(o,s).toUpperCase()}),t.setWindow=function(n){e("raphael.setWindow",t,h.win,n),h.win=n,h.doc=h.win.document,t._engine.initWin&&t._engine.initWin(h.win)};var oe=function(e){if(t.vml){var n,i=/^\s+|\s+$/g;try{var o=new ActiveXObject("htmlfile");o.write("<body>"),o.close(),n=o.body}catch(a){n=createPopup().document.body}var s=n.createTextRange();oe=de((function(e){try{n.style.color=_(e).replace(i,v);var t=s.queryCommandValue("ForeColor");return"#"+("000000"+(t=(255&t)<<16|65280&t|(16711680&t)>>>16).toString(16)).slice(-6)}catch(a){return"none"}}))}else{var r=h.doc.createElement("i");r.title="Rapha\xebl Colour Picker",r.style.display="none",h.doc.body.appendChild(r),oe=de((function(e){return r.style.color=e,h.doc.defaultView.getComputedStyle(r,v).getPropertyValue("color")}))}return oe(e)},se=function(){return"hsb("+[this.h,this.s,this.b]+")"},re=function(){return"hsl("+[this.h,this.s,this.l]+")"},ae=function(){return this.hex},le=function(e,n,i){if(null==n&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(i=e.b,n=e.g,e=e.r),null==n&&t.is(e,"string")){var o=t.getRGB(e);e=o.r,n=o.g,i=o.b}return(e>1||n>1||i>1)&&(e/=255,n/=255,i/=255),[e,n,i]},ce=function(e,n,i,o){var s={r:e*=255,g:n*=255,b:i*=255,hex:t.rgb(e,n,i),toString:ae};return t.is(o,"finite")&&(s.opacity=o),s};function de(e,t,n){return function i(){var o=Array.prototype.slice.call(arguments,0),s=o.join("\u2400"),r=i.cache=i.cache||{},a=i.count=i.count||[];return r[d](s)?(function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return e.push(e.splice(n,1)[0])}(a,s),n?n(r[s]):r[s]):(a.length>=1e3&&delete r[a.shift()],a.push(s),r[s]=e[f](t,o),n?n(r[s]):r[s])}}function he(){return this.hex}function ue(e,t){for(var n=[],i=0,o=e.length;o-2*!t>i;i+=2){var s=[{x:+e[i-2],y:+e[i-1]},{x:+e[i],y:+e[i+1]},{x:+e[i+2],y:+e[i+3]},{x:+e[i+4],y:+e[i+5]}];t?i?o-4==i?s[3]={x:+e[0],y:+e[1]}:o-2==i&&(s[2]={x:+e[0],y:+e[1]},s[3]={x:+e[2],y:+e[3]}):s[0]={x:+e[o-2],y:+e[o-1]}:o-4==i?s[3]=s[2]:i||(s[0]={x:+e[i],y:+e[i+1]}),n.push(["C",(-s[0].x+6*s[1].x+s[2].x)/6,(-s[0].y+6*s[1].y+s[2].y)/6,(s[1].x+6*s[2].x-s[3].x)/6,(s[1].y+6*s[2].y-s[3].y)/6,s[2].x,s[2].y])}return n}t.color=function(e){var n;return t.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(n=t.hsb2rgb(e),e.r=n.r,e.g=n.g,e.b=n.b,e.hex=n.hex):t.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(n=t.hsl2rgb(e),e.r=n.r,e.g=n.g,e.b=n.b,e.hex=n.hex):(t.is(e,"string")&&(e=t.getRGB(e)),t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(n=t.rgb2hsl(e),e.h=n.h,e.s=n.s,e.l=n.l,n=t.rgb2hsb(e),e.v=n.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=ae,e},t.hsb2rgb=function(e,t,n,i){var o,s,r,a,l;return this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(n=e.b,t=e.s,i=e.o,e=e.h),a=(l=n*t)*(1-E((e=(e*=360)%360/60)%2-1)),o=s=r=n-l,ce(o+=[l,a,0,0,a,l][e=~~e],s+=[a,l,l,a,0,0][e],r+=[0,0,a,l,l,a][e],i)},t.hsl2rgb=function(e,t,n,i){var o,s,r,a,l;return this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(n=e.l,t=e.s,e=e.h),(e>1||t>1||n>1)&&(e/=360,t/=100,n/=100),a=(l=2*t*(n<.5?n:1-n))*(1-E((e=(e*=360)%360/60)%2-1)),o=s=r=n-l/2,ce(o+=[l,a,0,0,a,l][e=~~e],s+=[a,l,l,a,0,0][e],r+=[0,0,a,l,l,a][e],i)},t.rgb2hsb=function(e,t,n){var i,o;return e=(n=le(e,t,n))[0],t=n[1],n=n[2],{h:((0==(o=(i=k(e,t,n))-A(e,t,n))?null:i==e?(t-n)/o:i==t?(n-e)/o+2:(e-t)/o+4)+360)%6*60/360,s:0==o?0:o/i,b:i,toString:se}},t.rgb2hsl=function(e,t,n){var i,o,s,r;return e=(n=le(e,t,n))[0],t=n[1],n=n[2],i=((o=k(e,t,n))+(s=A(e,t,n)))/2,{h:((0==(r=o-s)?null:o==e?(t-n)/r:o==t?(n-e)/r+2:(e-t)/r+4)+360)%6*60/360,s:0==r?0:i<.5?r/(2*i):r/(2-2*i),l:i,toString:re}},t._path2string=function(){return this.join(",").replace($,"$1")},t._preload=function(e,t){var n=h.doc.createElement("img");n.style.cssText="position:absolute;left:-9999em;top:-9999em",n.onload=function(){t.call(this),this.onload=null,h.doc.body.removeChild(this)},n.onerror=function(){h.doc.body.removeChild(this)},h.doc.body.appendChild(n),n.src=e},t.getRGB=de((function(e){if(!e||(e=_(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:he};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:he};!U[d](e.toLowerCase().substring(0,2))&&"#"!=e.charAt()&&(e=oe(e));var n,i,o,s,r,a,l=e.match(L);return l?(l[2]&&(o=B(l[2].substring(5),16),i=B(l[2].substring(3,5),16),n=B(l[2].substring(1,3),16)),l[3]&&(o=B((r=l[3].charAt(3))+r,16),i=B((r=l[3].charAt(2))+r,16),n=B((r=l[3].charAt(1))+r,16)),l[4]&&(a=l[4][b](H),n=j(a[0]),"%"==a[0].slice(-1)&&(n*=2.55),i=j(a[1]),"%"==a[1].slice(-1)&&(i*=2.55),o=j(a[2]),"%"==a[2].slice(-1)&&(o*=2.55),"rgba"==l[1].toLowerCase().slice(0,4)&&(s=j(a[3])),a[3]&&"%"==a[3].slice(-1)&&(s/=100)),l[5]?(a=l[5][b](H),n=j(a[0]),"%"==a[0].slice(-1)&&(n*=2.55),i=j(a[1]),"%"==a[1].slice(-1)&&(i*=2.55),o=j(a[2]),"%"==a[2].slice(-1)&&(o*=2.55),("deg"==a[0].slice(-3)||"\xb0"==a[0].slice(-1))&&(n/=360),"hsba"==l[1].toLowerCase().slice(0,4)&&(s=j(a[3])),a[3]&&"%"==a[3].slice(-1)&&(s/=100),t.hsb2rgb(n,i,o,s)):l[6]?(a=l[6][b](H),n=j(a[0]),"%"==a[0].slice(-1)&&(n*=2.55),i=j(a[1]),"%"==a[1].slice(-1)&&(i*=2.55),o=j(a[2]),"%"==a[2].slice(-1)&&(o*=2.55),("deg"==a[0].slice(-3)||"\xb0"==a[0].slice(-1))&&(n/=360),"hsla"==l[1].toLowerCase().slice(0,4)&&(s=j(a[3])),a[3]&&"%"==a[3].slice(-1)&&(s/=100),t.hsl2rgb(n,i,o,s)):((l={r:n,g:i,b:o,toString:he}).hex="#"+(16777216|o|i<<8|n<<16).toString(16).slice(1),t.is(s,"finite")&&(l.opacity=s),l)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:he}}),t),t.hsb=de((function(e,n,i){return t.hsb2rgb(e,n,i).hex})),t.hsl=de((function(e,n,i){return t.hsl2rgb(e,n,i).hex})),t.rgb=de((function(e,t,n){function i(e){return e+.5|0}return"#"+(16777216|i(n)|i(t)<<8|i(e)<<16).toString(16).slice(1)})),t.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},n=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),n.hex},t.getColor.reset=function(){delete this.start},t.parsePathString=function(e){if(!e)return null;var n=pe(e);if(n.arr)return be(n.arr);var i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},o=[];return t.is(e,P)&&t.is(e[0],P)&&(o=be(e)),o.length||_(e).replace(q,(function(e,t,n){var s=[],r=t.toLowerCase();if(n.replace(G,(function(e,t){t&&s.push(+t)})),"m"==r&&s.length>2&&(o.push([t][m](s.splice(0,2))),r="l",t="m"==t?"l":"L"),"r"==r)o.push([t][m](s));else for(;s.length>=i[r]&&(o.push([t][m](s.splice(0,i[r]))),i[r]););})),o.toString=t._path2string,n.arr=be(o),o},t.parseTransformString=de((function(e){if(!e)return null;var n=[];return t.is(e,P)&&t.is(e[0],P)&&(n=be(e)),n.length||_(e).replace(W,(function(e,t,i){var o=[];x.call(t),i.replace(G,(function(e,t){t&&o.push(+t)})),n.push([t][m](o))})),n.toString=t._path2string,n}));var pe=function e(t){var n=e.ps=e.ps||{};return n[t]?n[t].sleep=100:n[t]={sleep:100},setTimeout((function(){for(var e in n)n[d](e)&&e!=t&&(n[e].sleep--,!n[e].sleep&&delete n[e])})),n[t]};function fe(e,t,n,i,o){return e*(e*(-3*t+9*n-9*i+3*o)+6*t-12*n+6*i)-3*t+3*n}function me(e,t,n,i,o,s,r,a,l){null==l&&(l=1);for(var c=(l=l>1?1:l<0?0:l)/2,d=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],u=0,p=0;p<12;p++){var f=c*d[p]+c,m=fe(f,e,n,o,r),g=fe(f,t,i,s,a),v=m*m+g*g;u+=h[p]*S.sqrt(v)}return c*u}function ge(e,t,n,i,o,s,r,a){if(!(k(e,n)<A(o,r)||A(e,n)>k(o,r)||k(t,i)<A(s,a)||A(t,i)>k(s,a))){var l=(e-n)*(s-a)-(t-i)*(o-r);if(l){var c=((e*i-t*n)*(o-r)-(e-n)*(o*a-s*r))/l,d=((e*i-t*n)*(s-a)-(t-i)*(o*a-s*r))/l,h=+c.toFixed(2),u=+d.toFixed(2);if(!(h<+A(e,n).toFixed(2)||h>+k(e,n).toFixed(2)||h<+A(o,r).toFixed(2)||h>+k(o,r).toFixed(2)||u<+A(t,i).toFixed(2)||u>+k(t,i).toFixed(2)||u<+A(s,a).toFixed(2)||u>+k(s,a).toFixed(2)))return{x:c,y:d}}}}function ve(e,n,i){var o=t.bezierBBox(e),s=t.bezierBBox(n);if(!t.isBBoxIntersect(o,s))return i?0:[];for(var r=me.apply(0,e),a=me.apply(0,n),l=k(~~(r/5),1),c=k(~~(a/5),1),d=[],h=[],u={},p=i?0:[],f=0;f<l+1;f++){var m=t.findDotsAtSegment.apply(t,e.concat(f/l));d.push({x:m.x,y:m.y,t:f/l})}for(f=0;f<c+1;f++)m=t.findDotsAtSegment.apply(t,n.concat(f/c)),h.push({x:m.x,y:m.y,t:f/c});for(f=0;f<l;f++)for(var g=0;g<c;g++){var v=d[f],y=d[f+1],_=h[g],b=h[g+1],w=E(y.x-v.x)<.001?"y":"x",C=E(b.x-_.x)<.001?"y":"x",x=ge(v.x,v.y,y.x,y.y,_.x,_.y,b.x,b.y);if(x){if(u[x.x.toFixed(4)]==x.y.toFixed(4))continue;u[x.x.toFixed(4)]=x.y.toFixed(4);var S=v.t+E((x[w]-v[w])/(y[w]-v[w]))*(y.t-v.t),M=_.t+E((x[C]-_[C])/(b[C]-_[C]))*(b.t-_.t);S>=0&&S<=1.001&&M>=0&&M<=1.001&&(i?p++:p.push({x:x.x,y:x.y,t1:A(S,1),t2:A(M,1)}))}}return p}function ye(e,n,i){e=t._path2curve(e),n=t._path2curve(n);for(var o,s,r,a,l,c,d,h,u,p,f=i?0:[],m=0,g=e.length;m<g;m++){var v=e[m];if("M"==v[0])o=l=v[1],s=c=v[2];else{"C"==v[0]?(u=[o,s].concat(v.slice(1)),o=u[6],s=u[7]):(u=[o,s,o,s,l,c,l,c],o=l,s=c);for(var y=0,_=n.length;y<_;y++){var b=n[y];if("M"==b[0])r=d=b[1],a=h=b[2];else{"C"==b[0]?(p=[r,a].concat(b.slice(1)),r=p[6],a=p[7]):(p=[r,a,r,a,d,h,d,h],r=d,a=h);var w=ve(u,p,i);if(i)f+=w;else{for(var C=0,x=w.length;C<x;C++)w[C].segment1=m,w[C].segment2=y,w[C].bez1=u,w[C].bez2=p;f=f.concat(w)}}}}}return f}t.findDotsAtSegment=function(e,t,n,i,o,s,r,a,l){var c=1-l,d=M(c,3),h=M(c,2),u=l*l,p=u*l,f=d*e+3*h*l*n+3*c*l*l*o+p*r,m=d*t+3*h*l*i+3*c*l*l*s+p*a,g=e+2*l*(n-e)+u*(o-2*n+e),v=t+2*l*(i-t)+u*(s-2*i+t),y=n+2*l*(o-n)+u*(r-2*o+n),_=i+2*l*(s-i)+u*(a-2*s+i),b=c*e+l*n,w=c*t+l*i,C=c*o+l*r,x=c*s+l*a,k=90-180*S.atan2(g-y,v-_)/I;return(g>y||v<_)&&(k+=180),{x:f,y:m,m:{x:g,y:v},n:{x:y,y:_},start:{x:b,y:w},end:{x:C,y:x},alpha:k}},t.bezierBBox=function(e,n,i,o,s,r,a,l){t.is(e,"array")||(e=[e,n,i,o,s,r,a,l]);var c=Ee.apply(null,e);return{x:c.min.x,y:c.min.y,x2:c.max.x,y2:c.max.y,width:c.max.x-c.min.x,height:c.max.y-c.min.y}},t.isPointInsideBBox=function(e,t,n){return t>=e.x&&t<=e.x2&&n>=e.y&&n<=e.y2},t.isBBoxIntersect=function(e,n){var i=t.isPointInsideBBox;return i(n,e.x,e.y)||i(n,e.x2,e.y)||i(n,e.x,e.y2)||i(n,e.x2,e.y2)||i(e,n.x,n.y)||i(e,n.x2,n.y)||i(e,n.x,n.y2)||i(e,n.x2,n.y2)||(e.x<n.x2&&e.x>n.x||n.x<e.x2&&n.x>e.x)&&(e.y<n.y2&&e.y>n.y||n.y<e.y2&&n.y>e.y)},t.pathIntersection=function(e,t){return ye(e,t)},t.pathIntersectionNumber=function(e,t){return ye(e,t,1)},t.isPointInsidePath=function(e,n,i){var o=t.pathBBox(e);return t.isPointInsideBBox(o,n,i)&&ye(e,[["M",n,i],["H",o.x2+10]],1)%2==1},t._removedFactory=function(t){return function(){e("raphael.log",null,"Rapha\xebl: you are calling to method \u201c"+t+"\u201d of removed object",t)}};var _e=t.pathBBox=function(e){var t=pe(e);if(t.bbox)return ie(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};for(var n,i=0,o=0,s=[],r=[],a=0,l=(e=Me(e)).length;a<l;a++)if("M"==(n=e[a])[0])i=n[1],o=n[2],s.push(i),r.push(o);else{var c=Ee(i,o,n[1],n[2],n[3],n[4],n[5],n[6]);s=s[m](c.min.x,c.max.x),r=r[m](c.min.y,c.max.y),i=n[5],o=n[6]}var d=A[f](0,s),h=A[f](0,r),u=k[f](0,s),p=k[f](0,r),g=u-d,v=p-h,y={x:d,y:h,x2:u,y2:p,width:g,height:v,cx:d+g/2,cy:h+v/2};return t.bbox=ie(y),y},be=function(e){var n=ie(e);return n.toString=t._path2string,n},we=t._pathToRelative=function(e){var n=pe(e);if(n.rel)return be(n.rel);t.is(e,P)&&t.is(e&&e[0],P)||(e=t.parsePathString(e));var i=[],o=0,s=0,r=0,a=0,l=0;"M"==e[0][0]&&(r=o=e[0][1],a=s=e[0][2],l++,i.push(["M",o,s]));for(var c=l,d=e.length;c<d;c++){var h=i[c]=[],u=e[c];if(u[0]!=x.call(u[0]))switch(h[0]=x.call(u[0]),h[0]){case"a":h[1]=u[1],h[2]=u[2],h[3]=u[3],h[4]=u[4],h[5]=u[5],h[6]=+(u[6]-o).toFixed(3),h[7]=+(u[7]-s).toFixed(3);break;case"v":h[1]=+(u[1]-s).toFixed(3);break;case"m":r=u[1],a=u[2];default:for(var p=1,f=u.length;p<f;p++)h[p]=+(u[p]-(p%2?o:s)).toFixed(3)}else{h=i[c]=[],"m"==u[0]&&(r=u[1]+o,a=u[2]+s);for(var m=0,g=u.length;m<g;m++)i[c][m]=u[m]}var v=i[c].length;switch(i[c][0]){case"z":o=r,s=a;break;case"h":o+=+i[c][v-1];break;case"v":s+=+i[c][v-1];break;default:o+=+i[c][v-2],s+=+i[c][v-1]}}return i.toString=t._path2string,n.rel=be(i),i},Ce=t._pathToAbsolute=function(e){var n=pe(e);if(n.abs)return be(n.abs);if(t.is(e,P)&&t.is(e&&e[0],P)||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];var i=[],o=0,s=0,r=0,a=0,l=0;"M"==e[0][0]&&(r=o=+e[0][1],a=s=+e[0][2],l++,i[0]=["M",o,s]);for(var c,d,h=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),u=l,p=e.length;u<p;u++){if(i.push(c=[]),(d=e[u])[0]!=z.call(d[0]))switch(c[0]=z.call(d[0]),c[0]){case"A":c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=+(d[6]+o),c[7]=+(d[7]+s);break;case"V":c[1]=+d[1]+s;break;case"H":c[1]=+d[1]+o;break;case"R":for(var f=[o,s][m](d.slice(1)),g=2,v=f.length;g<v;g++)f[g]=+f[g]+o,f[++g]=+f[g]+s;i.pop(),i=i[m](ue(f,h));break;case"M":r=+d[1]+o,a=+d[2]+s;default:for(g=1,v=d.length;g<v;g++)c[g]=+d[g]+(g%2?o:s)}else if("R"==d[0])f=[o,s][m](d.slice(1)),i.pop(),i=i[m](ue(f,h)),c=["R"][m](d.slice(-2));else for(var y=0,_=d.length;y<_;y++)c[y]=d[y];switch(c[0]){case"Z":o=r,s=a;break;case"H":o=c[1];break;case"V":s=c[1];break;case"M":r=c[c.length-2],a=c[c.length-1];default:o=c[c.length-2],s=c[c.length-1]}}return i.toString=t._path2string,n.abs=be(i),i},xe=function(e,t,n,i){return[e,t,n,i,n,i]},Se=function(e,t,n,i,o,s){return[1/3*e+2/3*n,1/3*t+2/3*i,1/3*o+2/3*n,1/3*s+2/3*i,o,s]},ke=function e(t,n,i,o,s,r,a,l,c,d){var h,u=120*I/180,p=I/180*(+s||0),f=[],g=de((function(e,t,n){return{x:e*S.cos(n)-t*S.sin(n),y:e*S.sin(n)+t*S.cos(n)}}));if(d)M=d[0],O=d[1],k=d[2],A=d[3];else{t=(h=g(t,n,-p)).x,n=h.y,l=(h=g(l,c,-p)).x,c=h.y,S.cos(I/180*s),S.sin(I/180*s);var v=(t-l)/2,y=(n-c)/2,_=v*v/(i*i)+y*y/(o*o);_>1&&(i*=_=S.sqrt(_),o*=_);var w=i*i,C=o*o,x=(r==a?-1:1)*S.sqrt(E((w*C-w*y*y-C*v*v)/(w*y*y+C*v*v))),k=x*i*y/o+(t+l)/2,A=x*-o*v/i+(n+c)/2,M=S.asin(((n-A)/o).toFixed(9)),O=S.asin(((c-A)/o).toFixed(9));(M=t<k?I-M:M)<0&&(M=2*I+M),(O=l<k?I-O:O)<0&&(O=2*I+O),a&&M>O&&(M-=2*I),!a&&O>M&&(O-=2*I)}var P=O-M;if(E(P)>u){var T=O,L=l,N=c;O=M+u*(a&&O>M?1:-1),f=e(l=k+i*S.cos(O),c=A+o*S.sin(O),i,o,s,0,a,L,N,[O,T,k,A])}P=O-M;var R=S.cos(M),D=S.sin(M),j=S.cos(O),B=S.sin(O),z=S.tan(P/4),F=4/3*i*z,V=4/3*o*z,H=[t,n],U=[t+F*D,n-V*R],$=[l+F*B,c-V*j],q=[l,c];if(U[0]=2*H[0]-U[0],U[1]=2*H[1]-U[1],d)return[U,$,q][m](f);for(var W=[],G=0,K=(f=[U,$,q][m](f).join()[b](",")).length;G<K;G++)W[G]=G%2?g(f[G-1],f[G],p).y:g(f[G],f[G+1],p).x;return W},Ae=function(e,t,n,i,o,s,r,a,l){var c=1-l;return{x:M(c,3)*e+3*M(c,2)*l*n+3*c*l*l*o+M(l,3)*r,y:M(c,3)*t+3*M(c,2)*l*i+3*c*l*l*s+M(l,3)*a}},Ee=de((function(e,t,n,i,o,s,r,a){var l,c=o-2*n+e-(r-2*o+n),d=2*(n-e)-2*(o-n),h=e-n,u=(-d+S.sqrt(d*d-4*c*h))/2/c,p=(-d-S.sqrt(d*d-4*c*h))/2/c,m=[t,a],g=[e,r];return E(u)>"1e12"&&(u=.5),E(p)>"1e12"&&(p=.5),u>0&&u<1&&(l=Ae(e,t,n,i,o,s,r,a,u),g.push(l.x),m.push(l.y)),p>0&&p<1&&(l=Ae(e,t,n,i,o,s,r,a,p),g.push(l.x),m.push(l.y)),c=s-2*i+t-(a-2*s+i),h=t-i,u=(-(d=2*(i-t)-2*(s-i))+S.sqrt(d*d-4*c*h))/2/c,p=(-d-S.sqrt(d*d-4*c*h))/2/c,E(u)>"1e12"&&(u=.5),E(p)>"1e12"&&(p=.5),u>0&&u<1&&(l=Ae(e,t,n,i,o,s,r,a,u),g.push(l.x),m.push(l.y)),p>0&&p<1&&(l=Ae(e,t,n,i,o,s,r,a,p),g.push(l.x),m.push(l.y)),{min:{x:A[f](0,g),y:A[f](0,m)},max:{x:k[f](0,g),y:k[f](0,m)}}})),Me=t._path2curve=de((function(e,t){var n=!t&&pe(e);if(!t&&n.curve)return be(n.curve);for(var i=Ce(e),o=t&&Ce(t),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=function(e,t,n){var i,o;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][m](ke[f](0,[t.x,t.y][m](e.slice(1))));break;case"S":"C"==n||"S"==n?(i=2*t.x-t.bx,o=2*t.y-t.by):(i=t.x,o=t.y),e=["C",i,o][m](e.slice(1));break;case"T":"Q"==n||"T"==n?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"][m](Se(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][m](Se(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][m](xe(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][m](xe(t.x,t.y,e[1],t.y));break;case"V":e=["C"][m](xe(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][m](xe(t.x,t.y,t.X,t.Y))}return e},l=function(e,t){if(e[t].length>7){e[t].shift();for(var n=e[t];n.length;)d[t]="A",o&&(h[t]="A"),e.splice(t++,0,["C"][m](n.splice(0,6)));e.splice(t,1),v=k(i.length,o&&o.length||0)}},c=function(e,t,n,s,r){e&&t&&"M"==e[r][0]&&"M"!=t[r][0]&&(t.splice(r,0,["M",s.x,s.y]),n.bx=0,n.by=0,n.x=e[r][1],n.y=e[r][2],v=k(i.length,o&&o.length||0))},d=[],h=[],u="",p="",g=0,v=k(i.length,o&&o.length||0);g<v;g++){i[g]&&(u=i[g][0]),"C"!=u&&(d[g]=u,g&&(p=d[g-1])),i[g]=a(i[g],s,p),"A"!=d[g]&&"C"==u&&(d[g]="C"),l(i,g),o&&(o[g]&&(u=o[g][0]),"C"!=u&&(h[g]=u,g&&(p=h[g-1])),o[g]=a(o[g],r,p),"A"!=h[g]&&"C"==u&&(h[g]="C"),l(o,g)),c(i,o,s,r,g),c(o,i,r,s,g);var y=i[g],_=o&&o[g],b=y.length,w=o&&_.length;s.x=y[b-2],s.y=y[b-1],s.bx=j(y[b-4])||s.x,s.by=j(y[b-3])||s.y,r.bx=o&&(j(_[w-4])||r.x),r.by=o&&(j(_[w-3])||r.y),r.x=o&&_[w-2],r.y=o&&_[w-1]}return o||(n.curve=be(i)),o?[i,o]:i}),null,be),Ie=(t._parseDots=de((function(e){for(var n=[],i=0,o=e.length;i<o;i++){var s={},r=e[i].match(/^([^:]*):?([\d\.]*)/);if(s.color=t.getRGB(r[1]),s.color.error)return null;s.opacity=s.color.opacity,s.color=s.color.hex,r[2]&&(s.offset=r[2]+"%"),n.push(s)}for(i=1,o=n.length-1;i<o;i++)if(!n[i].offset){for(var a=j(n[i-1].offset||0),l=0,c=i+1;c<o;c++)if(n[c].offset){l=n[c].offset;break}l||(l=100,c=o);for(var d=((l=j(l))-a)/(c-i+1);i<c;i++)a+=d,n[i].offset=a+"%"}return n})),t._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),Oe=(t._tofront=function(e,t){t.top!==e&&(Ie(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},t._toback=function(e,t){t.bottom!==e&&(Ie(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},t._insertafter=function(e,t,n){Ie(e,n),t==n.top&&(n.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},t._insertbefore=function(e,t,n){Ie(e,n),t==n.bottom&&(n.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},t.toMatrix=function(e,t){var n=_e(e),i={_:{transform:v},getBBox:function(){return n}};return Pe(i,t),i.matrix}),Pe=(t.transformPath=function(e,t){return ee(e,Oe(e,t))},t._extractTransform=function(e,n){if(null==n)return e._.transform;n=_(n).replace(/\.{3}|\u2026/g,e._.transform||v);var i,o,s=t.parseTransformString(n),r=0,a=1,l=1,c=e._,d=new Ne;if(c.transform=s||[],s)for(var h=0,u=s.length;h<u;h++){var p,f,m,g,y,b=s[h],w=b.length,C=_(b[0]).toLowerCase(),x=b[0]!=C,S=x?d.invert():0;"t"==C&&3==w?x?(p=S.x(0,0),f=S.y(0,0),m=S.x(b[1],b[2]),g=S.y(b[1],b[2]),d.translate(m-p,g-f)):d.translate(b[1],b[2]):"r"==C?2==w?(y=y||e.getBBox(1),d.rotate(b[1],y.x+y.width/2,y.y+y.height/2),r+=b[1]):4==w&&(x?(m=S.x(b[2],b[3]),g=S.y(b[2],b[3]),d.rotate(b[1],m,g)):d.rotate(b[1],b[2],b[3]),r+=b[1]):"s"==C?2==w||3==w?(y=y||e.getBBox(1),d.scale(b[1],b[w-1],y.x+y.width/2,y.y+y.height/2),a*=b[1],l*=b[w-1]):5==w&&(x?(m=S.x(b[3],b[4]),g=S.y(b[3],b[4]),d.scale(b[1],b[2],m,g)):d.scale(b[1],b[2],b[3],b[4]),a*=b[1],l*=b[2]):"m"==C&&7==w&&d.add(b[1],b[2],b[3],b[4],b[5],b[6]),c.dirtyT=1,e.matrix=d}e.matrix=d,c.sx=a,c.sy=l,c.deg=r,c.dx=i=d.e,c.dy=o=d.f,1==a&&1==l&&!r&&c.bbox?(c.bbox.x+=+i,c.bbox.y+=+o):c.dirtyT=1}),Te=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return 4==e.length?[t,0,e[2],e[3]]:[t,0];case"s":return 5==e.length?[t,1,1,e[3],e[4]]:3==e.length?[t,1,1]:[t,1]}},Le=t._equaliseTransform=function(e,n){n=_(n).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],n=t.parseTransformString(n)||[];for(var i,o,s,r,a=k(e.length,n.length),l=[],c=[],d=0;d<a;d++){if(s=e[d]||Te(n[d]),r=n[d]||Te(s),s[0]!=r[0]||"r"==s[0].toLowerCase()&&(s[2]!=r[2]||s[3]!=r[3])||"s"==s[0].toLowerCase()&&(s[3]!=r[3]||s[4]!=r[4]))return;for(l[d]=[],c[d]=[],i=0,o=k(s.length,r.length);i<o;i++)i in s&&(l[d][i]=s[i]),i in r&&(c[d][i]=r[i])}return{from:l,to:c}};function Ne(e,t,n,i,o,s){null!=e?(this.a=+e,this.b=+t,this.c=+n,this.d=+i,this.e=+o,this.f=+s):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}t._getContainer=function(e,n,i,o){var s;if(null!=(s=null!=o||t.is(e,"object")?e:h.doc.getElementById(e)))return s.tagName?null==n?{container:s,width:s.style.pixelWidth||s.offsetWidth,height:s.style.pixelHeight||s.offsetHeight}:{container:s,width:n,height:i}:{container:1,x:e,y:n,width:i,height:o}},t.pathToRelative=we,t._engine={},t.path2curve=Me,t.matrix=function(e,t,n,i,o,s){return new Ne(e,t,n,i,o,s)},function(e){function n(e){return e[0]*e[0]+e[1]*e[1]}function i(e){var t=S.sqrt(n(e));e[0]&&(e[0]/=t),e[1]&&(e[1]/=t)}e.add=function(e,t,n,i,o,s){var r,a,l,c,d=[[],[],[]],h=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],u=[[e,n,o],[t,i,s],[0,0,1]];for(e&&e instanceof Ne&&(u=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]),r=0;r<3;r++)for(a=0;a<3;a++){for(c=0,l=0;l<3;l++)c+=h[r][l]*u[l][a];d[r][a]=c}this.a=d[0][0],this.b=d[1][0],this.c=d[0][1],this.d=d[1][1],this.e=d[0][2],this.f=d[1][2]},e.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new Ne(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)},e.clone=function(){return new Ne(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(e,t){this.add(1,0,0,1,e,t)},e.scale=function(e,t,n,i){null==t&&(t=e),(n||i)&&this.add(1,0,0,1,n,i),this.add(e,0,0,t,0,0),(n||i)&&this.add(1,0,0,1,-n,-i)},e.rotate=function(e,n,i){e=t.rad(e),n=n||0,i=i||0;var o=+S.cos(e).toFixed(9),s=+S.sin(e).toFixed(9);this.add(o,s,-s,o,n,i),this.add(1,0,0,1,-n,-i)},e.x=function(e,t){return e*this.a+t*this.c+this.e},e.y=function(e,t){return e*this.b+t*this.d+this.f},e.get=function(e){return+this[_.fromCharCode(97+e)].toFixed(4)},e.toString=function(){return t.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var o=[[this.a,this.c],[this.b,this.d]];e.scalex=S.sqrt(n(o[0])),i(o[0]),e.shear=o[0][0]*o[1][0]+o[0][1]*o[1][1],o[1]=[o[1][0]-o[0][0]*e.shear,o[1][1]-o[0][1]*e.shear],e.scaley=S.sqrt(n(o[1])),i(o[1]),e.shear/=e.scaley;var s=-o[0][1],r=o[1][1];return r<0?(e.rotate=t.deg(S.acos(r)),s<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(S.asin(s)),e.isSimple=!+e.shear.toFixed(9)&&(e.scalex.toFixed(9)==e.scaley.toFixed(9)||!e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(e){var t=e||this[b]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:v)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:v)+(t.rotate?"r"+[t.rotate,0,0]:v)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(Ne.prototype);for(var Re=function(){this.returnValue=!1},De=function(){return this.originalEvent.preventDefault()},je=function(){this.cancelBubble=!0},Be=function(){return this.originalEvent.stopPropagation()},ze=function(e){var t=h.doc.documentElement.scrollTop||h.doc.body.scrollTop,n=h.doc.documentElement.scrollLeft||h.doc.body.scrollLeft;return{x:e.clientX+n,y:e.clientY+t}},Fe=h.doc.addEventListener?function(e,t,n,i){var o=function(e){var t=ze(e);return n.call(i,e,t.x,t.y)};if(e.addEventListener(t,o,!1),g&&C[t]){var s=function(t){for(var o=ze(t),s=t,r=0,a=t.targetTouches&&t.targetTouches.length;r<a;r++)if(t.targetTouches[r].target==e){(t=t.targetTouches[r]).originalEvent=s,t.preventDefault=De,t.stopPropagation=Be;break}return n.call(i,t,o.x,o.y)};e.addEventListener(C[t],s,!1)}return function(){return e.removeEventListener(t,o,!1),g&&C[t]&&e.removeEventListener(C[t],s,!1),!0}}:h.doc.attachEvent?function(e,t,n,i){var o=function(e){e=e||h.win.event;var t=h.doc.documentElement.scrollTop||h.doc.body.scrollTop,o=h.doc.documentElement.scrollLeft||h.doc.body.scrollLeft,s=e.clientX+o,r=e.clientY+t;return e.preventDefault=e.preventDefault||Re,e.stopPropagation=e.stopPropagation||je,n.call(i,e,s,r)};return e.attachEvent("on"+t,o),function(){return e.detachEvent("on"+t,o),!0}}:void 0,Ve=[],He=function(t){for(var n,i=t.clientX,o=t.clientY,s=h.doc.documentElement.scrollTop||h.doc.body.scrollTop,r=h.doc.documentElement.scrollLeft||h.doc.body.scrollLeft,a=Ve.length;a--;){if(n=Ve[a],g&&t.touches){for(var l,c=t.touches.length;c--;)if((l=t.touches[c]).identifier==n.el._drag.id){i=l.clientX,o=l.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();var d,u=n.el.node,p=u.nextSibling,f=u.parentNode,m=u.style.display;h.win.opera&&f.removeChild(u),u.style.display="none",d=n.el.paper.getElementByPoint(i,o),u.style.display=m,h.win.opera&&(p?f.insertBefore(u,p):f.appendChild(u)),d&&e("raphael.drag.over."+n.el.id,n.el,d),i+=r,o+=s,e("raphael.drag.move."+n.el.id,n.move_scope||n.el,i-n.el._drag.x,o-n.el._drag.y,i,o,t)}},Ue=function n(i){t.unmousemove(He).unmouseup(n);for(var o,s=Ve.length;s--;)(o=Ve[s]).el._drag={},e("raphael.drag.end."+o.el.id,o.end_scope||o.start_scope||o.move_scope||o.el,i);Ve=[]},$e=t.el={},qe=w.length;qe--;)!function(e){t[e]=$e[e]=function(n,i){return t.is(n,"function")&&(this.events=this.events||[],this.events.push({name:e,f:n,unbind:Fe(this.shape||this.node||h.doc,e,n,i||this)})),this},t["un"+e]=$e["un"+e]=function(n){for(var i=this.events||[],o=i.length;o--;)i[o].name!=e||!t.is(n,"undefined")&&i[o].f!=n||(i[o].unbind(),i.splice(o,1),!i.length&&delete this.events);return this}}(w[qe]);$e.data=function(n,i){var o=K[this.id]=K[this.id]||{};if(0==arguments.length)return o;if(1==arguments.length){if(t.is(n,"object")){for(var s in n)n[d](s)&&this.data(s,n[s]);return this}return e("raphael.data.get."+this.id,this,o[n],n),o[n]}return o[n]=i,e("raphael.data.set."+this.id,this,i,n),this},$e.removeData=function(e){return null==e?K[this.id]={}:K[this.id]&&delete K[this.id][e],this},$e.getData=function(){return ie(K[this.id]||{})},$e.hover=function(e,t,n,i){return this.mouseover(e,n).mouseout(t,i||n)},$e.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var We=[];function Ge(){return this.x+y+this.y+y+this.width+" \xd7 "+this.height}$e.drag=function(n,i,o,s,r,a){function l(l){(l.originalEvent||l).preventDefault();var c=l.clientX,d=l.clientY,u=h.doc.documentElement.scrollTop||h.doc.body.scrollTop,p=h.doc.documentElement.scrollLeft||h.doc.body.scrollLeft;if(this._drag.id=l.identifier,g&&l.touches)for(var f,m=l.touches.length;m--;)if(f=l.touches[m],this._drag.id=f.identifier,f.identifier==this._drag.id){c=f.clientX,d=f.clientY;break}this._drag.x=c+p,this._drag.y=d+u,!Ve.length&&t.mousemove(He).mouseup(Ue),Ve.push({el:this,move_scope:s,start_scope:r,end_scope:a}),i&&e.on("raphael.drag.start."+this.id,i),n&&e.on("raphael.drag.move."+this.id,n),o&&e.on("raphael.drag.end."+this.id,o),e("raphael.drag.start."+this.id,r||s||this,l.clientX+p,l.clientY+u,l)}return this._drag={},We.push({el:this,start:l}),this.mousedown(l),this},$e.onDragOver=function(t){t?e.on("raphael.drag.over."+this.id,t):e.unbind("raphael.drag.over."+this.id)},$e.undrag=function(){for(var n=We.length;n--;)We[n].el==this&&(this.unmousedown(We[n].start),We.splice(n,1),e.unbind("raphael.drag.*."+this.id));!We.length&&t.unmousemove(He).unmouseup(Ue),Ve=[]},i.circle=function(e,n,i){var o=t._engine.circle(this,e||0,n||0,i||0);return this.__set__&&this.__set__.push(o),o},i.rect=function(e,n,i,o,s){var r=t._engine.rect(this,e||0,n||0,i||0,o||0,s||0);return this.__set__&&this.__set__.push(r),r},i.ellipse=function(e,n,i,o){var s=t._engine.ellipse(this,e||0,n||0,i||0,o||0);return this.__set__&&this.__set__.push(s),s},i.path=function(e){e&&!t.is(e,"string")&&!t.is(e[0],P)&&(e+=v);var n=t._engine.path(t.format[f](t,arguments),this);return this.__set__&&this.__set__.push(n),n},i.image=function(e,n,i,o,s){var r=t._engine.image(this,e||"about:blank",n||0,i||0,o||0,s||0);return this.__set__&&this.__set__.push(r),r},i.text=function(e,n,i){var o=t._engine.text(this,e||0,n||0,_(i));return this.__set__&&this.__set__.push(o),o},i.set=function(e){!t.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var n=new ut(e);return this.__set__&&this.__set__.push(n),n.paper=this,n.type="set",n},i.setStart=function(e){this.__set__=e||this.set()},i.setFinish=function(e){var t=this.__set__;return delete this.__set__,t},i.getSize=function(){var e=this.canvas.parentNode;return{width:e.offsetWidth,height:e.offsetHeight}},i.setSize=function(e,n){return t._engine.setSize.call(this,e,n)},i.setViewBox=function(e,n,i,o,s){return t._engine.setViewBox.call(this,e,n,i,o,s)},i.top=i.bottom=null,i.raphael=t,i.getElementByPoint=function(e,t){var n,i,o,s,r,a,l,c=this.canvas,d=h.doc.elementFromPoint(e,t);if(h.win.opera&&"svg"==d.tagName){var u=(i=(n=c).getBoundingClientRect(),o=n.ownerDocument,s=o.body,r=o.documentElement,a=r.clientTop||s.clientTop||0,l=r.clientLeft||s.clientLeft||0,{y:i.top+(h.win.pageYOffset||r.scrollTop||s.scrollTop)-a,x:i.left+(h.win.pageXOffset||r.scrollLeft||s.scrollLeft)-l}),p=c.createSVGRect();p.x=e-u.x,p.y=t-u.y,p.width=p.height=1;var f=c.getIntersectionList(p,null);f.length&&(d=f[f.length-1])}if(!d)return null;for(;d.parentNode&&d!=c.parentNode&&!d.raphael;)d=d.parentNode;return d==this.canvas.parentNode&&(d=c),d=d&&d.raphael?this.getById(d.raphaelid):null},i.getElementsByBBox=function(e){var n=this.set();return this.forEach((function(i){t.isBBoxIntersect(i.getBBox(),e)&&n.push(i)})),n},i.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},i.forEach=function(e,t){for(var n=this.bottom;n;){if(!1===e.call(t,n))return this;n=n.next}return this},i.getElementsByPoint=function(e,t){var n=this.set();return this.forEach((function(i){i.isPointInside(e,t)&&n.push(i)})),n},$e.isPointInside=function(e,n){var i=this.realPath=Q[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(i=t.transformPath(i,this.attr("transform"))),t.isPointInsidePath(i,e,n)},$e.getBBox=function(e){if(this.removed)return{};var t=this._;return e?(!t.dirty&&t.bboxwt||(this.realPath=Q[this.type](this),t.bboxwt=_e(this.realPath),t.bboxwt.toString=Ge,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&(!t.dirty&&this.realPath||(t.bboxwt=0,this.realPath=Q[this.type](this)),t.bbox=_e(ee(this.realPath,this.matrix)),t.bbox.toString=Ge,t.dirty=t.dirtyT=0),t.bbox)},$e.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},$e.glow=function(e){if("text"==this.type)return null;var t={width:((e=e||{}).width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:null==e.opacity?.5:e.opacity,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},n=t.width/2,i=this.paper,o=i.set(),s=this.realPath||Q[this.type](this);s=this.matrix?ee(s,this.matrix):s;for(var r=1;r<n+1;r++)o.push(i.path(s).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/n*r).toFixed(3),opacity:+(t.opacity/n).toFixed(3)}));return o.insertBefore(this).translate(t.offsetx,t.offsety)};var Ke=function(e,n,i,o,s,r,a,l,c){return null==c?me(e,n,i,o,s,r,a,l):t.findDotsAtSegment(e,n,i,o,s,r,a,l,function(e,t,n,i,o,s,r,a,l){if(!(l<0||me(e,t,n,i,o,s,r,a)<l)){var c,d=.5,h=1-d;for(c=me(e,t,n,i,o,s,r,a,h);E(c-l)>.01;)c=me(e,t,n,i,o,s,r,a,h+=(c<l?1:-1)*(d/=2));return h}}(e,n,i,o,s,r,a,l,c))},Ye=function(e,n){return function(i,o,s){for(var r,a,l,c,d,h="",u={},p=0,f=0,m=(i=Me(i)).length;f<m;f++){if("M"==(l=i[f])[0])r=+l[1],a=+l[2];else{if(p+(c=Ke(r,a,l[1],l[2],l[3],l[4],l[5],l[6]))>o){if(n&&!u.start){if(h+=["C"+(d=Ke(r,a,l[1],l[2],l[3],l[4],l[5],l[6],o-p)).start.x,d.start.y,d.m.x,d.m.y,d.x,d.y],s)return h;u.start=h,h=["M"+d.x,d.y+"C"+d.n.x,d.n.y,d.end.x,d.end.y,l[5],l[6]].join(),p+=c,r=+l[5],a=+l[6];continue}if(!e&&!n)return{x:(d=Ke(r,a,l[1],l[2],l[3],l[4],l[5],l[6],o-p)).x,y:d.y,alpha:d.alpha}}p+=c,r=+l[5],a=+l[6]}h+=l.shift()+l}return u.end=h,(d=e?p:n?u:t.findDotsAtSegment(r,a,l[0],l[1],l[2],l[3],l[4],l[5],1)).alpha&&(d={x:d.x,y:d.y,alpha:d.alpha}),d}},Ze=Ye(1),Je=Ye(),Xe=Ye(0,1);t.getTotalLength=Ze,t.getPointAtLength=Je,t.getSubpath=function(e,t,n){if(this.getTotalLength(e)-n<1e-6)return Xe(e,t).end;var i=Xe(e,n,1);return t?Xe(i,t).end:i},$e.getTotalLength=function(){var e=this.getPath();if(e)return Ze(e)},$e.getPointAtLength=function(e){var t=this.getPath();if(t)return Je(t,e)},$e.getPath=function(){var e,n=t._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return n&&(e=n(this)),e},$e.getSubpath=function(e,n){var i=this.getPath();if(i)return t.getSubpath(i,e,n)};var Qe=t.easing_formulas={linear:function(e){return e},"<":function(e){return M(e,1.7)},">":function(e){return M(e,.48)},"<>":function(e){var t=.48-e/1.04,n=S.sqrt(.1734+t*t),i=n-t,o=-n-t,s=M(E(i),1/3)*(i<0?-1:1)+M(E(o),1/3)*(o<0?-1:1)+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:M(2,-10*e)*S.sin(2*I*(e-.075)/.3)+1},bounce:function(e){var t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375}};Qe.easeIn=Qe["ease-in"]=Qe["<"],Qe.easeOut=Qe["ease-out"]=Qe[">"],Qe.easeInOut=Qe["ease-in-out"]=Qe["<>"],Qe["back-in"]=Qe.backIn,Qe["back-out"]=Qe.backOut;var et=[],tt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,16)},nt=function n(){for(var i=+new Date,o=0;o<et.length;o++){var s=et[o];if(!s.el.removed&&!s.paused){var r,a,l=i-s.start,c=s.ms,h=s.easing,u=s.from,p=s.diff,f=s.to,g=(s.t,s.el),v={},_={};if(s.initstatus?(l=(s.initstatus*s.anim.top-s.prev)/(s.percent-s.prev)*c,s.status=s.initstatus,delete s.initstatus,s.stop&&et.splice(o--,1)):s.status=(s.prev+(s.percent-s.prev)*(l/c))/s.anim.top,!(l<0))if(l<c){var b=h(l/c);for(var w in u)if(u[d](w)){switch(V[w]){case O:r=+u[w]+b*c*p[w];break;case"colour":r="rgb("+[it(D(u[w].r+b*c*p[w].r)),it(D(u[w].g+b*c*p[w].g)),it(D(u[w].b+b*c*p[w].b))].join(",")+")";break;case"path":r=[];for(var C=0,x=u[w].length;C<x;C++){r[C]=[u[w][C][0]];for(var S=1,k=u[w][C].length;S<k;S++)r[C][S]=+u[w][C][S]+b*c*p[w][C][S];r[C]=r[C].join(y)}r=r.join(y);break;case"transform":if(p[w].real)for(r=[],C=0,x=u[w].length;C<x;C++)for(r[C]=[u[w][C][0]],S=1,k=u[w][C].length;S<k;S++)r[C][S]=u[w][C][S]+b*c*p[w][C][S];else{var A=function(e){return+u[w][e]+b*c*p[w][e]};r=[["m",A(0),A(1),A(2),A(3),A(4),A(5)]]}break;case"csv":if("clip-rect"==w)for(r=[],C=4;C--;)r[C]=+u[w][C]+b*c*p[w][C];break;default:var E=[][m](u[w]);for(r=[],C=g.paper.customAttributes[w].length;C--;)r[C]=+E[C]+b*c*p[w][C]}v[w]=r}g.attr(v),function(t,n,i){setTimeout((function(){e("raphael.anim.frame."+t,n,i)}))}(g.id,g,s.anim)}else{if(function(n,i,o){setTimeout((function(){e("raphael.anim.frame."+i.id,i,o),e("raphael.anim.finish."+i.id,i,o),t.is(n,"function")&&n.call(i)}))}(s.callback,g,s.anim),g.attr(f),et.splice(o--,1),s.repeat>1&&!s.next){for(a in f)f[d](a)&&(_[a]=s.totalOrigin[a]);s.el.attr(_),rt(s.anim,s.el,s.anim.percents[0],null,s.totalOrigin,s.repeat-1)}s.next&&!s.stop&&rt(s.anim,s.el,s.next,null,s.totalOrigin,s.repeat)}}}et.length&&tt(n)},it=function(e){return e>255?255:e<0?0:e};function ot(e,t,n,i,o,s){var r=3*t,a=3*(i-t)-r,l=1-r-a,c=3*n,d=3*(o-n)-c,h=1-c-d;function u(e){return((l*e+a)*e+r)*e}return function(e,t){var n=function(e,t){var n,i,o,s,c,d;for(o=e,d=0;d<8;d++){if(s=u(o)-e,E(s)<t)return o;if(E(c=(3*l*o+2*a)*o+r)<1e-6)break;o-=s/c}if(i=1,(o=e)<(n=0))return n;if(o>i)return i;for(;n<i;){if(s=u(o),E(s-e)<t)return o;e>s?n=o:i=o,o=(i-n)/2+n}return o}(e,t);return((h*n+d)*n+c)*n}(e,1/(200*s))}function st(e,t){var n=[],i={};if(this.ms=t,this.times=1,e){for(var o in e)e[d](o)&&(i[j(o)]=e[o],n.push(j(o)));n.sort(Y)}this.anim=i,this.top=n[n.length-1],this.percents=n}function rt(n,i,o,s,r,l){o=j(o);var c,h,u,p,f,g,v=n.ms,y={},w={},C={};if(s)for(S=0,k=et.length;S<k;S++){var x=et[S];if(x.el.id==i.id&&x.anim==n){x.percent!=o?(et.splice(S,1),u=1):h=x,i.attr(x.totalOrigin);break}}else s=+w;for(var S=0,k=n.percents.length;S<k;S++){if(n.percents[S]==o||n.percents[S]>s*n.top){o=n.percents[S],f=n.percents[S-1]||0,v=v/n.top*(o-f),p=n.percents[S+1],c=n.anim[o];break}s&&i.attr(n.anim[n.percents[S]])}if(c){if(h)h.initstatus=s,h.start=new Date-h.ms*s;else{for(var A in c)if(c[d](A)&&(V[d](A)||i.paper.customAttributes[d](A)))switch(y[A]=i.attr(A),null==y[A]&&(y[A]=F[A]),w[A]=c[A],V[A]){case O:C[A]=(w[A]-y[A])/v;break;case"colour":y[A]=t.getRGB(y[A]);var E=t.getRGB(w[A]);C[A]={r:(E.r-y[A].r)/v,g:(E.g-y[A].g)/v,b:(E.b-y[A].b)/v};break;case"path":var M=Me(y[A],w[A]),I=M[1];for(y[A]=M[0],C[A]=[],S=0,k=y[A].length;S<k;S++){C[A][S]=[0];for(var P=1,T=y[A][S].length;P<T;P++)C[A][S][P]=(I[S][P]-y[A][S][P])/v}break;case"transform":var L=i._,N=Le(L[A],w[A]);if(N)for(y[A]=N.from,w[A]=N.to,C[A]=[],C[A].real=!0,S=0,k=y[A].length;S<k;S++)for(C[A][S]=[y[A][S][0]],P=1,T=y[A][S].length;P<T;P++)C[A][S][P]=(w[A][S][P]-y[A][S][P])/v;else{var D=i.matrix||new Ne,B={_:{transform:L.transform},getBBox:function(){return i.getBBox(1)}};y[A]=[D.a,D.b,D.c,D.d,D.e,D.f],Pe(B,w[A]),w[A]=B._.transform,C[A]=[(B.matrix.a-D.a)/v,(B.matrix.b-D.b)/v,(B.matrix.c-D.c)/v,(B.matrix.d-D.d)/v,(B.matrix.e-D.e)/v,(B.matrix.f-D.f)/v]}break;case"csv":var z=_(c[A])[b](a),H=_(y[A])[b](a);if("clip-rect"==A)for(y[A]=H,C[A]=[],S=H.length;S--;)C[A][S]=(z[S]-y[A][S])/v;w[A]=z;break;default:for(z=[][m](c[A]),H=[][m](y[A]),C[A]=[],S=i.paper.customAttributes[A].length;S--;)C[A][S]=((z[S]||0)-(H[S]||0))/v}var U=c.easing,$=t.easing_formulas[U];if(!$)if(($=_(U).match(R))&&5==$.length){var q=$;$=function(e){return ot(e,+q[1],+q[2],+q[3],+q[4],v)}}else $=Z;if(x={anim:n,percent:o,timestamp:g=c.start||n.start||+new Date,start:g+(n.del||0),status:0,initstatus:s||0,stop:!1,ms:v,easing:$,from:y,diff:C,to:w,el:i,callback:c.callback,prev:f,next:p,repeat:l||n.times,origin:i.attr(),totalOrigin:r},et.push(x),s&&!h&&!u&&(x.stop=!0,x.start=new Date-v*s,1==et.length))return nt();u&&(x.start=new Date-x.ms*s),1==et.length&&tt(nt)}e("raphael.anim.start."+i.id,i,n)}}function at(e){for(var t=0;t<et.length;t++)et[t].el.paper==e&&et.splice(t--,1)}$e.animateWith=function(e,n,i,o,s,r){if(this.removed)return r&&r.call(this),this;var a=i instanceof st?i:t.animation(i,o,s,r);rt(a,this,a.percents[0],null,this.attr());for(var l=0,c=et.length;l<c;l++)if(et[l].anim==n&&et[l].el==e){et[c-1].start=et[l].start;break}return this},$e.onAnimation=function(t){return t?e.on("raphael.anim.frame."+this.id,t):e.unbind("raphael.anim.frame."+this.id),this},st.prototype.delay=function(e){var t=new st(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},st.prototype.repeat=function(e){var t=new st(this.anim,this.ms);return t.del=this.del,t.times=S.floor(k(e,0))||1,t},t.animation=function(e,n,i,o){if(e instanceof st)return e;!t.is(i,"function")&&i||(o=o||i||null,i=null),e=Object(e),n=+n||0;var s,r,a={};for(r in e)e[d](r)&&j(r)!=r&&j(r)+"%"!=r&&(s=!0,a[r]=e[r]);if(s)return i&&(a.easing=i),o&&(a.callback=o),new st({100:a},n);if(o){var l=0;for(var c in e){var h=B(c);e[d](c)&&h>l&&(l=h)}!e[l+="%"].callback&&(e[l].callback=o)}return new st(e,n)},$e.animate=function(e,n,i,o){if(this.removed)return o&&o.call(this),this;var s=e instanceof st?e:t.animation(e,n,i,o);return rt(s,this,s.percents[0],null,this.attr()),this},$e.setTime=function(e,t){return e&&null!=t&&this.status(e,A(t,e.ms)/e.ms),this},$e.status=function(e,t){var n,i,o=[],s=0;if(null!=t)return rt(e,this,-1,A(t,1)),this;for(n=et.length;s<n;s++)if((i=et[s]).el.id==this.id&&(!e||i.anim==e)){if(e)return i.status;o.push({anim:i.anim,status:i.status})}return e?0:o},$e.pause=function(t){for(var n=0;n<et.length;n++)et[n].el.id!=this.id||t&&et[n].anim!=t||!1!==e("raphael.anim.pause."+this.id,this,et[n].anim)&&(et[n].paused=!0);return this},$e.resume=function(t){for(var n=0;n<et.length;n++)if(et[n].el.id==this.id&&(!t||et[n].anim==t)){var i=et[n];!1!==e("raphael.anim.resume."+this.id,this,i.anim)&&(delete i.paused,this.status(i.anim,i.status))}return this},$e.stop=function(t){for(var n=0;n<et.length;n++)et[n].el.id!=this.id||t&&et[n].anim!=t||!1!==e("raphael.anim.stop."+this.id,this,et[n].anim)&&et.splice(n--,1);return this},e.on("raphael.remove",at),e.on("raphael.clear",at),$e.toString=function(){return"Rapha\xebl\u2019s object"};var lt,ct,dt,ht,ut=function e(t){if(this.items=[],this.length=0,this.type="set",t)for(var n=0,i=t.length;n<i;n++)!t[n]||t[n].constructor!=$e.constructor&&t[n].constructor!=e||(this[this.items.length]=this.items[this.items.length]=t[n],this.length++)},pt=ut.prototype;for(var ft in pt.push=function(){for(var e,t,n=0,i=arguments.length;n<i;n++)!(e=arguments[n])||e.constructor!=$e.constructor&&e.constructor!=ut||(this[t=this.items.length]=this.items[t]=e,this.length++);return this},pt.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},pt.forEach=function(e,t){for(var n=0,i=this.items.length;n<i;n++)if(!1===e.call(t,this.items[n],n))return this;return this},$e)$e[d](ft)&&(pt[ft]=function(e){return function(){var t=arguments;return this.forEach((function(n){n[e][f](n,t)}))}}(ft));return pt.attr=function(e,n){if(e&&t.is(e,P)&&t.is(e[0],"object"))for(var i=0,o=e.length;i<o;i++)this.items[i].attr(e[i]);else for(var s=0,r=this.items.length;s<r;s++)this.items[s].attr(e,n);return this},pt.clear=function(){for(;this.length;)this.pop()},pt.splice=function(e,t,n){e=e<0?k(this.length+e,0):e,t=k(0,A(this.length-e,t));var i,o=[],s=[],r=[];for(i=2;i<arguments.length;i++)r.push(arguments[i]);for(i=0;i<t;i++)s.push(this[e+i]);for(;i<this.length-e;i++)o.push(this[e+i]);var a=r.length;for(i=0;i<a+o.length;i++)this.items[e+i]=this[e+i]=i<a?r[i]:o[i-a];for(i=this.items.length=this.length-=t-a;this[i];)delete this[i++];return new ut(s)},pt.exclude=function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]==e)return this.splice(t,1),!0},pt.animate=function(e,n,i,o){(t.is(i,"function")||!i)&&(o=i||null);var s,r,a=this.items.length,l=a,c=this;if(!a)return this;o&&(r=function(){!--a&&o.call(c)}),i=t.is(i,"string")?i:r;var d=t.animation(e,n,i,r);for(s=this.items[--l].animate(d);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(s,d,d),this.items[l]&&!this.items[l].removed||a--;return this},pt.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},pt.getBBox=function(){for(var e=[],t=[],n=[],i=[],o=this.items.length;o--;)if(!this.items[o].removed){var s=this.items[o].getBBox();e.push(s.x),t.push(s.y),n.push(s.x+s.width),i.push(s.y+s.height)}return{x:e=A[f](0,e),y:t=A[f](0,t),x2:n=k[f](0,n),y2:i=k[f](0,i),width:n-e,height:i-t}},pt.clone=function(e){e=this.paper.set();for(var t=0,n=this.items.length;t<n;t++)e.push(this.items[t].clone());return e},pt.toString=function(){return"Rapha\xebl\u2018s set"},pt.glow=function(e){var t=this.paper.set();return this.forEach((function(n,i){var o=n.glow(e);null!=o&&o.forEach((function(e,n){t.push(e)}))})),t},pt.isPointInside=function(e,t){var n=!1;return this.forEach((function(i){if(i.isPointInside(e,t))return n=!0,!1})),n},t.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},n=e.face["font-family"];for(var i in e.face)e.face[d](i)&&(t.face[i]=e.face[i]);if(this.fonts[n]?this.fonts[n].push(t):this.fonts[n]=[t],!e.svg)for(var o in t.face["units-per-em"]=B(e.face["units-per-em"],10),e.glyphs)if(e.glyphs[d](o)){var s=e.glyphs[o];if(t.glyphs[o]={w:s.w,k:{},d:s.d&&"M"+s.d.replace(/[mlcxtrv]/g,(function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"}))+"z"},s.k)for(var r in s.k)s[d](r)&&(t.glyphs[o].k[r]=s.k[r])}return e},i.getFont=function(e,n,i,o){if(o=o||"normal",i=i||"normal",n=+n||{normal:400,bold:700,lighter:300,bolder:800}[n]||400,t.fonts){var s,r=t.fonts[e];if(!r){var a=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,v)+"(\\s|$)","i");for(var l in t.fonts)if(t.fonts[d](l)&&a.test(l)){r=t.fonts[l];break}}if(r)for(var c=0,h=r.length;c<h&&((s=r[c]).face["font-weight"]!=n||s.face["font-style"]!=i&&s.face["font-style"]||s.face["font-stretch"]!=o);c++);return s}},i.print=function(e,n,i,o,s,r,l,c){r=r||"middle",l=k(A(l||0,1),-1),c=k(A(c||1,3),1);var d,h=_(i)[b](v),u=0,p=0,f=v;if(t.is(o,"string")&&(o=this.getFont(o)),o){d=(s||16)/o.face["units-per-em"];for(var m=o.face.bbox[b](a),g=+m[0],y=m[3]-m[1],w=0,C=+m[1]+("baseline"==r?y+ +o.face.descent:y/2),x=0,S=h.length;x<S;x++){if("\n"==h[x])u=0,M=0,p=0,w+=y*c;else{var E=p&&o.glyphs[h[x-1]]||{},M=o.glyphs[h[x]];u+=p?(E.w||o.w)+(E.k&&E.k[h[x]]||0)+o.w*l:0,p=1}M&&M.d&&(f+=t.transformPath(M.d,["t",u*d,w*d,"s",d,d,g,C,"t",(e-g)/d,(n-C)/d]))}}return this.path(f).attr({fill:"#000",stroke:"none"})},i.add=function(e){if(t.is(e,"array"))for(var n,i=this.set(),o=0,s=e.length;o<s;o++)n=e[o]||{},l[d](n.type)&&i.push(this[n.type]().attr(n));return i},t.format=function(e,n){var i=t.is(n,P)?[0][m](n):arguments;return e&&t.is(e,"string")&&i.length-1&&(e=e.replace(c,(function(e,t){return null==i[++t]?v:i[t]}))),e||v},t.fullfill=(lt=/\{([^\}]+)\}/g,ct=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,function(e,t){return String(e).replace(lt,(function(e,n){return function(e,t,n){var i=n;return t.replace(ct,(function(e,t,n,o,s){t=t||o,i&&(t in i&&(i=i[t]),"function"==typeof i&&s&&(i=i()))})),i=(null==i||i==n?e:i)+""}(e,n,t)}))}),t.ninja=function(){if(u.was)h.win.Raphael=u.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(e){}}return t},t.st=pt,e.on("raphael.DOMload",(function(){n=!0})),null==(dt=document).readyState&&dt.addEventListener&&(dt.addEventListener("DOMContentLoaded",ht=function(){dt.removeEventListener("DOMContentLoaded",ht,!1),dt.readyState="complete"},!1),dt.readyState="loading"),function e(){/in/.test(dt.readyState)?setTimeout(e,9):t.eve("raphael.DOMload")}(),t}.apply(t,i))||(e.exports=o)},function(e,t,n){var i,o,s,r,a,l,c,d,h,u,p,f,m,g;r="hasOwnProperty",a=/[\.\/]/,l=/\s*,\s*/,c=function(e,t){return e-t},d={n:{}},h=function(){for(var e=0,t=this.length;e<t;e++)if("undefined"!=typeof this[e])return this[e]},u=function(){for(var e=this.length;--e;)if("undefined"!=typeof this[e])return this[e]},p=Object.prototype.toString,f=String,m=Array.isArray||function(e){return e instanceof Array||"[object Array]"==p.call(e)},(g=function e(t,n){var i,r=s,a=Array.prototype.slice.call(arguments,2),l=e.listeners(t),d=0,p=[],f={},m=[],g=o;m.firstDefined=h,m.lastDefined=u,o=t,s=0;for(var v=0,y=l.length;v<y;v++)"zIndex"in l[v]&&(p.push(l[v].zIndex),l[v].zIndex<0&&(f[l[v].zIndex]=l[v]));for(p.sort(c);p[d]<0;)if(i=f[p[d++]],m.push(i.apply(n,a)),s)return s=r,m;for(v=0;v<y;v++)if("zIndex"in(i=l[v]))if(i.zIndex==p[d]){if(m.push(i.apply(n,a)),s)break;do{if((i=f[p[++d]])&&m.push(i.apply(n,a)),s)break}while(i)}else f[i.zIndex]=i;else if(m.push(i.apply(n,a)),s)break;return s=r,o=g,m})._events=d,g.listeners=function(e){var t,n,i,o,s,r,l,c,h=m(e)?e:e.split(a),u=d,p=[u],f=[];for(o=0,s=h.length;o<s;o++){for(c=[],r=0,l=p.length;r<l;r++)for(n=[(u=p[r].n)[h[o]],u["*"]],i=2;i--;)(t=n[i])&&(c.push(t),f=f.concat(t.f||[]));p=c}return f},g.separator=function(e){e?(e="["+(e=f(e).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",a=new RegExp(e)):a=/[\.\/]/},g.on=function(e,t){if("function"!=typeof t)return function(){};for(var n=m(e)?m(e[0])?e:[e]:f(e).split(l),i=0,o=n.length;i<o;i++)!function(e){for(var n,i=m(e)?e:f(e).split(a),o=d,s=0,r=i.length;s<r;s++)o=(o=o.n).hasOwnProperty(i[s])&&o[i[s]]||(o[i[s]]={n:{}});for(o.f=o.f||[],s=0,r=o.f.length;s<r;s++)if(o.f[s]==t){n=!0;break}!n&&o.f.push(t)}(n[i]);return function(e){+e==+e&&(t.zIndex=+e)}},g.f=function(e){var t=[].slice.call(arguments,1);return function(){g.apply(null,[e,null].concat(t).concat([].slice.call(arguments,0)))}},g.stop=function(){s=1},g.nt=function(e){var t=m(o)?o.join("."):o;return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(t):t},g.nts=function(){return m(o)?o:o.split(a)},g.off=g.unbind=function(e,t){if(e){var n=m(e)?m(e[0])?e:[e]:f(e).split(l);if(n.length>1)for(var i=0,o=n.length;i<o;i++)g.off(n[i],t);else{n=m(e)?e:f(e).split(a);var s,c,h,u,p,v=[d];for(i=0,o=n.length;i<o;i++)for(u=0;u<v.length;u+=h.length-2){if(h=[u,1],s=v[u].n,"*"!=n[i])s[n[i]]&&h.push(s[n[i]]);else for(c in s)s[r](c)&&h.push(s[c]);v.splice.apply(v,h)}for(i=0,o=v.length;i<o;i++)for(s=v[i];s.n;){if(t){if(s.f){for(u=0,p=s.f.length;u<p;u++)if(s.f[u]==t){s.f.splice(u,1);break}!s.f.length&&delete s.f}for(c in s.n)if(s.n[r](c)&&s.n[c].f){var y=s.n[c].f;for(u=0,p=y.length;u<p;u++)if(y[u]==t){y.splice(u,1);break}!y.length&&delete s.n[c].f}}else for(c in delete s.f,s.n)s.n[r](c)&&s.n[c].f&&delete s.n[c].f;s=s.n}}}else g._events=d={n:{}}},g.once=function(e,t){return g.on(e,(function n(){return g.off(e,n),t.apply(this,arguments)}))},g.version="0.5.0",g.toString=function(){return"You are running Eve 0.5.0"},"undefined"!=typeof e&&e.exports?e.exports=g:void 0===(i=function(){return g}.apply(t,[]))||(e.exports=i)},function(e,t,n){var i,o;i=[n(1)],void 0===(o=function(e){if(!e||e.svg){var t="hasOwnProperty",n=String,i=parseFloat,o=parseInt,s=Math,r=s.max,a=s.abs,l=s.pow,c=/[, ]+/,d=e.eve,h="",u=" ",p="http://www.w3.org/1999/xlink",f={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},m={};e.toString=function(){return"Your browser supports SVG.\nYou are running Rapha\xebl "+this.version};var g=function i(o,s){if(s)for(var r in"string"==typeof o&&(o=i(o)),s)s[t](r)&&("xlink:"==r.substring(0,6)?o.setAttributeNS(p,r.substring(6),n(s[r])):o.setAttribute(r,n(s[r])));else(o=e._g.doc.createElementNS("http://www.w3.org/2000/svg",o)).style&&(o.style.webkitTapHighlightColor="rgba(0,0,0,0)");return o},v=function(t,o){var c="linear",d=t.id+o,u=.5,p=.5,f=t.node,m=t.paper,v=f.style,_=e._g.doc.getElementById(d);if(!_){if(o=(o=n(o).replace(e._radial_gradient,(function(e,t,n){if(c="radial",t&&n){u=i(t);var o=2*((p=i(n))>.5)-1;l(u-.5,2)+l(p-.5,2)>.25&&(p=s.sqrt(.25-l(u-.5,2))*o+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*o)}return h}))).split(/\s*\-\s*/),"linear"==c){var b=o.shift();if(b=-i(b),isNaN(b))return null;var w=[0,0,s.cos(e.rad(b)),s.sin(e.rad(b))],C=1/(r(a(w[2]),a(w[3]))||1);w[2]*=C,w[3]*=C,w[2]<0&&(w[0]=-w[2],w[2]=0),w[3]<0&&(w[1]=-w[3],w[3]=0)}var x=e._parseDots(o);if(!x)return null;if(d=d.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&d!=t.gradient.id&&(m.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){_=g(c+"Gradient",{id:d}),t.gradient=_,g(_,"radial"==c?{fx:u,fy:p}:{x1:w[0],y1:w[1],x2:w[2],y2:w[3],gradientTransform:t.matrix.invert()}),m.defs.appendChild(_);for(var S=0,k=x.length;S<k;S++)_.appendChild(g("stop",{offset:x[S].offset?x[S].offset:S?"100%":"0%","stop-color":x[S].color||"#fff","stop-opacity":isFinite(x[S].opacity)?x[S].opacity:1}))}}return g(f,{fill:y(d),opacity:1,"fill-opacity":1}),v.fill=h,v.opacity=1,v.fillOpacity=1,1},y=function(e){if((t=document.documentMode)&&(9===t||10===t))return"url('#"+e+"')";var t,n=document.location;return"url('"+n.protocol+"//"+n.host+n.pathname+n.search+"#"+e+"')"},_=function(e){var t=e.getBBox(1);g(e.pattern,{patternTransform:e.matrix.invert()+" translate("+t.x+","+t.y+")"})},b=function(i,o,s){if("path"==i.type){for(var r,a,l,c,d,u=n(o).toLowerCase().split("-"),p=i.paper,v=s?"end":"start",y=i.node,_=i.attrs,b=_["stroke-width"],w=u.length,C="classic",x=3,S=3,k=5;w--;)switch(u[w]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":C=u[w];break;case"wide":S=5;break;case"narrow":S=2;break;case"long":x=5;break;case"short":x=2}if("open"==C?(x+=2,S+=2,k+=2,l=1,c=s?4:1,d={fill:"none",stroke:_.stroke}):(c=l=x/2,d={fill:_.stroke,stroke:"none"}),i._.arrows?s?(i._.arrows.endPath&&m[i._.arrows.endPath]--,i._.arrows.endMarker&&m[i._.arrows.endMarker]--):(i._.arrows.startPath&&m[i._.arrows.startPath]--,i._.arrows.startMarker&&m[i._.arrows.startMarker]--):i._.arrows={},"none"!=C){var A="raphael-marker-"+C,E="raphael-marker-"+v+C+x+S+"-obj"+i.id;e._g.doc.getElementById(A)?m[A]++:(p.defs.appendChild(g(g("path"),{"stroke-linecap":"round",d:f[C],id:A})),m[A]=1);var M,I=e._g.doc.getElementById(E);I?(m[E]++,M=I.getElementsByTagName("use")[0]):(I=g(g("marker"),{id:E,markerHeight:S,markerWidth:x,orient:"auto",refX:c,refY:S/2}),M=g(g("use"),{"xlink:href":"#"+A,transform:(s?"rotate(180 "+x/2+" "+S/2+") ":h)+"scale("+x/k+","+S/k+")","stroke-width":(1/((x/k+S/k)/2)).toFixed(4)}),I.appendChild(M),p.defs.appendChild(I),m[E]=1),g(M,d);var O=l*("diamond"!=C&&"oval"!=C);s?(r=i._.arrows.startdx*b||0,a=e.getTotalLength(_.path)-O*b):(r=O*b,a=e.getTotalLength(_.path)-(i._.arrows.enddx*b||0)),(d={})["marker-"+v]="url(#"+E+")",(a||r)&&(d.d=e.getSubpath(_.path,r,a)),g(y,d),i._.arrows[v+"Path"]=A,i._.arrows[v+"Marker"]=E,i._.arrows[v+"dx"]=O,i._.arrows[v+"Type"]=C,i._.arrows[v+"String"]=o}else s?(r=i._.arrows.startdx*b||0,a=e.getTotalLength(_.path)-r):(r=0,a=e.getTotalLength(_.path)-(i._.arrows.enddx*b||0)),i._.arrows[v+"Path"]&&g(y,{d:e.getSubpath(_.path,r,a)}),delete i._.arrows[v+"Path"],delete i._.arrows[v+"Marker"],delete i._.arrows[v+"dx"],delete i._.arrows[v+"Type"],delete i._.arrows[v+"String"];for(d in m)if(m[t](d)&&!m[d]){var P=e._g.doc.getElementById(d);P&&P.parentNode.removeChild(P)}}},w={"-":[3,1],",":[1.1,1.1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},C=function(e,t,i){if(t=w[n(t).toLowerCase()]){for(var o=e.attrs["stroke-width"]||"1",s={round:o,square:o,butt:0}[e.attrs["stroke-linecap"]||i["stroke-linecap"]]||0,r=[],a=t.length;a--;)r[a]=t[a]*o+(a%2?1:-1)*s;g(e.node,{"stroke-dasharray":r.join(",")})}else g(e.node,{"stroke-dasharray":"none"})},x=function(i,s){var l=i.node,d=i.attrs,u=l.style.visibility;for(var f in l.style.visibility="hidden",s)if(s[t](f)){if(!e._availableAttrs[t](f))continue;var m=s[f];switch(d[f]=m,f){case"blur":i.blur(m);break;case"title":var y=l.getElementsByTagName("title");if(y.length&&(y=y[0]))y.firstChild.nodeValue=m;else{y=g("title");var w=e._g.doc.createTextNode(m);y.appendChild(w),l.appendChild(y)}break;case"href":case"target":var x=l.parentNode;if("a"!=x.tagName.toLowerCase()){var k=g("a");x.insertBefore(k,l),k.appendChild(l),x=k}"target"==f?x.setAttributeNS(p,"show","blank"==m?"new":m):x.setAttributeNS(p,f,m);break;case"cursor":l.style.cursor=m;break;case"transform":i.transform(m);break;case"arrow-start":b(i,m);break;case"arrow-end":b(i,m,1);break;case"clip-rect":var A=n(m).split(c);if(4==A.length){i.clip&&i.clip.parentNode.parentNode.removeChild(i.clip.parentNode);var E=g("clipPath"),M=g("rect");E.id=e.createUUID(),g(M,{x:A[0],y:A[1],width:A[2],height:A[3]}),E.appendChild(M),i.paper.defs.appendChild(E),g(l,{"clip-path":"url(#"+E.id+")"}),i.clip=M}if(!m){var I=l.getAttribute("clip-path");if(I){var O=e._g.doc.getElementById(I.replace(/(^url\(#|\)$)/g,h));O&&O.parentNode.removeChild(O),g(l,{"clip-path":h}),delete i.clip}}break;case"path":"path"==i.type&&(g(l,{d:m?d.path=e._pathToAbsolute(m):"M0,0"}),i._.dirty=1,i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1)));break;case"width":if(l.setAttribute(f,m),i._.dirty=1,!d.fx)break;f="x",m=d.x;case"x":d.fx&&(m=-d.x-(d.width||0));case"rx":if("rx"==f&&"rect"==i.type)break;case"cx":l.setAttribute(f,m),i.pattern&&_(i),i._.dirty=1;break;case"height":if(l.setAttribute(f,m),i._.dirty=1,!d.fy)break;f="y",m=d.y;case"y":d.fy&&(m=-d.y-(d.height||0));case"ry":if("ry"==f&&"rect"==i.type)break;case"cy":l.setAttribute(f,m),i.pattern&&_(i),i._.dirty=1;break;case"r":"rect"==i.type?g(l,{rx:m,ry:m}):l.setAttribute(f,m),i._.dirty=1;break;case"src":"image"==i.type&&l.setAttributeNS(p,"href",m);break;case"stroke-width":1==i._.sx&&1==i._.sy||(m/=r(a(i._.sx),a(i._.sy))||1),l.setAttribute(f,m),d["stroke-dasharray"]&&C(i,d["stroke-dasharray"],s),i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1));break;case"stroke-dasharray":C(i,m,s);break;case"fill":var P=n(m).match(e._ISURL);if(P){E=g("pattern");var T=g("image");E.id=e.createUUID(),g(E,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),g(T,{x:0,y:0,"xlink:href":P[1]}),E.appendChild(T),function(t){e._preload(P[1],(function(){var e=this.offsetWidth,n=this.offsetHeight;g(t,{width:e,height:n}),g(T,{width:e,height:n})}))}(E),i.paper.defs.appendChild(E),g(l,{fill:"url(#"+E.id+")"}),i.pattern=E,i.pattern&&_(i);break}var L=e.getRGB(m);if(L.error){if(("circle"==i.type||"ellipse"==i.type||"r"!=n(m).charAt())&&v(i,m)){if("opacity"in d||"fill-opacity"in d){var N=e._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,h));if(N){var R=N.getElementsByTagName("stop");g(R[R.length-1],{"stop-opacity":("opacity"in d?d.opacity:1)*("fill-opacity"in d?d["fill-opacity"]:1)})}}d.gradient=m,d.fill="none";break}}else delete s.gradient,delete d.gradient,!e.is(d.opacity,"undefined")&&e.is(s.opacity,"undefined")&&g(l,{opacity:d.opacity}),!e.is(d["fill-opacity"],"undefined")&&e.is(s["fill-opacity"],"undefined")&&g(l,{"fill-opacity":d["fill-opacity"]});L[t]("opacity")&&g(l,{"fill-opacity":L.opacity>1?L.opacity/100:L.opacity});case"stroke":L=e.getRGB(m),l.setAttribute(f,L.hex),"stroke"==f&&L[t]("opacity")&&g(l,{"stroke-opacity":L.opacity>1?L.opacity/100:L.opacity}),"stroke"==f&&i._.arrows&&("startString"in i._.arrows&&b(i,i._.arrows.startString),"endString"in i._.arrows&&b(i,i._.arrows.endString,1));break;case"gradient":("circle"==i.type||"ellipse"==i.type||"r"!=n(m).charAt())&&v(i,m);break;case"opacity":d.gradient&&!d[t]("stroke-opacity")&&g(l,{"stroke-opacity":m>1?m/100:m});case"fill-opacity":if(d.gradient){(N=e._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,h)))&&(R=N.getElementsByTagName("stop"),g(R[R.length-1],{"stop-opacity":m}));break}default:"font-size"==f&&(m=o(m,10)+"px");var D=f.replace(/(\-.)/g,(function(e){return e.substring(1).toUpperCase()}));l.style[D]=m,i._.dirty=1,l.setAttribute(f,m)}}S(i,s),l.style.visibility=u},S=function(i,s){if("text"==i.type&&(s[t]("text")||s[t]("font")||s[t]("font-size")||s[t]("x")||s[t]("y"))){var r=i.attrs,a=i.node,l=a.firstChild?o(e._g.doc.defaultView.getComputedStyle(a.firstChild,h).getPropertyValue("font-size"),10):10;if(s[t]("text")){for(r.text=s.text;a.firstChild;)a.removeChild(a.firstChild);for(var c,d=n(s.text).split("\n"),u=[],p=0,f=d.length;p<f;p++)c=g("tspan"),p&&g(c,{dy:1.2*l,x:r.x}),c.appendChild(e._g.doc.createTextNode(d[p])),a.appendChild(c),u[p]=c}else for(p=0,f=(u=a.getElementsByTagName("tspan")).length;p<f;p++)p?g(u[p],{dy:1.2*l,x:r.x}):g(u[0],{dy:0});g(a,{x:r.x,y:r.y}),i._.dirty=1;var m=i._getBBox(),v=r.y-(m.y+m.height/2);v&&e.is(v,"finite")&&g(u[0],{dy:v})}},k=function(e){return e.parentNode&&"a"===e.parentNode.tagName.toLowerCase()?e.parentNode:e},A=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5),t.raphaelid=this.id,this.matrix=e.matrix(),this.realPath=null,this.paper=n,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},E=e.el;A.prototype=E,E.constructor=A,e._engine.path=function(e,t){var n=g("path");t.canvas&&t.canvas.appendChild(n);var i=new A(n,t);return i.type="path",x(i,{fill:"none",stroke:"#000",path:e}),i},E.rotate=function(e,t,o){if(this.removed)return this;if((e=n(e).split(c)).length-1&&(t=i(e[1]),o=i(e[2])),e=i(e[0]),null==o&&(t=o),null==t||null==o){var s=this.getBBox(1);t=s.x+s.width/2,o=s.y+s.height/2}return this.transform(this._.transform.concat([["r",e,t,o]])),this},E.scale=function(e,t,o,s){if(this.removed)return this;if((e=n(e).split(c)).length-1&&(t=i(e[1]),o=i(e[2]),s=i(e[3])),e=i(e[0]),null==t&&(t=e),null==s&&(o=s),null==o||null==s)var r=this.getBBox(1);return o=null==o?r.x+r.width/2:o,s=null==s?r.y+r.height/2:s,this.transform(this._.transform.concat([["s",e,t,o,s]])),this},E.translate=function(e,t){return this.removed?this:((e=n(e).split(c)).length-1&&(t=i(e[1])),e=i(e[0])||0,t=+t||0,this.transform(this._.transform.concat([["t",e,t]])),this)},E.transform=function(n){var i=this._;if(null==n)return i.transform;if(e._extractTransform(this,n),this.clip&&g(this.clip,{transform:this.matrix.invert()}),this.pattern&&_(this),this.node&&g(this.node,{transform:this.matrix}),1!=i.sx||1!=i.sy){var o=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":o})}return this},E.hide=function(){return this.removed||(this.node.style.display="none"),this},E.show=function(){return this.removed||(this.node.style.display=""),this},E.remove=function(){var t=k(this.node);if(!this.removed&&t.parentNode){var n=this.paper;for(var i in n.__set__&&n.__set__.exclude(this),d.unbind("raphael.*.*."+this.id),this.gradient&&n.defs.removeChild(this.gradient),e._tear(this,n),t.parentNode.removeChild(t),this.removeData(),this)this[i]="function"==typeof this[i]?e._removedFactory(i):null;this.removed=!0}},E._getBBox=function(){if("none"==this.node.style.display){this.show();var e=!0}var t,n=!1;this.paper.canvas.parentElement?t=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(t=this.paper.canvas.parentNode.style),t&&"none"==t.display&&(n=!0,t.display="");var i={};try{i=this.node.getBBox()}catch(o){i={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{i=i||{},n&&(t.display="none")}return e&&this.hide(),i},E.attr=function(n,i){if(this.removed)return this;if(null==n){var o={};for(var s in this.attrs)this.attrs[t](s)&&(o[s]=this.attrs[s]);return o.gradient&&"none"==o.fill&&(o.fill=o.gradient)&&delete o.gradient,o.transform=this._.transform,o}if(null==i&&e.is(n,"string")){if("fill"==n&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==n)return this._.transform;for(var r=n.split(c),a={},l=0,h=r.length;l<h;l++)(n=r[l])in this.attrs?a[n]=this.attrs[n]:e.is(this.paper.customAttributes[n],"function")?a[n]=this.paper.customAttributes[n].def:a[n]=e._availableAttrs[n];return h-1?a:a[r[0]]}if(null==i&&e.is(n,"array")){for(a={},l=0,h=n.length;l<h;l++)a[n[l]]=this.attr(n[l]);return a}if(null!=i){var u={};u[n]=i}else null!=n&&e.is(n,"object")&&(u=n);for(var p in u)d("raphael.attr."+p+"."+this.id,this,u[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[t](p)&&u[t](p)&&e.is(this.paper.customAttributes[p],"function")){var f=this.paper.customAttributes[p].apply(this,[].concat(u[p]));for(var m in this.attrs[p]=u[p],f)f[t](m)&&(u[m]=f[m])}return x(this,u),this},E.toFront=function(){if(this.removed)return this;var t=k(this.node);t.parentNode.appendChild(t);var n=this.paper;return n.top!=this&&e._tofront(this,n),this},E.toBack=function(){if(this.removed)return this;var t=k(this.node),n=t.parentNode;return n.insertBefore(t,n.firstChild),e._toback(this,this.paper),this.paper,this},E.insertAfter=function(t){if(this.removed||!t)return this;var n=k(this.node),i=k(t.node||t[t.length-1].node);return i.nextSibling?i.parentNode.insertBefore(n,i.nextSibling):i.parentNode.appendChild(n),e._insertafter(this,t,this.paper),this},E.insertBefore=function(t){if(this.removed||!t)return this;var n=k(this.node),i=k(t.node||t[0].node);return i.parentNode.insertBefore(n,i),e._insertbefore(this,t,this.paper),this},E.blur=function(t){var n=this;if(0!==+t){var i=g("filter"),o=g("feGaussianBlur");n.attrs.blur=t,i.id=e.createUUID(),g(o,{stdDeviation:+t||1.5}),i.appendChild(o),n.paper.defs.appendChild(i),n._blur=i,g(n.node,{filter:"url(#"+i.id+")"})}else n._blur&&(n._blur.parentNode.removeChild(n._blur),delete n._blur,delete n.attrs.blur),n.node.removeAttribute("filter");return n},e._engine.circle=function(e,t,n,i){var o=g("circle");e.canvas&&e.canvas.appendChild(o);var s=new A(o,e);return s.attrs={cx:t,cy:n,r:i,fill:"none",stroke:"#000"},s.type="circle",g(o,s.attrs),s},e._engine.rect=function(e,t,n,i,o,s){var r=g("rect");e.canvas&&e.canvas.appendChild(r);var a=new A(r,e);return a.attrs={x:t,y:n,width:i,height:o,rx:s||0,ry:s||0,fill:"none",stroke:"#000"},a.type="rect",g(r,a.attrs),a},e._engine.ellipse=function(e,t,n,i,o){var s=g("ellipse");e.canvas&&e.canvas.appendChild(s);var r=new A(s,e);return r.attrs={cx:t,cy:n,rx:i,ry:o,fill:"none",stroke:"#000"},r.type="ellipse",g(s,r.attrs),r},e._engine.image=function(e,t,n,i,o,s){var r=g("image");g(r,{x:n,y:i,width:o,height:s,preserveAspectRatio:"none"}),r.setAttributeNS(p,"href",t),e.canvas&&e.canvas.appendChild(r);var a=new A(r,e);return a.attrs={x:n,y:i,width:o,height:s,src:t},a.type="image",a},e._engine.text=function(t,n,i,o){var s=g("text");t.canvas&&t.canvas.appendChild(s);var r=new A(s,t);return r.attrs={x:n,y:i,"text-anchor":"middle",text:o,"font-family":e._availableAttrs["font-family"],"font-size":e._availableAttrs["font-size"],stroke:"none",fill:"#000"},r.type="text",x(r,r.attrs),r},e._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},e._engine.create=function(){var t=e._getContainer.apply(0,arguments),n=t&&t.container,i=t.x,o=t.y,s=t.width,r=t.height;if(!n)throw new Error("SVG container not found.");var a,l=g("svg"),c="overflow:hidden;";return i=i||0,o=o||0,g(l,{height:r=r||342,version:1.1,width:s=s||512,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),1==n?(l.style.cssText=c+"position:absolute;left:"+i+"px;top:"+o+"px",e._g.doc.body.appendChild(l),a=1):(l.style.cssText=c+"position:relative",n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l)),(n=new e._Paper).width=s,n.height=r,n.canvas=l,n.clear(),n._left=n._top=0,a&&(n.renderfix=function(){}),n.renderfix(),n},e._engine.setViewBox=function(e,t,n,i,o){d("raphael.setViewBox",this,this._viewBox,[e,t,n,i,o]);var s,a,l=this.getSize(),c=r(n/l.width,i/l.height),h=this.top,p=o?"xMidYMid meet":"xMinYMin";for(null==e?(this._vbSize&&(c=1),delete this._vbSize,s="0 0 "+this.width+u+this.height):(this._vbSize=c,s=e+u+t+u+n+u+i),g(this.canvas,{viewBox:s,preserveAspectRatio:p});c&&h;)a="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":a}),h._.dirty=1,h._.dirtyT=1,h=h.prev;return this._viewBox=[e,t,n,i,!!o],this},e.prototype.renderfix=function(){var e,t=this.canvas,n=t.style;try{e=t.getScreenCTM()||t.createSVGMatrix()}catch(s){e=t.createSVGMatrix()}var i=-e.e%1,o=-e.f%1;(i||o)&&(i&&(this._left=(this._left+i)%1,n.left=this._left+"px"),o&&(this._top=(this._top+o)%1,n.top=this._top+"px"))},e.prototype.clear=function(){e.eve("raphael.clear",this);for(var t=this.canvas;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,(this.desc=g("desc")).appendChild(e._g.doc.createTextNode("Created with Rapha\xebl "+e.version)),t.appendChild(this.desc),t.appendChild(this.defs=g("defs"))},e.prototype.remove=function(){for(var t in d("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this)this[t]="function"==typeof this[t]?e._removedFactory(t):null};var M=e.st;for(var I in E)E[t](I)&&!M[t](I)&&(M[I]=function(e){return function(){var t=arguments;return this.forEach((function(n){n[e].apply(n,t)}))}}(I))}}.apply(t,i))||(e.exports=o)},function(e,t,n){var i,o;i=[n(1)],void 0===(o=function(e){if(!e||e.vml){var t="hasOwnProperty",n=String,i=parseFloat,o=Math,s=o.round,r=o.max,a=o.min,l=o.abs,c=/[, ]+/,d=e.eve,h=" ",u="",p={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},f=/([clmz]),?([^clmz]*)/gi,m=/ progid:\S+Blur\([^\)]+\)/g,g=/-?[^,\s-]+/g,v="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",y=21600,_={path:1,rect:1,image:1},b={circle:1,ellipse:1},w=function(t,n,i){var o=e.matrix();return o.rotate(-t,.5,.5),{dx:o.x(n,i),dy:o.y(n,i)}},C=function(e,t,n,i,o,s){var r=e._,a=e.matrix,c=r.fillpos,d=e.node,u=d.style,p=1,f="",m=y/t,g=y/n;if(u.visibility="hidden",t&&n){if(d.coordsize=l(m)+h+l(g),u.rotation=s*(t*n<0?-1:1),s){var v=w(s,i,o);i=v.dx,o=v.dy}if(t<0&&(f+="x"),n<0&&(f+=" y")&&(p=-1),u.flip=f,d.coordorigin=i*-m+h+o*-g,c||r.fillsize){var _=d.getElementsByTagName("fill");_=_&&_[0],d.removeChild(_),c&&(v=w(s,a.x(c[0],c[1]),a.y(c[0],c[1])),_.position=v.dx*p+h+v.dy*p),r.fillsize&&(_.size=r.fillsize[0]*l(t)+h+r.fillsize[1]*l(n)),d.appendChild(_)}u.visibility="visible"}};e.toString=function(){return"Your browser doesn\u2019t support SVG. Falling down to VML.\nYou are running Rapha\xebl "+this.version};var x,S=function(e,t,i){for(var o=n(t).toLowerCase().split("-"),s=i?"end":"start",r=o.length,a="classic",l="medium",c="medium";r--;)switch(o[r]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":a=o[r];break;case"wide":case"narrow":c=o[r];break;case"long":case"short":l=o[r]}var d=e.node.getElementsByTagName("stroke")[0];d[s+"arrow"]=a,d[s+"arrowlength"]=l,d[s+"arrowwidth"]=c},k=function(o,l){o.attrs=o.attrs||{};var d=o.node,m=o.attrs,v=d.style,w=_[o.type]&&(l.x!=m.x||l.y!=m.y||l.width!=m.width||l.height!=m.height||l.cx!=m.cx||l.cy!=m.cy||l.rx!=m.rx||l.ry!=m.ry||l.r!=m.r),k=b[o.type]&&(m.cx!=l.cx||m.cy!=l.cy||m.r!=l.r||m.rx!=l.rx||m.ry!=l.ry),E=o;for(var M in l)l[t](M)&&(m[M]=l[M]);if(w&&(m.path=e._getPath[o.type](o),o._.dirty=1),l.href&&(d.href=l.href),l.title&&(d.title=l.title),l.target&&(d.target=l.target),l.cursor&&(v.cursor=l.cursor),"blur"in l&&o.blur(l.blur),(l.path&&"path"==o.type||w)&&(d.path=function(t){var i=/[ahqstv]/gi,o=e._pathToAbsolute;if(n(t).match(i)&&(o=e._path2curve),i=/[clmz]/g,o==e._pathToAbsolute&&!n(t).match(i)){var r=n(t).replace(f,(function(e,t,n){var i=[],o="m"==t.toLowerCase(),r=p[t];return n.replace(g,(function(e){o&&2==i.length&&(r+=i+p["m"==t?"l":"L"],i=[]),i.push(s(e*y))})),r+i}));return r}var a,l,c=o(t);r=[];for(var d=0,m=c.length;d<m;d++){a=c[d],"z"==(l=c[d][0].toLowerCase())&&(l="x");for(var v=1,_=a.length;v<_;v++)l+=s(a[v]*y)+(v!=_-1?",":u);r.push(l)}return r.join(h)}(~n(m.path).toLowerCase().indexOf("r")?e._pathToAbsolute(m.path):m.path),o._.dirty=1,"image"==o.type&&(o._.fillpos=[m.x,m.y],o._.fillsize=[m.width,m.height],C(o,1,1,0,0,0))),"transform"in l&&o.transform(l.transform),k){var I=+m.cx,O=+m.cy,P=+m.rx||+m.r||0,T=+m.ry||+m.r||0;d.path=e.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",s((I-P)*y),s((O-T)*y),s((I+P)*y),s((O+T)*y),s(I*y)),o._.dirty=1}if("clip-rect"in l){var L=n(l["clip-rect"]).split(c);if(4==L.length){L[2]=+L[2]+ +L[0],L[3]=+L[3]+ +L[1];var N=d.clipRect||e._g.doc.createElement("div"),R=N.style;R.clip=e.format("rect({1}px {2}px {3}px {0}px)",L),d.clipRect||(R.position="absolute",R.top=0,R.left=0,R.width=o.paper.width+"px",R.height=o.paper.height+"px",d.parentNode.insertBefore(N,d),N.appendChild(d),d.clipRect=N)}l["clip-rect"]||d.clipRect&&(d.clipRect.style.clip="auto")}if(o.textpath){var D=o.textpath.style;l.font&&(D.font=l.font),l["font-family"]&&(D.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,u)+'"'),l["font-size"]&&(D.fontSize=l["font-size"]),l["font-weight"]&&(D.fontWeight=l["font-weight"]),l["font-style"]&&(D.fontStyle=l["font-style"])}if("arrow-start"in l&&S(E,l["arrow-start"]),"arrow-end"in l&&S(E,l["arrow-end"],1),null!=l.opacity||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var j=d.getElementsByTagName("fill");if(!(j=j&&j[0])&&(j=x("fill")),"image"==o.type&&l.src&&(j.src=l.src),l.fill&&(j.on=!0),null!=j.on&&"none"!=l.fill&&null!==l.fill||(j.on=!1),j.on&&l.fill){var B=n(l.fill).match(e._ISURL);if(B){j.parentNode==d&&d.removeChild(j),j.rotate=!0,j.src=B[1],j.type="tile";var z=o.getBBox(1);j.position=z.x+h+z.y,o._.fillpos=[z.x,z.y],e._preload(B[1],(function(){o._.fillsize=[this.offsetWidth,this.offsetHeight]}))}else j.color=e.getRGB(l.fill).hex,j.src=u,j.type="solid",e.getRGB(l.fill).error&&(E.type in{circle:1,ellipse:1}||"r"!=n(l.fill).charAt())&&A(E,l.fill,j)&&(m.fill="none",m.gradient=l.fill,j.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var F=((+m["fill-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+e.getRGB(l.fill).o+1||2)-1);F=a(r(F,0),1),j.opacity=F,j.src&&(j.color="none")}d.appendChild(j);var V=d.getElementsByTagName("stroke")&&d.getElementsByTagName("stroke")[0],H=!1;!V&&(H=V=x("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(V.on=!0),("none"==l.stroke||null===l.stroke||null==V.on||0==l.stroke||0==l["stroke-width"])&&(V.on=!1);var U=e.getRGB(l.stroke);V.on&&l.stroke&&(V.color=U.hex),F=((+m["stroke-opacity"]+1||2)-1)*((+m.opacity+1||2)-1)*((+U.o+1||2)-1);var $=.75*(i(l["stroke-width"])||1);if(F=a(r(F,0),1),null==l["stroke-width"]&&($=m["stroke-width"]),l["stroke-width"]&&(V.weight=$),$&&$<1&&(F*=$)&&(V.weight=1),V.opacity=F,l["stroke-linejoin"]&&(V.joinstyle=l["stroke-linejoin"]||"miter"),V.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(V.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),"stroke-dasharray"in l){var q={",":"minidot","-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};V.dashstyle=q[t](l["stroke-dasharray"])?q[l["stroke-dasharray"]]:u}H&&d.appendChild(V)}if("text"==E.type){E.paper.canvas.style.display=u;var W=E.paper.span,G=m.font&&m.font.match(/\d+(?:\.\d*)?(?=px)/);v=W.style,m.font&&(v.font=m.font),m["font-family"]&&(v.fontFamily=m["font-family"]),m["font-weight"]&&(v.fontWeight=m["font-weight"]),m["font-style"]&&(v.fontStyle=m["font-style"]),G=i(m["font-size"]||G&&G[0])||10,v.fontSize=100*G+"px",E.textpath.string&&(W.innerHTML=n(E.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var K=W.getBoundingClientRect();E.W=m.w=(K.right-K.left)/100,E.H=m.h=(K.bottom-K.top)/100,E.X=m.x,E.Y=m.y+E.H/2,("x"in l||"y"in l)&&(E.path.v=e.format("m{0},{1}l{2},{1}",s(m.x*y),s(m.y*y),s(m.x*y)+1));for(var Y=["x","y","text","font","font-family","font-weight","font-style","font-size"],Z=0,J=Y.length;Z<J;Z++)if(Y[Z]in l){E._.dirty=1;break}switch(m["text-anchor"]){case"start":E.textpath.style["v-text-align"]="left",E.bbx=E.W/2;break;case"end":E.textpath.style["v-text-align"]="right",E.bbx=-E.W/2;break;default:E.textpath.style["v-text-align"]="center",E.bbx=0}E.textpath.style["v-text-kern"]=!0}},A=function(t,s,r){t.attrs=t.attrs||{},t.attrs;var a=Math.pow,l="linear",c=".5 .5";if(t.attrs.gradient=s,s=(s=n(s).replace(e._radial_gradient,(function(e,t,n){return l="radial",t&&n&&(t=i(t),n=i(n),a(t-.5,2)+a(n-.5,2)>.25&&(n=o.sqrt(.25-a(t-.5,2))*(2*(n>.5)-1)+.5),c=t+h+n),u}))).split(/\s*\-\s*/),"linear"==l){var d=s.shift();if(d=-i(d),isNaN(d))return null}var p=e._parseDots(s);if(!p)return null;if(t=t.shape||t.node,p.length){t.removeChild(r),r.on=!0,r.method="none",r.color=p[0].color,r.color2=p[p.length-1].color;for(var f=[],m=0,g=p.length;m<g;m++)p[m].offset&&f.push(p[m].offset+h+p[m].color);r.colors=f.length?f.join():"0% "+r.color,"radial"==l?(r.type="gradientTitle",r.focus="100%",r.focussize="0 0",r.focusposition=c,r.angle=0):(r.type="gradient",r.angle=(270-d)%360),t.appendChild(r)}return 1},E=function(t,n){this[0]=this.node=t,t.raphael=!0,this.id=e._oid++,t.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=n,this.matrix=e.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!n.bottom&&(n.bottom=this),this.prev=n.top,n.top&&(n.top.next=this),n.top=this,this.next=null},M=e.el;E.prototype=M,M.constructor=E,M.transform=function(t){if(null==t)return this._.transform;var i,o=this.paper._viewBoxShift,s=o?"s"+[o.scale,o.scale]+"-1-1t"+[o.dx,o.dy]:u;o&&(i=t=n(t).replace(/\.{3}|\u2026/g,this._.transform||u)),e._extractTransform(this,s+t);var r,a=this.matrix.clone(),l=this.skew,c=this.node,d=~n(this.attrs.fill).indexOf("-"),p=!n(this.attrs.fill).indexOf("url(");if(a.translate(1,1),p||d||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",r=a.split(),d&&r.noRotation||!r.isSimple){c.style.filter=a.toFilter();var f=this.getBBox(),m=this.getBBox(1),g=f.x-m.x,v=f.y-m.y;c.coordorigin=g*-y+h+v*-y,C(this,1,1,g,v,0)}else c.style.filter=u,C(this,r.scalex,r.scaley,r.dx,r.dy,r.rotate);else c.style.filter=u,l.matrix=n(a),l.offset=a.offset();return null!==i&&(this._.transform=i,e._extractTransform(this,i)),this},M.rotate=function(e,t,o){if(this.removed)return this;if(null!=e){if((e=n(e).split(c)).length-1&&(t=i(e[1]),o=i(e[2])),e=i(e[0]),null==o&&(t=o),null==t||null==o){var s=this.getBBox(1);t=s.x+s.width/2,o=s.y+s.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",e,t,o]])),this}},M.translate=function(e,t){return this.removed?this:((e=n(e).split(c)).length-1&&(t=i(e[1])),e=i(e[0])||0,t=+t||0,this._.bbox&&(this._.bbox.x+=e,this._.bbox.y+=t),this.transform(this._.transform.concat([["t",e,t]])),this)},M.scale=function(e,t,o,s){if(this.removed)return this;if((e=n(e).split(c)).length-1&&(t=i(e[1]),o=i(e[2]),s=i(e[3]),isNaN(o)&&(o=null),isNaN(s)&&(s=null)),e=i(e[0]),null==t&&(t=e),null==s&&(o=s),null==o||null==s)var r=this.getBBox(1);return o=null==o?r.x+r.width/2:o,s=null==s?r.y+r.height/2:s,this.transform(this._.transform.concat([["s",e,t,o,s]])),this._.dirtyT=1,this},M.hide=function(){return!this.removed&&(this.node.style.display="none"),this},M.show=function(){return!this.removed&&(this.node.style.display=u),this},M.auxGetBBox=e.el.getBBox,M.getBBox=function(){var e=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var t={},n=1/this.paper._viewBoxShift.scale;return t.x=e.x-this.paper._viewBoxShift.dx,t.x*=n,t.y=e.y-this.paper._viewBoxShift.dy,t.y*=n,t.width=e.width*n,t.height=e.height*n,t.x2=t.x+t.width,t.y2=t.y+t.height,t}return e},M._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},M.remove=function(){if(!this.removed&&this.node.parentNode){for(var t in this.paper.__set__&&this.paper.__set__.exclude(this),e.eve.unbind("raphael.*.*."+this.id),e._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape),this)this[t]="function"==typeof this[t]?e._removedFactory(t):null;this.removed=!0}},M.attr=function(n,i){if(this.removed)return this;if(null==n){var o={};for(var s in this.attrs)this.attrs[t](s)&&(o[s]=this.attrs[s]);return o.gradient&&"none"==o.fill&&(o.fill=o.gradient)&&delete o.gradient,o.transform=this._.transform,o}if(null==i&&e.is(n,"string")){if("fill"==n&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var r=n.split(c),a={},l=0,h=r.length;l<h;l++)(n=r[l])in this.attrs?a[n]=this.attrs[n]:e.is(this.paper.customAttributes[n],"function")?a[n]=this.paper.customAttributes[n].def:a[n]=e._availableAttrs[n];return h-1?a:a[r[0]]}if(this.attrs&&null==i&&e.is(n,"array")){for(a={},l=0,h=n.length;l<h;l++)a[n[l]]=this.attr(n[l]);return a}var u;for(var p in null!=i&&((u={})[n]=i),null==i&&e.is(n,"object")&&(u=n),u)d("raphael.attr."+p+"."+this.id,this,u[p]);if(u){for(p in this.paper.customAttributes)if(this.paper.customAttributes[t](p)&&u[t](p)&&e.is(this.paper.customAttributes[p],"function")){var f=this.paper.customAttributes[p].apply(this,[].concat(u[p]));for(var m in this.attrs[p]=u[p],f)f[t](m)&&(u[m]=f[m])}u.text&&"text"==this.type&&(this.textpath.string=u.text),k(this,u)}return this},M.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&e._tofront(this,this.paper),this},M.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),e._toback(this,this.paper)),this)},M.insertAfter=function(t){return this.removed?this:(t.constructor==e.st.constructor&&(t=t[t.length-1]),t.node.nextSibling?t.node.parentNode.insertBefore(this.node,t.node.nextSibling):t.node.parentNode.appendChild(this.node),e._insertafter(this,t,this.paper),this)},M.insertBefore=function(t){return this.removed?this:(t.constructor==e.st.constructor&&(t=t[0]),t.node.parentNode.insertBefore(this.node,t.node),e._insertbefore(this,t,this.paper),this)},M.blur=function(t){var n=this.node.runtimeStyle,i=n.filter;return i=i.replace(m,u),0!==+t?(this.attrs.blur=t,n.filter=i+h+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+t||1.5)+")",n.margin=e.format("-{0}px 0 0 -{0}px",s(+t||1.5))):(n.filter=i,n.margin=0,delete this.attrs.blur),this},e._engine.path=function(e,t){var n=x("shape");n.style.cssText=v,n.coordsize=y+h+y,n.coordorigin=t.coordorigin;var i=new E(n,t),o={fill:"none",stroke:"#000"};e&&(o.path=e),i.type="path",i.path=[],i.Path=u,k(i,o),t.canvas&&t.canvas.appendChild(n);var s=x("skew");return s.on=!0,n.appendChild(s),i.skew=s,i.transform(u),i},e._engine.rect=function(t,n,i,o,s,r){var a=e._rectPath(n,i,o,s,r),l=t.path(a),c=l.attrs;return l.X=c.x=n,l.Y=c.y=i,l.W=c.width=o,l.H=c.height=s,c.r=r,c.path=a,l.type="rect",l},e._engine.ellipse=function(e,t,n,i,o){var s=e.path();return s.attrs,s.X=t-i,s.Y=n-o,s.W=2*i,s.H=2*o,s.type="ellipse",k(s,{cx:t,cy:n,rx:i,ry:o}),s},e._engine.circle=function(e,t,n,i){var o=e.path();return o.attrs,o.X=t-i,o.Y=n-i,o.W=o.H=2*i,o.type="circle",k(o,{cx:t,cy:n,r:i}),o},e._engine.image=function(t,n,i,o,s,r){var a=e._rectPath(i,o,s,r),l=t.path(a).attr({stroke:"none"}),c=l.attrs,d=l.node,h=d.getElementsByTagName("fill")[0];return c.src=n,l.X=c.x=i,l.Y=c.y=o,l.W=c.width=s,l.H=c.height=r,c.path=a,l.type="image",h.parentNode==d&&d.removeChild(h),h.rotate=!0,h.src=n,h.type="tile",l._.fillpos=[i,o],l._.fillsize=[s,r],d.appendChild(h),C(l,1,1,0,0,0),l},e._engine.text=function(t,i,o,r){var a=x("shape"),l=x("path"),c=x("textpath");i=i||0,o=o||0,r=r||"",l.v=e.format("m{0},{1}l{2},{1}",s(i*y),s(o*y),s(i*y)+1),l.textpathok=!0,c.string=n(r),c.on=!0,a.style.cssText=v,a.coordsize=y+h+y,a.coordorigin="0 0";var d=new E(a,t),p={fill:"#000",stroke:"none",font:e._availableAttrs.font,text:r};d.shape=a,d.path=l,d.textpath=c,d.type="text",d.attrs.text=n(r),d.attrs.x=i,d.attrs.y=o,d.attrs.w=1,d.attrs.h=1,k(d,p),a.appendChild(c),a.appendChild(l),t.canvas.appendChild(a);var f=x("skew");return f.on=!0,a.appendChild(f),d.skew=f,d.transform(u),d},e._engine.setSize=function(t,n){var i=this.canvas.style;return this.width=t,this.height=n,t==+t&&(t+="px"),n==+n&&(n+="px"),i.width=t,i.height=n,i.clip="rect(0 "+t+" "+n+" 0)",this._viewBox&&e._engine.setViewBox.apply(this,this._viewBox),this},e._engine.setViewBox=function(t,n,i,o,s){e.eve("raphael.setViewBox",this,this._viewBox,[t,n,i,o,s]);var r,a,l=this.getSize(),c=l.width,d=l.height;return s&&(i*(r=d/o)<c&&(t-=(c-i*r)/2/r),o*(a=c/i)<d&&(n-=(d-o*a)/2/a)),this._viewBox=[t,n,i,o,!!s],this._viewBoxShift={dx:-t,dy:-n,scale:l},this.forEach((function(e){e.transform("...")})),this},e._engine.initWin=function(e){var t=e.document;t.styleSheets.length<31?t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):t.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!t.namespaces.rvml&&t.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),x=function(e){return t.createElement("<rvml:"+e+' class="rvml">')}}catch(n){x=function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},e._engine.initWin(e._g.win),e._engine.create=function(){var t=e._getContainer.apply(0,arguments),n=t.container,i=t.height,o=t.width,s=t.x,r=t.y;if(!n)throw new Error("VML container not found.");var a=new e._Paper,l=a.canvas=e._g.doc.createElement("div"),c=l.style;return s=s||0,r=r||0,o=o||512,i=i||342,a.width=o,a.height=i,o==+o&&(o+="px"),i==+i&&(i+="px"),a.coordsize=216e5+h+216e5,a.coordorigin="0 0",a.span=e._g.doc.createElement("span"),a.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(a.span),c.cssText=e.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",o,i),1==n?(e._g.doc.body.appendChild(l),c.left=s+"px",c.top=r+"px",c.position="absolute"):n.firstChild?n.insertBefore(l,n.firstChild):n.appendChild(l),a.renderfix=function(){},a},e.prototype.clear=function(){e.eve("raphael.clear",this),this.canvas.innerHTML=u,this.span=e._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},e.prototype.remove=function(){for(var t in e.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas),this)this[t]="function"==typeof this[t]?e._removedFactory(t):null;return!0};var I=e.st;for(var O in M)M[t](O)&&!I[t](O)&&(I[O]=function(e){return function(){var t=arguments;return this.forEach((function(n){n[e].apply(n,t)}))}}(O))}}.apply(t,i))||(e.exports=o)}])},"object"===r(t)&&"object"===r(e)?e.exports=s():(i=[],void 0===(o="function"===typeof(n=s)?n.apply(t,i):n)||(e.exports=o))}).call(this,n("YuTi")(e))},FZoo:function(e,t,n){var i=n("MrPd"),o=n("4uTw"),s=n("wJg7"),r=n("GoyQ"),a=n("9Nap");e.exports=function(e,t,n,l){if(!r(e))return e;for(var c=-1,d=(t=o(t,e)).length,h=d-1,u=e;null!=u&&++c<d;){var p=a(t[c]),f=n;if(c!=h){var m=u[p];void 0===(f=l?l(m,p,u):void 0)&&(f=r(m)?m:s(t[c+1])?[]:{})}i(u,p,f),u=u[p]}return e}},Fbyt:function(e,t,n){"use strict";n.r(t),n.d(t,"_Draggable",(function(){return o})),n.d(t,"_Droppable",(function(){return r}));var i={ghosting:!0,revert:!1,reverteffect:null,starteffect:null,endeffect:null,scroll:"canvas_container",positionLazy:!0,initialDelta:[0,0],customFindAffected:function(e,t){return canvas.findAffected(e,t)}},o={draggable:null,enableDragging:function(e){e&&this.draggable&&this.disableDragging(),this.draggable||(this.draggable=new Draggable(this.el,i))},disableDragging:function(){this.draggable&&(this.draggable.destroy(),this.draggable=null)}},s={accept:"tk_label",overlap:"vertical",positionLazy:!0,onHover:function(e,t,n){return canvas.onLblHover(e,t,n)},scroll:"canvas_container"},r={enableDropping:function(){Droppables.add(this.el,s)},disableDropping:function(){Droppables.remove(this.el)}}},Fjee:function(e,t,n){"use strict";(function(e){var i=n("4qC0"),o=n.n(i),s=n("2L+8"),r=n("PjTj");function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?d(e):t}(this,c(n).call(this,e))).state={value:t.props.value,focused:t.props.autoFocus},t.onFocus=t.onFocus.bind(d(t)),t.onBlur=t.onBlur.bind(d(t)),t.onChange=t.onChange.bind(d(t)),t.clear=t.clear.bind(d(t)),t}var i,u,p;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,t),i=n,(u=[{key:"onFocus",value:function(){this.props.onFocus&&this.props.onFocus(),this.setState({focused:!0})}},{key:"onBlur",value:function(){this.props.onBlur&&this.props.onBlur(),this.setState({focused:!1})}},{key:"onChange",value:function(e,t){this.setState({value:t}),this.props.onChange(e,t)}},{key:"clear",value:function(e){e.nativeEvent.stopImmediatePropagation(),this.props.onChange(null,""),this.setState({focused:!0,value:""})}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=e.value;o()(t)&&this.state.value!==t&&this.setState({value:t})}},{key:"render",value:function(){var t=this.props,n=t.className,i=t.iconColor,o=t.renderIcon,a=this.state,l=a.value,c=a.focused,d=c?"bc-blue":"bc-grey300",h=l?e.createElement(s.a,{opts:{name:"close",size:10,color:"grey300",parentClasses:"mr-8"},onMouseDown:this.clear}):null;return e.createElement("div",{className:"".concat(n," h-flex-row justify-sb b-1 rad-7px ").concat(d)},e.createElement("div",{className:"h-flex-row h-flex-grow mr-8"},o({color:i}),e.createElement(r.a,{type:"text",autoFocus:c,placeholder:I18n.t("js.search"),onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,className:"width-100% b-0 p-0",value:l})),h)}}])&&l(i.prototype,u),p&&l(i,p),n}(e.Component);p(f,"defaultProps",{renderIcon:function(t){return t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(n,!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({name:"search",size:14,classes:"h-a-center",parentClasses:"p-r ml-8 mr-4",consize:16},t),e.createElement(s.a,{opts:t})}}),t.a=f}).call(this,n("q1tI"))},G6z8:function(e,t,n){var i=n("fR/l"),o=n("oCl/"),s=n("mTTR");e.exports=function(e){return i(e,s,o)}},GDhZ:function(e,t,n){var i=n("wF/u"),o=n("mwIZ"),s=n("hgQt"),r=n("9ggG"),a=n("CMye"),l=n("IOzZ"),c=n("9Nap"),d=1,h=2;e.exports=function(e,t){return r(e)&&a(t)?l(c(e),t):function(n){var r=o(n,e);return void 0===r&&r===t?s(n,e):i(t,r,d|h)}}},GNiM:function(e,t,n){var i=n("I01J"),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,r=i((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(o,(function(e,n,i,o){t.push(i?o.replace(s,"$1"):n||e)})),t}));e.exports=r},GcUR:function(e,t,n){"use strict";n.r(t);var i=Class.create({initialize:function(e){this.options=e||{}},query:function(e,t){this.callback=t.onComplete,this.queryText=e,this.queryGroup=t.hasOwnProperty("group_id")?t.group_id:this.queryGroup,this.doSearch(t)},nextPage:function(e){this.doSearch({page:e})},doSearch:function(e){this.queryGroup&&(e=Object.extend({group_id:this.queryGroup},e)),this.queryText.empty()?this.doSearchAll(e):this.doTextSearch(e)},doTextSearch:function(e){e=Object.extend({query:this.queryText},e),new Ajax.Request("/skoletube/"+(this.queryGroup?"group":"user")+"_"+this.options.type+"_search",{method:"GET",asynchronous:!0,parameters:e,onSuccess:this.onSearchComplete.bind(this),onFailure:this.onSearchError.bind(this),onException:this.onSearchError.bind(this),onTimeout:this.onSearchError.bind(this)})},doSearchAll:function(e){new Ajax.Request("/skoletube/"+(this.queryGroup?"group":"user")+"_"+this.options.type,{method:"GET",asynchronous:!0,parameters:e,onSuccess:this.onSearchComplete.bind(this),onFailure:this.onSearchError.bind(this),onException:this.onSearchError.bind(this),onTimeout:this.onSearchError.bind(this)})},onSearchComplete:function(e){var t=e.responseJSON;if(t.error)"Authentication required"===t.error?MM.ui.dialogs.dialogSkoletubeLogin(this.options.type):this.onSearchError();else if(this.callback){if(t.media)var n=this.transformResults?this.transformResults(t.media):t.media;else n=[];this.callback(n,t.total_pages,t.current_page)}},onSearchError:function(){MM.ui.dialogs.showError(I18n.t("js.s_could_not_be_contacted",{v0:"Skoletube"}))}});t.default=i},Gga9:function(e,t,n){"use strict";n.r(t),n.d(t,"RectangleLayouter",(function(){return r})),n.d(t,"RCRectangle",(function(){return s}));var i=n("uvak"),o={node:null,fixedInitialPosition:!1,initialize:function($super,e,t,n){$super(e,t),this.node=n||null}},s=Class.create(i.Rectangle,o);s.fromRectangle=function(e,t){return Object.extend(e,o),t&&(e.node=t),e};var r=Class.create({_rectangles:[],initialize:function(){this._rectangles=[]},rectangles:function(){return this._rectangles.reject((function(e){return e.node.hidden}))},getRectangle:function(e){for(var t=this._rectangles.length;t>0;)if(this._rectangles[--t].node===e)return this._rectangles[t]},update:function(e){if(!e.isRoot()){var t,n=e.getRootC(),i=n._listener.getSizesForLayouter(!0),o=i.rectangle,r=this.getRectangle(n);if(r){var l=Object.clone(r);r.p1=o.p1,r.p2=o.p2,canvas.checkBounds(),t=this.changeRectangle(n,l,r)}else o=s.fromRectangle(o,e),Point.isValid(e.pos)?(this.setPosition(o,e.pos,i.offsets,!0),t=a.addPositioned(o)):(e.pos=null,t=a.addUnpositioned(o,i.offsets));return t}},findPosition:function(e){if(null!==App.config.layout.orientation)return this.findPositionAligned();var t=[],n=[];this.rectangles().sort((function(e,t){return e.p2.y-t.p2.y})).each((function(e){e.p1.x>0?n.unshift(e):t.unshift(e)}));var i=e.size(),o=canvas.root.dcontent.size()[0]/2;return n.length<2||n.length<t.length?[90+o,n[0]?n[0].p2.y+75:-100]:[-90-o-i.x,t[0]?t[0].p2.y+75:-100]},findPositionAligned:function(){var e=canvas.root.dcontent.size()[0]/2,t=this.rectangles(),n=t.length-1;return n<0?[90+e,-25]:[t[n].p1.x,t[n].p2.y]},addPositioned:function(e,t){e.fixedInitialPosition=!t,this._rectangles.push(e),canvas.checkBounds();var n=e.center();return this.changeRectangle(e.node,new i.Rectangle(n,n),e)},addUnpositioned:function(e,t){return this.setPosition(e,this.findPosition(e),t),this.addPositioned(e,!0)},setPosition:function(e,t,n,i){var o=i?t:r.rectanglePositionToNodeCoords(t,n),s=i?r.nodePositionToRectangleCoords(t,n):t;e.node.pos=o,e.move(new Point(s))},updateAll:function(){for(var e=0,t=this.rectangles(),n=t.length;e<n;e++)this.update(t[e].node)},remove:function(e){for(var t,n=this._rectangles,o=n.length,s=[];o>0;)if(n[--o].node.id!=e.id)s.push(n[o]);else var r=(t=n[o]).center(),a=this.changeRectangle(t.node,t,new i.Rectangle(r,r));return this._rectangles=s,a},_horizontalArrange:function(e,t){return[e,[-(e.p2.x-t.p1.x)-5,0]]},_verticalArrange:function(e,t){var n=e.center().y<t.center().y||e.p1.y===t.p1.y?Math.abs(t.p1.y-e.p2.y)+1:-Math.abs(e.p1.y-t.p2.y)-1;return[t,[0,n]]},_arrange:function(e,t){return e.center().x<0&&t.center().x>=0?this._horizontalArrange(e,t):e.center().x>=0&&t.center().x<0?this._horizontalArrange(t,e):this._verticalArrange(e,t)},_getOverlapping:function(e,t){var n,i=e.detect((function(e){return n=t.detect((function(t){return e!==t&&e.overlaps(t)}))}));return i&&n?[i,n]:null},_getLayoutingChanges:function(e){for(var t=[],n=this.rectangles().slice(0).sortBy((function(e){return Math.abs(e.center().y)})),i=0,o=this._getOverlapping(e,n);o&&i<100;){var s=this._arrange(o[0],o[1]);if(!s)return MM.error.reportException({message:"Layouter DEBUG: result is null,  r1: "+o[0].toString()+" r2: "+o[1].toString()+" dirtySet: "+Object.inspect(e)+" rectangles: "+Object.inspect(n)}),[];var r=s[0],a=s[1];e.include(r)||e.push(r),t.push([r.node,a]),r.shift(new Point(a)),o=this._getOverlapping(e,n),i++}return t},changeRectangleTidy:function(e){return this._getLayoutingChanges([e])},autoLayout:function(){return this._getLayoutingChanges(this.rectangles().slice(0).sortBy((function(e){return Math.abs(e.center().y)})))},autoCondense:function(){for(var e=new r,t=[],n=0,i=this._rectangles.length;n<i;n++){var o=this._rectangles[n];o=new s(new Point(0,0),o.size(),o.node),e.addUnpositioned(o),t.push([o.node,[0,0]])}return t},changeRectangle:function(e,t,n){if(this.elasticLayoutingEnabled&&!App.config.layout.autoAlign){var i,o=t.p1.y-n.p1.y,s=t.p2.y-n.p2.y;if(t.p1.y-t.p2.y===n.p1.y-n.p2.y)return null;for(var r=this.getRectangle(e),a=[],l=this.rectangles().slice(0),c=0;c<l.length;c++)if((i=l[c]).node.id===r.node.id)a.push([i.node,[0,0]]);else{var d=t,h=n,u=i.p1.x<=d.p1.x&&d.p1.x<=i.p2.x||i.p1.x<=d.p2.x&&d.p2.x<=i.p2.x||d.p1.x<=i.p1.x&&i.p1.x<=d.p2.x||d.p1.x<=i.p2.x&&i.p2.x<=d.p2.x;if(!(i.p1.x<=h.p1.x&&h.p1.x<=i.p2.x||i.p1.x<=h.p2.x&&h.p2.x<=i.p2.x||h.p1.x<=i.p1.x&&i.p1.x<=h.p2.x||h.p1.x<=i.p2.x&&i.p2.x<=h.p2.x)&&!u)continue;if(i.center().y===r.center().y)continue;var p=i.center().y>r.center().y?s:o;0!==p&&a.push([i.node,[0,-p]])}return a}},getTotalSize:function(){for(var e=this.rectangles(),t=canvas.root.getSize(),n=t[0]/2,i=-n,o=t[1]/2,s=-o,r=0;r<e.length;r++){var a=e[r];a.p1.x<i&&(i=a.p1.x),a.p1.y<s&&(s=a.p1.y),a.p2.x>n&&(n=a.p2.x),a.p2.y>o&&(o=a.p2.y)}return{width:n-i,height:o-s,centerOffset:[-i,-s]}}});r.rectanglePositionToNodeCoords=function(e,t){if(!t)return e;var n=[e[0],e[1]+t[1]];return e[0]<0&&(n[0]+=t[0]),n},r.nodePositionToRectangleCoords=function(e,t){if(!t)return e;var n=[e[0],e[1]-t[1]];return e[0]<0&&(n[0]-=t[0]),n};var a=new r;t.default=a},GlCk:function(e,t,n){"use strict";(function(e){var i=n("Fjee");function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(t){function n(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var i=(t=function(e,t){return!t||"object"!==o(t)&&"function"!==typeof t?l(e):t}(this,a(n).call(this,e)))._getAllItems(e.children);return t.state={allItems:i,items:i},t.filter=t.filter.bind(l(t)),t}var d,h,u;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,t),d=n,(h=[{key:"_getAllItems",value:function(t){var n=this,i=[];return e.Children.forEach(t,(function(e){e.props&&(i=[].concat(s(i),s(e.props.items||[]),s(n._getAllItems(e.props.children))))})),i}},{key:"renderChildren",value:function(t){var n=this;return e.Children.map(t,(function(t){var i={};return t.props.items&&(i={items:n.state.items}),i.children=n.renderChildren(t.props.children),e.cloneElement(t,i)}))}},{key:"filter",value:function(e,t){var n=this.filterItems(this.state.allItems,t);this.setState({items:n})}},{key:"filterItems",value:function(e,t){var n=this;return(t=t.toLowerCase())&&(e=e.filter((function(e){return e[n.props.filterableAttribute].toLowerCase().indexOf(t)>=0}))),e}},{key:"render",value:function(){var t=this.renderChildren(this.props.children);return e.createElement("div",null,e.createElement(i.a,{placeholder:this.props.placeholder,autoFocus:this.props.autofocus,className:this.props.inputClassName,onChange:this.filter,iconColor:this.props.iconColor}),t)}}])&&r(d.prototype,h),u&&r(d,u),n}(e.Component);d.defaultProps={placeholder:I18n.t("js.search"),iconColor:"grey300"},t.a=d}).call(this,n("q1tI"))},"H+JK":function(e,t,n){"use strict";n.r(t);var i=Class.create({vnode:null,icon:null,initialize:function(e,t){if(this.icon=t,this.vnode=e,this.icon){this.el=new Element("div",{className:"tk_icon_container"}),this.el.writeAttribute("icon-id",this.icon.id);var n=this.icon.getElement({className:"tk_icon i16"});this.el.appendChild(n),this.listener=canvas.onSetGroupIcon.bindAsEventListener(canvas,e.node,t);var i=e.node.icons.indexOf(this.icon);(e.image||e.video)&&i++,e.dcontent.insertChild(this,i),App.config.editable&&App.config.currentlyEditable&&this.enable()}},animate:function(){var e=childElements(this.el)[0];addClassName(e,"appear"),setTimeout((function(){removeClassName(e,"appear")}),300)},animateDeletion:function(e){CSS.set(childElements(this.el)[0],{transform:CSS.scale(.1),transformOrigin:"50% 50%",transitionDuration:"300ms"}),e.onFinish&&setTimeout(function(){e.onFinish(this)}.bind(this),300)},disable:function(){addClassName(this.el,"disabled"),this.el.stopObserving("click",this.listener)},enable:function(){removeClassName(this.el,"disabled"),this.el.observe("click",this.listener)}});t.default=i},HKtW:function(e,t,n){"use strict";(function(e){var i=n("Y1fO");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=function(t){var n=t.className,r=t.elementsInRow,a=t.emojis,l=t.onSelect,c=a.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{onClick:function(){l(e.name)}})}));return e.createElement(i.a,{className:n,elementsInRow:r,items:c})};r.defaultProps={className:"",elementsInRow:9,emojis:[],onSelect:function(){}},t.a=r}).call(this,n("q1tI"))},HmSg:function(e,t,n){"use strict";(function(e){var i=n("AJqD"),o=n("pfjc"),s=n("2L+8"),r=n("ERGR"),a={youtube:{label:"YouTube"},vimeo:{},dailymotion:{},google:{},iconfinder:{label:"IconFinder",iconClassName:"rad-0"},url:{label:"URL"},skoletube:{label:"SkoleTube"}};t.a=function(t){var n=t.sources,l=t.selectedSource,c=t.onChange,d=n.map((function(t){var n=a[t],i=n.label,o=void 0===i?t.capitalize():i,r=n.iconClassName,l=void 0===r?"":r;return{icon:e.createElement(s.a,{opts:{name:"".concat("url"===t?"":"service-").concat(t),size:22,parentClasses:"rad-100% mr-8 ".concat(l)}}),label:o,value:t}}));return e.createElement(i.a,{opener:e.createElement(o.a,{className:"w-190 mr-10"}),selected:d.find((function(e){return e.value===l})),onChange:c},e.createElement(r.a,{items:d}))}}).call(this,n("q1tI"))},I01J:function(e,t,n){var i=n("44Ds"),o=500;e.exports=function(e){var t=i(e,(function(e){return n.size===o&&n.clear(),e})),n=t.cache;return t}},I8na:function(e,t,n){"use strict";var i=n("vN+2"),o=n.n(i);function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}t.a=Class.create({currentValue:"",initialize:function(e,t){this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(n,!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({observeEvent:"keyup",onFocus:o.a,onBlur:o.a,onClear:t.onChange||o.a},t),this.field=$(e),this.parent=this.field.up(),this.clearer=this.parent.select(".clearer")[0],Element.bindOnClick(this.clearer,this.clear.bind(this)),this.field.observe("focus",this.onFocus.bind(this)),this.field.observe("blur",this.onBlur.bind(this)),this.field.observe(this.options.observeEvent,this.update.bind(this)),this.update()},getValue:function(){return this.field.value},onFocus:function(){addClassName(this.parent,"focused"),this.options.onFocus()},onBlur:function(){removeClassName(this.parent,"focused"),this.options.onBlur()},disable:function(){this.field.addClassName("disabled"),this.field.disabled=!0},enable:function(){this.field.removeClassName("disabled"),this.field.disabled=!1},blur:function(){this.field.blur()},update:function(e){var t=this.getValue();this.currentValue!==t&&(this.currentValue=t,this.field.removeClassName("inactive"),0===t.length?this.parent.removeClassName("active"):this.parent.addClassName("active"),this.options.onChange&&e&&this.options.onChange(t))},clear:function(e){this.currentValue="",this.field.value=this.currentValue,this.parent.removeClassName("active"),e&&this.options.onClear(this.getValue())}})},IOzZ:function(e,t){e.exports=function(e,t){return function(n){return null!=n&&(n[e]===t&&(void 0!==t||e in Object(n)))}}},Ij8n:function(e,t,n){"use strict";n.r(t);var i=n("PYYe"),o=n.n(i),s=n("J4oq"),r=n("zYya"),a=n("vpdt"),l=n("i5FV"),c=n("dYE5"),d=n("fh04"),h=n("ZlCP"),u=n("syde"),p=(n("Gga9"),n("CJ9X")),f=function(e){return e.replace(/\n/gi,"<br/>").replace(/\r/gi,'<br class="js-automatic-break ">')},m=Class.create({id:null,title:null,parent:null,children:null,closed:null,pos:null,icons:[],style:null,note:null,link:null,task:null,externalTask:null,_listener:null,hidden:null,modifiedAt:null,modifiedBy:null,attachments:null,idea_image:null,idea_video:null,comments:null,connections:null,outgoing_connections:null,initialize:function(e){if(this.id=e.id,this.children=[],this.title=e.title,this.closed=e.closed||!1,this.icons=[],e.icon){var t=[];e.icon.split(",").each(function(e){var n=Icon.fromFullName(e);n&&t.push(n)}.bind(this)),this.icons=Icon.compactAndOrder(t)}e.style&&(this.style=new Style(e.style)),this.note=e.note,this.link=e.link?e.link.escapeHTML():"",e.idea_video&&(this.idea_video=new c.default(Object.extend(e.idea_video,{idea_id:this.id}))),this.getTaskObject(e.task),this.externalTask=e.externalTask,this.pos=e.pos,this.modifiedAt=e.modifiedAt?new Date(e.modifiedAt):new Date,this.modifiedBy=e.modifiedBy,this.attachments=[],this.idea_image=null,this.connections=[],this.outgoing_connections=[],this.ideaProperty=e.ideaProperty,e.boundary&&(this.boundary=new s.default(Object.extend(e.boundary)),this.boundary.node=this),tree.nodes[e.id]=this,this.votes=[],e.votes&&e.votes.each(function(e){this.votes.push(new IdeaVote(e)),-1===IdeaVote.nodesWithVotes.indexOf(this)&&IdeaVote.nodesWithVotes.push(this)}.bind(this)),this.comments=[],e.comments&&e.comments.each(function(e){this.comments.push(new a.default(e))}.bind(this))},defaultStyle:function(){if(!App.config.mapTheme)return null;return this.isRoot()?Object.clone(App.config.mapTheme.root_style):this.parent.isRoot()?Object.clone(App.config.mapTheme.root_children_style):Object.clone(App.config.mapTheme.nodes_style)},currentStyle:function(){return this.style?this.style:this.defaultStyle()},__onAddChild:function(e,t,n,i,o){return e.parent=this,e.hidden=!1,"number"===typeof t&&t>=0?this.children.insert(e,t):this.children[this.children.length]=e,!!this._listener.__onAddChild(e._listener,this.rank(e),tree.notPainted,n,i,o)||(this.children.remove(e),!1)},addChild:function(e,t,n,i){if(ServerConnection.canQueueDoRequests()){this.closed&&this.toggleClosed();var o=tree.uncommitedId,s=new ChangeList;if(s.changes.push(new InsertChange({idea_id:this.id,new_data:{id:o,parent:this.id,title:tree.default_title,style:null,pos:e||null,rank:null!==t?t:this.children.length,closed:!1}})),i&&s.changes.push(new IdeaPropertiesChange({idea_id:o,type:"IdeaProperties",new_data:{floating:!0}})),n&&s.changes.push(new TextStyleChange({idea_id:o,type:"TextStyle",new_data:{style:n.toJSON()}})),s.execute()){var r=this.getChild(o);return mapView.hasMapFeature("graphics")&&App.config.editable&&App.config.currentlyEditable&&r._listener.dcontent.toEditing(null,null!==t?"insert-sibling":"insert"),r}return null}ServerConnection.networkIssues()},addChildren:function(e){this.closed&&this.toggleClosed();for(var t=[],n=0;n<e.length;n++){var i=this.escapeTitle(e[n].title);if(e[n].id)t.push(new RenameChange({idea_id:e[n].id,type:"Title",new_data:{title:i}}));else{var o=--tree.uncommitedId,s={id:o,parent:this.id,title:i,style:null};e[n].link&&Object.extend(s,{link:e[n].link}),e[n].note&&Object.extend(s,{note:e[n].note}),e[n].video&&Object.extend(s,{video:e[n].video});var r=new InsertChange({idea_id:o,type:"Insert",new_data:s});t.push(r)}}ChangeList.layoutAlteringChangeset(t)},__onRemoveChild:function(e,t,n){n=n||"definitive",this.children.remove(e),"definitive"===n&&(mapView.hasMapFeature("graphics")&&e.__onRemoveAllConnections(),tree.nodes[e.id]=null),e.hidden||(this._listener.__onRemoveChild(e._listener,t,n),e.hidden=!0,e.parent=null,mapView.hasMapFeature("graphics")&&App.config.layout.elasticLayout&&ChangeList.elasticLayoutChangeset(rectangleLayouter.remove(e)))},__onShowChild:function(e){return!(!e.hidden||!this.isInMapStructure())&&(e.hidden=!1,this._listener.__onAddChild(e._listener,this.rank(e),null),rectangleLayouter.update(this),!0)},__onHideChild:function(e,t){return t=t||"definitive",!(e.hidden||!this.children.include(e))&&(e.hidden=!0,this._listener.__onRemoveChild(e._listener,null,t),!mapView.hasMapFeature("graphics")||("temporary"!=t&&App.config.layout.elasticLayout&&ChangeList.elasticLayoutChangeset(rectangleLayouter.remove(e)),rectangleLayouter.update(this),!0))},removeChild:function(e){if(ServerConnection.canQueueDoRequests()){var t=new RemoveChange({idea_id:e.id,type:"Delete"});t.executeLocally(),ServerConnection.doChange(t)}else ServerConnection.networkIssues()},toggleAllClosed:function(e){for(var t=this;t.parent;)(t=t.parent).closed&&t.toggleClosed(e)},toggleClosed:function(e){this.isRoot()||(this.closed=!this.closed,this._listener.__onToggleClosed(),App.config.persistent&&!e&&users.selfUser&&ServerConnection.toggleClosed({ids:[this.id]}))},toggleClosedDetail:function(e){var t=[],n=this.depth();this.eachChild((function(i){var o=i.depth()-n;(i.closed&&e>o||!i.closed&&e==o&&i.hasChildren())&&(t.push(i.id),i.closed=!i.closed,i._listener.__onToggleClosed(),rectangleLayouter.update(i))}),!1),App.config.persistent&&ServerConnection.toggleClosed({ids:t})},reposition:function(e){var t=new RepositionChange({idea_id:this.id,type:"Reposition",new_data:{pos:e}});return t.execute(),t},__onReposition:function(e,t,n){return n||this.touch(t),this.pos=e,this._listener.__onReposition(t),!0},__onMove:function(e,t,n,i,o){if(this.touch(n),n)var s={moveClone:this.cloneWithPosition(this._listener.dcontainer.el)};return this.parent.__onRemoveChild(this,null,o?"temporary":"move"),i&&(this.pos=i),e.__onAddChild(this,t,n,s||[],!0),e.isRoot()?(n||rectangleLayouter.update(this),mapView.hasMapFeature("graphics")&&this._listener.rc.paint()):n||rectangleLayouter.update(e),!0},__onRename:function(e,t){return this.touch(t),this.title=e,this._listener.__onRename(t),!0},rename:function(e,t){if(ServerConnection.canQueueDoRequests()){if(!e.match(/^\s*$/)&&e!==this.title){var n=new ChangeList;if(this.isRootC()&&t&&App.config.layout.elasticLayout){var i=new RepositionChange({idea_id:this.id,type:"Reposition",old_data:{pos:this.pos},new_data:{pos:Math.offset(this.pos,t)}});i.execute(),n.changes.push(i)}e=this.escapeTitle(e),n.changes.push(new RenameChange({idea_id:this.id,type:"Title",old_data:{title:this.getRawTitle()},new_data:{id:this.id,title:e}})),this.__onRename(e),App.config.layout.elasticLayout&&n.doNodeLayoutingChanges(this),ServerConnection.doChanges(n),this.isRoot()&&App.trigger(CustomEvents.ROOT_RENAMED)}}else ServerConnection.networkIssues()},insertRename:function(e,t,n,i){if(ServerConnection.canQueueDoRequests()){e=this.escapeTitle(e),this.__onRename(e),this.pos&&t&&App.config.layout.elasticLayout&&this.__onReposition([this.pos[0]+t[0],this.pos[1]+t[1]]);var o=new ChangeList;o.changes.push(new InsertChange({idea_id:this.id,type:"Insert",new_data:{id:this.id,parent:this.parent.id,title:e,style:null,pos:this.pos,closed:this.closed,rank:this.parent.rank(this)}})),n&&o.changes.push(new IdeaPropertiesChange({idea_id:this.id,type:"IdeaProperties",new_data:{floating:!0}})),this.style&&o.changes.push(new TextStyleChange({idea_id:this.id,type:"TextStyle",new_data:{style:this.style.toJSON()}})),App.config.layout.elasticLayout&&o.doNodeLayoutingChanges(o.changes.first().node()),ServerConnection.doChanges(o),App.trigger(CustomEvents.TOPIC_INSERTED),i&&App.trigger(CustomEvents.SIBLING_ADDED)}else ServerConnection.networkIssues()},generateThumb:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n.onError||(n.onError=function(){return!0}),n.onSuccess||(n.onError=function(){return!0}),!(this.link||this.idea_image||this.idea_video)){this._listener.setLoadingOnDrop();var i=new Image;i.src="/images/download_url?url=".concat(o()(e)),i.onload=function(){t.generateImageThumb(e,{onError:n.onError,onSuccess:n.onSuccess})},i.onerror=function(){new Ajax.Request("/maps/expand_link/",{parameters:{link:e},onSuccess:function(i){var o=i.responseJSON;if(o.url){var s=Object(p.checkLink)(o.url);s.video&&s.source?(t.generateVideoThumb(s,e,o),n.onSuccess()):(t.generateWebsiteThumb(e,o),n.onSuccess())}else t._listener.removeLoadingFromDrop()},onFailure:function(){n.onError(),t._listener.removeLoadingFromDrop()}})}}},generateVideoThumb:function(e,t,n){var i=[],o=n.title,s=n.url,r=new c.default({url:p.embeddedURLs[e.source]+e.video,source:e.source,size:{width:480,height:272}});i.push(new RenameChange({idea_id:this.id,type:"Title",old_data:{title:this.title},new_data:{title:this.title.replace(t,o)}})),i.push(new AddVideoChange({idea_id:this.id,type:"AddVideo",new_data:r.toJSON()})),i.push(new LinkChange({idea_id:this.id,type:"Link",old_data:{link:this.link},new_data:{link:s}})),ChangeList.layoutAlteringChangeset(i),this._listener.removeLoadingFromDrop()},generateImageThumb:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.onError||(t.onError=function(){return!0}),t.onSuccess||(t.onError=function(){return!0});var n={def_image_id:"",idea_image_url:e};MM.utils.File.uploadImage([this],n,{successCallback:function(e,n){Tree.utils.setImage(new l.default(e),n),t.onSuccess()},errorCallback:function(){t.onError(),this._listener.removeLoadingFromDrop()}})},generateWebsiteThumb:function(e,t){var n=this,i=t.title,o=t.url,s=[];if(i.length>0&&s.push(new RenameChange({idea_id:this.id,type:"Title",old_data:{title:this.title},new_data:{title:this.title.replace(e,i)}})),s.push(new LinkChange({idea_id:this.id,type:"Link",old_data:{link:this.link},new_data:{link:o}})),!t.images[0])return ChangeList.layoutAlteringChangeset(s),void this._listener.removeLoadingFromDrop();MM.utils.File.uploadImage([this],{idea_image_url:t.images[0].src},{successCallback:function(e){var t=new l.default(e);s.push(new AddImageChange({idea_id:n.id,type:"AddImage",new_data:{idea_image_id:t.id,details:{url:t.download_link,size:[500,300]}},old_data:{idea_image_id:n.idea_image?n.idea_image.id:null}})),ChangeList.layoutAlteringChangeset(s)},errorCallback:function(){ChangeList.layoutAlteringChangeset(s),Message.show(I18n.t("your_request_was_not_done"),Message.ERROR)}})},commitEdit:function(e,t,n,i){var o=this,s=function(){"insert"===n||"insert-sibling"===n?o.insertRename(e,t,i,"insert-sibling"===n):o.rename(e,t)};ServerConnection.canQueueDoRequests()?s():ServerConnection.registerPendingCode(s)},__onSetIcon:function(e,t){if(e||(e=[]),this.touch(t),e&&"string"===typeof e){var n=[];e.split(",").each(function(e){var t=Icon.fromFullName(e);t&&n.push(t)}.bind(this)),this.icons=Icon.compactAndOrder(n)}else this.icons=[];return this.updateTaskFromIcons(this.icons),this._listener.__onSetIcon(!1,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onSetStyle:function(e,t){return this.touch(t),this.style=e,this._listener.__onSetStyle(tree.notPainted,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onSetProperty:function(e,t,n){switch(this.touch(n),this[e]=t,e){case"task":this.getTaskObject(t),this._listener.__onSetProperty("task",tree.notPainted,n),this._listener.__onSetProperty("externalTask",tree.notPainted,n);break;case"link":this.link=this.link?this.link.escapeHTML():"",this._listener.__onSetProperty("link",tree.notPainted,n);break;default:this._listener.__onSetProperty(e,tree.notPainted,n)}return mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onSetIdeaProperty:function(e,t){return this.touch(t),this.ideaProperty=e,this._listener.__onSetIdeaProperty(tree.notPainted,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onAddAttachment:function(e,t){this.touch(t),this.attachments.push(e),1==this.attachments.length&&this._listener.__onSetProperty("attachments",tree.notPainted,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},addAttachment:function(e){ChangeList.layoutAlteringChangeset([new AddAttachmentChange({idea_id:this.id,type:"AddAttachment",new_data:{attachment_id:e.id}})])},__onRemoveAttachment:function(e,t){this.touch(t),this.attachments.remove(e),this._listener.__onSetProperty("attachments",!1,t),0==this.attachments.length&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},removeAttachment:function(e){ChangeList.layoutAlteringChangeset([new RemoveAttachmentChange({idea_id:this.id,type:"RemoveAttachment",old_data:{attachment_id:e.id}})])},__onAddComment:function(e,t){this.touch(t),this.comments.push(e),this._listener.__onSetProperty("comments",tree.notPainted,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},__onRemoveComment:function(e,t){this.touch(t),this.comments.remove(e),this._listener.__onSetProperty("comments",!1,t),0===this.comments.length&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},removeComment:function(e){ChangeList.layoutAlteringChangeset([new RemoveCommentChange({idea_id:this.id,type:"RemoveComment",old_data:{idea_comment_id:e.id}})])},__onAddVote:function(e,t){return this.touch(t),this.votes.push(e),-1===IdeaVote.nodesWithVotes.indexOf(this)&&IdeaVote.nodesWithVotes.push(this),IdeaVote.updateAll(this),this._listener.__onSetProperty("votes",tree.notPainted,t),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onEditVote:function(e,t){return this._listener.__onSetProperty("votes",!1,t),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onRemoveVote:function(e,t){return this.touch(t),e&&this.votes.remove(e),0===this.votes.length?IdeaVote.nodesWithVotes.remove(this):IdeaVote.updateAll(this),this._listener.__onSetProperty("votes",!1,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onAddVideo:function(e,t){return this.touch(t),this.idea_video=e,this._listener.__onSetProperty("video",tree.notPainted,t),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onRemoveVideo:function(e){return this.touch(e),this.idea_video=null,this._listener.__onSetProperty("video",tree.notPainted,e),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onAddImage:function(e){return this.touch(e),this._listener.__onSetProperty("image",tree.notPainted,e),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},removeImage:function(){ChangeList.layoutAlteringChangeset([new RemoveImageChange({idea_id:this.id,type:"RemoveImage",old_data:{idea_image_id:this.idea_image.id}})])},__onRemoveImage:function(e,t){return this.touch(t),this.idea_image=null,this._listener.__onSetProperty("image",tree.notPainted,t),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},addBoundary:function(e){ChangeList.layoutAlteringChangeset([new AddBoundaryChange({idea_id:this.id,type:"AddBoundary",new_data:e})])},__onAddBoundary:function(){this.boundary&&this._listener.__onAddBoundary()},removeBoundary:function(){this.boundary&&ChangeList.layoutAlteringChangeset([new RemoveBoundaryChange({idea_id:this.id,type:"RemoveBoundary",old_data:this.boundary.toJSON()})])},__onRemoveBoundary:function(){this.boundary&&this.boundary.destroy(),this.boundary=null,this._listener.__onRemoveBoundary()},editBoundary:function(e){this.boundary?ChangeList.layoutAlteringChangeset([new EditBoundaryChange({idea_id:this.id,type:"EditBoundary",new_data:e,old_data:this.boundary.toJSON()})]):this.addBoundary(e)},resizeImage:function(e,t,n){ChangeList.layoutAlteringChangeset([new ResizeImageChange({idea_id:this.id,type:"ResizeImage",new_data:{idea_image_id:e.id,width:t,height:n},old_data:{idea_image_id:e.id,width:this.idea_image.width(),height:this.idea_image.height()}})])},__onResizeImage:function(e,t){return this.touch(t),this.idea_image.equals(e)?(this._listener.__onResizeImage(t),this._listener.image.onSelect(),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0):Message.show(I18n.t("js.image_does_not_match"),Message.ERROR,5)},__onAddConnection:function(e,t){return this.touch(t),this.connections.push(e),this.outgoing_connections.push(e),e.to.connections.push(e),this._listener.__onAddConnection(e),!0},__onRemoveConnection:function(e,t){return this.touch(t),this._listener.__onRemoveConnection(e),!!e&&(e.destroy(),!0)},__onRemoveAllConnections:function(){for(var e=this.connections.length-1;e>=0;e--)this.__onRemoveConnection(this.connections[e]);for(e=0;e<this.children.length;e++)this.children[e].__onRemoveAllConnections()},connectTo:function(e){var t=new ChangeList,n=h.default.get(e.id,this.id);n&&t.changes.push(new RemoveConnectionChange({idea_id:e.id,type:"RemoveConnection",old_data:{from_id:e.id,to_id:this.id,color:n.color||r.DEFAULT_COLOR}})),t.changes.push(new AddConnectionChange({idea_id:this.id,type:"AddConnection",new_data:{from_id:this.id,to_id:e.id,color:r.DEFAULT_COLOR}})),t.execute(),ServerConnection.doChanges(t)},disconnectFrom:function(e){var t=new ChangeList,n=h.default.get(this.id,e.id);t.changes.push(new RemoveConnectionChange({idea_id:this.id,type:"RemoveConnection",old_data:{from_id:this.id,to_id:e.id,color:n.color||r.DEFAULT_COLOR}})),t.execute(),ServerConnection.doChanges(t)},getLinkObj:function(){var e=this.link.match(/^([^:]+):[\/]*(.*)$/);if(e){var t;switch(e[1]){case"mailto":t="email";break;case"topic":t="topic";break;default:t="url"}return{protocol:e[1],link:e[2],type:t}}return{type:"url"}},getLinkRel:function(e){var t=e.link;return/(mindmeister|meistertask).com/i.test(void 0===t?"":t)?"noopener":"nofollow noopener"},touch:function(e){e?(this.modifiedBy=e,this.modifiedAt=new Date):"undefined"!=typeof RevisionBrowser&&RevisionBrowser.on||(this.modifiedBy=users&&users.selfUser?users.selfUser[0]:null,this.modifiedAt=new Date),this._listener.dcontent&&this._listener.dcontent.setHoverTitle()},changeId:function(e){this._listener.__onChangeId(this.id,e),tree.nodes[e]=tree.nodes[this.id],tree.nodes[this.id]=null,this.id=e},changeImageId:function(e){if(this.idea_image&&!l.default.get(e)){var t=Object.clone(this.idea_image);t.id=e,l.default.all[e]=t,this.idea_image=t,this.__onAddImage()}},normalizeWhitespaces:function(e){return e.replace(new RegExp(String.fromCharCode(160),"g")," ")},getTitle:function(e){var t=this.normalizeWhitespaces(this.title);return e||(t=f(t)),t},getTitleWithLinks:function(e){var t=this.normalizeWhitespaces(this.title).toLink();return e?t:f(t)},getRawTitle:function(){return this.title.safeUnescapeHTML()},escapeTitle:function(e){return(e.match(/^\s*$/)?"":e).escapeHTML()},getSingleLineTitle:function(){return this.getRawTitle().replace(/[\n\r]/gi," ")},getTaskObject:function(e,t){e?(this.task=new d.default(e),this.task.empty()&&(this.task=null)):(this.task=null,this.externalTask=null),t||this.updateTaskFromIcons(this.icons)},updateTaskFromIcons:function(e){this.task||(this.task=new d.default({}));var t=e.detect((function(e){return"priority"===e.group()}));this.task.priority=t?u.TASK.priority.indexOf(t.id):-1;var n=e.detect((function(e){return"task"===e.group()}));this.task.complete=n?u.TASK.complete.indexOf(n.id):-1,this.task.empty()&&(this.task=null)},setTaskNotify:function(e){ServerConnection.setTaskNotify(this.id,e)},hasChildren:function(){return this.children.any((function(e){return!e.hidden}))},numChildren:function(){return this.children.count((function(e){return!e.hidden}))},countTotalChildren:function(){for(var e=0,t=0;t<this.children.length;t++)e+=this.children[t].countTotalChildren();return 1+e},isChild:function(e){return!!this.parent&&(this.parent==e||this.parent.isChild(e))},isChildOrSelf:function(e){return e==this||!!this.parent&&this.parent.isChildOrSelf(e)},isRoot:function(){return null==this.parent},isRootC:function(){return this.parent&&this.parent.isRoot()},getRootC:function(){return this.isRoot()?null:this.ancestor(this.depth()-1)},rank:function(e){return this.indexOf(e)},indexOf:function(e){return this.children.indexOf(e)},depth:function(){return this.parent?1+this.parent.depth():0},ancestor:function(e){return 0==e?this:this.parent?this.parent.ancestor(e-1):null},getAncestors:function(){var e=[];return this.parent&&(e=this.parent.getAncestors()).push(this.parent),e},equals:function(e){return this.id==e.id},getChildRecursive:function(e){if(e===this.id)return this;for(var t=0;t<this.children.length;t++){var n=this.children[t].getChild(e);if(n)return n}return null},getChild:function(e){var t=tree.nodes[e];return t||(tree.nodes[e]=this.getChildRecursive(e))},isVisible:function(){return!this.hidden&&this.getAncestors().all((function(e){return!e.hidden&&!e.closed}))},isFloating:function(){return this.ideaProperty&&this.ideaProperty.floating},getVisibleChild:function(e){var t=this.getChild(e);return t&&t.isVisible()?t:null},isInMapStructure:function(){return this===tree.root||this.getAncestors().include(tree.root)},getVisibleParent:function(){return this.isVisible()?this:this.parent.getVisibleParent()},getVisibleChildren:function(){for(var e=[],t=0;t<this.children.length;t++)this.children[t].isVisible()&&e.push(this.children[t]);return e},getChildByTitle:function(e){if(e===this.title)return this;for(var t=0;t<this.children.length;t++){var n=this.children[t].getChildByTitle(e);if(n)return n}return null},getMiddleChild:function(){if(this.closed||!this.hasChildren())return null;var e=this.getVisibleChildren();return e[e.length%2===0?e.length/2-1:parseInt(e.length/2)]},getNextSibling:function(){if(this.isRootC())return tree.root._listener.getNextSibling(this._listener);var e=this.parent?this.parent.children.indexOf(this):-1;if(-1===e)return null;for(;++e<this.parent.children.length&&this.parent.children[e].hidden;);return e>=this.parent.children.length?null:this.parent.children[e]},getPrevSibling:function(){if(this.isRootC())return tree.root._listener.getPrevSibling(this._listener);var e=this.parent?this.parent.children.indexOf(this):-1;if(-1===e)return null;for(;--e>=0&&this.parent.children[e].hidden;);return e<0?null:this.parent.children[e]},getNextSiblingExtended:function(e){for(var t,n=0,i=this.depth(),o=e?e-i:0;i-n>0;){if(t=this.ancestor(n).getNextSibling())return t.getTopChild(n+o);n+=1}return null},getPrevSiblingExtended:function(e){for(var t,n=0,i=this.depth(),o=e?e-i:0;i-n>0;){if(t=this.ancestor(n).getPrevSibling())return t.getBottomChild(n+o);n+=1}return null},getTopChild:function(e){return this.children&&this.children.length>0&&e>0?this.children.first().getTopChild(e-1):this},getBottomChild:function(e){return this.children&&this.children.length>0&&e>0?this.children.last().getBottomChild(e-1):this},doBreadthFirstTraversal:function(e){for(var t=[this];t.length>0;){var n=t.shift();e(n),n.children.each((function(e){t.push(e)}))}},cloneWithPosition:function(e){for(var t=e.cloneNode(!0),n=this.getElementsByClassName(t,"tk_label"),i=0,o=n.length;i<o;i++)n[i].style.color="#ccc";Position.absolutize(t);var s=e.cumulativeOffset();return t.style.left=s[0]+"px",t.style.top=s[1]-35+"px",t},getElementsByClassName:function(e,t){for(var n=[],i=new RegExp("\\b"+t+"\\b"),o=e.getElementsByTagName("*"),s=0,r=o.length;s<r;s++)i.test(o[s].className)&&n.push(o[s]);return n},eachChild:function(e,t){for(var n=e(this,t),i=0;i<this.children.length;i++)this.children[i].eachChild(e,n)},detect:function(e){var t;return this.eachChild((function(n){if(e(n))throw t=n,$break})),t},eachChildWithoutSelf:function(e,t){for(var n=0;n<this.children.length;n++)this.children[n].eachChild(e,t)},destroy:function(){for(var e=0,t=this.children.length;e<t;e++)this.children[e].destroy();for(e=0,t=this.connections.length;e<t;e++)this.connections[e]&&this.connections[e].destroy();this._listener=null,this.parent=null,this.children=null}});t.default=m},Ioao:function(e,t,n){var i=n("heNW"),o=Math.max;e.exports=function(e,t,n){return t=o(void 0===t?e.length-1:t,0),function(){for(var s=arguments,r=-1,a=o(s.length-t,0),l=Array(a);++r<a;)l[r]=s[t+r];r=-1;for(var c=Array(t+1);++r<t;)c[r]=s[r];return c[t]=n(l),i(e,this,c)}}},J4oq:function(e,t,n){"use strict";n.r(t);var i=n("aOY9"),o=Class.create({id:null,AvailableProperties:["shape","fill_color","fill_opacity","stroke_color","stroke_width","stroke_style","stroke_opacity"],initialize:function(e){"undefined"!==typeof e&&e.idea_id&&(this.node=tree.root.getChild(e.idea_id)),this.style=new BoundaryStyle(e),this.view=new i.default(this)},__onSetProperties:function(e,t){return this.style.update(e),this.view.redraw(!0),!0},destroy:function(){this.view.destroy()},paint:function(){this.view.drawBoundary()},toJSON:function(){return this.style.toJSON()}});o.SHAPE_BOX=0,o.SHAPE_BOX_ROUND=1,o.SHAPE_CONE=2,o.SHAPE_CONE_ROUND=3,o.SHAPE_CLOUD=4,o.STROKE_SOLID=0,o.STROKE_DASHED=1,o.STROKE_DOTTED=2,t.default=o},JC6p:function(e,t,n){var i=n("cq/+"),o=n("7GkX");e.exports=function(e,t){return e&&i(e,t,o)}},JPst:function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",i=e[3];if(!i)return n;if(t&&"function"===typeof btoa){var o=(r=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(l," */")),s=i.sources.map((function(e){return"/*# sourceURL=".concat(i.sourceRoot).concat(e," */")}));return[n].concat(s).concat([o]).join("\n")}var r,a,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(n,"}"):n})).join("")},t.i=function(e,n){"string"===typeof e&&(e=[[null,e,""]]);for(var i={},o=0;o<this.length;o++){var s=this[o][0];null!=s&&(i[s]=!0)}for(var r=0;r<e.length;r++){var a=e[r];null!=a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="(".concat(a[2],") and (").concat(n,")")),t.push(a))}},t}},Juji:function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},KfNM:function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},KwMD:function(e,t){e.exports=function(e,t,n,i){for(var o=e.length,s=n+(i?1:-1);i?s--:++s<o;)if(t(e[s],s,e))return s;return-1}},KxBF:function(e,t){e.exports=function(e,t,n){var i=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(o);++i<o;)s[i]=e[i+t];return s}},Kz5y:function(e,t,n){function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n("WFqU"),s="object"==("undefined"===typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,r=o||s||Function("return this")();e.exports=r},L0S0:function(e,t,n){"use strict";n.r(t);var i=n("wK+5"),o=n("h2DW"),s=n("7XaY"),r=n("ZlCP"),a=Class.create(i.default,{pcenter:null,initialize:function(e){this.children=[],this.node=e,this.icons=[],mapView.root=this,this.dcontent=new o.default("tk_label root"),this.dcontent.el.id=e.id,this.dcontent.el._listener=this,this.dcontent.setTitle(),App.config.editable&&App.config.currentlyEditable&&this.initEditMode(),this.__onSetStyle(!0),this.node.icons.length>0&&this.__onSetIcon(!0),this.node.note&&this.__onSetProperty("note",!0),this.node.link&&this.__onSetProperty("link",!0),this.node.attachments.length>0&&this.__onSetProperty("attachments",!0),this.node.task&&this.__onSetProperty("task",!0),this.node.comments.length>0&&this.__onSetProperty("comments",!0),this.node.idea_image&&this.__onSetProperty("image",!0),this.node.idea_video&&this.__onSetProperty("video",!0)},initEditMode:function(){this.dcontent.enabled||(this.dcontent.makeSelectable(),this.dcontent.makeEditable(),this.dcontent.toInactive(),this.dcontent.makeResizable(),this.dcontent.enableResizing())},initViewOnlyMode:function(){this.dcontent.toInactive&&this.dcontent.toInactive(),this.dcontent.disableSelecting&&this.dcontent.disableSelecting(),this.dcontent.disableResizing&&this.dcontent.disableResizing(),this.dcontent.el.style.cursor="default"},refreshLayout:function(){if(App.config.layout.autoAlign)for(var e=0,t=canvas.root.children.length;e<t;e++){var n=canvas.root.children[e];n.rc.redrawRootLine(),n.rc.redrawLines()}},translateChildNodes:function(e,t){if(App.config.layout.autoAlign)for(var n=0,i=canvas.root.children.length;n<i;n++){var o=canvas.root.children[n];o.rc.redrawRootLine(),o.rc.orientation!==t&&t||(o.rc.translateBoundaries({x:e.x,y:e.y}),o.rc.graphics.childrenPath.translate(e.x,e.y))}},findAffected:function(e){if(this.dcontent.contains(e))return this.dcontent.el;for(var t=null,n=0,i=this.children.length;n<i;n++){var o=e;if(App.config.layout.autoAlign&&(o=Math.negativeOffset(e,canvas.getElementOffset(this.children[n].dcontainer.el.parentNode))),t=this.children[n].findAffected(o))break}return t},select:function(e,t,n,i,o){App.config.editable&&App.config.currentlyEditable&&this.dcontent&&(canvas._rememberedDepth=t,this.dcontent.toSelected(e,n,i,o))},reposition:function(e){var t=this.dcontent,n=App.config.layout;if(n.autoAlign){var i=App.Layouts.get(n.id),o=$("tk_map"),s=canvas.getCenter(),r=$("tk_rootcontainer"),a=[r.offsetLeft+r.clientWidth/2,r.offsetTop+r.clientHeight/2],l=Math.max(s[0]-a[0],0);i===App.Layouts.LeftAligned&&"phantomjs"!==App.config.environment?o.style.right="calc(100% - "+(o.getWidth()+l)+"px)":o.style.left="".concat(l,"px"),o.style.top="".concat(s[1]-a[1],"px"),this.pcenter=s,tree.notPainted||e||this.children.each((function(e){e.rc.redrawLines()}))}else t.move([parseInt(canvas.size[0]/2-t.el.offsetWidth/2),parseInt(canvas.size[1]/2-t.el.offsetHeight/2)]),t.doMove(),this.pcenter=[parseInt(t.pos[0]+t.size()[0]/2),parseInt(t.pos[1]+t.size()[1]/2)];this.redrawBoundaries()},getCenter:function(){var e=this.dcontent.el,t=canvas.getNodeCanvasOffset(this);return[t[0]+parseInt(e.clientWidth/2),t[1]+parseInt(e.clientHeight/2)]},paint:function(){App.config.layout.paintRoot();var e=this.children.clone();e.sort((function(e,t){return e.node.pos&&t.node.pos?e.node.pos[1]-t.node.pos[1]:0}));for(var t=0,n=e.length;t<n;t++)e[t].rc.paint(!0);if(App.config.layout.autoAlign){this.reposition(!0);for(t=0,n=e.length;t<n;t++)e[t].rc.redrawLines()}},makeVisible:function(){return!0},redrawBoundaries:function(){this.__onAddBoundary()},__onAddBoundary:function(){this.node.boundary&&this.node.boundary.view.redraw()},__onRemoveBoundary:function(){this.node.boundary&&this.node.boundary.view.destroy()},__onAddChild:function(e,t,n,i,o,r){var a=new s.default(e);return e.setRc(a),this.children.push(e),e.parent=this,removeClassName(e.dcontent.el,"node"),addClassName(e.dcontent.el,"root_child"),!!n||(r&&(e.isTemporarilyRemoved=!1),!!a.paint()&&(i&&"undefined"!==typeof App.ui.Users&&App.ui.Users&&(o&&o.moveClone?App.ui.Users.highlightMovement(e,i,o.moveClone):App.ui.Users.highlightNode(e,i)),!0))},__onRemoveChild:function(e,t,n){canvas.isSelected(e)&&"definitive"===n&&(e.node.getPrevSibling()||e.node.getNextSibling()||this.node)._listener.select(null,null,!0,!0);e.dcontainer.el.parentNode&&(e.dcontainer.el.parentNode.removeChild(e.dcontainer.el),App.config.layout.autoAlign&&canvas.root.reposition()),e.rc.destroyLines();for(var i=0,o=e.node.connections.length;i<o;i++)e.__onRemoveConnection(e.node.connections[i]);this.children=this.children.reject((function(t){return t===e})),rectangleLayouter.update(this.node)},_refreshRootCAngles:function(){for(var e=0,t=this.children.length;e<t;e++){var n=this.children[e];if(!n.rc.vnode.node.pos)return;n.rc.angle=Math.slopeAngle(n.rc.vnode.node.pos)}this.children.sort((function(e,t){return e.node.pos[1]-t.node.pos[1]}))},_childCloserToAngle:function(e,t,n,i){return Math.abs(e.rc.angle-n)<(i?Math.abs(t.rc.angle-i):Math.abs(t.rc.angle-n))?e:t},getChildAtAngle:function(e){var t=null;if(0==this.children.length)return null;var n=this.children.sortBy((function(e){return e.rc.angle}));if(e<n.first().rc.angle)return this._childCloserToAngle(n.first(),n.last(),e,e+360);if(e>n.last().rc.angle)return this._childCloserToAngle(n.first(),n.last(),e+360,e);for(var i=0,o=n.length;i<o;i++)if(e<n[i].rc.angle){var s=n[i-1];t=this._childCloserToAngle(n[i],s,e);break}return t},getLeftChildren:function(){return this.children.filter((function(e){return e.rc.orientation==App.Layouts.orientation.left}))},getRightChildren:function(){return this.children.filter((function(e){return e.rc.orientation==App.Layouts.orientation.right}))},getNextSibling:function(e){if(null===e.node.pos)return null;if(App.config.layout.rootChildrenPosition){var t=this.children.filter((function(t){return t.rc.orientation===e.rc.orientation&&t!==e&&t.node.pos[1]>e.node.pos[1]}));return t.sort((function(t,n){return t.node.pos[1]-e.node.pos[1]-(n.node.pos[1]-e.node.pos[1])})),t.length>0?t[0].node:null}var n=e.rc.vnode.dcontainer.el.nextSibling;return n?tree.root.getChild(parseInt(n.id.replace("tk_container_",""))):null},getPrevSibling:function(e){if(null===e.node.pos)return null;if(App.config.layout.rootChildrenPosition){var t=this.children.filter((function(t){return t.rc.orientation===e.rc.orientation&&t!==e&&t.node.pos[1]<e.node.pos[1]}));return t.sort((function(t,n){return e.node.pos[1]-t.node.pos[1]-(e.node.pos[1]-n.node.pos[1])})),t.length>0?t[0].node:null}var n=e.rc.vnode.dcontainer.el.previousSibling;return n?tree.root.getChild(parseInt(n.id.replace("tk_container_",""))):null},getSize:function(){return this.dcontent.size()},destroy:function(){if(this.children){for(var e=0,t=this.children.length;e<t;e++)this.children[e].rc.destroy(),this.children[e].destroy(),this.children[e]=null;this.children=null,this.dcontent.destroy(),this.dcontent=null,this.node=null,r.default.all.each((function(e){e.view.destroy()}))}},alphabetizeChildren:function(){var e=new ChangeList,t=this.children.clone();t.sort(i.default.naturalCompare);var n=App.Layouts.orientation,o=n.down,s=n.left,r=n.right;switch(App.config.layout.orientation){case o:e.changes=this.__alphabetizeChildrenOrgChart(t);break;case s:case r:e.changes=this.__alphabetizeChildrenVerticallyOrientedLayouts(t);break;default:e.changes=this.__alphabetizeChildrenNonOrientedLayouts(t)}return e},__alphabetizeChildrenOrgChart:function(e){var t=-this.getSize()[1]/2+100;return e.map((function(n,i){var o=e[i-1],s=[o?o.node.pos[0]+o.dcontainer.size()[0]+50:0,t];return n.node.reposition(s)}))},__alphabetizeChildrenVerticallyOrientedLayouts:function(e){var t=e.reduce((function(e,t){return e-t.dcontainer.size()[1]/2}),0),n=App.config.layout.orientation,i=App.Layouts.orientation,o=i.left,s=i.right,r=n===o,a=n===s,l=this.getSize()[0]/2;return r?l=-l-100:a&&(l+=100),e.map(function(n,i){var o=e[i-1],s=this.__positionOffset(o,n),a=[r?l-n.dcontent.size()[0]:l,o?o.node.pos[1]+s:t];return n.node.reposition(a)}.bind(this))},__alphabetizeChildrenNonOrientedLayouts:function(e){var t=this.getSize(),n=parseInt(e.length/2),i=0,o=0;e.each((function(e,t){t<n?o-=e.dcontainer.size()[1]/2:i-=e.dcontainer.size()[1]/2}));var s=-t[0]/2-100,r=t[0]/2+100;return e.map(function(t,a){var l=null;if(0===a)l=[r,o];else if(a===n)l=[s-t.dcontent.size()[0],i];else{var c=e[a-1],d=this.__positionOffset(c,t);l=a<n?[r,c.node.pos[1]+d]:[s-t.dcontent.size()[0],c.node.pos[1]+d]}return t.node.reposition(l)}.bind(this))},__positionOffset:function(e,t){return e&&t?e.dcontainer.size()[1]/2+t.dcontainer.size()[1]/2+50:0}});t.default=a},LGYb:function(e,t,n){var i=n("1hJj"),o=n("jbM+"),s=n("Xt/L"),r=n("xYSL"),a=n("dQpi"),l=n("rEGp"),c=200;e.exports=function(e,t,n){var d=-1,h=o,u=e.length,p=!0,f=[],m=f;if(n)p=!1,h=s;else if(u>=c){var g=t?null:a(e);if(g)return l(g);p=!1,h=r,m=new i}else m=t?[]:f;e:for(;++d<u;){var v=e[d],y=t?t(v):v;if(v=n||0!==v?v:0,p&&y===y){for(var _=m.length;_--;)if(m[_]===y)continue e;t&&m.push(y),f.push(v)}else h(m,y,n)||(m!==f&&m.push(y),f.push(v))}return f}},LOIY:function(e,t,n){"use strict";n.r(t);var i=function(e){addClassName(e,"selected"),addClassName(e,"current")},o=function(e){this.el.stopObserving("click",this.eventClickObserver),e&&(this.eventClickObserver=e,this.el.observe("click",this.eventClickObserver))};t.default={enabled:!0,state:null,_editingAction:null,eventClickObserver:null,isSelected:function(){return 2===this.state},isPartiallySelected:function(){return 5===this.state},isEditing:function(){return 3===this.state},toInactive:function(e){switch(this.state){case 1:return;case 2:case 4:case 5:break;case 3:this.leaveEditMode(e)}this.el.stopObserving("click",this.eventClickObserver);var t,n=this.el._listener;this.eventClickObserver=n.select.bindAsEventListener(n),this.enableSelecting(),this.state=1,t=this.el,removeClassName(t,"selected"),removeClassName(t,"current"),canvas.onUnselect(this.el._listener)},toPartiallySelected:function(e){switch(this.state){case 5:return;case 1:case 2:case 4:break;case 3:this.leaveEditMode(e)}var t,n=this.el._listener;o.call(this,n.select.bindAsEventListener(n)),this.state=5,t=this.el,addClassName(t,"selected"),removeClassName(t,"current")},toSelected:function(e,t,n,s){var r=!1,a=!1;if(e){if(canvas._imageResizing)return;r=MM.ua.isPlatform("Macintosh")?e.metaKey:e.ctrlKey,a=e.shiftKey}switch(this.state){case 5:if(r||a)return void this.toInactive();break;case 2:return;case 1:case 4:break;case 3:this.leaveEditMode(t)}o.call(this,this.toEditing.bindAsEventListener(this,"rename")),canvas.onSelect(this.el._listener,e,n,s),this.state=2,i(this.el)},toEditing:function(e,t){if((!e||!canvas._imageResizing&&!e.target.href)&&this.enabled){switch(this._editingAction=t,this.state){case 3:case 4:return}o.call(this),this.state=3;var n=this.el._listener;canvas.onSelect(n,e),this.enterEditMode(),i(this.el)}},toResizing:function(){switch(this.state){case 3:this.leaveEditMode(!0);break;case 1:case 2:case 5:break;case 4:return}o.call(this),this.state=4},disableSelecting:function(){this.enabled=!1,this.el.stopObserving("click",this.eventClickObserver)},enableSelecting:function(){this.enabled=!0,this.el.observe("click",this.eventClickObserver)}}},LboF:function(e,t,n){"use strict";var i,o={},s=function(){return"undefined"===typeof i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},r=function(){var e={};return function(t){if("undefined"===typeof e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(i){n=null}e[t]=n}return e[t]}}();function a(e,t){for(var n=[],i={},o=0;o<e.length;o++){var s=e[o],r=t.base?s[0]+t.base:s[0],a={css:s[1],media:s[2],sourceMap:s[3]};i[r]?i[r].parts.push(a):n.push(i[r]={id:r,parts:[a]})}return n}function l(e,t){for(var n=0;n<e.length;n++){var i=e[n],s=o[i.id],r=0;if(s){for(s.refs++;r<s.parts.length;r++)s.parts[r](i.parts[r]);for(;r<i.parts.length;r++)s.parts.push(g(i.parts[r],t))}else{for(var a=[];r<i.parts.length;r++)a.push(g(i.parts[r],t));o[i.id]={id:i.id,refs:1,parts:a}}}}function c(e){var t=document.createElement("style");if("undefined"===typeof e.attributes.nonce){var i=n.nc;i&&(e.attributes.nonce=i)}if(Object.keys(e.attributes).forEach((function(n){t.setAttribute(n,e.attributes[n])})),"function"===typeof e.insert)e.insert(t);else{var o=r(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var d,h=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function u(e,t,n,i){var o=n?"":i.css;if(e.styleSheet)e.styleSheet.cssText=h(t,o);else{var s=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(s,r[t]):e.appendChild(s)}}function p(e,t,n){var i=n.css,o=n.media,s=n.sourceMap;if(o&&e.setAttribute("media",o),s&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var f=null,m=0;function g(e,t){var n,i,o;if(t.singleton){var s=m++;n=f||(f=c(t)),i=u.bind(null,n,s,!1),o=u.bind(null,n,s,!0)}else n=c(t),i=p.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).attributes="object"===typeof t.attributes?t.attributes:{},t.singleton||"boolean"===typeof t.singleton||(t.singleton=s());var n=a(e,t);return l(n,t),function(e){for(var i=[],s=0;s<n.length;s++){var r=n[s],c=o[r.id];c&&(c.refs--,i.push(c))}e&&l(a(e,t),t);for(var d=0;d<i.length;d++){var h=i[d];if(0===h.refs){for(var u=0;u<h.parts.length;u++)h.parts[u]();delete o[h.id]}}}}},LcsW:function(e,t,n){var i=n("kekF")(Object.getPrototypeOf,Object);e.exports=i},LqpT:function(e,t,n){var i=n("1hJj"),o=n("jbM+"),s=n("Xt/L"),r=n("eUgh"),a=n("sEf8"),l=n("xYSL"),c=200;e.exports=function(e,t,n,d){var h=-1,u=o,p=!0,f=e.length,m=[],g=t.length;if(!f)return m;n&&(t=r(t,a(n))),d?(u=s,p=!1):t.length>=c&&(u=l,p=!1,t=new i(t));e:for(;++h<f;){var v=e[h],y=null==n?v:n(v);if(v=d||0!==v?v:0,p&&y===y){for(var _=g;_--;)if(t[_]===y)continue e;m.push(v)}else u(t,y,d)||m.push(v)}return m}},MrPd:function(e,t,n){var i=n("hypo"),o=n("ljhN"),s=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var r=e[t];s.call(e,t)&&o(r,n)&&(void 0!==n||t in e)||i(e,t,n)}},NykK:function(e,t,n){var i=n("nmnc"),o=n("AP2z"),s=n("KfNM"),r="[object Null]",a="[object Undefined]",l=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:r:l&&l in Object(e)?o(e):s(e)}},O0oS:function(e,t,n){var i=n("Cwc5"),o=function(){try{var e=i(Object,"defineProperty");return e({},"",{}),e}catch(t){}}();e.exports=o},O4Ny:function(e,t,n){"use strict";(function(e){var i=n("h5dI");function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==o(t)&&"function"!==typeof t?a(e):t}(this,r(n).call(this,e))).handleNodeClick=t.handleNodeClick.bind(a(t)),t}var c,d,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),c=n,(d=[{key:"handleNodeClick",value:function(e){this.props.onClick(e.props.name),this.setActiveTab(e.props.name)}},{key:"setActiveTab",value:function(e){var t=this.refs[e],n=this.state.selectedNode;n&&n.setState({selected:!1}),t.setState({selected:!0}),this.setState({selectedNode:t})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){var e=this.props.libs[0],t=this.refs[e];t.setState({selected:!0}),this.setState({selectedNode:t})}},{key:"render",value:function(){var t=this;return e.createElement("div",{className:this.props.classes},this.props.libs.map((function(n,o){var s="lib-"+n.replace(/_/g,"-");return e.createElement(i.a,{key:o,name:n,ref:n,icon:s,selected:!1,selectedColor:"blue",defaultColor:"grey500",iconSize:16,handleClick:t.handleNodeClick})})))}}])&&s(c.prototype,d),h&&s(c,h),n}(e.Component);t.a=c}).call(this,n("q1tI"))},O7RO:function(e,t,n){var i=n("CMye"),o=n("7GkX");e.exports=function(e){for(var t=o(e),n=t.length;n--;){var s=t[n],r=e[s];t[n]=[s,r,i(r)]}return t}},P0TD:function(e,t,n){"use strict";n.r(t);var i=n("RdGn"),o=Class.create({dcontainer:null,vnode:null,idea_image:null,loaded:!1,initialize:function(e,t){this.dcontainer=new i.default([t.width(),t.height()]),this.dcontainer.el._listener=e,this.vnode=e,this.dcontainer.el.id=this.vnode.dcontent.el.id+"_image",this.listener=this.onSelect.bindAsEventListener(this),this.idea_image=t,this.dcontainer.makeResizable({onResizeFinished:this.onResizeFinished.bind(this)}),this.toEditMode(),o.all.push(this)},onSelect:function(e){!e||App.config.editable&&!this.dcontainer.isSelected()||(this.showPopup(e),e.stop())},onResizeFinished:function(e,t){this.vnode.node.resizeImage(this.idea_image,e,t)},onUnselect:function(){canvas._imageResizing||this.dcontainer.toInactive()},toEditMode:function(){this.dcontainer.el.observe("click",this.listener)},toViewMode:function(){},show:function(){this.dcontainer.show(this.idea_image.url()),this.loaded=!0},showPopup:function(e){if(!(canvas._imageResizing||e&&Event.element(e)!==this.dcontainer.image)){var t=this.idea_image.url(),n=new Element("img",{id:"tinybox_image",class:"wauto",style:"max-width: 90vw; max-height: 90vh; min-width: "+this.idea_image.size[0]+"px; min-height: "+this.idea_image.size[1]+"px;"});if(this.idea_image.isLinkedMapPreview()){t=t.replace(/medium(\/\d+\/)/,"original$1").replace(/(\?size=)medium/,"$1original");var i=new Element("div",{style:"width: 50vw; height: 50vh;"}),o=MM.ui.LoadingSpinner(64);i.update(o),MM.ui.Lightbox.show(i.outerHTML,0,0,0,0)}n.onload=function(){MM.ui.Lightbox.show(n.outerHTML,0,0,0,0)},n.src=t}}});o.all=[],o.removeImage=function(e){o.all=o.all.without(e)},o.showAll=function(e){for(var t=o.all.length;t>0;){t--;var n=o.all[t];!n.loaded&&n.vnode&&n.vnode.dcontent&&(e||n.vnode.isVisible())&&n.show()}},t.default=o},P2n3:function(e,t,n){"use strict";n.r(t);var i=n("dYE5"),o=n("C9l9"),s=n("a3FK"),r=Class.create({loaded:!1,initialize:function(e){this.options=e||{}},load:function(e){MM.utils.loadScript("https://apis.google.com/js/client.js",function(){setTimeout(function(){"undefined"!==typeof gapi.client?(gapi.client.load("youtube","v3",e),this.loaded=!0):this.load(e)}.bind(this),500)}.bind(this))},query:function(e,t){this.loaded?this.doSearch(e,t):this.load(this.doSearch.bind(this,e,t))},queryVideoDetails:function(e,t){t=Object.extend({details:!0},t),this.query(e,t)},doSearch:function(e,t){if(t=Object.extend({per_page:10},t),gapi.client.setApiKey(ServerData.keys.googleOauth),t.details)var n=gapi.client.youtube.videos.list({part:"snippet",id:e,fields:"items/snippet/title"});else{this.queryText=e.toLowerCase();n=gapi.client.youtube.search.list({part:"snippet",type:"video",maxResults:t.per_page,fields:"items(id, snippet)",q:this.queryText})}n.execute((function(e){e&&e.items?t.onComplete(e.items.map((function(e){return{id:e.id?e.id.videoId:"",url:e.id?e.id.videoId:"",title:e.snippet.title}}))):t.onComplete([])}))}}),a=Class.create({api_url:"https://api.vimeo.com/videos?",api_detail_url:"https://vimeo.com/api/oembed.json?url=https://vimeo.com/",initialize:function(e){this.options=e||{}},createRequest:function(e,t,n){var i,o=new XMLHttpRequest;o.open("GET",e,!0),t&&(o.setRequestHeader("Authorization","bearer "+ServerData.keys.vimeo),o.setRequestHeader("Accept","application/vnd.vimeo.*+json;version=3.2"),o.setRequestHeader("Content-Type","application/json")),o.onreadystatechange=(i=o,function(){if(4===i.readyState&&200===i.status){var e=JSON.parse(i.responseText);e.data?n.onComplete&&n.onComplete(e.data.map((function(e){return{id:e.uri.replace("/videos/",""),url:e.uri.replace("/videos/",""),title:e.name}}))):n.onComplete([e])}}),o.send()},query:function(e,t){this.queryText=e.toLowerCase();var n=Object.toQueryString(Object.extend({query:e,page:1,per_page:10},t)),i=this.api_url+n.toLowerCase();this.createRequest(i,!0,t)},queryVideoDetails:function(e,t){this.createRequest(this.api_detail_url+e,!1,t)}}),l=Class.create({initialize:function(e){this.options=e||{}},createRequest:function(e,t){var n=mm$(e);n&&document.body.removeChild(n),n=new Element("script",{id:e,src:"https://api.dailymotion.com/"+t}),document.body.appendChild(n)},query:function(e,t){window.dailymotionCallback=this.showSearchResult.bind(this);var n={limit:t.per_page||10,personal:0,private:0,search:e},i="videos?fields=id,title&"+Object.toQueryString(n)+"&callback=dailymotionCallback";this.createRequest("dailymotion_script",i),this.queryText=e.toLowerCase(),this.callback&&this.callback==t.onComplete||(this.callback=t.onComplete)},queryVideoDetails:function(e,t){window.dailymotionCallback=this.showSearchResult.bind(this);var n="video/"+e+"?fields=";t.fields.each((function(e){n+=e+","})),this.createRequest("dailymotion_script",n+"&callback=dailymotionCallback"),this.callback&&this.callback==t.onComplete||(this.callback=t.onComplete)},showSearchResult:function(e){if(delete window.dailymotionCallback,this.callback)if(e.list){var t=e.list;this.callback(t.map((function(e){return{id:e.id,url:e.id,title:e.title}})))}else e.title?this.callback([{id:"",url:"",title:e.title}]):this.callback([])}}),c=Class.create(o.default,{initialize:function($super,e){switch($super(e),this.options=Object.extend({type:"videos"},this.options),this.options.searcher){case"youtube":this.search=new r,this.options.embedURL="//www.youtube.com/embed/";break;case"vimeo":this.search=new a,this.options.embedURL="//player.vimeo.com/video/";break;case"dailymotion":this.search=new l,this.options.embedURL="//www.dailymotion.com/embed/video/";break;case"skoletube":this.search=new s.default,this.options.embedURL="//www.skoletube.dk/e/"}},insertListElement:function(e,t){var n=mm$(this.options.searcher+"_"+this.options.type+"_container");if(n){var o=new i.default({url:this.options.embedURL+e.url,source:this.searcher,size:{width:320,height:200},title:e.title}),s=new Element("li",{className:"p5 very-rounded text-center"}),r=MM.ui.LoadingSpinner(48),a=o.getElement();addClassName(a,"mb5"),Event.observeOnce(a,"load",function(e,t,n,i){this.items[e]=t;var o=new Element("div",{class:"icon-svg video_selector","data-icon":"checkmark",title:I18n.t("js.select_video")}),s=new Element("p").update(t.title.escapeHTML());i.remove(),n.appendChild(o),n.appendChild(s),n.onclick=this.options.onItemSelect.curry(t),o.onclick=this.options.onItemSelect.curry(t)}.bind(this,t,o,s,r)),s.appendChild(a),s.appendChild(r),n.appendChild(s)}},onNoResultsFound:function(){this.ui&&mm$(this.options.searcher+"_"+this.options.type+"_container").update(I18n.t("js.no_video_was_found"))},destroy:function(){this.search.items=[],this.search.queryText=null,this.ui=!1}});t.default=c},P5KB:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return c}));var i=n("2L+8");function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==o(t)&&"function"!==typeof t?a(e):t}(this,r(n).call(this,e)))._showExtendedSidebar=t._showExtendedSidebar.bind(a(t)),t}var c,d,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),c=n,(d=[{key:"_showExtendedSidebar",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.editable&&this.props.onExpand()}},{key:"render",value:function(){var t,n,o=this.props,s=o.editable,r=o.userVote,a=o.downVotes,l=o.votes,c=o.onVote;s&&(n=e.createElement(i.a,{onClick:function(e){return c(e,IdeaVote.DOWN)},opts:{name:"like",size:16,consize:28,classes:"h-a-center",parentClasses:"vote unlike p-r"+(r<0?" active":"")}}),t=e.createElement(i.a,{onClick:function(e){return c(e,IdeaVote.UP)},opts:{name:"like",size:16,consize:28,classes:"h-a-center",parentClasses:"vote like p-r"+(r>0?" active":"")}}));var d="w-".concat(a/IdeaVote.maxVotes*100,"%"),h="w-".concat(l.length/IdeaVote.maxVotes*100,"%");return e.createElement("div",{className:"h-flex-row w-200 votes_widget"},n,e.createElement("div",{className:"h-flex-row h-flex-grow ph-5"},e.createElement("div",{className:"h-6px p-r w-100%"},e.createElement("div",{className:"vote_progress_bar grey"}),e.createElement("div",{className:"vote_progress_bar orange animated "+d}),e.createElement("div",{className:"vote_progress_bar green animated "+h}))),t,e.createElement("div",{className:"pl-5 text-center"},e.createElement("a",{id:"vote_count_preview",href:"#",className:"fs-s"+(s?"":" disabled"),onClick:this._showExtendedSidebar},l.length+" "+(1===l.length?I18n.t("js.vote"):I18n.t("js.votes")))))}}])&&s(c.prototype,d),h&&s(c,h),n}(e.Component)}).call(this,n("q1tI"))},PYYe:function(e,t,n){"use strict";e.exports=function(e){return String(e).replace(o,s).replace(i,encodeURI)};var i=/(?:[^\x21\x25\x26-\x3B\x3D\x3F-\x5B\x5D\x5F\x61-\x7A\x7E]|%(?:[^0-9A-Fa-f]|[0-9A-Fa-f][^0-9A-Fa-f]|$))+/g,o=/(^|[^\uD800-\uDBFF])[\uDC00-\uDFFF]|[\uD800-\uDBFF]([^\uDC00-\uDFFF]|$)/g,s="$1\ufffd$2"},PiLb:function(e,t,n){"use strict";var i=n("oEzx");t.a={items:[],currentlyLoading:null,add:function(e){this.items.push(e),this.load()},remove:function(e){var t=e.src;if(this.currentlyLoading&&this.currentlyLoading.image.src===t)this.imagePromise.cancel();else if(this.items.length>0){var n=this.items.findIndex((function(e){return e.image.src===t}));this.items.splice(n,1)}},load:function(){var e=this;if(!this.currentlyLoading&&0!==this.items.length){this.currentlyLoading=this.items.shift();var t,n,o,s=this.currentlyLoading.image,r=new Image;for(var a in s)r[a]=s[a];this.imagePromise=Object(i.a)(function(e){return new Promise((function(t,n){if(e.naturalWidth)t(e);else if(e.complete)n(e);else{var i=function i(){e.removeEventListener("load",i),e.removeEventListener("error",i),e.naturalWidth?t(e):n(e)};e.addEventListener("load",i),e.addEventListener("error",i)}}))}(r)),(t=this.imagePromise.promise,n=3e4,o=new Promise((function(e,t){var i=setTimeout((function(){clearTimeout(i),t("Timed out in ".concat(n,"ms"))}),n)})),Promise.race([t,o])).then((function(t){e.currentlyLoading.onLoad&&e.currentlyLoading.onLoad(t),e.handleResponse()})).catch((function(t){e.currentlyLoading.onError&&e.currentlyLoading.onError(t),e.handleResponse()}))}},handleResponse:function(){this.currentlyLoading=null,this.load()}}},PjTj:function(e,t,n){"use strict";(function(e){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(t){function a(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(t=function(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?s(e):t}(this,o(a).call(this,e))).state={value:e.defaultValue},t._focusField=t._focusField.bind(s(t)),t._handleValueChange=t._handleValueChange.bind(s(t)),t}var l,c,d;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(a,t),l=a,(c=[{key:"_focusField",value:function(){this.props.autoFocus&&this.field.focus()}},{key:"_handleValueChange",value:function(e){var t=e.target.value;this.setState({value:t}),this.props.onChange(e,t)}},{key:"componentDidMount",value:function(){this._focusField()}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.setState({value:e.value})}},{key:"componentDidUpdate",value:function(){this._focusField()}},{key:"render",value:function(){var t=this;return e.createElement("input",{ref:function(e){return t.field=e},type:this.props.type,value:this.state.value||"",className:this.props.className,placeholder:this.props.placeholder,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onChange:this._handleValueChange})}}])&&i(l.prototype,c),d&&i(l,d),a}(e.Component);a.defaultProps={type:"text",defaultValue:"",className:"",onChange:function(){}},t.a=a}).call(this,n("q1tI"))},Pqld:function(e,t,n){"use strict";(function(e){var n=function(t){var n=t.className,i=t.elementLeft,o=t.elementLeftClassName,s=t.elementRight,r=t.elementRightClassName,a=t.title,l=t.titleClassName;return e.createElement("div",{className:"h-flex-row "+n},i?e.createElement("div",{className:o},i):null,e.createElement("div",{className:l},a),s?e.createElement("div",{className:r+" ml-auto"},s):null)};n.defaultProps={title:"",className:"",elementLeftClassName:"",elementRightClassName:"",titleClassName:"title"},t.a=n}).call(this,n("q1tI"))},QIyF:function(e,t,n){var i=n("Kz5y");e.exports=function(){return i.Date.now()}},QcOe:function(e,t,n){var i=n("GoyQ"),o=n("6sVZ"),s=n("7Ix3"),r=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return s(e);var t=o(e),n=[];for(var a in e)("constructor"!=a||!t&&r.call(e,a))&&n.push(a);return n}},Qh5C:function(e,t,n){"use strict";n.r(t);var i=n("GcUR");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=Class.create(i.default,{initialize:function($super,e){$super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"images"},e))},transformResults:function(e){return e.map((function(e){return{title:e.title,description:e.description,thumbnailUrl:e.thumbnail_url,url:e.image_url}}))}});t.default=r},QjzQ:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n("ERGR"),o=n("Aw6l");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){return e&&null===e.id?e.name:""},h=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?l(e):t}(this,a(n).call(this,e)))._onFocusInput=t._onFocusInput.bind(l(t)),t._onBlurInput=t._onBlurInput.bind(l(t)),t}var h,u,p;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,t),h=n,(u=[{key:"_onFocusInput",value:function(){this.keyMap.enable()}},{key:"_onBlurInput",value:function(){this.keyMap.disable()}},{key:"_setCustomResource",value:function(e){this.props.setResource(e)}},{key:"_revertCustomResource",value:function(){this.customResource.value=d(this.props.assignee),this.customResource.blur()}},{key:"componentDidMount",value:function(){var e=this,t=MM.utils.KeyEvent;this.keyMap=new MM.utils.KeyMap(this.customResource,"custom_resource_keymap",[{key:t.ENTER,fn:function(){return e._setCustomResource(e.customResource.value)}},{key:t.ESC,fn:function(){return e._revertCustomResource()}}]),this.keyMap.disable(),this.tooltips=MM.ui.ToolTips.touchSafe({el:this.container})}},{key:"componentWillUnmount",value:function(){MM.ui.ToolTips.destroyTouchSafe(this.tooltips)}},{key:"renderCustomResource",value:function(){var t=this,n=this.props,i=n.assignee,o=n.isExternalTask,s=o?I18n.t("js.custom_assignee_not_possible_on_external_tasks"):"";return e.createElement("div",{className:"ph-10 pt-10 mt-8 bt-1 bc-grey200 tooltip",title:s},e.createElement("input",{ref:function(e){return t.customResource=e},type:"text",className:"w-100%",defaultValue:d(i),placeholder:I18n.t("js.enter_custom"),onFocus:this._onFocusInput,onBlur:this._onBlurInput,disabled:o}))}},{key:"render",value:function(){var t=this,n=this.props,s=n.users,r=n.assignee,a=s.sortBy((function(e){return e.name.split(/\s/)[1]})).map((function(n){return{icon:e.createElement(o.a,{user:n,className:"small mr-5"}),label:n.name,selected:r&&n.id===r.id,onClick:function(){return t._setCustomResource(n.id)}}}));return e.createElement("div",{ref:function(e){return t.container=e}},e.createElement(i.a,{className:"maxh-150 h-overflow-y",items:a}),this.renderCustomResource())}}])&&r(h.prototype,u),p&&r(h,p),n}(e.Component)}).call(this,n("q1tI"))},"R/W3":function(e,t,n){var i=n("KwMD"),o=n("2ajD"),s=n("CZoQ");e.exports=function(e,t,n){return t===t?s(e,t,n):i(e,o,n)}},R8jl:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("nyiR"),r=n("AGWK");function a(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(l){o=!0,s=l}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var l=Class.create(o.default,{initialize:function($super,e,t){$super("boundaries",e,t),Element.bindOnClick("btn_remove_boundary",this.setValue.bind(this)),Element.bindOnClick("btn_customize_boundary",this.showDialog.bind(this))},load:function($super){this.list=this.el.select("grid")[0],this.list.innerHTML="";for(var e=this._getBoundaryStyles(),t=0;t<e.length;t++)this.addStyle(e[t]);$super()},addStyle:function(e){var t={r1:Rectangle.fromPosSize(new Point(15,18),new Point(35,10)),r2:Rectangle.fromPosSize(new Point(35,10),new Point(22,26)),style:e},n=new Element("a",{href:"#",id:"style_boundary_"+e.id,className:"item",style:"background-color: #"+App.config.mapTheme.background.color});n.observe("click",this.setValue.bindAsEventListener(this,e)),s.Graphics.drawBoundaryPreview(n,t),this.list.insert(new Element("cell",{className:"topic-preview"}).insert(n))},setValue:function(e,t){if(Event.stop(e),t){var n=canvas.allSelected,i=n.filter((function(e){var n=e.node;return n.boundary&&n.boundary.style.equals(t)}));n.length===i.length&&(t=null)}canvas.onSetBoundary(t),this._setSelected(t)},showDialog:function(t){var o=this,s=t.target;MM.ui.disableButton(s),Dialog.multipleChoice('<div id="format_dialog"></div>',{windowParameters:{id:"formatboundary",width:630,onBeforeShow:function(){$("formatboundary_content").select(".dialog_buttons")[0].style.visibility="hidden"},onShow:function(){MM.status.helpTopic="218435697-Customize",e.render(i.createElement(r.a,{size:64,opts:{className:"h-h-center"}}),mm$("format_dialog")),Promise.all([n.e(23).then(n.bind(null,"Wsn6")),n.e(22).then(n.bind(null,"4zSx"))]).then((function(e){var t=a(e,1)[0];$("formatboundary_content").select(".dialog_buttons")[0].style.visibility="visible",o.customizeBoundary=t.default,o.customizeBoundary.init()}))},onClose:function(){return MM.ui.enableButton(s)}},choices:[{label:I18n.t("js.cancel"),callback:function(){return MM.ui.dialogs.close("formatboundary")},classes:"button"},{label:"".concat(I18n.t("js.save"),"..."),callback:function(){App.hasFeature("custom_styles")?o.customizeBoundary.save():MM.ui.dialogs.dialogUpgrade({feature:"map_custom_styles",s:"map_".concat(App.config.map_id)})},classes:"button"},{label:I18n.t("js.ok"),callback:function(){o.customizeBoundary.setStyle(App.config.mapTheme.id),MM.ui.dialogs.close("formatboundary")},classes:"button default"}]})},onSelectNode:function(){if(canvas.selected.node){var e=this._getStyleByBoundary(canvas.selected.node.boundary);this._setSelected(e)}},_setSelected:function(e){if(this.list.select(".selected").invoke("removeClassName","selected"),e){var t=mm$("style_boundary_"+e.id);t&&addClassName(t,"selected")}},_getStyleByBoundary:function(e){if(e)return this._getBoundaryStyles().find((function(t){return e.style.equals(t)}))},_getBoundaryStyles:function(){var e=App.config.mapTheme.boundary_styles;return 0===e.length&&MapTheme.getDefault()&&(e=MapTheme.getDefault().boundary_styles),e.concat(Style.userBoundaryStyles)}});t.default=l}.call(this,n("i8i4"),n("q1tI"))},RdGn:function(e,t,n){"use strict";n.r(t);var i=n("TxdS");function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(l){o=!0,s=l}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var s=Class.create({el:null,image:null,initialize:function(e){this.el=new Element("div",{className:"tk_image_container"}),this.imageWrapper=new Element("div",{className:"h-iblock p-r"}),this.image=new Element("img",{className:"tk_image",alt:I18n.t("js.image_not_available"),style:"visibility: hidden;"}),e&&this.setSize(e),this.el.insert(this.imageWrapper.insert(this.image)),this.image.draggable=!1,this.image.onmousedown=function(e){return e.preventDefault(),!1}},show:function(e){this.loadingImage=MM.ui.LoadingSpinner(24),this.loadingImage.title=I18n.t("js.loading_image"),this.el.appendChild(this.loadingImage),Event.observeOnce(this.image,"load",this.onImageLoaded.bind(this)),this.image.src=e},appendActionBtn:function(){if("phantomjs"!==App.config.environment){var e=MM.ui.icon({name:"triangle",size:10,consize:18,color:"grey500",parentClasses:"js-btn-image-action p-a at-5 ar-5 bg-white rad-100% b-1 bc-grey300"});this.imageWrapper.insert(e),this.actionButton=this.imageWrapper.select(".js-btn-image-action")[0],this.actionButton.onclick=this.showContextMenu.bind(this),this.actionButton.oncontextmenu=this.showContextMenu.bind(this)}},showContextMenu:function(e){e.preventDefault(),e.stopPropagation(),i.default&&i.default.show(e)},onImageLoaded:function(){this.loadingImage.remove(),this.image.style.visibility="",show(this.resizeHandle),this.appendActionBtn(),IdeaImage.mapLoadedImages++},makeResizable:function(e){this.resizeHandle=this.imageWrapper.appendChild(new Element("span",{className:"imrhandle"})),hide(this.resizeHandle),this.onMouseDown=this.onResizeStart.bindAsEventListener(this),this.onMouseMove=this.onResize.bindAsEventListener(this),this.onMouseUp=this.onResizeEnd.bindAsEventListener(this),e&&e.onResizeFinished&&(this._onResizeFinished=e.onResizeFinished),Event.observe(this.resizeHandle,"mousedown",this.onMouseDown)},toSelected:function(){addClassName(this.el,"selected")},toInactive:function(){removeClassName(this.el,"selected")},isSelected:function(){return hasClassName(this.el,"selected")},onShiftPressed:function(){var e=o(this.baseSize,2),t=e[0],n=e[1];this.aspectRatio=t/n},onShiftReleased:function(){this.aspectRatio=null},onResizeStart:function(e){this.mouseCoords=[Event.pointerX(e),Event.pointerY(e)],Event.stop(e),addClassName(this.el,"resizing"),Draggables.deactivate(),Event.observe(document,"mousemove",this.onMouseMove),Event.observe(document,"mouseup",this.onMouseUp)},onResize:function(e){canvas._imageResizing=!0,Draggables.deactivate();var t,n,i=Event.pointerX(e)-this.mouseCoords[0],o=Event.pointerY(e)-this.mouseCoords[1];if(canvas.shiftPressed){var s=this.baseSize[0]+i,r=((s/this.aspectRatio+o)*this.aspectRatio+s)/2;t=r.toFixed(0),n=(r/this.aspectRatio).toFixed(0)}else t=this.baseSize[0]+i,n=this.baseSize[1]+o;this.image.style.width="".concat(t>=20?t:20,"px"),this.image.style.height="".concat(n>=20?n:20,"px")},onResizeEnd:function(){setTimeout((function(){canvas._imageResizing=!1}),10),this._onResizeFinished&&(this.baseSize=[this.image.clientWidth,this.image.clientHeight],this._onResizeFinished(this.baseSize[0],this.baseSize[1])),Event.stopObserving(document,"mouseup",this.onMouseUp),Event.stopObserving(document,"mousemove",this.onMouseMove),removeClassName(this.el,"resizing")},setSize:function(e){this.baseSize=e,this.image.style.width=this.baseSize[0]+"px",this.image.style.height=this.baseSize[1]+"px"}});t.default=s},"S/+i":function(e,t,n){"use strict";n.r(t),function(e){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t){return!t||"object"!==n(t)&&"function"!==typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function r(e,t){return(r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var a=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=o(this,s(n).call(this,e))).state={selected:!1},t}var a,l,c;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}(n,t),a=n,(l=[{key:"selectNode",value:function(e,t){t.preventDefault(),t.stopPropagation(),this.props.onSelectIcon(e)}},{key:"render",value:function(){var t=this.props.icon,n="0 "+24*-this.props.index+"px",i=this.props.className+" item tooltip"+(this.state.selected?" selected":"");return e.createElement("div",null,e.createElement("a",{href:"#",className:i,title:t.getTitle(),onClick:this.selectNode.bind(this,t)},e.createElement("span",{ref:t.fullName(),style:{backgroundPosition:n}})))}}])&&i(a.prototype,l),c&&i(a,c),n}(e.Component);a.defaultProps={className:""},t.default=a}.call(this,n("q1tI"))},SKAX:function(e,t,n){var i=n("JC6p"),o=n("lQqw")(i);e.exports=o},Sxd8:function(e,t,n){var i=n("ZCgT");e.exports=function(e){var t=i(e),n=t%1;return t===t?n?t-n:t:0}},TFUZ:function(e,t,n){"use strict";n.r(t);var i=function(e,t,n){if(t){t.end=Object.extend(Object.clone(t.start),t.end);var i=t.start[1]>t.end[1]?t.start[1]:t.end[1],o=n&&n.reverse?t.end:t.start,s=n&&n.reverse?t.start:t.end;(e=$(e)).setStyle(o[0]),setTimeout((function(){var t=Object.extend(s[0],{transitionDuration:o[1]+"ms",transitionTimingFunction:o[2]});CSS.set(e,t)}),0),n&&n.done&&setTimeout(n.done,i)}},o=n("mNz5"),s=n.n(o),r=Class.create({initialize:function(e){this.opts=Object.extend(this.opts,e),this.uniqueId=s()("simple-view-"),this._eventList=[],this._hotkeyList=[],this.$el=new Element("div",{class:(this.className||"")+" "+this.uniqueId}),this._bindEvents(),this._bindHotkeys()},destroy:function(e){this._unbindEvents(),this._unbindHotkeys(),!1!==e.destroyElement&&this.$el.remove(),this.$el=null,this.el=null,this.els=null,this.destroyed=!0},_bindEvents:function(){this.events&&Object.keys(this.events).forEach(function(e){var t=this.events[e];if(!this[t])return alert("Events - could not find callback "+t);var n=e.split(" "),i=n[0],o=n[1];this._eventList.push(Event.on(document,i,"."+this.uniqueId+" "+o,this[t].bind(this)))}.bind(this))},_unbindEvents:function(){this._eventList.invoke("stop")},_bindHotkeys:function(){this.hotkeys&&(this.keymap&&this.keymap.disable(),Object.keys(this.hotkeys).forEach(function(e){var t=this.hotkeys[e].split(" "),n=(t[0],t[1]),i=MM.utils.KeyEvent;this._hotkeyList.push({key:i[e.toUpperCase()],stopEvent:!1,fn:this[n].bind(this)})}.bind(this)),this.keymap=new MM.utils.KeyMap(document,this.uniqueId+"-keymap",this._hotkeyList))},_unbindHotkeys:function(){this.keymap.disable()}}),a=(n("hYyt"),Class.create(r,{className:"p-a-full v-attachment-viewer",events:{"click .js-previous":"navigateLeft","click .js-next":"navigateRight","click .js-download":"downloadAttachment","click .js-open":"openAttachment","click .js-close":"close","click .js-image":"close"},hotkeys:{left:"this navigateLeft",right:"this navigateRight",esc:"this close"},animations:{overlay:{start:[{opacity:0},300,"in-out"],end:[{opacity:.9}]},content:{start:[{opacity:0},300,"easeOutExpo"],end:[{opacity:1},100]}},opts:{attachmentId:null,node:null,currentIndex:null,currentAttachment:null},els:{$content:null,$overlay:null},initialize:function($super,e){$super(e),this.opts.node=tree.root.getChild(this.opts.nodeId),this.getIndexAndAttachment()},getIndexAndAttachment:function(){this.opts.node.attachments.forEach(function(e,t){if(e.id===this.opts.attachmentId)return this.opts.currentIndex=t,this.opts.currentAttachment=e,!1}.bind(this))},render:function(){return this.renderOverlay(),this.renderContent(),this.hideSpinnerWhenLoaded(),this},renderOverlay:function(){this.els.$overlay=new Element("div",{class:"p-a-full bg-black js-close o-90"}),this.$el.update(this.els.$overlay)},renderContent:function(){var e=this.opts.currentAttachment,t=e.isGoogleViewerSupported(),n=e.isBoxViewerSupported(),i=e.isEvernote(),o=e.isImage()&&!e.isSvg(),s=new Element("div",{class:"us-none"});if(s.update(JST["app/ui/attachment_viewer/template"]({count:this.opts.node.attachments.length,index:this.opts.currentIndex,name:e.filename,url:e.downloadLink(),type:e.getFileType(),sizeReadable:e.size.toHumanSize(1),isImage:o,hasGoogleViewer:t,hasBoxViewer:n,isEvernote:i,show_navigation:!0})),this.els.$content=s,this.$el.insert(this.els.$content),clearTimeout(this.checkLoadedTimeout),!o&&t)new Ajax.Request("/generic_files/get_file_token/"+e.id,{onSuccess:this.renderGoogleViewer.bind(this)});else if(!o&&n)new Ajax.Request("/generic_files/get_box_preview/"+e.id,{onSuccess:this.renderBoxViewer.bind(this)});else if(i){$(this.els.$content).select(".evernote-content")[0].src="".concat(e.downloadLink(),"&disposition=inline")}},renderGoogleViewer:function(e){var t=this,n=e.responseText.evalJSON();if(n.timestamp&&n.token){var i=this.opts.currentAttachment,o=encodeURIComponent(document.location.protocol+"//"+document.location.host+i.downloadLink()+"&key="+n.token+"&timestamp="+n.timestamp+"&filename="+i.filename);this.hideViewerFrame("box"),this.showViewerFrame("google");var s=$(this.els.$content).select(".google-preview-container")[0];s.src="//docs.google.com/viewer?embedded=true&url="+o,this.checkLoadedTimeout=setTimeout(function(e){e===this.opts.currentAttachment.id&&this.opts.currentAttachment.isBoxViewerSupported()&&new Ajax.Request("/generic_files/get_box_preview/"+this.opts.currentAttachment.id,{onSuccess:this.renderBoxViewer.bind(this)})}.bind(this,i.id),1e4),s.onload=function(){return clearTimeout(t.checkLoadedTimeout)}}},renderBoxViewer:function(e){var t=e.responseJSON;if(t.fileId){if(this.hideViewerFrame("google"),this.showViewerFrame("box"),"undefined"===typeof Box)return Message.show(I18n.t("js.preview_loading_error"),Message.ERROR),void this.close();(new Box.Preview).show(t.fileId,ServerData.keys.box,{container:".box-preview-container",showDownload:!1,logoUrl:"https://www.meisterlabs.com/wp-content/themes/meisterlabs/images/logo-mindmeister.svg"})}},open:function(){canvas.removeFocus(),this.render(),document.body.insert(this.$el),i(this.els.$overlay,this.animations.overlay),i(this.els.$content,this.animations.content)},close:function(){canvas.addFocus(),i(this.els.$overlay,this.animations.overlay,{reverse:!0}),i(this.els.$content,this.animations.content,{reverse:!0,done:function(){this.destroy({destroyElement:!0})}.bind(this)})},hideSpinnerWhenLoaded:function(){var e=this.$el.select("img")[0];if(e){var t=this.$el.select(".loading-spinner-48")[0];Event.observeOnce(e,"load",(function(){t.remove()})),Event.observeOnce(e,"error",(function(){t.remove(),e.addClassName("h-hidden")}))}},downloadAttachment:function(){this.opts.currentAttachment.openAsDownload()},openAttachment:function(){window.open(this.opts.currentAttachment.get("url"))},navigate:function(e){var t=this.opts.currentIndex+e,n=this.opts.node.attachments[t];n&&(this.opts.currentIndex=t,this.opts.currentAttachment=n,this.render())},navigateLeft:function(e){e&&e.preventDefault(),this.navigate(-1)},navigateRight:function(e){e&&e.preventDefault(),this.navigate(1)},hideViewerFrame:function(e){hide($(this.els.$content).select(".".concat(e,"-preview-container"))[0])},showViewerFrame:function(e){show($(this.els.$content).select(".".concat(e,"-preview-container"))[0])}}));t.default=a},TYy9:function(e,t,n){var i=n("XGnz");e.exports=function(e){return(null==e?0:e.length)?i(e,1):[]}},Te9D:function(e,t,n){var i=n("/kAC"),o=n("dt0z"),s=/[&<>"']/g,r=RegExp(s.source);e.exports=function(e){return(e=o(e))&&r.test(e)?e.replace(s,i):e}},TiCD:function(e,t,n){var i=n("b+/x"),o=n("jFDo");e.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!i.string(t))throw new TypeError("Second argument must be a String");if(!i.fn(n))throw new TypeError("Third argument must be a Function");if(i.node(e))return function(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}(e,t,n);if(i.nodeList(e))return function(e,t,n){return Array.prototype.forEach.call(e,(function(e){e.addEventListener(t,n)})),{destroy:function(){Array.prototype.forEach.call(e,(function(e){e.removeEventListener(t,n)}))}}}(e,t,n);if(i.string(e))return function(e,t,n){return o(document.body,e,t,n)}(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},Tqv9:function(e,t,n){"use strict";n.r(t);var i=Class.create({vnode:null,idea_video:null,initialize:function(e,t){this.vnode=e,this.idea_video=t,this.idea_video&&(this.el=new Element("div",{className:"tk_video_container"}),this.el.appendChild(this.idea_video.getElement()))},updateVideo:function(e){this.idea_video=e,this.idea_video.el=null,this.el.update(this.idea_video.getElement())},remove:function(){this.vnode.dcontent.removeChild(this.dcontainer)},showPlaceholder:function(){if(mm$("video_placeholder"+this.vnode.node.id))this.placeholder=mm$("video_placeholder_"+this.vnode.node.id);else{this.el.setStyle({opacity:0,visibility:"hidden"});var e=MM.ui.icon({name:"play",size:16,color:"grey500",clickable:!1,parentClasses:"h-a-center"});this.placeholder=new Element("div",{id:"video_placeholder_"+this.vnode.node.id,className:"tk_video_placeholder video_border h-a-center"}).insert(e),this.el.parentNode.appendChild(this.placeholder)}},removePlaceholder:function(){this.el.setStyle({opacity:1,visibility:""}),this.placeholder&&this.el.parentNode.removeChild(this.placeholder)}});t.default=i},TxdS:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("6acW"),s=n.n(o),r=n("4AML"),a=n("2Dbh"),l=n("39z+"),c=n("HKtW"),d=n("2L+8"),h={init:function(){document.observe("contextmenu",this.show.bindAsEventListener(this)),this.popover=new Popover("nodemenu",this.doActions.bind(this),{observeEvent:"none",offset:[0,0]}),this.iconsPopover=new l.c("iconmenu"),this.initialized=!0},show:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((!canvas.selected||!canvas.selected.dcontent.isEditing())&&(this._resetPopover(),this.vnode=this.findAffected(t,n),this.vnode||this.type)){App.config.currentlyEditable&&this.vnode&&!this.vnode.isPartiallySelected()&&this.vnode.select();var o=this.getElements();if(0!==o.length){if("icon"===this.type)e.unmountComponentAtNode(this.iconsPopover.widgetContainer),e.render(i.createElement(c.a,{className:"icon-grid ph-10",emojis:o,elementsInRow:Math.min(8,o.length),onSelect:this.doIconActions.bind(this)}),this.iconsPopover.widgetContainer),this.iconsPopover.show();else{switch(this.popover.addElements(o),this.type){case"node":case"root":this._initClipboardButton()}this.popover.options=Object.extend(this.popover.options,{noKeymap:!1}),this.popover.show()}return this.vnode&&canvas.scrollToElement(this.vnode.dcontent.el),!1}}},_initClipboardButton:function(){var e=this;mm$("btn_menu_link_to_topic")&&(this._destroyClipboardButton(),this.clipboardButton=Object(a.a)("#btn_menu_link_to_topic",{text:function(){var t=document.location,n=t.protocol,i=t.host,o=t.search;return"".concat(n,"//").concat(i,"/").concat(e.vnode.node.id).concat(o)},onSuccess:function(){return new MM.ui.Activity(I18n.t("js.link_copied_to_clipboard"),{type:"feedback",icon:{name:"widget-link",color:"grey300"}})}}))},_destroyClipboardButton:function(){this.clipboardButton&&(this.clipboardButton.destroy(),this.clipboardButton=null)},showCustom:function(e,t){this._resetPopover(),this.popover.addElements(e),this.popover.opener=t.opener,this.popover.options=Object.extend(this.popover.options,t),this.popover.show()},findAffected:function(e,t){var n=t.opener||Event.element(e);if(this.type=null,n.hasClassName){if(n.hasClassName("editor")||n.hasClassName("link_preview"))return null;if(n.hasClassName("tk_icon")){this.type="icon";var i=n.parentNode,o=i.parentNode;this.iconsPopover.opener=i;var s=o.select(".tk_icon_container");return this.iconIndex=s.indexOf(i),e.stop&&e.stop(),o._listener}if(Event.findElement(e,".tk_image_container"))return n=Event.findElement(e,".tk_image_container"),this.type="image",this.popover.opener=n,e.stop&&e.stop(),n._listener;if(n.hasClassName("root")||n.up(".root")){this.type="root";var r=canvas.root;this.popover.opener=r.dcontent.el}if(n.className.match(/root_child|node/g)||n.up(".root_child, .node")){this.type="node";r=(n.up(".tk_label")||n)._listener;this.popover.opener=r.dcontent.el}if(r)return e.stop&&e.stop(),r}if(hasAncestor(n,canvas.el)){this.type="canvas",mm$("tk_openerghost")||canvas.el.appendChild(new Element("div",{id:"tk_openerghost"}));var a=e.offsetX||e.layerX,l=e.offsetY||e.layerY;if(n.cumulativeOffset){var c=n.cumulativeOffset();a+=c.left,l+=c.top}this.popover.opener=mm$("tk_openerghost"),this.popover.opener.setStyle({left:a-1+"px",top:l-1+"px"}),e.stop&&e.stop()}return null},getElements:function(){var e=[];if(this.vnode)var t=this.vnode.node;if(!App.config.currentlyEditable)return App.config.showRevisions&&e.push(new Element("a",{href:"#",id:"btn_menu_view_changes"}).update(I18n.t("js.view_changes_on_this_idea"))),e;switch(this.type){case"icon":e.push({name:"remove-icon",title:I18n.t("js.remove_icon"),className:"",element:i.createElement(d.a,{opts:{name:"remove",color:"blue",size:20,parentClasses:"h-iblock va-middle"}})});var n=t.icons[this.iconIndex],o=n.group();if(o)Icon.allInGroup(n.library,o).each((function(n){e.push({name:n.fullName(),className:"lib_".concat(Icon.sectionToString(n.library,n.section)).concat(t.icons.include(n)?" selected":""),element:i.createElement("span",{style:{backgroundPosition:"0 ".concat(24*-n.getSpritePosition(),"px")}})})}));break;case"image":e.push(new Element("a",{href:t.idea_image.download_link,download:"",target:"_blank",id:"btn_menu_save_image","data-handler":"false"}).update(I18n.t("js.save_image"))),e.push(new Element("a",{href:"#",id:"btn_menu_edit_image"}).update(I18n.t("js.editing_image"))),e.push(new Element("a",{href:"#",id:"btn_menu_remove_image"}).update(I18n.t("js.remove_image")));break;case"canvas":e.push(new Element("a",{href:"#",id:"btn_menu_add_topic"}).update(s()(I18n.t("js.add_s",{v0:I18n.t("js.topic").toLowerCase()})))),e.push(new Element("a",{href:"#",id:"btn_menu_add_floating_topic"}).update(I18n.t("js.add_floating_topic"))),e.push(new Element("a",{href:"#",id:"btn_menu_customize_theme"}).update(I18n.t("js.edit_map_theme")));break;default:var a=canvas.allSelected.length>1;if(e.push(new Element("a",{href:"#",id:"btn_menu_cut"}).update(I18n.t("js.cut"))),e.push(new Element("a",{href:"#",id:"btn_menu_copy"}).update(I18n.t("js.copy"))),a||e.push(new Element("a",{href:"#",class:r.default._copied||!t.isRoot()?"":"separator",id:"btn_menu_paste"}).update(I18n.t("js.paste"))),r.default._copied&&e.push(new Element("a",{href:"#",class:"separator",id:"btn_menu_paste_style"}).update(I18n.t("js.paste_style"))),t.isRoot()||e.push(new Element("a",{href:"#",class:"separator",id:"btn_menu_delete"}).update(I18n.t("js.delete"))),a||e.push(new Element("a",{href:"#",id:"btn_menu_edit"}).update(I18n.t("js.edit_caption"))),!t.isRoot()){var l=t.isFloating()?"connect":"disconnect";e.push(new Element("a",{id:"btn_menu_"+l,href:"#",class:a?"":"separator"}).update(I18n.t("js."+l)))}if(!a){var c=new Element("a",{href:"#",class:"subitem separator"}).update(I18n.t("js.show_detail")),h=new Element("ul",{class:"popover submenu menu",style:"display: none"});h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_show_detail_1"}).update(I18n.t("js.one_level")))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_show_detail_2"}).update(I18n.t("js.two_levels")))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_show_detail_99"}).update(I18n.t("js.all")))),c.insert(h),e.push(c),c=new Element("a",{href:"#",class:"subitem separator"}).update(I18n.t("js.tools")),(h=new Element("ul",{class:"popover submenu menu",style:"display: none"})).insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_view_changes"}).update(I18n.t("js.view_changes_on_this_idea")))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_copy_as_text"}).update(I18n.t("js.copy_as_text")+"..."))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_alphabetize"}).update(I18n.t("js.alphabetize")))),t.isRoot()||("external"!=App.config.viewMode&&(h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_create_as_map"}).update(I18n.t("js.create_as_map")+"..."))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_link_to_map"}).update(I18n.t("js.link_to_map")+"...")))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_split"}).update(I18n.t("js.split")))),h.insert(new Element("li").insert(new Element("a",{href:"#",id:"btn_menu_numbering"}).update(I18n.t("js.numbering"))))),c.insert(h),e.push(c),e.push(new Element("a",{href:"#",id:"btn_menu_link_to_topic"}).update(I18n.t("js.copy_link")))}}return e},doIconActions:function(e){if("remove-icon"===e){var t=this.vnode.node.icons[this.iconIndex];t&&sideBar.icons.removeIcon(t.fullName())}else sideBar.icons.toggleIcon(Icon.get(e))},doActions:function(e){if(0==(e=e.replace("btn_menu_","")).indexOf("show_detail"))e=e.replace("show_detail_",""),canvas.onShowDetail(parseInt(e),!0);else switch(e){case"add_topic":canvas.onAdd(canvas.root);break;case"add_floating_topic":canvas.onAddFloating();break;case"copy_image":case"save_image":break;case"edit_image":sideBar.images.editImage();break;case"remove_image":sideBar.images.removeImage(null,this.vnode.node);break;case"cut":case"copy":r.default.execCommand(e,{onError:MM.ui.dialogs.dialogCopyPasteInfo});break;case"paste":MM.ui.dialogs.dialogCopyPasteInfo();break;case"copy_as_image":case"copy_as_attachment":r.default.onPasteImage(e.replace("copy_as_",""));break;case"paste_style":r.default.onPasteStyle();break;case"delete":canvas.onRemove();break;case"edit":canvas.selected.dcontent.toEditing();break;case"view_changes":MM.ui.dialogs.historyDialog(this.vnode?this.vnode.node.getSingleLineTitle():"");break;case"customize_theme":MM.ui.dialogs.dialogCustomizeTheme({themeId:App.config.mapTheme.id});break;case"copy_as_text":MM.ui.dialogs.dialogTextOutline(canvas.selected.node);break;case"create_as_map":MM.ui.dialogs.dialogPasteAsMap();break;case"link_to_map":MM.ui.dialogs.show("link_topic",{map_id:canvas.selected.node.id,autoSize:!0,onComplete:function(){MM.status.helpTopic="218027868-Add-Links-to-Topics"}});break;case"alphabetize":canvas.onAlphabetize();break;case"numbering":canvas.onNumbering();break;case"split":canvas.onSplitLines();break;case"split_tree":canvas.onSplitTree();break;case"connect":canvas.onConnect();break;case"disconnect":canvas.onDisconnect()}},_resetPopover:function(){this.popover.parent.className="popover submenus menu",this.popover.removeElements()}};t.default=h}.call(this,n("i8i4"),n("q1tI"))},UfWW:function(e,t,n){var i=n("KwMD"),o=n("ut/Y"),s=n("Sxd8"),r=Math.max;e.exports=function(e,t,n){var a=null==e?0:e.length;if(!a)return-1;var l=null==n?0:s(n);return l<0&&(l=r(a+l,0)),i(e,o(t,3),l)}},V0xI:function(e,t,n){"use strict";var i={init:function(e){this.loaded||(MM.utils.loadScript("https://www.dropbox.com/static/api/2/dropins.js",null,null,{id:"dropboxjs","data-app-key":ServerData.keys.dropbox}),this.loaded=!0,this.options={linkType:"direct",success:function(t){var n=t[0];n.bytes>262144e3?Message.show(I18n.t("js.attachment_size_exceeded",{v0:n.name}),Message.NOTICE):e.onPick&&e.onPick({link:n.link,name:n.name,size:n.bytes})}})},create:function(){return Dropbox.choose(this.options),!1}};t.a=i},VQOc:function(e,t,n){"use strict";n.r(t);var i=n("WXko"),o=n("PiLb");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var r=110,a=74;App.ui.Slide=Class.create({initialize:function(e){this.id=e.id,this.nodes=e.nodes||[],this.padding=e.padding||{top:0,right:0,bottom:0,left:0},this.next_slide_id=e.next_slide_id,this.transition="undefined"!==typeof e.transition?e.transition:"undefined"!==typeof App.ui.SlideShow?App.ui.SlideShow.defaultTransition:App.ui.Slide.Transition.fast_zoom_pan,this.setRectangle()},setRectangle:function(){this.rectangle=null;var e=this.nodes.findAll((function(e){return e.isVisible()}));0!==e.length&&(this.rectangle=canvas.getRectangleFromNodes(e),this.rectangle&&this.rectangle.addPadding(this.padding))},save:function(e){if(0!==this.nodes.length){e=Object.extend({},e);var t=[];this.nodes.each(function(e){for(var n=e.children.length>0,i=0;i<e.children.length&&n;){var o=e.children[i];this.nodes.include(o)||(n=!1),i++}t.push({id:e.id,with_children:n})}.bind(this));var n={map_id:App.config.map_id,nodes:Object.toJSON(t),padding:Object.toJSON(this.padding),transition:this.transition};this.id&&Object.extend(n,{id:this.id}),this.next&&Object.extend(n,{next_slide:this.next.id}),new Ajax.Request("/presentation/slide",{parameters:n,onSuccess:function(t){var n=t.responseText.evalJSON();n.error?(Message.show("The slide could not be saved.",Message.ERROR),e.onFailure&&e.onFailure()):this.id=n.slide.id}.bind(this)})}},buildUI:function(e){if(this.setRectangle(),this.rectangle){var t={x1:this.rectangle.p1.x,y1:this.rectangle.p1.y,x2:this.rectangle.p2.x,y2:this.rectangle.p2.y};if(!this.selection||this.selection.areaCoords.x1!==t.x1||this.selection.areaCoords.x2!==t.x2||this.selection.areaCoords.y1!==t.y1||this.selection.areaCoords.y2!==t.y2){var n=Object.extend(this.defaultSelectionOptions(),{displayOnInit:!0,useEffect:e,onloadCoords:{x1:this.rectangle.p1.x,y1:this.rectangle.p1.y,x2:this.rectangle.p2.x,y2:this.rectangle.p2.y}});this.selection&&Selections.all.indexOf(this.selection)>-1?(this.selection.areaCoords=t,this.selection.drawArea()):"undefined"!==typeof Selection&&"undefined"!==typeof Selection.Base&&App.config.editable&&(this.selection=new Selection.Base("canvas",n),this.selection.deselect(),"undefined"===typeof App.ui.SlideShow||App.ui.SlideShow.selectionsVisible||this.selection.hide())}}else this.selection&&(this.selection.remove(),this.selection=null)},getSize:function(){return this.rectangle?this.rectangle.dimensions():{width:0,height:0}},getCoords:function(){return this.rectangle||this.setRectangle(),this.rectangle?{x1:this.rectangle.p1.x,y1:this.rectangle.p1.y,x2:this.rectangle.p2.x,y2:this.rectangle.p2.y}:{x1:0,y1:0,x2:0,y2:0}},transformCoordsForPreview:function(e){var t=this.getCoords(),n=Math.min(t.x1,t.x2)-e.left,i=Math.min(t.y1,t.y2)-e.top,o=Math.abs(t.x2-t.x1),s=Math.abs(t.y2-t.y1);if(o<r&&s<a)return n-=(r-o)/2,i-=(a-s)/2,{x:parseInt(n),y:parseInt(i),width:r,height:a};var l=o/r,c=s/a,d=Math.max(l,c);return l>c?i-=(a*d-s)/2:n-=(r*d-o)/2,{x:parseInt(n),y:parseInt(i),width:parseInt(r*d),height:parseInt(a*d)}},getPreviewImageSrc:function(e){var t=this.transformCoordsForPreview(e);return"/export/image_section/"+App.config.map_id+"?x="+t.x+"&y="+t.y+"&w="+t.width+"&h="+t.height},onExitPlay:function(){this.nodes.each((function(e){removeClassName(e._listener.dcontent.el,"slideshow_current")})),this.nodes.detect((function(e){return!e.isVisible()}))&&this.selection&&(this.selection.remove(),this.selection=null),canvas.closeTemporarilyOpen()},onPlay:function(){var e=!1;if(this.nodes.detect((function(e){return!e.isVisible()}))&&(this.nodes.each((function(e){e._listener.makeVisible()})),this.buildUI(),e=!0),this.nodes.each((function(e){addClassName(e._listener.dcontent.el,"slideshow_current")})),this.prev?MM.ui.enableButton("slideshow-prev"):MM.ui.disableButton("slideshow-prev"),this.next?MM.ui.enableButton("slideshow-next"):MM.ui.disableButton("slideshow-next"),mm$("slideshow_steps")){mm$("slideshow_step"+this.id).className="selected";for(var t=this.prev;t;)mm$("slideshow_step"+t.id).className="seen",t=t.prev;for(t=this.next;t;)mm$("slideshow_step"+t.id).className="unseen",t=t.next}return e},onEnter:function(){},defaultSelectionOptions:function(){return{}}}),App.ui.VSlide=Class.create(App.ui.Slide,{initialize:function($super,e){$super(e),this.registerObservers(),App.trigger(CustomEvents.SLIDE_CREATED)},registerObservers:function(){this.content=new Element("a"),this.label=new Element("span"),this.opener=new Element("div",{className:"p-a at-5 ar-5 z-10"}).update(MM.ui.icon({name:"opener",size:12})),this.imagePreview=new Element("img",{className:"h-hidden"}),this.content.insert(this.opener).insert(this.label),this.content.insert(this.imagePreview),this.element=new Element("div",{class:"slide h-cp"}).insert(this.content),this.element.setStyle({backgroundColor:"#"+App.config.mapTheme.background.color}),this.element.listener=this,App.config.editable&&(Event.observe(this.element,"click",this.select.bindAsEventListener(this,!0)),Event.observe(this.element,"contextmenu",this.showMenu.bindAsEventListener(this)),Event.observe(this.opener,"click",this.showMenu.bindAsEventListener(this)))},save:function($super){this.rectangle&&this.updatePreview(),$super({onFailure:this.remove.bind(this)})},buildUI:function($super,e){$super(e),this.show()},copy:function(){var e=new App.ui.VSlide({transition:this.transition,padding:this.padding,nodes:this.nodes});return e.selection=this.selection,e},select:function(e,t){if(e&&e.shiftKey){var n=App.ui.SlideShow.selectedSlide;if(parseInt(n.element.id.replace("mmslide_",""))<this.element.id.replace("mmslide_",""))for(;n&&n.next&&n.next!=this;)(n=n.next).onSelect();else for(;n&&n.prev&&n.prev!=this;)(n=n.prev).onSelect()}else if(e&&(e.metaKey||e.ctrlKey)){if(this.isSelected()&&App.ui.SlideShow.selected.length>1)return void this.deselect(e)}else App.ui.SlideShow.selected.each((function(e){e.deselect()})),App.ui.SlideShow.selected=[];this.onSelect(),App.ui.SlideShow.selectedSlide=this,this.selection&&App.ui.SlideShow.selectionsVisible&&t&&canvas.centerOnElement(this.selection.selArea),e&&e.preventDefault()},onSelect:function(){if(!this.isSelected()){App.ui.SlideShow.selectionsVisible&&this.nodes.detect((function(e){return!e.isVisible()}))&&(this.nodes.each((function(e){e._listener.makeVisible()})),this.buildUI(),App.ui.SlideShow.updateLabels()),App.ui.SlideShow.selected.push(this),App.trigger(CustomEvents.SELECTED_SLIDE,{slide:this}),this.element.addClassName("selected"),this.selection&&this.selection.select();var e=App.ui.SlideShow.element.parentNode,t=App.ui.SlideShow.element.clientWidth/App.ui.SlideShow.list.length,n=Math.round(t*App.ui.SlideShow.list.indexOf(this))+20;e.scrollLeft<=n&&n<=e.scrollLeft+e.clientWidth-t||(e.scrollLeft<n?e.scrollLeft=n:e.scrollLeft=n-e.clientWidth+t)}},isSelected:function(){return this.element.hasClassName("selected")},deselect:function(e){App.ui.SlideShow.selectedSlide===this&&(App.ui.SlideShow.selectedSlide=null),App.ui.SlideShow.selected=App.ui.SlideShow.selected.without(this),this.element.removeClassName("selected"),this.selection&&this.selection.deselect(),canvas.closeTemporarilyOpen(),this.selection&&!this.nodes.detect((function(e){return e.isVisible()}))&&(this.selection.remove(),this.selection=null),e&&"object"===s(e)&&Event.stop(e)},remove:function(){CSS.set(this.element,{transform:CSS.scale(.01),transition:"all 500ms ease"}),setTimeout(function(){this.element.remove(),this.selection.remove(),this.selection=null}.bind(this),500)},show:function(){this.element.show()},showMenu:function(e){Event.stop(e);var t=e.findElement();this.select();var n=App.ui.SlideShow,i=n.popover;n.selectedSlide.id===this.id&&i.visible&&i.opener===t||(i.opener=t,i.show())},onStartDrag:function(){canvas.disableScrollByDrag(),this.markedNodes=this.nodes,this.markNodes(this.markedNodes)},onDrag:function(e){if(canvas.disableScrollByDrag(),this.unMarkNodes(this.markedNodes),e.areaCoords){var t=new Rectangle(new Point(e.areaCoords.x1,e.areaCoords.y1),new Point(e.areaCoords.x2,e.areaCoords.y2));this.markedNodes=canvas.getNodesFromRectangle(t)}this.markNodes(this.markedNodes)},onEndDrag:function(e){if(canvas.enableScrollByDrag(),this.unMarkNodes(this.markedNodes),this.markedNodes=null,e=e||this.selection){var t=this.nodes;if(this.updateNodes(e.areaCoords),this.nodes=this.nodes.reject((function(e){return e.id<0})),0===this.nodes.length)return Message.show(I18n.t("js.slideshow_no_nodes_error"),Message.INFO),void(this.selection?(this.nodes=t,this.buildUI(),App.ui.SlideShow.updateLabels(),this.isSelected()&&this.selection.select()):e.remove());var n=this.nodes[0]._listener.dcontent.el.toRectangle();this.nodes.each((function(e){var t=e._listener.dcontent.el.toRectangle();n=Rectangle.max(n,t)}));var i=e.areaCoords,o=new Rectangle(new Point(i.x1,i.y1),new Point(i.x2,i.y2)),s=Rectangle.max(n,o);this.padding={top:Math.abs(s.p1.y-n.p1.y),right:Math.abs(s.p2.x-n.p2.x),bottom:Math.abs(s.p2.y-n.p2.y),left:Math.abs(s.p1.x-n.p1.x)},this.setRectangle();var r={x1:s.p1.x,y1:s.p1.y,x2:s.p2.x,y2:s.p2.y};e.setAreaCoords(r,!1,!1,1),e.drawArea(),this.element.parentNode||App.ui.SlideShow.onEndDrag(this),this.select()}},updatePreview:function(){var e=this,t=this.getPreviewImageSrc(App.ui.SlideShow.mapSize);o.a.add({image:{src:t},onLoad:function(t){e.imagePreview.src=t.src,removeClassName(e.imagePreview,"h-hidden")}})},isInViewport:function(){var e=this.element.getBoundingClientRect();return e.left>0&&e.right<window.innerWidth},updateLabel:function(e){this.element.id="mmslide_"+(e+1),this.label.update(e+1),this.selection&&this.selection.updateLabel(e+1)},updateNodes:function(e){if(this.unMarkNodes(),e){var t=new Rectangle(new Point(e.x1,e.y1),new Point(e.x2,e.y2));this.nodes=canvas.getNodesFromRectangle(t),this.setRectangle()}},markNodes:function(e){(e=e||this.nodes).each((function(e){addClassName(e._listener.dcontent.el,"drop_label")}))},unMarkNodes:function(e){(e=e||this.nodes).each((function(e){removeClassName(e._listener.dcontent.el,"drop_label")}))},blurForCut:function(){Effect.Fade(this.element.id,{from:1,to:.5})},unblurForCut:function(){Effect.Fade(this.element.id,{from:.5,to:1})},defaultSelectionOptions:function(){return{listener:this,onStartDrag:this.onStartDrag.bind(this),onDrag:this.onDrag.bind(this),onEndDrag:this.onEndDrag.bind(this),onUpdate:this.save.bind(this),captureKeys:!1}}}),Object.extend(App.ui.Slide,i.a.Node)},Vq2u:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("PYYe"),s=n.n(o),r=n("mbwg"),a=n("4tVC"),l=n("ERGR"),c=n("rW35"),d=n("AJqD"),h=n("WfvK"),u=n("GlCk"),p=Class.create(r.default,{activeType:"url",cache:{autolink:{id:null}},initialize:function($super,e,t){$super("links",e,t),this.field=$("fld_link"),Element.bindOnClick("btn_autolink",this.getAutoLink.bind(this)),Element.bindOnClick("btn_removelink",this.removeLink.bind(this)),Element.bindOnClick("btn_dlg_link",this.showDialog.bind(this)),this.field.observe("focus",this.focus.bind(this)),this.blurListener=this.blur.bind(this),this.buildPopover()},focus:function(){_Event.observeBlur(this.field,this.blurListener),canvas.removeFocus(),"topic"===this.activeType&&this.showDialog()},blur:function(){_Event.stopObservingBlur(this.field,this.blurListener),canvas.addFocus(),this.setFieldValue()},setFieldValue:function(){var e;switch(this.activeType){case"topic":return;case"url":this.field.value.length>0&&this.field.value.indexOf("://")<0&&(this.field.value="http://"+this.field.value),e=s()(this.field.value);break;case"email":e=this.field.value.length>0?"mailto:".concat(s()(this.field.value)):this.field.value}canvas.onSetProperty("link",e),canvas.addFocus(),this.updateLinkControl(),App.trigger(CustomEvents.LINK_CHANGED)},onSelectNode:function(){this.updatePopover()},updateLinkControl:function(e,t){var n=canvas.selected.node.link?canvas.selected.node.getLinkObj().type:"url";if(e||(e=n),this.activeType=e,mm$("cap_link").innerHTML=I18n.t("js."+e),hasClassName(this.field,"disabled")&&removeClassName(this.field,"disabled"),p.types.each((function(e){mm$("linktype_"+e)&&removeClassName(mm$("linktype_"+e).parentNode,"selected")})),e.length&&addClassName(mm$("linktype_"+e).parentNode,"selected"),!t)switch(e){case"url":this.field.value=canvas.selected.node.link&&e==n?canvas.selected.node.link.unescapeHTML():"";break;case"email":this.field.value=e==n?canvas.selected.node.link.substring(7):"";break;case"topic":var i="";if(e==n){var o=$(canvas.selected.node.link.substring(6));i=o?o._listener.node.title.truncate(20):"("+I18n.t("js.in_other_map")+")"}this.field.value=i,addClassName(this.field,"disabled")}},buildPopover:function(){var e=p.types.map((function(e){return new Element("a",{href:"#",id:"linktype_"+e}).update(I18n.t("js."+e))}));this.linkTypePopover=new Popover("link",this.setPopoverValue.bind(this)),this.linkTypePopover.addElements(e)},updatePopover:function(e){this.updateLinkControl(e)},setPopoverValue:function(e){this.updateLinkControl(e.split("linktype_")[1])},showDialog:function(){var e=canvas.selected.node.link&&canvas.selected.node.getLinkObj().type==this.activeType?"&edit="+this.activeType:"";MM.ui.dialogs.show("link_"+this.activeType,{map_id:canvas.selected.node.id,param:e,autoSize:!0,onComplete:function(){MM.status.helpTopic="218027868-Add-Links-to-Topics"}})},initTopicList:function(t,n){var o=e.createElement(d.a,{className:"w-300",opener:e.createElement(h.a,{className:"b-1 bc-grey300 rad-5 fs-m p-10 w-300",labelClassName:"to-ellipsis",color:"black"}),selected:t.find((function(e){return e.value===n})),onChange:this._updateTopicList},e.createElement(u.a,{autofocus:!0,filterableAttribute:"label",inputClassName:"m-10 content-visible"},e.createElement(c.a,null,e.createElement(l.a,{className:"maxh-300 h-overflow-y",items:t}))));i.render(o,mm$("link_map_id"))},_updateTopicList:function(e){$("topiclist").insert(MM.ui.LoadingSpinner(48)),new Ajax.Request("/dialog/update_link_topics/"+e.value)},removeLink:function(){this.field.value="",this.updateLinkControl("url",!0),this.setFieldValue(),this.cache.autolink={id:null}},getAutoLink:function(){if(this.cache.autolink.id==canvas.selected.node.id&&this.cache.autolink.title==canvas.selected.node.title&&this.cache.autolink.items.length>1)return this.cache.autolink.items.shift(),this.field.value=this.cache.autolink.items[0].link,this.updateLinkControl("url",!0),void this.setFieldValue();$("btn_autolink").addClassName("fx-wiggle fx-infinite fx-none"),this.saved_url=this.field.value,this.field.value=I18n.t("js.getting_auto_link"),this.initGoogleSearch(),this.googleSearch.query(canvas.selected.node.title,{onComplete:this.setAutoLink.bind(this),onError:this.setAutoLink.bind(this,[])}),Amplitude.logEvent("wunder_link")},setAutoLink:function(e){if($("btn_autolink").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),!e||0===e.length)return Message.show(I18n.t("js.no_link_found_for_topic"),Message.INFO),void(this.field.value=this.saved_url);this.field.value=e[0].link,this.updateLinkControl("url",!0),this.setFieldValue(),this.cache.autolink={id:canvas.selected.node.id,title:canvas.selected.node.title,items:e}},getPopularLinks:function(e){var t=mm$("get_popular_links"),n=mm$("popular_links"),i=hasClassName(t,"open");return toggleClassName(t,"open"),i?(hide(n),n.innerHTML=""):(show(n),this.cache.popularLinks&&this.cache.popularLinks.title===e?this.setPopularLinks(this.cache.popularLinks.items):(this.cache.popularLinks={title:e},n.insert(MM.ui.LoadingSpinner(24)),this.initGoogleSearch(),this.googleSearch.query(e,{onComplete:this.setPopularLinks.bind(this),onError:this.setPopularLinks.bind(this,[])}))),!1},setPopularLinks:function(e){var t=mm$("popular_links"),n=mm$("link_target");this.cache.popularLinks=Object.extend({items:e},this.cache.popularLinks),e&&0!==e.length?(t.innerHTML="",e.each((function(e){var i=new Element("a",{href:"#",title:e.description.stripTags().truncate(150),className:"ellipsis"}).update('<span class="va-middle">'+e.title+"</span>");i.onclick=function(){return n.value=e.link,addClassName(n,"highlight"),setTimeout((function(){removeClassName(n,"highlight")}),300),!1},t.appendChild(i)}))):t.innerHTML=I18n.t("js.no_results_received")},initGoogleSearch:function(){if(!this.googleSearch){var e={disablePages:!0};App.hasFeature("google_cse")||(e=Object.extend({limitRequests:!0},e)),this.googleSearch=new a.GoogleWebSearch(e)}}});p.types=["url","topic","email"],t.default=p}.call(this,n("q1tI"),n("i8i4"))},WFqU:function(e,t,n){(function(t){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i="object"==("undefined"===typeof t?"undefined":n(t))&&t&&t.Object===Object&&t;e.exports=i}).call(this,n("yLpj"))},WXko:function(e,t,n){"use strict";function i(){}i.prototype={length:0,first:null,last:null},i.Doubly=function(){},i.Doubly.prototype=new i,i.Doubly.prototype.insertAfter=function(e,t){t.next=e.next,t.prev=e,null===e.next?this.last=t:e.next.prev=t,e.next=t,this.length++},i.Doubly.prototype.insertBefore=function(e,t){t.prev=e.prev,t.next=e,null===e.prev?this.first=t:e.prev.next=t,e.prev=t,this.length++},i.Doubly.prototype.insertBeginning=function(e){null===this.first?(this.first=e,this.last=e,e.prev=null,e.next=null,this.length++):this.insertBefore(this.first,e)},i.Doubly.prototype.insertEnd=function(e){null===this.last?this.insertBeginning(e):this.insertAfter(this.last,e)},i.Doubly.prototype.remove=function(e){null===e.prev?this.first=e.next:e.prev.next=e.next,null===e.next?this.last=e.prev:e.next.prev=e.prev,this.length--},i.Doubly.prototype.each=function(e,t){for(var n=this.first,i=0;n;)e.call(t,n,i),n=n.next,i++},i.Doubly.prototype.indexOf=function(e){for(var t=this.first,n=0;t!=e&&t.next;)t=t.next,n++;return t!=e?-1:n},i.Doubly.prototype.detect=function(e,t){for(var n=this.first,i=!1;n&&!i;)(i=e.call(t,n))||(n=n.next);return i?n:null},i.Doubly.prototype.map=function(e,t){for(var n=this.first,i=[];n;)i.push(e.call(t,n)),n=n.next;return i},i.Doubly.prototype.sort=function(e){if(0==this.length)return this;return function t(n){if(1===n.length)return n;for(var o=new i.Doubly,s=new i.Doubly,r=n.length/2,a=0,l=n.first;l;){var c=l.next;a<r?(n.remove(l),o.insertEnd(l)):(n.remove(l),s.insertEnd(l)),l=c,a++}return function(t,n){var o=new i.Doubly;for(;t.length>0||n.length>0;)if(t.length>0&&n.length>0)if(e(t.first,n.first)){var s=t.first;t.remove(t.first),o.insertEnd(s)}else{var r=n.first;n.remove(n.first),o.insertEnd(r)}else if(t.length>0){s=t.first;t.remove(t.first),o.insertEnd(s)}else if(n.length>0){r=n.first;n.remove(n.first),o.insertEnd(r)}return o}(o=t(o),s=t(s))}(this)},i.Node=function(e){this.data=e,this.prev=null,this.next=null},t.a=i},WbBG:function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},Wd7y:function(e,t,n){"use strict";n.r(t);var i=n("4AML");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=function(e){e.preventDefault(),e.stopPropagation();var t=i.default.getPlainClipboardData(e);i.default.simulatePaste(t)},a=Class.create({el:null,initialize:function(e,t){this.options=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({defaultText:"Label",saveCallback:function(){},onEnterEditMode:function(){},onLeaveEditMode:function(){}},t),this.el=new Element("div",{className:"tk_editable "+e}).update(this.options.defaultText),App.config.editable&&(this.clickObserver=this.onDocumentClick.bind(this),this.el.observe("click",this.toEditing.bind(this)),this.el.observe("dblclick",this.toEditing.bind(this))),this.initKeyMap()},initKeyMap:function(){var e=MM.utils.KeyEvent;this.keyMap=new MM.utils.KeyMap(this.el,"edit_connection_label_keymap",[{key:e.ENTER,stopEvent:!0,handler:this.stopEditing.bind(this,!0)},{key:e.ESC,stopEvent:!0,handler:this.stopEditing.bind(this,!1)}]),this.keyMap.disable()},toEditing:function(e){if(e&&(e.preventDefault(),e.stopPropagation()),!this.editing){this.editing=!0,this.options.onEnterEditMode(),this.initialValue=this.getValue(),this.el.setAttribute("contenteditable","true"),this.el.focus();var t=document.createRange();t.selectNodeContents(this.el),MM.utils.addSelection(t),Event.observe(this.el,"paste",r),Event.observe(document,"click",this.clickObserver),this.keyMap.enable()}},stopEditing:function(e){this.options.onLeaveEditMode(),this.el.setAttribute("contenteditable","false"),MM.utils.clearSelection(),Event.stopObserving(this.el,"paste",r),Event.stopObserving(document,"click",this.clickObserver),this.keyMap.disable(),e?this.save():this.setValue(this.initialValue),this.editing=!1,this.initialValue=""},onDocumentClick:function(e){Event.findElement(e)!==this.el&&this.stopEditing(!0)},getWidth:function(){return this.el.getWidth()},getHeight:function(){return this.el.getHeight()},setValue:function(e){this.el.update(e)},getValue:function(){return this.el.textContent.replace(/\s*$/,"").escapeHTML()},save:function(){this.options.saveCallback(this.getValue())}});t.default=a},WfvK:function(e,t,n){"use strict";(function(e){var i=n("2L+8"),o=function(t){var n=t.className,o=t.labelClassName,s=t.color,r=t.icon,a=t.label;return e.createElement("div",{className:n},e.createElement("div",{className:"w-100% h-flex-row justify-sb h-cp c-".concat(s)},r,e.createElement("span",{className:o},a),e.createElement(i.a,{className:"pl-5px",opts:{name:"triangle",size:8,color:s}})))};o.defaultProps={color:"grey500"},t.a=o}).call(this,n("q1tI"))},XGnz:function(e,t,n){var i=n("CH3K"),o=n("BiGR");e.exports=function e(t,n,s,r,a){var l=-1,c=t.length;for(s||(s=o),a||(a=[]);++l<c;){var d=t[l];n>0&&s(d)?n>1?e(d,n-1,s,r,a):i(a,d):r||(a[a.length]=d)}return a}},"Xt/L":function(e,t){e.exports=function(e,t,n){for(var i=-1,o=null==e?0:e.length;++i<o;)if(n(t,e[i]))return!0;return!1}},"Y+p1":function(e,t,n){var i=n("wF/u");e.exports=function(e,t){return i(e,t)}},Y1fO:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var i=n("Pqld"),o=n("moWC");function s(e){return(s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var h=function(t){function n(t){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),o=function(e,t){return!t||"object"!==s(t)&&"function"!==typeof t?l(e):t}(this,a(n).call(this,t)),d(l(o),"renderHeader",(function(){if(!o.props.header)return null;var t=o.props.header,n=t.elementLeft,s=t.title,r=t.className,a=t.elementRight,l=t.titleClassName;return e.createElement(i.a,{elementLeft:n,title:s,className:r,elementRight:a,titleClassName:l})})),o.state={items:o.props.items},o.onMouseLeave=o.onMouseLeave.bind(l(o)),o.onMouseEnter=o.onMouseEnter.bind(l(o)),o}var h,u,p;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&c(e,t)}(n,t),h=n,(u=[{key:"onMouseLeave",value:function(){this.props.onMouseLeave?this.props.onMouseLeave(-1):this.updateSelection(-1)}},{key:"onMouseEnter",value:function(e){this.props.onMouseEnter?this.props.onMouseEnter(e):this.updateSelection(e)}},{key:"unselectAll",value:function(){var e=this.state.items;return e[this.index]&&(e[this.index].highlighted=!1),e}},{key:"updateSelection",value:function(e){var t=this.unselectAll();this.index=e,t[this.index]&&(t[this.index].highlighted=!0),this.setState({allItems:t})}},{key:"componentDidMount",value:function(){this.props.tooltips&&(this._tooltips=MM.ui.ToolTips.touchSafe({el:this.container}))}},{key:"componentWillUnmount",value:function(){this.props.tooltips&&MM.ui.ToolTips.destroyTouchSafe(this._tooltips)}},{key:"render",value:function(){var t=this,n=this.props,i=n.className,s=n.elementsInRow,r=n.gridClassName,a=n.indexStart,l=n.items,c=a||0,d="g-".concat(s," h-flex-grid ").concat(r);return e.createElement("div",{ref:function(e){return t.container=e},className:i},this.renderHeader(),e.createElement("div",{className:d},l.map((function(n,i){return e.createElement(o.a,{key:i,title:n.title,element:n.element,className:n.className,onClick:function(e){return function(e,t){e.preventDefault(),e.nativeEvent.closePopover=!0,t.onClick&&t.onClick()}(e,n)},selected:n.selected,highlighted:n.highlighted,index:c+i,onMouseEnter:t.onMouseEnter,onMouseLeave:t.onMouseLeave})}))))}}])&&r(h.prototype,u),p&&r(h,p),n}(e.Component);d(h,"defaultProps",{className:"h-flex",gridClassName:"",elementsInRow:6})}).call(this,n("q1tI"))},YDNs:function(e,t,n){var i,o,s;function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}o=[e,n("gvr7")],void 0===(s="function"===typeof(i=function(e,t){"use strict";var n,i=(n=t)&&n.__esModule?n:{default:n},o="function"===typeof Symbol&&"symbol"===r(Symbol.iterator)?function(e){return r(e)}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":r(e)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.resolveOptions(t),this.initSelection()}return s(e,[{key:"resolveOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=e.action,this.container=e.container,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return e.removeFake()},this.fakeHandler=this.container.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[t?"right":"left"]="-9999px";var n=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=n+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,this.container.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(this.container.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(this.container.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,i.default)(this.target),this.copyText()}},{key:"copyText",value:function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)}},{key:"handleResult",value:function(e){this.emitter.emit(e?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.trigger&&this.trigger.focus(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==("undefined"===typeof e?"undefined":o(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}();e.exports=a})?i.apply(t,o):i)||(e.exports=s)},YIZm:function(e,t,n){"use strict";n.r(t);var i=n("wK+5"),o=n("h2DW"),s=n("fK4Y"),r=(n("uvak"),Class.create(i.default,{dcontainer:null,dchildren:null,dopener:null,rc:null,initialize:function(e){this.node=e,this.icons=[],this.cache={};var t="tk_label";this.node.parent.isRoot()?t+=" root_child":t+=" node",this.node.isFloating()&&(t+=" floating"),this.dcontent=new o.default(t),this.dcontent.el.id=this.node.id,this.dcontent.el._listener=this,this.dcontent.setTitle(),App.config.editable&&App.config.currentlyEditable||(this.dcontent.el.style.cursor="default"),App.config.editable&&App.config.currentlyEditable&&this.initEditMode(),this.__onSetStyle(!0),this.node.icons.length>0&&this.__onSetIcon(!0),this.node.note&&this.__onSetProperty("note",!0),this.node.link&&this.__onSetProperty("link",!0),this.node.attachments.length>0&&this.__onSetProperty("attachments",!0),this.node.task&&this.__onSetProperty("task",!0),this.node.comments.length>0&&this.__onSetProperty("comments",!0),this.node.idea_image&&this.__onSetProperty("image",!0),this.node.idea_video&&this.__onSetProperty("video",!0),this.node.externalTask&&this.__onSetProperty("externalTask",!0),this.dchildren=new o.default("tk_children"),this.dchildren.el.id="tk_children_"+this.node.id,this.children=[],this._initOpener(),this.dcontainer=new o.default("tk_container"),this.dcontainer.el.id="tk_container_"+this.node.id,this.node.boundary&&addClassName(this.dcontainer.el,"with-boundary");var n=new o.default("tk_open_container");App.config.layout.orientation===App.Layouts.orientation.down?(n.appendChild(this.dopener),n.appendChild(this.dcontent)):(n.appendChild(this.dcontent),n.appendChild(this.dopener)),this.dcontainer.appendChild(n),Element.hide(this.dopener.el),this.dcontainer.appendChild(this.dchildren),Element.hide(this.dchildren.el)},initEditMode:function(){this.dcontent.enabled||(this.dcontent.makeSelectable(),this.dcontent.makeEditable(),this.dcontent.toInactive(),this.dcontent.makeResizable(),this.dcontent.enableResizing(),this.dcontent.makeDraggable(),this.dcontent.enableDragging(),this.dcontent.makeDroppable(),this.dcontent.enableDropping(),this.dcontent.el.observe("dblclick",Prototype.stopEvent),this.dcontent.el.style.cursor="move",this.image&&this.image.toEditMode())},initViewOnlyMode:function(){this.dcontent.toInactive&&this.dcontent.toInactive(),this.dcontent.disableSelecting&&this.dcontent.disableSelecting(),this.dcontent.disableResizing&&this.dcontent.disableResizing(),this.dcontent.disableDragging&&this.dcontent.disableDragging(),this.dcontent.disableDropping&&this.dcontent.disableDropping(),this.dcontent.el.stopObserving("dblclick",Prototype.stopEvent),this.dcontent.el.style.cursor="default",this.image&&this.image.toViewMode()},setRc:function(e){for(var t=0,n=this.children.length;t<n;t++)this.children[t].setRc(e);this.rc=e},refreshLayout:function(){this.rc.refreshLayout()},getSizesForLayouter:function(e,t){var n,i,o,s=canvas.getCenter(),r=this.rc.vnode.dcontainer,a=r.size();if(e&&(n=this.dcontent.parent.getPosition()[1],i=this.dchildren.size()[0],this.node.hasChildren()&&(i+=this.dopener.size()[0]+6)),t){var l=new Point(this.dcontent.parent.size()[0]+this.dchildren.size()[0],this.dcontainer.size()[1]);o=new Rectangle(new Point([0,0]),l)}var c=Math.offset(canvas.getElementOffset(r.el),[-s[0],-s[1]]),d=Math.offset(c,a);return c[0]-=15,c[1]-=15,d[0]+=15,d[1]+=15,{rectangle:new Rectangle(new Point(c),new Point(d)),offsets:[i,n],childRectangle:o}},getContentOffset:function(){var e=this.dcontent.parent.getPosition();return this.rc.orientation===App.Layouts.orientation.left&&this.node.hasChildren()&&(e[0]+=this.dopener.size()[0]+6),e},__onChangeId:function($super,e,t){$super(e,t),this.dchildren.el.id="tk_children_"+t,this.dcontainer.el.id="tk_container_"+t},__onAddChild:function(e,t,n,i,o,r){return e.setRc(this.rc),e.parent=this,hasClassName(e.dcontent.el,"root_child")&&(e.dcontainer.resetPosition(),removeClassName(e.dcontent.el,"root_child"),removeClassName(e.dcontainer.el,"left_pane")),addClassName(e.dcontent.el,"node"),this.dchildren.insertChild(e.dcontainer,t,i),this.children.insert(e,t),1===this.children.length?(Element.show(this.dopener.el),this.node.closed||Element.show(this.dchildren.el),addClassName(this.dchildren.el,"single_child")):2===this.children.length&&removeClassName(this.dchildren.el,"single_child"),!!n||(r&&(e.isTemporarilyRemoved=!1),tree.notPainted||this.refreshLayout(),i&&"undefined"!==typeof s.default&&s.default&&(o&&o.moveClone?s.default.highlightMovement(e,i,o.moveClone):s.default.highlightNode(e,i)),tree.finishedInitialization&&this.node.closed&&this.node.toggleClosed(),!0)},__onRemoveChild:function(e,t,n){canvas.isSelected(e)&&"definitive"===n&&(e.node.getPrevSibling()||e.node.getNextSibling()||this.node)._listener.select(null,null,!0,!0);if(t){var i=function(e){return canvas.isSelected(e)?(e.dcontent.toInactive(),this.select(),!0):e.children.any(i)}.bind(this);i(e)}this.dchildren.removeChild(e.dcontainer),this.children=this.children.reject((function(t){return t===e})),0===this.children.length?(this.node.closed&&this.node.toggleClosed(),Element.hide(this.dopener.el)):1===this.children.length&&addClassName(this.dchildren.el,"single_child"),e.parent=null,e.isTemporarilyRemoved="move"===n,tree.notPainted||"definitive"!==n&&"move"!==n&&"cancel"!==n||this.refreshLayout(),rectangleLayouter.update(this.node)},_childSelected:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];if(canvas.isSelected(t)||t.children[0]&&t._childSelected())return!0}return!1},_initOpener:function(){var e=new Element("div",{className:"h-flex-row justify-center h-100%"}).insert(new Element("span",{className:"tk_open_indicator s-6 rad-100%"}));this.dopener=new o.default("tk_open"),this.dopener.el.update(e),this._updateOpener(),this.dopener.el.observe("click",function(){this.node.toggleClosed()}.bind(this)),this.dopener.el.observe("dblclick",Event.stop)},_updateOpener:function(){this.node.closed?removeClassName(this.dopener.el,"open"):addClassName(this.dopener.el,"open")},__onToggleClosed:function(){var e=0,t=0;if(mapView.hasMapFeature("graphics")&&App.config.layout.autoAlign&&!tree.notPainted&&canvas.selected){var n=canvas.getNodeCanvasOffset(canvas.selected);e=n[0]-canvas.getScrollLeft(),t=n[1]-canvas.getScrollTop()}if(_Element.toggle(this.dchildren.el),this._updateOpener(),this.node.closed?1===this.node.children.length?this.dopener.el.title=I18n.t("js.one_child_idea"):this.dopener.el.title=I18n.t("js.more_child_ideas_d",{v0:this.node.children.length}):this.dopener.el.title="",this.refreshLayout(),this.node.closed&&this._childSelected()&&App.config.editable&&App.config.currentlyEditable&&this.select(),this.node.closed?this.node.eachChildWithoutSelf((function(e){for(var t=0,n=e.connections.length;t<n;t++)e.connections[t].view.clear()})):this.node.eachChildWithoutSelf((function(e){for(var t=0,n=e.connections.length;t<n;t++)e.connections[t].view.redraw()})),"undefined"!==typeof App.ui.SlideShow&&App.ui.SlideShow.initialized){var i=[],o=[];this.node.getRootC().eachChild((function(e){return o.push(e)})),App.ui.SlideShow.list.each((function(e){o.any((function(t){return e.nodes.indexOf(t)>=0}))&&i.push(e)})),i.each((function(e){e.buildUI(),e.updateLabel(App.ui.SlideShow.list.indexOf(e))}))}if(mapView.hasMapFeature("graphics")&&(rectangleLayouter.update(this.node),ChangeList.autoLayoutChangeset()),mapView.hasMapFeature("graphics")&&App.config.layout.autoAlign&&!tree.notPainted&&canvas.selected){var s=canvas.getNodeCanvasOffset(canvas.selected);canvas.scrollTo([s[0]-e,s[1]-t],!1)}},__onAddBoundary:function(){addClassName(this.dcontainer.el,"with-boundary"),this.rc.redrawLines(),this.rc.refreshLayout()},__onRemoveBoundary:function(){removeClassName(this.dcontainer.el,"with-boundary"),this.rc.redrawLines(),this.rc.refreshLayout()},select:function(e,t,n,i,o){App.config.editable&&App.config.currentlyEditable&&this.dcontent&&("number"===typeof t&&(canvas._rememberedDepth=t),this.dcontent.toSelected(e,n,i,o))},openTemporarily:function(){this.node.closed&&(this.node.toggleClosed(!0),canvas.tempOpen||(canvas.tempOpen=[]),canvas.tempOpen.push(this.node))},makeVisible:function(){this.node.getAncestors().each((function(e){e.closed&&e._listener.openTemporarily()}))},__onReposition:function(e){tree.notPainted||this.rc.reposition(e),rectangleLayouter.update(this.node)},showTask:function(){this.dcontent.el.setStyle({opacity:1})},hideTask:function(){this.dcontent.el.setStyle({opacity:.2})},calculateLinePoints:function(){this._horizontalLine=this.horizontalLine(),this._verticalLine=this.verticalLine()},offsetLinePoints:function(){var e=this.getContentOffset();this._horizontalLine[0][0]+=e[0],this._horizontalLine[1][0]+=e[0],this._horizontalLine[0][1]+=e[1],this._horizontalLine[1][1]+=e[1],this._verticalLine&&(this._verticalLine[0][0]+=e[0],this._verticalLine[1][0]+=e[0],this._verticalLine[0][1]+=e[1],this._verticalLine[1][1]+=e[1])},lineCoordinates:function(e){if("live"===e){var t=this.dcontent.getPosition(),n=this.node.pos?this.node.pos[0]:0;if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up||App.config.layout.orientation===App.Layouts.orientation.left||n+t[0]>=0)var i=(this._tempRc?this._tempRc:this.rc).vnode._horizontalLine[0];else(i=(this._tempRc?this._tempRc:this.rc).vnode._horizontalLine[1])[0]-=(this._tempRc?this._tempRc:this.rc).vnode.dopener.size()[0]+6;return Math.offset(i,t)}return this.rc.orientation===App.Layouts.orientation.left?this._horizontalLine[1]:this._horizontalLine[0]},horizontalLine:function(){var e=this.dcontent.size(),t=0,n=e[0],i=e[1],o=this.dopener.size()[0]/2;return this.rc.orientation===App.Layouts.orientation.left?(t-=o,n+=o,this.node.isRootC()&&(n-=2)):App.config.layout.orientation===App.Layouts.orientation.down?(t+=o+2,n+=2*o,this.node.children.length>0&&(n+=o)):n+=o,[[t,i],[n,i]]},verticalLine:function(){if(this.node.closed||!this.node.hasChildren())return null;var e=[0,0],t=[0,0];return e[1]=this.children.first()._horizontalLine[0][1],t[1]=this.children.last()._horizontalLine[0][1]+this.children.last().dcontainer.pos[1],this.rc.orientation===App.Layouts.orientation.left?e[0]=t[0]=this.dchildren.size()[0]:e[0]=t[0]=0,[e,t]},getContainerRCOffset:function(){if(this.node.isRootC())return[0,0];var e=Element.cumulativeOffset(this.rc.vnode.dcontainer.el),t=Element.cumulativeOffset(this.dcontainer.el);return[t[0]-e[0],t[1]-e[1]]},mark:function(){canvas.allSelected.indexOf(this)<0&&addClassName(this.dcontent.el,"selected")},unmark:function(){canvas.allSelected.indexOf(this)<0&&removeClassName(this.dcontent.el,"selected")},findAffected:function(e){if(!this.dcontainer.contains(e))return null;var t=Math.negativeOffset(e,this.dcontainer.getPosition());if(this.dcontent.parent.contains(t))return this.dcontent.el;if(this.dchildren.contains(t)){for(var n=null,i=Math.negativeOffset(t,this.dchildren.getPosition()),o=0,s=this.children.length;o<s&&!(n=this.children[o].findAffected(i));o++);return n||(Droppables.last_active?Droppables.last_active.element:null)}return this.node.isRootC()&&this.dcontainer.contains(t)||!this.node.isRootC()&&this.dcontainer.contains(e)?this.dcontent.el:null},getParallelNode:function(e){var t=null;if(e)for(var n=this.dcontent.el.cumulativeOffset(),i=$$("#tk_container_"+e._listener.dcontent.el.id+" .tk_label"),o=0;null===t&&o<=i.length-1;){var s=i[o].cumulativeOffset();s.top>n.top-20&&s.top<n.top+20&&(t=i[o]._listener),o++}return t},getLeftCounterpart:function(){var e=this.rc.vnode.node.getPrevSibling();return this.getParallelNode(e)},getRightCounterpart:function(){var e=this.rc.vnode.node.getNextSibling();return this.getParallelNode(e)},destroy:function(){for(var e=0,t=this.children.length;e<t;e++)this.children[e].destroy(),this.children[e]=null;this.dcontent.el._listener=null,this.dcontent.disableDragging&&this.dcontent.disableDragging(),this.dcontent.disableDropping&&this.dcontent.disableDropping(),this.dcontent.destroy(),this.dcontent=null,this.dopener.destroy(),this.dopener=null,this.dchildren.destroy(),this.dchildren=null,this.dcontainer.destroy(),this.dcontainer=null,this.node=null,this.rc=null,this.children=null,this.parent=null},alphabetizeChildren:function(){var e=new ChangeList,t=this.children.clone();return t.sort(i.default.naturalCompare),t.each(function(t,n){var i=new MoveChange({idea_id:t.node.id,type:"Move",new_data:{parent:this.node.id,rank:n}});i.execute(),e.changes.push(i)}.bind(this)),e}}));t.default=r},YLnn:function(e,t,n){"use strict";n.r(t);var i=n("pddD"),o=n("nyiR"),s=[],r=Class.create({initialize:function(e){this.id=e.id,this.name=e.name,this.team_id=e.team_id,this.no_overwrite=e.no_overwrite,this.root_style=e.root_style?new Style(e.root_style):null,this.root_children_style=e.root_children_style?new Style(e.root_children_style):null,this.nodes_style=e.nodes_style?new Style(e.nodes_style):null,this.styles=[],e.styles&&e.styles.each(function(e){this.styles.push(new Style(e))}.bind(this)),this.styles.sortBy((function(e){return e.name})),this.boundary_styles=[],e.boundary_styles&&e.boundary_styles.each(function(e){this.boundary_styles.push(new i.default(e))}.bind(this)),this.root_selected_color=e.root_selected_color,this.root_children_selected_color=e.root_children_selected_color,this.nodes_selected_color=e.nodes_selected_color,this.background=e.background,this.line=e.line,this.is_default=e.is_default,this.is_template=e.is_template,this.thumbnail_asset_url=e.thumbnail_asset_url,0===this.styles.length&&(this.styles.push(new Style(e.root_style)),this.styles.push(new Style(e.root_children_style)),this.styles.push(new Style(e.nodes_style))),r.get(this.id)||s.push(this)},toJSON:function(){return{id:this.id,name:this.name,team_id:this.team_id,no_overwrite:!!this.no_overwrite,root_style:this.root_style.toJSON(),root_children_style:this.root_children_style.toJSON(),nodes_style:this.nodes_style.toJSON(),root_selected_color:this.root_selected_color,root_children_selected_color:this.root_children_selected_color,nodes_selected_color:this.nodes_selected_color,background:this.background,line:this.line}},isNew:function(e){return this.background.color!=e.background.color||this.background.image!=e.background.image||this.background.repeat!=e.background.repeat||(this.line.organicity!=e.line.organicity||this.line.style!=e.line.style||this.line.color!=e.line.color||(!this.root_style.equals(new Style(e.root_style))||(!this.root_children_style.equals(new Style(e.root_children_style))||!this.nodes_style.equals(new Style(e.nodes_style)))))},clone:function(){var e=Object.clone(this);return e.root_style=new Style(this.root_style),e.root_children_style=new Style(this.root_children_style),e.nodes_style=new Style(this.nodes_style),this.line&&(e.line=Object.clone(this.line)),this.background&&(e.background=Object.clone(this.background)),e.team_id=null,e},singleName:function(){return this.name.gsub(/\s/,"_").toLowerCase()},displayName:function(){return this.name.split(" ").map(function(e){return this.is_template?e.capitalize():e}.bind(this)).join(" ")},lineStrokeWidth:function(){return o.VGraphics.ZOOM_LINE_WIDTH},allStyles:function(){return this.styles.concat(this.root_style).concat(this.root_children_style).concat(this.nodes_style)},hasExternalFonts:function(){return this.allStyles().any((function(e){return e.hasExternalFonts()}))},externalFonts:function(){return this.allStyles().findAll((function(e){return e.hasExternalFonts()})).map((function(e){return e.externalFonts()})).flatten().uniqBy((function(e,t){return e.id===t.id}))}});r.get=function(e){for(var t=s.length;t>0;)if(s[--t].id==e)return s[t];return null},r.getDefault=function(){for(var e=s.length;e>0;)if(s[--e].is_default)return s[e];return null},r.team=function(){for(var e=[],t=0,n=s.length;t<n;t++)s[t].team_id&&e.push(s[t]);return e},r.remove=function(e){r.get(e)&&(s=s.reject((function(t){return t.id==e})))},r.closeActivity=function(e){this.activity&&(this.activity.update(100),e?setTimeout(this.activity.close.bind(this.activity),e):this.activity.close())},r.lineStraight=0,r.lineOrganicCurve=1,r.lineCurve=2,r.lineStraightCorner=3,r.activity=null,r.styles=["root_style","root_children_style","nodes_style"],window.MAP_THEMES=window.MAP_THEMES||s,t.default=r},Z0cm:function(e,t){var n=Array.isArray;e.exports=n},Z7WR:function(e,t,n){"use strict";n.r(t);t.default=function(e){e=Array.isArray(e)?e:Object.keys(e);var t={};return e.each((function(e){return t[e]=e})),t}(["CHILD_ADDED","EDIT_MODE_ENTERED","FILE_UPLOAD","ICON_CHANGED","NOTE_CHANGED","SIBLING_ADDED","TASK_ADDED","UNDO","WEB_IMAGE_ADDED","PRESENTATION_MODE_STARTED","PRESENTATION_STARTED","PRESENTATION_STOPPED","ROOT_RENAMED","TOPICS_COPIED","TOPIC_INSERTED","TUTORIAL_STARTED","TUTORIAL_STOPPED","WUNDERBILD_ADDED","TUTORIAL_INTRO_SHOWN","TOPIC_DROPPED","MAP_PROPERTIES_OPENED","TUTORIAL_PART_COMPLETED","LINK_CHANGED","ATTACHMENT_UPLOADED","EXPORT_DLG_OPENED","EXPORT_DLG_CLOSED","HISTORY_MODE_CLOSED","HISTORY_MODE_STARTED","MAP_EXPORTED","MEISTERTASK_BAR_OPENED","EXTERNAL_TASK_CREATED","EXTERNAL_TASK_OPENED","SHARING_POPOVER_OPENED","SHARING_POPOVER_CLOSED","WIDGET_NOTES_SELECTED","WIDGET_ICONS_SELECTED","WIDGET_LINKS_SELECTED","WIDGET_ATTACHMENTS_SELECTED","WIDGET_IMAGES_SELECTED","MEISTERTASK_SHOWN","TRAINING_TIP_SHOWN","POST_LOAD","THEME_CHANGED","COLLABORATORS_UPDATED","CHAT_UPDATE","SIMULATE_TOPIC_PASTED","SELECTED_SLIDE","SLIDE_CREATED"])},ZCgT:function(e,t,n){var i=n("tLB3"),o=1/0,s=17976931348623157e292;e.exports=function(e){return e?(e=i(e))===o||e===-o?(e<0?-1:1)*s:e===e?e:0:0===e?e:0}},ZCpW:function(e,t,n){var i=n("lm/5"),o=n("O7RO"),s=n("IOzZ");e.exports=function(e){var t=o(e);return 1==t.length&&t[0][2]?s(t[0][0],t[0][1]):function(n){return n===e||i(n,e,t)}}},ZWtO:function(e,t,n){var i=n("4uTw"),o=n("9Nap");e.exports=function(e,t){for(var n=0,s=(t=i(t,e)).length;null!=e&&n<s;)e=e[o(t[n++])];return n&&n==s?e:void 0}},ZlCP:function(e,t,n){"use strict";n.r(t);var i=n("zYya"),o=["cp_from_x","cp_from_y","cp_to_x","cp_to_y","cp_scale_x","cp_scale_y","color","label"],s=Class.create({id:null,from_id:null,to_id:null,view:null,color:null,cp_from_x:null,cp_from_y:null,cp_to_x:null,cp_to_y:null,cp_scale_x:null,cp_scale_y:null,cp_zoom_factor:null,initialize:function(e){var t=this;this.id=e.id,this.from_id=e.from_id,this.from=tree.root.getChild(this.from_id),this.to_id=e.to_id,this.raphael_id=e.from_id+"-"+e.to_id,this.to=tree.root.getChild(this.to_id),o.each((function(n){return t[n]=e[n]})),this.view=new i.default(this),this.from&&this.to&&s.all.push(this)},__onSetProperties:function(e,t){var n=!1;for(var i in e)this[i]=e[i],("color"===i||"label"===i||t)&&(n=!0);return tree.readyForConnections&&n&&this.view.redraw(!0),!0},setProperties:function(e){var t=new ChangeList,n=this.getProperties(),i={};for(var o in e)i[o]=e[o];i.from_id=n.from_id=this.from.id,i.to_id=n.to_id=this.to.id,t.changes.push(new ConnectionPropertiesChange({idea_id:this.from.id,type:"ConnectionProperties",new_data:i,old_data:n})),t.execute(),i.label&&(i.label=i.label.unescapeHTML()),ServerConnection.doChanges(t)},getProperties:function(){var e=this,t={};return o.each((function(n){return t[n]=e[n]})),t},destroy:function(){this.from.connections.remove(this),this.from.outgoing_connections.remove(this),this.to.connections.remove(this),s.all.remove(this),this.view.destroy(),this.from_id=this.from=this.to_id=this.to=this.raphael_id=this.color=this.view=null},isDrawable:function(){var e=this.to.getAncestors().concat(this.from.getAncestors());return e.push(this.to,this.from),!e.any((function(e){return e._listener.isTemporarilyRemoved}))}});s.all=[],s.get=function(e,t){for(var n=s.all.length;n>0;){var i=s.all[--n];if(i.from.id==e&&i.to.id==t)return i}},t.default=s},Zu2b:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("CW34"),r=Class.create(o.default,{initialize:function($super,e,t){$super("format",e,t),Element.bindOnClick("btn_bold",canvas.onSetStyle.bind(canvas,"bold","toggle")),Element.bindOnClick("btn_italic",canvas.onSetStyle.bind(canvas,"italic","toggle"))},onSelectNode:function(){MM.ui.buttonUnselect("btn_bold","btn_italic");var t,n=canvas.selected.node.currentStyle();t=n.fontSize,e.render(i.createElement(s.a,{selectedValue:t,onSelect:canvas.onSetStyle.bind(canvas,"fontSize")}),mm$("btn-size-container")),n.bold&&MM.ui.buttonSelect("btn_bold"),n.italic&&MM.ui.buttonSelect("btn_italic")}});t.default=r}.call(this,n("i8i4"),n("q1tI"))},a3FK:function(e,t,n){"use strict";n.r(t);var i=n("GcUR");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var r=Class.create(i.default,{initialize:function($super,e){$super(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(n,!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({type:"videos"},e))},query:function($super,e,t){$super(e,t=Object.extend({per_page:10},t))},queryVideoDetails:function(e,t){new Ajax.Request("/skoletube/video_title",{method:"get",parameters:{id:e},onSuccess:function(e){var n=e.responseText.evalJSON();n.error?Message.show(n.error,Message.ERROR):n.title?t.onComplete([{id:"",url:"",title:n.title}]):t.onComplete([])}})},transformResults:function(e){return e.map((function(e){var t=e.video_url.match(/(?:https?:\/\/(?:www\.)?|www\.|^).*(?:skoletube\.dk\/(?:video|e)\/)(?:(?:[\d]+\/([a-zA-Z0-9]{20}))|([a-zA-Z0-9]{20}|\d+))/),n=t.last()||t[t.length-2];return{id:e.VID,url:n,title:e.title}}))}});t.default=r},aOY9:function(e,t,n){"use strict";n.r(t);var i=n("J4oq"),o=n("nyiR");t.default=Class.create({boundary:null,padding:{top:4,right:6,bottom:4,left:6},offset:{x:0,y:0},initialize:function(e){this.boundary=e},redraw:function(){this.drawBoundary()},drawBoundary:function(){var e=this.boundary,t=e.node,n=e.style,s=t._listener,r=t.isRoot(),a=r||t.closed||!t.hasChildren(),l=App.config.layout.orientation,c=l===App.Layouts.orientation.down||l===App.Layouts.orientation.up,d=n.shape;if((a||c)&&(d===i.default.SHAPE_CONE?d=i.default.SHAPE_BOX:d===i.default.SHAPE_CONE_ROUND&&(d=i.default.SHAPE_BOX_ROUND)),!r&&c)var h=s.dcontainer.el,u=Rectangle.fromPosSize(new Point(canvas.getElementOffset(h)),new Point(getDimensionsAsArray(h))),p=new Rectangle(new Point(u.p1.x,u.p1.y),new Point(u.p2.x,u.p2.y));else if(a){u=Rectangle.fromPosSize(new Point(canvas.getElementOffset(s.dcontent.el)),new Point(getDimensionsAsArray(s.dcontent.el)));if(!r&&s.node.hasChildren()){var f=s.rc.orientation===App.Layouts.orientation.right?{right:12,bottom:5}:{left:10,bottom:5};u.addPadding(f)}p=new Rectangle(new Point(u.p1.x,u.p1.y),new Point(u.p2.x,u.p2.y))}else{var m=s.dcontent.el,g=(u=Rectangle.fromPosSize(new Point(canvas.getElementOffset(m)),new Point(getDimensionsAsArray(m))),s.dchildren.el);p=Rectangle.fromPosSize(new Point(canvas.getElementOffset(g)),new Point(getDimensionsAsArray(g)));Math.abs(u.size().y-p.size().y)<5&&(u.addPadding({bottom:5}),p.addPadding({bottom:5}))}u.addPadding(this.padding),u.shift(this.offset),p.addPadding(this.padding),p.shift(this.offset),this.destroy(),this.path=o.Graphics.drawBoundary(u,p,n,{shape:d,orientation:r?null:s.rc.orientation}),o.Graphics.allBoundaries.set(t.id,this.path),this.visible=!0},translate:function(e){this.path.translate(e.x,e.y)},destroy:function(){this.path&&this.path.remove(),o.Graphics.allBoundaries.unset(this.boundary.node.id)},clear:function(){this.destroy()}})},aUUJ:function(e,t){App.ui.Message={INFO:"info",NOTICE:"info",WARNING:"warning",ERROR:"error",captions:[I18n.t("js.info")+":",I18n.t("js.note")+":",I18n.t("js.warning")+":",I18n.t("js.error")+":",I18n.t("js.did_you_know")],duration:5,show:function(e,t,n){if(!Presentation.on){this.element||(this.element=$("popover_message")),this.duration=n||this.duration;var i="<div row>"+MM.ui.icon({name:t||this.WARNING,size:16})+'<p class="mh-10">'+e+"</p></div>";this.element.innerHTML===i&&this.visible?(this.clearTimer(),this.setTimer()):(this.element.update(i),CSS.set(this.element,{top:"-60px",left:UI.Registry.getViewportOffset("left")+"px",transitionDuration:0}),this.timeout&&this.clearTimer(),setTimeout(function(){CSS.Effect.Morph(this.element,{duration:.8,style:{top:UI.Registry.getViewportOffset("top")+"px",opacity:"1"}}),this.setTimer()}.bind(this),10)),this.visible=!0}},hide:function(){CSS.Effect.Morph(this.element,{duration:.8,style:{left:"-360px",opacity:"0"}}),this.clearTimer(),this.visible=!1},showSticky:function(e,t){var n=new Element("div",{id:"popover_message_sticky",class:"popover message sticky rad-5 "+(t||"")});document.body.appendChild(n),mm$("popover_message_sticky").innerHTML=e,new Effect.Appear(n)},hideSticky:function(){$("popover_message_sticky").remove()},setTimer:function(){-1!==this.duration&&(this.timeout=setTimeout(function(){this.hide()}.bind(this),1e3*this.duration))},clearTimer:function(){this.timeout&&clearTimeout(this.timeout),this.timeout=null}},window.Message=App.ui.Message},"b+/x":function(e,t){t.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},t.nodeList=function(e){var n=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in e&&(0===e.length||t.node(e[0]))},t.string=function(e){return"string"===typeof e||e instanceof String},t.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},bNQv:function(e,t,n){var i=n("gFfm"),o=n("SKAX"),s=n("EwQA"),r=n("Z0cm");e.exports=function(e,t){return(r(e)?i:o)(e,s(t))}},bahg:function(e,t){e.exports=function(e){return e.split("")}},bccC:function(e,t,n){"use strict";n.r(t);var i={enableResizing:function(){this.handle||(this.handle=new Element("span",{className:"rhandle"}),Element.insert(this.el,{top:this.handle})),Draggables.deactivate(),this.initListeners()},disableResizing:function(){this.handle.stopObserving("mousedown",this.onMouseDown)},initListeners:function(){this.onMouseDown=this.onResizeStart.bindAsEventListener(this),this.onMouseMove=this.onResize.bindAsEventListener(this),this.onMouseUp=this.onResizeEnd.bindAsEventListener(this),this.handle.observe("mousedown",this.onMouseDown)},onResizeStart:function(e){this.toResizing(),this.mouseCoords=[Event.pointerX(e),Event.pointerY(e)],Event.stop(e),this.el.style.visibility="hidden",this.getResizer({className:this.el.className,style:{borderImage:"",borderStyle:""}});var t=this.el._listener,n=t.getTextPosition();show(App.resizer),this.initialWidth=this.getBrowserQuirks(t.node.title).width,this.getTextElement().innerHTML=this.getTextForResizer(t.node.title.replace(/\r/gi," ")),App.resizer.style.left=n[0]+"px",App.resizer.style.top=n[1]+"px",App.resizer.style.width=this.initialWidth+"px",Draggables.deactivate(),Event.observe(document,"mousemove",this.onMouseMove),Event.observe(document,"mouseup",this.onMouseUp)},onResize:function(e){Draggables.deactivate(),this.resizeElement(e)},onResizeEnd:function(e){this.resizeElement(e),Event.stopObserving(document,"mouseup",this.onMouseUp),Event.stopObserving(document,"mousemove",this.onMouseMove);var t=this.insertWraps(this.el._listener.node.title,getRealWidth(App.resizer)).safeUnescapeHTML();App.resizer.style.display="none",this.el.style.visibility="visible",this.el._listener.node.commitEdit(t,[0,0],"rename"),setTimeout(function(){this.toSelected()}.bind(this),10)},resizeElement:function(e){var t=Event.pointerX(e)-this.mouseCoords[0];App.resizer.style.width=this.initialWidth+t+"px"},getResizer:function(e){for(var t in mm$("resizer_field")?App.resizer.className=e.className:(App.resizer=new Element("div",{id:"resizer_field",className:e.className}),App.resizer.container=new Element("div",{className:"tk_title",dir:"auto"}),App.resizer.appendChild(App.resizer.container),canvas.el.appendChild(App.resizer)),App.resizer.style.top="-9999px",App.resizer.style.left="-9999px",this.applyStyles(App.resizer),e.style)App.resizer.style[t]=e.style[t];this.unfixWidth()},getTextForResizer:function(e,t){var n=e.replace(/\n$/g,"<br/><br/>").replace(/\r\n/g,"<br/>").replace(/[\n]/g,"<br/>").replace(/ \</g,"<").replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");return t&&(n=n.replace(/[\r]/g,"<br/>")),n},getTextElement:function(){return App.resizer.container},getLabelSize:function(e){return this.getTextElement().innerHTML=this.getTextForResizer(e||"I",!0),{width:getRealWidth(App.resizer),height:App.resizer.clientHeight}},insertWraps:function(e,t){var n=this,i=e.split("\n"),o=[],s=t;return i.each((function(e){var t=e.replace(/[\r\f\v]{1}/gi," ").split(" "),i=n.getTextElement();i.innerHTML=t.map((function(e){return"<span>"+e.safeUnescapeHTML().escapeHTML()+"</span>"})).join(" "),s&&n.fixWidth(s),i.childElements().each((function(e,n){var i=nextSibling(e);i&&i.clientWidth>0&&i.offsetTop>e.offsetTop&&(t[n]+="\r")})),o.push(t.join(" ").replace(/\r /gi,"\r"))})),o.join("\n")},getBrowserQuirks:function(e){return(MM.ua.isBrowser("Internet Explorer")||MM.ua.isBrowser("Edge")||MM.ua.isBrowser("Firefox"))&&(e=e.replace(/\r/gi," \r")),this.getLabelSize(e)},fixWidth:function(e,t){App.resizer.setStyle({width:e+"px"}),t&&(this.fixed_width=e)},unfixWidth:function(){App.resizer.setStyle({width:"auto",maxWidth:""}),this.fixed_width=!1}};t.default=i},"cq/+":function(e,t,n){var i=n("mc0g")();e.exports=i},cvCv:function(e,t){e.exports=function(e){return function(){return e}}},d7KX:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"default",(function(){return o}));var o=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._capacity=t||10,this._contents=[]}var t,n,o;return t=e,(n=[{key:"add",value:function(e){this._contents.push(e),this._contents.length>this._capacity&&this._contents.shift()}},{key:"join",value:function(){return this._contents.collect((function(e){return e.toString()})).join("\n\n")}},{key:"empty",value:function(){return 0==this._contents.length}},{key:"first",value:function(){return this._contents[0]}},{key:"last",value:function(){return this._contents[this._contents.length-1]}},{key:"shift",value:function(){return this._contents.shift()}},{key:"unshift",value:function(e){return this._contents.unshift(e)}},{key:"size",value:function(){return this._contents.length}},{key:"toArray",value:function(){return this._contents}}])&&i(t.prototype,n),o&&i(t,o),e}()},d8FT:function(e,t,n){var i=n("eUgh"),o=n("ut/Y"),s=n("idmN"),r=n("G6z8");e.exports=function(e,t){if(null==e)return{};var n=i(r(e),(function(e){return[e]}));return t=o(t),s(e,n,(function(e,n){return t(e,n[0])}))}},dQpi:function(e,t,n){var i=n("yGk4"),o=n("vN+2"),s=n("rEGp"),r=i&&1/s(new i([,-0]))[1]==1/0?function(e){return new i(e)}:o;e.exports=r},dYE5:function(e,t,n){"use strict";n.r(t);var i=Class.create({url:null,source:null,title:null,size:null,frameOptions:{youtube:"&showinfo=1"+(MM.ua.isBrowser("Internet Explorer")?"":"&html5=1"),vimeo:"&title=0&byline=0&portrait=0",dailymotion:MM.ua.isBrowser("Internet Explorer")?"":"&html=1"},initialize:function(e){e&&(this.url=e.url,this.title=e.title||"",this.size=e.size?[e.size.width,e.size.height]:[320,200],this.updateSource())},toJSON:function(){return{url:this.url,source:this.source,width:this.width(),height:this.height(),title:this.title}},updateSource:function(){this.source=this.url.split(".")[1]},width:function(){return this.size[0]},height:function(){return this.size[1]},getElement:function(){return this.el||(this.el=new Element("iframe",{src:this.url+(this.url.indexOf("?")>=0?"&":"?")+"wmode=transparent"+(this.frameOptions[this.source]?this.frameOptions[this.source]:""),width:this.width(),height:this.height(),frameborder:0,allowfullscreen:""})),this.el}});t.default=i},dt0z:function(e,t,n){var i=n("zoYe");e.exports=function(e){return null==e?"":i(e)}},eAEe:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("347H"),s=n("2L+8"),r=n("O4Ny");function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?d(e):t}(this,c(n).call(this,e))).goToLibrary=t.goToLibrary.bind(d(t)),t.onScroll=t.onScroll.bind(d(t)),t}var u,p,f;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,t),u=n,(p=[{key:"onScroll",value:function(e){this.tabs&&!this.animating&&this.tabs.setActiveTab(e)}},{key:"goToLibrary",value:function(e){var t=this;this.animating=!0,Effect.ScrollToContext(i.findDOMNode(this.libraries[e]),{target:i.findDOMNode(this.icons),duration:"0.5",offset:-115,afterFinish:function(){return t.animating=!1}})}},{key:"update",value:function(){var e=this;if(canvas.selected){var t=canvas.selected.node.icons;this.props.libs.map((function(n){var i=Icon.sectionToString(n.lib,n.section),o=t.filter((function(e){return e.isInLibraryAndSection(n.lib,n.section)}));e.libraries[i].update(o)}))}}},{key:"UNSAFE_componentWillMount",value:function(){this.libraries={}}},{key:"componentDidMount",value:function(){this._tooltips=MM.ui.ToolTips.touchSafe({el:this.container})}},{key:"componentWillUnmount",value:function(){MM.ui.ToolTips.destroyTouchSafe(this._tooltips)}},{key:"render",value:function(){var t,n=this,i=this.props.libs.map((function(i){var s=Icon.sectionToString(i.lib,i.section),r="lib-"+s.replace("_","-"),a=e.createElement(o.default,{prevName:t||s,onScrollTo:n.onScroll,icon:r,iconSize:16,library:i.lib,ref:function(e){return n.libraries[s]=e},section:i.section,onSelectIcon:n.props.onSelectIcon,name:s,key:"library_"+s});return t=s,a})),a=this.props.libs.map((function(e){return Icon.sectionToString(e.lib,e.section)}));return e.createElement("div",{ref:function(e){return n.container=e}},e.createElement("div",{className:"h-flex-row bb-1 bc-grey100 p-10"},e.createElement(s.a,{opts:{name:"arrow-left",color:"grey500",size:12},onClick:this.props.onBack}),e.createElement("div",{className:"h-flex-row h-flex-grow justify-center fw-medium "},"Icons"),e.createElement(s.a,{opts:{name:"close",color:"grey500",size:10},onClick:this.props.onClose})),e.createElement("div",{ref:function(e){return n.icons=e},id:"icon_libraries",className:"maxh-500 h-overflow-y p-r"},i),e.createElement(r.a,{ref:function(e){return n.tabs=e},onClick:this.goToLibrary,libs:a,classes:"bt-1 bc-grey100 p-10 h-flex-row justify-sb"}))}}])&&l(u.prototype,p),f&&l(u,f),n}(e.Component);t.default=u}.call(this,n("q1tI"),n("i8i4"))},eQkx:function(e,t,n){"use strict";(function(e){var i=n("2L+8"),o=n("6r2b"),s=n("fay+"),r=n("s7eh");function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var u=function(t){function n(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),t=function(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?d(e):t}(this,c(n).call(this,e));var i=e.icon?"grey100":"blue";return t.state={backgroundColor:e.backgroundColor||i},t._enableSubMenu=t._enableSubMenu.bind(d(t)),t._disableSubMenu=t._disableSubMenu.bind(d(t)),t._onMouseEnter=t._onMouseEnter.bind(d(t)),t._onMouseLeave=t._onMouseLeave.bind(d(t)),t._handleClick=t._handleClick.bind(d(t)),t}var u,p,f;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(n,t),u=n,(p=[{key:"_enableSubMenu",value:function(){this.props.disableParentKeyMap&&this.props.disableParentKeyMap()}},{key:"_disableSubMenu",value:function(){this.props.enableParentKeyMap&&this.props.enableParentKeyMap()}},{key:"_onMouseEnter",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.onMouseEnter(this.props.index)}},{key:"_onMouseLeave",value:function(e){e.stopPropagation(),e.preventDefault(),this._disableSubMenu(),this.props.onMouseLeave(this.props.index)}},{key:"_handleClick",value:function(e){this.props.isDisabled||(e.nativeEvent.closePopover=this.props.closePopover,this.props.onClick&&this.props.onClick(e))}},{key:"componentDidMount",value:function(){this.props.subMenu&&(this.keymap=new MM.utils.KeyMap(document,"menu_item_"+(new Date).getTime(),[{key:MM.utils.KeyEvent.RIGHT,fn:this._enableSubMenu},{key:MM.utils.KeyEvent.LEFT,fn:this._disableSubMenu}]),this.keymap.disable())}},{key:"componentWillUnmount",value:function(){this.props.subMenu&&this.keymap&&(this.keymap.disable(),this.keymap=null)}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){e.highlighted?this.keymap&&this.keymap.enable():this.keymap&&this.keymap.disable()}},{key:"componentDidUpdate",value:function(){if(this.props.highlighted){for(var e=this.el,t=e.getBoundingClientRect(),n=e.parentElement;(0===n.clientHeight||!Object(r.a)(n))&&n!==document.body;)n=n.parentElement;var i=n.getBoundingClientRect();(t.top+t.height<i.top||t.top+10>i.top+i.height)&&e.scrollIntoView(!1)}}},{key:"render",value:function(){var t,n,r=this;this.props.selected&&(t=e.createElement(i.a,{opts:{name:"checkmark",size:10,color:"blue",classes:"h-a-center",parentClasses:"p-r ml-8",consize:16}})),this.props.subMenu&&(n=e.createElement("div",null,e.createElement(i.a,{opts:{name:"arrow-right",size:10,color:"grey300",classes:"h-a-center",parentClasses:"p-r ml-8",consize:16}}),this.props.selected||this.props.highlighted?e.createElement(o.a,{selectable:this.props.subMenu.selectable,items:this.props.subMenu.items}):null));var a=this.props.highlighted?"bg-"+this.state.backgroundColor:"",l=this.props.isDisabled?"o-50":"",c="list-widget-item p-r h-flex-row minh-32 pv-6 h-cp ".concat(a," ").concat(this.props.itemClassName," ").concat(l);return e.createElement("div",{ref:function(e){return r.el=e},className:c,onClick:this._handleClick,onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave},e.createElement(s.a,{parentClassName:"width-100%",className:"ws-nowrap "+this.props.className,style:this.props.style,icon:this.props.icon,label:this.props.label}),t,n)}}])&&l(u.prototype,p),f&&l(u,f),n}(e.Component);u.defaultProps={itemClassName:"",className:""},t.a=u}).call(this,n("q1tI"))},eUgh:function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,o=Array(i);++n<i;)o[n]=t(e[n],n,e);return o}},fK4Y:function(e,t,n){"use strict";n.r(t);var i={highlight:function(e){var t=mm$("user_"+e.id);t&&(t.style.borderColor=e.color||"#cccccc",setTimeout((function(){t.style.borderColor="transparent"}),2e3))},highlightNode:function(e,t){var n=users.findByID(t,!0);n&&(this.highlight(n),e.highlight(n.color,!1))},highlightMovement:function(e,t,n){if(!App.config.layout.autoAlign&&!e.dcontainer.el.eventRunning){var i=e.dcontainer.el.cumulativeOffset(),o=e.node.getElementsByClassName(e.dcontainer.el,"tk_label");o.each((function(e){e.style.color="#cccccc"})),mm$("canvas").appendChild(n),e.dcontainer.el.eventRunning=!0,new Effect.Move(n,{x:i[0],y:i[1],mode:"absolute",afterFinish:function(){Element.discard(n),e.node&&(e.dcontainer.el.eventRunning=!1,e.dcontainer.el.style.zIndex=3,o.each((function(e){e&&e.style&&(e.style.color="#"+e._listener.node.currentStyle().color)})),e.dcontent.el.style.color=e.node.currentStyle().color,this.highlightNode(e,t))}.bind(this,e)})}}};t.default=i},fMIU:function(e,t,n){"use strict";n.r(t);var i=Class.create({id:null,library:null,section:null,team:null,initialize:function(e){this.id=e.id,this.library=e.library,this.section=e.section,this.team=e.team?e.team:null,i.all[this.fullName()]=this},isDefault:function(){return"default"===this.library},isInLibraryAndSection:function(e,t){return this.library===e&&this.section===t},name:function(){return(this.section?this.section+"-":"")+this.id},fullName:function(){return(this.isDefault()?"":this.library+"/")+(this.section?this.section+"-":"")+this.id},equals:function(e){return this.fullName()===e.fullName()},url:function(){return i.libraries[this.library].paths[this.name()]},group:function(){if(!i.libraries[this.library].hasGroups)return null;var e=this.id.substring(0,this.id.indexOf("_"));return""!=e?e:null},nextInGroup:function(){if(!this.group())return null;var e=i.allInGroup(this.library,this.group());if(0===e.length)return null;var t=e.indexOf(this);return t===e.length-1?e[0]:e[t+1]},getTitle:function(){return"task"===this.group()?25*Number(this.id.charAt(5)-1)+"% "+I18n.t("js.done_lower"):"priority"===this.group()?I18n.t("js.priority_s",{v0:this.id.charAt(10)}):this.id.split("_").map((function(e){return e.capitalize()})).join(" ")},getElement:function(e){return e=Object.extend({src:this.url()},e),new Element("img",e)},getSpritePosition:function(){return i.allInSection(this.library,this.section).indexOf(this)},getSpriteElement:function(e){var t=this.getSpritePosition();return new Element(e||"a",{href:"#",style:"background-position: 0 "+24*-t+"px"})}});i.all={},i.get=function(e){return i.all.hasOwnProperty(e)?i.all[e]:null},i.fromFullName=function(e){if(e.split("/").length>1)var t=e.split("/")[0],n=e.split("/")[1];else t="default",n=e;var o=null;n.split("-").length>1&&(o=n.split("-")[0],n=n.split("-")[1]);try{if(i.libraries[t]&&i.libraries[t].icons&&(Array.isArray(i.libraries[t].icons)&&i.libraries[t].icons.indexOf(n)>=0||!Array.isArray(i.libraries[t].icons)&&i.libraries[t].icons[o].indexOf(n)>=0)){var s=i.get(e);return s||(s=new i({id:n,library:t,section:o})),s}return null}catch(r){return null}},i.allInGroup=function(e,t){if(!i.libraries[e].hasGroups)return[];var n=i.allInLibrary(e),o=[];return n.each((function(e){e.group()===t&&o.push(e)})),o},i.allInSection=function(e,t){if(!i.libraries[e])return[];var n=i.libraries[e].icons;return null===t||Array.isArray(n)||!n.hasOwnProperty(t)?i.allInLibrary(e):n[t].map((function(n){return i.findOrInit({id:n,library:e,section:t})}))},i.getSections=function(e){var t=i.libraries[e].icons;return Array.isArray(t)?null:Object.keys(t)},i.allInLibrary=function(e){if(!i.libraries[e])return[];var t=i.libraries[e].icons,n=[];return Array.isArray(t)?t.each((function(t){n.push(i.findOrInit({id:t,library:e,section:null}))})):Object.keys(t).each((function(o){t[o].each((function(t){n.push(i.findOrInit({id:t,library:e,section:o}))}))})),n},i.libraryElements=function(e,t){if(!i.libraries[e])return[];for(var n=i.libraries[e].icons,o=0,s=n.length;o<s;o++){i.findOrInit({id:n[o],library:e,section:null});ret.push(element)}return 0},i.sectionToString=function(e,t){return e!==t&&t?e+"_"+t:e},i.getByDetails=function(e){for(var t=Object.keys(i.all),n=null,o=t.length;o--&&!n;)i.all[t[o]].id===e.id&&i.all[t[o]].section===e.section&&i.all[t[o]].library===e.library&&(n=i.all[t[o]]);return n},i.findOrInit=function(e){var t=i.getByDetails({id:e.id,library:e.library,section:e.section});return t||(t=new i({id:e.id,library:e.library,section:e.section})),t},i.compactAndOrder=function(e){var t=[];return e.each((function(e){e&&(e.isDefault()&&"priority"===e.group()?t.unshift(e):e.isDefault()&&"task"===e.group()?t.insert(e,t[0]&&t[0].id.match("priority")?1:0):t.push(e))})),t=t.uniqBy((function(e,t){return e.equals(t)}))},t.default=i},"fay+":function(e,t,n){"use strict";(function(e){var n=function(t){var n=t.parentClassName,i=t.className,o=t.style,s=t.label,r=t.icon;return e.createElement("div",{className:"h-flex-row "+n},r,e.createElement("div",{className:i,style:o},s))};n.defaultProps={parentClassName:"",className:"",style:{},label:""},t.a=n}).call(this,n("q1tI"))},fh04:function(e,t,n){"use strict";function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.r(t);var o=Class.create({from:null,due:null,resource:null,effort:"",priority:-1,complete:-1,initialize:function(e){e.from&&(this.from=new Date(e.from)),e.due&&(this.due=new Date(e.due)),this.resource=null,"string"===typeof e.resource&&""!==e.resource?this.resource={id:e.resource_id,name:e.resource}:"object"===i(e.resource)&&(this.resource=e.resource),this.effort=e.effort||"",this.priority="undefined"!=typeof e.priority&&e.priority>-1?e.priority:-1,this.complete="undefined"!=typeof e.complete&&e.complete>-1?e.complete:-1},equals:function(e){return!(this.from&&!e.from||!this.from&&e.from||this.from&&e.from&&this.from.toString()!=e.from.toString())&&(!(this.due&&!e.due||!this.due&&e.due||this.due&&e.due&&this.due.toString()!=e.due.toString())&&(!(this.resource&&!e.resource||!this.resource&&e.resource||this.resource&&e.resource&&(this.resource.name!=e.resource.name||this.resource.id!=e.resource.id))&&(this.effort==e.effort&&(this.priority==e.priority&&this.complete==e.complete))))},empty:function(){return!this.from&&!this.due&&!this.resource&&!this.effort&&this.priority<0&&this.complete<0},iconsOnly:function(){return!this.from&&!this.due&&!this.resource&&!this.effort},toString:function(e){return"due"===e?this.due?this.due.getMonth()+1+"/"+this.due.getDate()+"/"+this.due.getFullYear():"-":"from"===e?this.from?this.from.getMonth()+1+"/"+this.from.getDate()+"/"+this.from.getFullYear():"-":"resource"===e?this.resource?this.resource.name:"-":void 0}});t.default=o},fhuu:function(e,t,n){"use strict";n.r(t);var i=n("FQ1s"),o=n.n(i),s=n("o8/4"),r=(n("iyru"),n("VQOc"),n("0s9k"),n("iX0B"),n("aUUJ"),n("Z7WR")),a=Class.create(Draggable,{initialize:function(e){this.options=Object.extend({drawMethod:function(){}},arguments[1]||{}),this.element=$(e),this.handle=this.element,this.delta=this.currentDelta(),this.dragging=!1,this.eventMouseDown=this.initDrag.bindAsEventListener(this),Event.observe(this.handle,"mousedown",this.eventMouseDown),Draggables.register(this)},draw:function(e){var t=Element.cumulativeOffset(this.element),n=this.currentDelta();t[0]-=n[0],t[1]-=n[1];var i=[0,1].map(function(n){return e[n]-t[n]-this.offset[n]}.bind(this));this.options.drawMethod(i)}}),l={all:[],prefix:"sel_",setup:function(e){this.canvas=$(e);var t=this.canvas.parentNode;this.canvasWrap=new Element("div",{class:this.prefix+"wrap"}),this.canvasWrap.appendChild(this.canvas),t.appendChild(this.canvasWrap)},teardown:function(){"undefined"!==typeof this.canvasWrap&&(this.canvasWrap.parentNode.insertBefore(this.canvas,this.canvasWrap),this.canvasWrap.parentNode.removeChild(this.canvasWrap),this.all.each((function(e){e.removeObservers(),e.remove()})),this.canvasWrap=void 0)},add:function(e){this.all.push(e)},remove:function(e){this.all=this.all.reject((function(t){return t==e}))}},c={};c.Base=Class.create({initialize:function(e,t){if(this.options=Object.extend({ratioDim:{x:0,y:0},minWidth:0,minHeight:0,displayOnInit:!1,onStartDrag:Prototype.emptyFunction,onEndDrag:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction,onRemove:Prototype.emptyFunction,captureKeys:!0,initialEvent:null,listener:null,allowMultiple:!0,useEffect:!1,onloadCoords:null,maxWidth:0,maxHeight:0,resize:!0,label:!0},t||{}),this.canvas=$(e),this.clickCoords={x:0,y:0},this.dragging=!1,this.resizing=!1,this.isWebKit=/Konqueror|Safari|KHTML/.test(navigator.userAgent),this.isIE=/MSIE/.test(navigator.userAgent),this.ratioX=0,this.ratioY=0,this.attached=!1,this.fixedWidth=this.options.maxWidth>0&&this.options.minWidth>=this.options.maxWidth,this.fixedHeight=this.options.maxHeight>0&&this.options.minHeight>=this.options.maxHeight,"undefined"!=typeof this.canvas){if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){var n=this.getGCD(this.options.ratioDim.x,this.options.ratioDim.y);this.ratioX=this.options.ratioDim.x/n,this.ratioY=this.options.ratioDim.y/n}l.add(this),this.subInitialize(),this.onLoad(),this.removeObservers()}},getGCD:function(e,t){return 0===t?e:this.getGCD(t,e%t)},onLoad:function(){var e=l.prefix;this.canvasWrap=l.canvasWrap,this.north=new Element("div",{class:e+"overlay "+e+"north"}).insert(new Element("span")),this.east=new Element("div",{class:e+"overlay "+e+"east"}).insert(new Element("span")),this.south=new Element("div",{class:e+"overlay "+e+"south"}).insert(new Element("span")),this.west=new Element("div",{class:e+"overlay "+e+"west"}).insert(new Element("span"));var t=[this.north,this.east,this.south,this.west];this.dragArea=this.canvas,t.each((function(e){this.dragArea.insert(e)}),this),this.options.resize&&(this.handleN=new Element("div",{class:e+"handle "+e+"handleN"}),this.handleNE=new Element("div",{class:e+"handle "+e+"handleNE"}),this.handleE=new Element("div",{class:e+"handle "+e+"handleE"}),this.handleSE=new Element("div",{class:e+"handle "+e+"handleSE"}),this.handleS=new Element("div",{class:e+"handle "+e+"handleS"}),this.handleSW=new Element("div",{class:e+"handle "+e+"handleSW"}),this.handleW=new Element("div",{class:e+"handle "+e+"handleW"}),this.handleNW=new Element("div",{class:e+"handle "+e+"handleNW"})),this.selArea=new Element("div",{class:e+"selArea",style:"display:none"}),this.options.resize&&[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW].each((function(e){this.selArea.insert(e)}),this),this.options.label&&(this.label=new Element("div",{class:e+"label"}),this.selArea.insert(new Element("div",{class:e+"innerArea"}).insert(this.label))),this.dragArea.appendChild(this.selArea),this.startDragBind=this.startDrag.bindAsEventListener(this),this.onDragBind=this.onDrag.bindAsEventListener(this),this.endDragBind=this.endDrag.bindAsEventListener(this),this.options.resize&&(this.resizeBind=this.startResize.bindAsEventListener(this)),this.keysBind=this.handleKeys.bindAsEventListener(this),this.stopEventBind=this.stopEvent.bindAsEventListener(this),Event.observe(this.selArea,"dblclick",this.stopEventBind),this.options.resize&&(this.handles=[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW]),this.addObservers(),this.setParams(),this.options.initialEvent&&this.startDrag(this.options.initialEvent),this.visible=!0},addObservers:function(){this.observersActive||(this.observersActive=!0,this.options.initialEvent||this.options.displayOnInit||Event.observe(this.dragArea,"mousedown",this.startDragBind),this.options.captureKeys&&Event.observe(document,"keydown",this.keysBind),this.options.allowMultiple&&this.selectBind&&Event.stopObserving(this.selArea,"mousedown",this.selectBind),this.options.resize&&this.registerHandles(!0),new a(this.selArea,{onDrag:this.onDragSelection.bind(this),onEnd:this.onEndDragSelection.bind(this),drawMethod:this.moveArea.bindAsEventListener(this)}))},removeObservers:function(){this.observersActive&&(this.observersActive=!1,this.options.initialEvent||this.options.displayOnInit||Event.stopObserving(this.dragArea,"mousedown",this.startDragBind),this.options.captureKeys&&Event.stopObserving(document,"keypress",this.keysBind),this.options.allowMultiple&&(this.selectBind=this.select.bindAsEventListener(this),Event.observe(this.selArea,"mousedown",this.selectBind)),this.options.resize&&this.registerHandles(!1))},registerHandles:function(e){for(var t=0;t<this.handles.length;t++){var n=$(this.handles[t]);if(e){var i=!1;if(this.fixedWidth&&this.fixedHeight)i=!0;else if(this.fixedWidth||this.fixedHeight){var o=n.className.match(/([S|N][E|W])$/),s=n.className.match(/(E|W)$/),r=n.className.match(/(N|S)$/);(o||this.fixedWidth&&s||this.fixedHeight&&r)&&(i=!0)}i?n.hide():this.options.resize&&Event.observe(n,"mousedown",this.resizeBind)}else n.show(),this.options.resize&&Event.stopObserving(n,"mousedown",this.resizeBind)}},stopEvent:function(e){Event.stop(e)},setParams:function(){this.canvasW=this.canvas.getWidth(),this.canvasH=this.canvas.getHeight(),$(this.north).setStyle({height:0}),$(this.east).setStyle({width:0,height:0}),$(this.south).setStyle({height:0}),$(this.west).setStyle({width:0,height:0}),$(this.canvasWrap).setStyle({width:this.canvasW+"px",height:this.canvasH+"px"}),$(this.selArea).hide();var e={x1:0,y1:0,x2:0,y2:0},t=!1;null!==this.options.onloadCoords?(e=this.cloneCoords(this.options.onloadCoords),t=!0):this.options.ratioDim.x>0&&this.options.ratioDim.y>0&&(e.x1=Math.ceil((this.canvasW-this.options.ratioDim.x)/2),e.y1=Math.ceil((this.canvasH-this.options.ratioDim.y)/2),e.x2=e.x1+this.options.ratioDim.x,e.y2=e.y1+this.options.ratioDim.y,t=!0),this.setAreaCoords(e,!1,!1,1),this.options.displayOnInit&&t&&(this.options.useEffect?new Effect.Appear(this.selArea,{duration:.2}):this.selArea.show(),this.drawArea()),this.attached=!0},updateLabel:function(e){this.label&&this.label.update(e)},select:function(e){l.selected&&l.selected.deselect(),this.selArea.addClassName("selected"),this.selected=!0,l.selected=this,this.addObservers(),e&&this.options.listener&&this.options.listener.select()},deselect:function(e){this.selArea.removeClassName("selected"),this.selected=!1,l.selected=null,this.removeObservers(),e&&this.options.listener&&this.options.listener.deselect()},remove:function(){this.attached&&(this.attached=!1,this.removeObservers()),l.remove(this),this.selArea.remove(),this.north.remove(),this.east.remove(),this.south.remove(),this.west.remove(),this.options.resize&&(this.handleN.remove(),this.handleNE.remove(),this.handleE.remove(),this.handleSE.remove(),this.handleS.remove(),this.handleSW.remove(),this.handleW.remove(),this.handleNW.remove()),this.options.onRemove()},show:function(){this.selArea.show(),this.north.show(),this.east.show(),this.south.show(),this.west.show(),this.options.resize&&(this.handleN.show(),this.handleNE.show(),this.handleE.show(),this.handleSE.show(),this.handleS.show(),this.handleSW.show(),this.handleW.show(),this.handleNW.show()),this.visible=!0},hide:function(){this.selArea.hide(),this.north.hide(),this.east.hide(),this.south.hide(),this.west.hide(),this.options.resize&&(this.handleN.hide(),this.handleNE.hide(),this.handleE.hide(),this.handleSE.hide(),this.handleS.hide(),this.handleSW.hide(),this.handleW.hide(),this.handleNW.hide()),this.visible=!1},reset:function(){this.attached?this.setParams():this.onLoad(),this.endDrag()},handleKeys:function(e){var t={x:0,y:0};if(!this.dragging){switch(e.keyCode){case 37:t.x=-1;break;case 38:t.y=-1;break;case 39:t.x=1;break;case 40:t.y=1}0===t.x&&0===t.y||(e.shiftKey&&(t.x*=10,t.y*=10),this.moveArea([this.areaCoords.x1+t.x,this.areaCoords.y1+t.y]),this.endDrag(),Event.stop(e))}},calcW:function(){return this.areaCoords.x2-this.areaCoords.x1},calcH:function(){return this.areaCoords.y2-this.areaCoords.y1},cloneCoords:function(e){return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2}},setAreaCoords:function(e,t,n,i,o){if(t){var s=e.x2-e.x1,r=e.y2-e.y1;e.x1<0&&(e.x1=0,e.x2=s),e.y1<0&&(e.y1=0,e.y2=r),e.x2>this.canvasW&&(e.x2=this.canvasW,e.x1=this.canvasW-s),e.y2>this.canvasH&&(e.y2=this.canvasH,e.y1=this.canvasH-r)}else if(e.x1<0&&(e.x1=0),e.y1<0&&(e.y1=0),e.x2>this.canvasW&&(e.x2=this.canvasW),e.y2>this.canvasH&&(e.y2=this.canvasH),null!==i){this.ratioX>0?this.applyRatio(e,{x:this.ratioX,y:this.ratioY},i,o):n&&this.applyRatio(e,{x:1,y:1},i,o);var a=[this.options.minWidth,this.options.minHeight],l=[this.options.maxWidth,this.options.maxHeight];if(a[0]>0||a[1]>0||l[0]>0||l[1]>0){var c={a1:e.x1,a2:e.x2},d={a1:e.y1,a2:e.y2},h={min:0,max:this.canvasW},u={min:0,max:this.canvasH};0===a[0]&&0===a[1]||!n||(a[0]>0?a[1]=a[0]:a[1]>0&&(a[0]=a[1])),0===l[0]&&0===l[0]||!n||(l[0]>0&&l[0]<=l[1]?l[1]=l[0]:l[1]>0&&l[1]<=l[0]&&(l[0]=l[1])),a[0]>0&&this.applyDimRestriction(c,a[0],i.x,h,"min"),a[1]>1&&this.applyDimRestriction(d,a[1],i.y,u,"min"),l[0]>0&&this.applyDimRestriction(c,l[0],i.x,h,"max"),l[1]>1&&this.applyDimRestriction(d,l[1],i.y,u,"max"),e={x1:c.a1,y1:d.a1,x2:c.a2,y2:d.a2}}}this.areaCoords=e},applyDimRestriction:function(e,t,n,i,o){("min"==o?e.a2-e.a1<t:e.a2-e.a1>t)&&(1==n?e.a2=e.a1+t:e.a1=e.a2-t,e.a1<i.min?(e.a1=i.min,e.a2=t):e.a2>i.max&&(e.a1=i.max-t,e.a2=i.max))},applyRatio:function(e,t,n,i){var o;"N"==i||"S"==i?(o=this.applyRatioToAxis({a1:e.y1,b1:e.x1,a2:e.y2,b2:e.x2},{a:t.y,b:t.x},{a:n.y,b:n.x},{min:0,max:this.canvasW}),e.x1=o.b1,e.y1=o.a1,e.x2=o.b2,e.y2=o.a2):(o=this.applyRatioToAxis({a1:e.x1,b1:e.y1,a2:e.x2,b2:e.y2},{a:t.x,b:t.y},{a:n.x,b:n.y},{min:0,max:this.canvasH}),e.x1=o.a1,e.y1=o.b1,e.x2=o.a2,e.y2=o.b2)},applyRatioToAxis:function(e,t,n,i){var o=Object.extend(e,{}),s=o.a2-o.a1,r=Math.floor(s*t.b/t.a),a=null,l=null,c=null;return 1==n.b?((a=o.b1+r)>i.max&&(c=(a=i.max)-o.b1),o.b2=a):((a=o.b2-r)<i.min&&(c=(a=i.min)+o.b2),o.b1=a),null!==c&&(l=Math.floor(c*t.a/t.b),1==n.a?o.a2=o.a1+l:o.a1=o.a1=o.a2-l),o},forceReRender:function(){if(this.isIE){var e=document.createTextNode(" ");fixEl=this.selArea,fixEl.appendChild(e),fixEl.removeChild(e)}},drawArea:function(){var e=this.calcW(),t=this.calcH(),n="px",i=[this.areaCoords.x1+n,this.areaCoords.y1+n,e+n,t+n,this.areaCoords.x2+n,this.areaCoords.y2+n,this.canvas.getWidth()-this.areaCoords.x2+n,this.canvas.getHeight()-this.areaCoords.y2+n],o=this.selArea.style;o.left=i[0],o.top=i[1],o.width=i[2],o.height=i[3];var s=Math.ceil((e-6)/2)+n,r=Math.ceil((t-6)/2)+n;this.options.resize&&(this.handleN.style.left=s,this.handleE.style.top=r,this.handleS.style.left=s,this.handleW.style.top=r),this.north.style.height=i[1];var a=this.east.style;a.top=i[1],a.height=i[3],a.left=i[4],a.width=i[6];var l=this.south.style;l.top=i[5],l.height=i[7];var c=this.west.style;c.top=i[1],c.height=i[3],c.width=i[0],this.subDrawArea(),this.forceReRender()},transformCoords:function(e,t,n,i){var o=[e,t];e>t&&o.reverse(),n[i+"1"]=o[0],n[i+"2"]=o[1]},getCurPos:function(e){var t=this.canvasWrap,n=Element.cumulativeOffset(t),i=Element.cumulativeScrollOffset(t);return n[0]-=i[0],n[1]-=i[1],{x:Event.pointerX(e)-n[0],y:Event.pointerY(e)-n[1]}},onDragSelection:function(e,t){this.options.onDrag(this)},onEndDragSelection:function(e,t){this.options.onEndDrag(this),this.update()},moveArea:function(e){this.setAreaCoords({x1:e[0],y1:e[1],x2:e[0]+this.calcW(),y2:e[1]+this.calcH()},!0,!1),this.drawArea()},startResize:function(e){this.startCoords=this.cloneCoords(this.areaCoords),this.resizing=!0,this.resizeHandle=Event.element(e).classNames().toString().replace(/([^N|NE|E|SE|S|SW|W|NW])+/,""),Event.observe(document,"mousemove",this.onDragBind),Event.observe(document,"mouseup",this.endDragBind),Event.stop(e)},startDrag:function(e){this.select(),this.selArea.show(),this.clickCoords=this.getCurPos(e),this.setAreaCoords({x1:this.clickCoords.x,y1:this.clickCoords.y,x2:this.clickCoords.x,y2:this.clickCoords.y},!1,!1,null),Event.observe(document,"mousemove",this.onDragBind),Event.observe(document,"mouseup",this.endDragBind),this.dragging=!0,this.onDrag(e),Event.stop(e),this.options.onStartDrag(this)},onDrag:function(e){if(this.dragging||this.resizing){var t=null,n=this.getCurPos(e),i=this.cloneCoords(this.areaCoords),o={x:1,y:1};this.dragging?(n.x<this.clickCoords.x&&(o.x=-1),n.y<this.clickCoords.y&&(o.y=-1),this.transformCoords(n.x,this.clickCoords.x,i,"x"),this.transformCoords(n.y,this.clickCoords.y,i,"y")):this.resizing&&((t=this.resizeHandle).match(/E/)?(this.transformCoords(n.x,this.startCoords.x1,i,"x"),n.x<this.startCoords.x1&&(o.x=-1)):t.match(/W/)&&(this.transformCoords(n.x,this.startCoords.x2,i,"x"),n.x<this.startCoords.x2&&(o.x=-1)),t.match(/N/)?(this.transformCoords(n.y,this.startCoords.y2,i,"y"),n.y<this.startCoords.y2&&(o.y=-1)):t.match(/S/)&&(this.transformCoords(n.y,this.startCoords.y1,i,"y"),n.y<this.startCoords.y1&&(o.y=-1))),this.setAreaCoords(i,!1,e.shiftKey,o,t),this.drawArea(),Event.stop(e)}this.options.onDrag(this)},update:function(){this.options.onUpdate(this)},endDrag:function(){Event.stopObserving(document,"mousemove",this.onDragBind),Event.stopObserving(document,"mouseup",this.endDragBind),this.options.onEndDrag(this),this.update(),this.dragging=!1,this.resizing=!1},subInitialize:function(){},subDrawArea:function(){}}),c.Previewable=Class.create(c.Base,{subInitialize:function(){this.hasPreview=!1,"undefined"!=typeof this.options.previewWrap&&this.options.minWidth>0&&this.options.minHeight>0&&(this.previewWrap=$(this.options.previewWrap),this.previewCanvas=this.canvas.cloneNode(!1),this.previewCanvas.id=l.prefix+this.previewCanvas.id,this.options.displayOnInit=!0,this.hasPreview=!0,this.previewWrap.addClassName(l.prefix+"previewWrap"),this.previewWrap.setStyle({width:this.options.minWidth+"px",height:this.options.minHeight+"px"}),this.previewWrap.appendChild(this.previewCanvas))},subDrawArea:function(){if(this.hasPreview){var e=this.calcW(),t=this.calcH(),n={x:this.canvasW/e,y:this.canvasH/t},i={x:e/this.options.minWidth,y:t/this.options.minHeight},o={w:Math.ceil(this.options.minWidth*n.x)+"px",h:Math.ceil(this.options.minHeight*n.y)+"px",x:"-"+Math.ceil(this.areaCoords.x1/i.x)+"px",y:"-"+Math.ceil(this.areaCoords.y1/i.y)+"px"},s=this.previewCanvas.style;s.width=o.w,s.height=o.h,s.left=o.x,s.top=o.y}}});n("C9DP");var d=n("iLPW"),h=n("YLnn"),u=(n("hvl1"),n("iors")),p=n("CO2j"),f=n("pddD"),m=n("fMIU"),g=n("i5FV"),v=n("Gga9"),y=n("uvak");o.a.el.isAbsolute=!0,o.a.el.absolutely=function(){return this.isAbsolute=1,this},o.a.el.relatively=function(){return this.isAbsolute=0,this},o.a.el.moveTo=function(e,t){return this._last={x:e,y:t},this.attr({path:this.attrs.path+["m","M"][+this.isAbsolute]+parseFloat(e)+" "+parseFloat(t)})},o.a.el.lineTo=function(e,t){return this._last={x:e,y:t},this.attr({path:this.attrs.path+["l","L"][+this.isAbsolute]+parseFloat(e)+" "+parseFloat(t)})},o.a.el.arcTo=function(e,t,n,i,o,s,r){return this._last={x:o,y:s},this.attr({path:this.attrs.path+["a","A"][+this.isAbsolute]+[parseFloat(e),parseFloat(t),+r,n,i,parseFloat(o),parseFloat(s)].join(" ")})},o.a.el.curveTo=function(){var e=Array.prototype.splice.call(arguments,0,arguments.length),t=[0,0,0,0,"s",0,"c"][e.length]||"";return this.isAbsolute&&(t=t.toUpperCase()),this._last={x:e[e.length-2],y:e[e.length-1]},this.attr({path:this.attrs.path+t+e})},o.a.el.cplineTo=function(e,t,n){return this.attr({path:this.attrs.path+["C",this._last.x+n,this._last.y,e-n,t,e,t]}),this._last={x:e,y:t},this},o.a.el.qcurveTo=function(){var e=[0,1,"t",3,"q"][arguments.length],t=Array.prototype.splice.call(arguments,0,arguments.length);return this.isAbsolute&&(e=e.toUpperCase()),this._last={x:t[t.length-2],y:t[t.length-1]},this.attr({path:this.attrs.path+e+t})},o.a.el.addRoundedCorner=function(e,t){var n=this.isAbsolute;return n&&this.relatively(),this._last={x:e*(2*!!(t.indexOf("r")+1)-1),y:e*(2*!!(t.indexOf("d")+1)-1)},this.arcTo(e,e,0,{lu:1,rd:1,ur:1,dl:1}[t]||0,this._last.x,this._last.y),n&&this.absolutely(),this},o.a.el.andClose=function(){return this.attr({path:this.attrs.path+"z"})};var _=n("hwfg"),b=n("k8rv");window.Raphael=o.a,window.Point=y.Point,window.Rectangle=y.Rectangle,window.rectangleLayouter=v.default,window.IdeaImage=g.default,window.BoundaryStyle=f.default,window.Icon=m.default,window.Font=u.default,window.Style=p.default,window.MapTheme=h.default,window.Tree=d.default,window.Canvas=s.default,window.CustomEvents=r.default,window.Presentation=_.default,window.SelDraggable=a,window.Selection=c,window.Selections=l,App.ui.Zoom=b.default},fvY9:function(e,t,n){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}n.r(t),n.d(t,"default",(function(){return s}));var o=function(){return null},s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onContextMenu=t,this.onCloseContextMenu=n,this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.observe()}var t,n,s;return t=e,(n=[{key:"observe",value:function(){window.addEventListener("contextmenu",this.onOpen)}},{key:"stopObserving",value:function(){window.removeEventListener("contextmenu",this.onOpen)}},{key:"onOpen",value:function(e){this.onContextMenu(e),window.addEventListener(MM.ua.getEvent().mousedown,this.onClose),window.addEventListener("keyup",this.onClose)}},{key:"onClose",value:function(e){this.onCloseContextMenu(e),window.removeEventListener(MM.ua.getEvent().mousedown,this.onClose),window.removeEventListener("keyup",this.onClose)}}])&&i(t.prototype,n),s&&i(t,s),e}()},gFfm:function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}},gP1L:function(e,t,n){(e.exports=n("JPst")(!0)).push([e.i,'@font-face{font-family:\'Avenir\';font-weight:300;src:local("Avenir Light"),local("Avenir-Light"),url("/fonts/Avenir/Light.woff2") format("woff2"),url("/fonts/Avenir/Light.woff") format("woff")}@font-face{font-family:\'Avenir\';font-weight:400;src:local("Avenir Book"),local("Avenir-Book"),url("/fonts/Avenir/Book.woff2") format("woff2"),url("/fonts/Avenir/Book.woff") format("woff")}@font-face{font-family:\'Avenir\';font-weight:500;src:local("Avenir Medium"),local("Avenir-Medium"),url("/fonts/Avenir/Medium.woff2") format("woff2"),url("/fonts/Avenir/Medium.woff") format("woff")}@font-face{font-family:\'Avenir\';font-weight:700;src:local("Avenir Heavy"),local("Avenir-Heavy"),url("/fonts/Avenir/Heavy.woff2") format("woff2"),url("/fonts/Avenir/Heavy.woff") format("woff")}@font-face{font-family:\'Avenir\';font-weight:900;src:local("Avenir Black"),local("Avenir-Black"),url("/fonts/Avenir/Black.woff2") format("woff2"),url("/fonts/Avenir/Black.woff") format("woff")}@font-face{font-family:\'Avenir Next\';font-weight:300;src:local("Avenir Next Light"),local("AvenirNext-Light"),url("/fonts/AvenirNext/Light.woff2") format("woff2"),url("/fonts/AvenirNext/Light.woff") format("woff")}@font-face{font-family:\'Avenir Next\';font-weight:400;src:local("Avenir Next Regular"),local("AvenirNext-Regular"),url("/fonts/AvenirNext/Regular.woff2") format("woff2"),url("/fonts/AvenirNext/Regular.woff") format("woff")}@font-face{font-family:\'Avenir Next\';font-weight:500;src:local("Avenir Next Medium"),local("AvenirNext-Medium"),url("/fonts/AvenirNext/Medium.woff2") format("woff2"),url("/fonts/AvenirNext/Medium.woff") format("woff")}@font-face{font-family:\'Avenir Next\';font-weight:700;src:local("Avenir Next Demi Bold"),local("AvenirNext-DemiBold"),url("/fonts/AvenirNext/Demi.woff2") format("woff2"),url("/fonts/AvenirNext/Demi.woff") format("woff")}@font-face{font-family:\'Avenir Next\';font-weight:900;src:local("Avenir Next Bold"),local("AvenirNext-Bold"),url("/fonts/AvenirNext/Bold.woff2") format("woff2"),url("/fonts/AvenirNext/Bold.woff") format("woff")}.ql-active{background-color:#0af;border-color:#0af;fill:white;color:white}\n',"",{version:3,sources:["/home/mindmeister/server/mymind/releases/20200115114804/app/assets/stylesheets/meisterlabs/0-settings/_fonts.scss","/home/mindmeister/server/mymind/releases/20200115114804/webpack/css/tools/quill.scss","/home/mindmeister/server/mymind/releases/20200115114804/app/assets/stylesheets/meisterlabs/0-settings/_colors.scss"],names:[],mappings:"AAEA,WACE,oBAAqB,CACrB,eAAgB,CAChB,+IAIgD,CAGlD,WACE,oBAAqB,CACrB,eAAgB,CAChB,2IAI+C,CAGjD,WACE,oBAAqB,CACrB,eAAgB,CAChB,mJAIiD,CAGnD,WACE,oBAAqB,CACrB,eAAgB,CAChB,+IAIgD,CAGlD,WACE,oBAAqB,CACrB,eAAgB,CAChB,+IAIgD,CAKlD,WACE,yBAA0B,CAC1B,eAAgB,CAChB,gKAIoD,CAGtD,WACE,yBAA0B,CAC1B,eAAgB,CAChB,wKAIsD,CAGxD,WACE,yBAA0B,CAC1B,eAAgB,CAChB,oKAIqD,CAGvD,WACE,yBAA0B,CAC1B,eAAgB,CAChB,qKAImD,CAGrD,WACE,yBAA0B,CAC1B,eAAgB,CAChB,4JAImD,CClGrD,WACE,qBCe+B,CDd/B,iBCc+B,CDb/B,UAAW,CACX,WAAY",file:"quill.scss",sourcesContent:["/* Font Definitions */\n\n@font-face {\n  font-family: 'Avenir';\n  font-weight: 300;\n  src:\n    local('Avenir Light'),\n    local('Avenir-Light'),\n    url('/fonts/Avenir/Light.woff2') format('woff2'),\n    url('/fonts/Avenir/Light.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir';\n  font-weight: 400;\n  src:\n    local('Avenir Book'),\n    local('Avenir-Book'),\n    url('/fonts/Avenir/Book.woff2') format('woff2'),\n    url('/fonts/Avenir/Book.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir';\n  font-weight: 500;\n  src:\n    local('Avenir Medium'),\n    local('Avenir-Medium'),\n    url('/fonts/Avenir/Medium.woff2') format('woff2'),\n    url('/fonts/Avenir/Medium.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir';\n  font-weight: 700;\n  src:\n    local('Avenir Heavy'),\n    local('Avenir-Heavy'),\n    url('/fonts/Avenir/Heavy.woff2') format('woff2'),\n    url('/fonts/Avenir/Heavy.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir';\n  font-weight: 900;\n  src:\n    local('Avenir Black'),\n    local('Avenir-Black'),\n    url('/fonts/Avenir/Black.woff2') format('woff2'),\n    url('/fonts/Avenir/Black.woff') format('woff');\n}\n\n/* Avenir Next */\n\n@font-face {\n  font-family: 'Avenir Next';\n  font-weight: 300;\n  src:\n    local('Avenir Next Light'),\n    local('AvenirNext-Light'),\n    url('/fonts/AvenirNext/Light.woff2') format('woff2'),\n    url('/fonts/AvenirNext/Light.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir Next';\n  font-weight: 400;\n  src:\n    local('Avenir Next Regular'),\n    local('AvenirNext-Regular'),\n    url('/fonts/AvenirNext/Regular.woff2') format('woff2'),\n    url('/fonts/AvenirNext/Regular.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir Next';\n  font-weight: 500;\n  src:\n    local('Avenir Next Medium'),\n    local('AvenirNext-Medium'),\n    url('/fonts/AvenirNext/Medium.woff2') format('woff2'),\n    url('/fonts/AvenirNext/Medium.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir Next';\n  font-weight: 700;\n  src:\n    local('Avenir Next Demi Bold'),\n    local('AvenirNext-DemiBold'),\n    url('/fonts/AvenirNext/Demi.woff2') format('woff2'),\n    url('/fonts/AvenirNext/Demi.woff') format('woff');\n}\n\n@font-face {\n  font-family: 'Avenir Next';\n  font-weight: 900;\n  src:\n    local('Avenir Next Bold'),\n    local('AvenirNext-Bold'),\n    url('/fonts/AvenirNext/Bold.woff2') format('woff2'),\n    url('/fonts/AvenirNext/Bold.woff') format('woff');\n}\n",'@import "meisterlabs/includes";\n\n/* Rich text editor plugin (=Quill) adds this class to active buttons */\n.ql-active {\n  background-color: $blue;\n  border-color: $blue;\n  fill: white;\n  color: white;\n}',"/* Grey Tones (Font Colors) */\n\n$grey900               : #333C40;\n$grey700               : #3D474D;\n$grey500               : #8A9499;\n$grey300               : #DCE2E6;\n$grey200               : #EDF1F2;\n$grey100               : #F7F9FA;\n\n$grey                  : $grey700; /* keep this to avoid scss undefined errors until MM19 */\n\n/* Other Colors */\n\n$red                    : #FF4019;\n$orange                 : #FFAA00;\n$yellow                 : #FFD426;\n$banana                 : #FFF2B3;\n$green                  : #3DCC3D;\n$turquoise              : #2BD9D9;\n$blue                   : #00AAFF;\n$navy                   : #4070FF;\n$sky                    : #E6F7FF; /* used for selected items with light blue bg*/\n$purple                 : #A179F2;\n$brown                  : #806040;\n$grass                  : #96DB0B;\n$pink                   : #F7578C;\n\n"]}])},gQMU:function(e,t,n){var i=n("0ZTe")("toUpperCase");e.exports=i},gvr7:function(e,t){e.exports=function(e){var t;if("SELECT"===e.nodeName)e.focus(),t=e.value;else if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName){var n=e.hasAttribute("readonly");n||e.setAttribute("readonly",""),e.select(),e.setSelectionRange(0,e.value.length),n||e.removeAttribute("readonly"),t=e.value}else{e.hasAttribute("contenteditable")&&e.focus();var i=window.getSelection(),o=document.createRange();o.selectNodeContents(e),i.removeAllRanges(),i.addRange(o),t=i.toString()}return t}},h2DW:function(e,t,n){"use strict";n.r(t);var i=n("+c3t"),o=n("bccC"),s=n("LOIY"),r=n("Fbyt"),a=Class.create({el:null,pos:null,children:null,childrenSize:null,childrenLength:null,initialize:function(e,t){this.el=document.createElement(t||"div"),this.el=$(this.el),this.el.className=e,this.pos=[0,0],this.children=[],this.childrenSize=null,this.childrenLength=null},size:function(){return[this.el.offsetWidth,this.el.offsetHeight]},setSize:function(e){this.el.width=e[0],this.el.height=e[1]},contains:function(e){var t=this.size(),n=this.getPosition();return n[0]<=e[0]&&n[1]<=e[1]&&n[0]+t[0]>=e[0]&&n[1]+t[1]>=e[1]},getPosition:function(){return this.el.offsetParent!==this.el.parentNode?[this.el.offsetLeft-this.el.parentNode.offsetLeft,this.el.offsetTop-this.el.parentNode.offsetTop]:[this.el.offsetLeft,this.el.offsetTop]},move:function(e){this.pos=e.slice()},shift:function(e){this.pos[0]+=e[0],this.pos[1]+=e[1]},doMove:function(){this.el.style.position="absolute",this.el.style.top=this.pos[1]+"px",hasClassName(this.el,"left_pane")&&"phantomjs"!==App.config.environment?(this.el.style.left="auto",this.el.style.right="calc(100% - "+(this.pos[0]+this.el.getWidth())+"px)"):(this.el.style.right="auto",this.el.style.left=this.pos[0]+"px")},resetPosition:function(){this.el.style.position="",this.el.style.left="",this.el.style.top="",this.el.style.width="",this.el.style.height=""},onImageRemoved:function(){this.el.childNodes[0].style.marginLeft="0"},setTitle:function(){var e=new Element("div",{className:"h-iblock va-middle"});this.title=new Element("div",{className:"tk_title",dir:"auto"}).update(this.el._listener.node.getTitleWithLinks()),e.appendChild(this.title),this.insertChild({el:e},0),this.setHoverTitle()},setHoverTitle:function(){if(App.config.editable){var e=this.el._listener.node,t=users.findByID(e.modifiedBy,!0)||users.selfUser,n=(new Date).getTime();this.title.title=I18n.t("js.modified_by_s_s",{v0:t.name,v1:e.modifiedAt.toUIString(n-e.modifiedAt.getTime()>864e5)})}},updateTitle:function(){this.title.innerHTML=this.el._listener.node.getTitleWithLinks()},applyStyles:function(e){this.el._listener.node.style?Style.applyToElement(this.el._listener.node.style,e):Style.removeFromElement(e)},insertChild:function(e,t){this.children.insert(e,t),e.parent=this,t>=this.children.length-1?this.el.appendChild(e.el):this.el.insertBefore(e.el,this.children[t+1].el)},appendChild:function(e){this.children[this.children.length]=e,e.parent=this,this.el.appendChild(e.el)},removeChild:function(e){this.children=this.children.reject((function(t){return e.el==t.el})),this.el.removeChild(e.el)},destroy:function(){this.children.each((function(e){e.destroy&&e.destroy()})),this.children.clear(),Element.discard(this.el)},makeSelectable:function(){Object.extend(this,s.default)},makeResizable:function(){Object.extend(this,o.default)},makeEditable:function(){Object.extend(this,i.default)},makeDraggable:function(){Object.extend(this,r._Draggable)},makeDroppable:function(){Object.extend(this,r._Droppable)}});t.default=a},h5dI:function(e,t,n){"use strict";(function(e){var i=n("2L+8");function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==o(t)&&"function"!==typeof t?a(e):t}(this,r(n).call(this,e))).state={selected:t.props.selected},t.handleClick=t.handleClick.bind(a(t)),t}var c,d,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),c=n,(d=[{key:"handleClick",value:function(){this.props.handleClick(this),this.setState({selected:!0})}},{key:"render",value:function(){var t=this.state.selected?this.props.selectedColor:this.props.defaultColor;return e.createElement("div",{className:"bg-grey100-hover w-24px h-24px rad-3 h-flex-row justify-center",onClick:this.handleClick},e.createElement(i.a,{opts:{name:this.props.icon,color:t,size:this.props.iconSize}}))}}])&&s(c.prototype,d),h&&s(c,h),n}(e.Component);t.a=c}).call(this,n("q1tI"))},hYyt:function(e,t,n){var i=n("lH83");"string"===typeof i&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1};n("LboF")(i,o);i.locals&&(e.exports=i.locals)},heNW:function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},hgQt:function(e,t,n){var i=n("Juji"),o=n("4sDh");e.exports=function(e,t){return null!=e&&o(e,t,i)}},hvl1:function(e,t,n){"use strict";n.r(t);var i=n("+29S"),o=n("x6O/"),s=n("d7KX");function r(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var l=["/maps/undo_redo_status","/maps/poll","/maps/save_map_preferences","/maps/auto_note","/maps/toggle_closed","/maps/set_task_notify","/maps/paste_as_map","/maps/clone_revision","/external/drive/update","external/drive/sync"],c=["/maps/get_tree"],d=Class.create({id:null,url:null,data:null,response:null,responseHeaders:null,revision:null,timestamp:null,_customHandler:null,initialize:function(e,t,n){this.id=d.id++,this.url=e,this.data=t,this._customHandler=n,this.responseHeaders="",this.timestamp=(new Date).toString()},handleResponse:function(e){this.response=e;try{var t=e.evalJSON()}catch(n){this.handleAjaxException(null,"Bad response ("+n.message+")")}if("object"!=a(t)&&this.handleAjaxException(null,"Bad response"),t.revision&&(tree.revision=t.revision),"undefined"!=typeof App.config.handleServerResponseRemote&&App.config.handleServerResponseRemote(t),t.error&&1==t.error.code&&(this.silentError()?Message.show(t.error.message,Message.ERROR):window.location="/"),this._customHandler)try{this._customHandler(t)}catch(i){MM.error.reportMapException({exception:i,message:"Exception handling response"})}},handleAjaxException:function(e,t){if("localhost:3000"===document.location.host)throw e;this.ignorable()||MM.error.reportMapException({exception:e,message:t})},ignorable:function(){var e=this;return l.any((function(t){return t==e.url}))},silentError:function(){var e=this;return c.any((function(t){return e.url.indexOf(t)>-1}))},saveResponseDelay:function(){this.responseDelay=(new Date-new Date(this.timestamp))/1e3},toString:function(){return"Id: "+this.id+"\nUrl: "+this.url+"\nRevision: "+this.revision+"\nTimestamp: "+this.timestamp+"\nResponse delay: "+this.responseDelay+"\nData: "+Object.toJSON(this.data)+"\nResponse: "+this.response},setResponseHeaders:function(e){this.responseHeaders=e}});d.id=0;var h=Class.create(d,{changesets:null,append:function(e){this.changesets=this.changesets.concat(e);for(var t=[],n=0;n<e.length;n++)t[n]=e[n].toJSON();this.data.changelists=this.data.changelists.concat(t)},remove:function(e){var t=this.changesets.remove(e);this.data.changelists.splice(t,1)},countDos:function(){for(var e=0,t=0;t<this.data.changelists.length;t++)for(var n=this.data.changelists[t],i=0;i<n.length;i++)"NonPersistentReposition"!=n[i].type&&(e+=1);return e}}),u={protocolVersion:1,timeoutDelay:120,requestQueue:new s.default,pendingCode:null,lastRequestTime:0,req_data:null,repeatedQueue:0,initialize:function(){this._onRequestSuccess=this.requestSuccess.bind(this),this._onRequestFailure=this.requestFailure.bind(this),this._onRequestException=this.requestException.bind(this),this._onRequestTimeout=this.requestTimeout.bind(this)},registerPendingCode:function(e){this.isPending()?this.pendingCode=e:e()},_preRequest:function(e){App.busy(!0),App.requestLog&&App.requestLog.add(e),"/maps/do"===e.url&&(this.lastRequestTime=new Date)},_postRequest:function(){u.requestQueue.shift(),App.busy(!1),u.processQueue()},requestSuccess:function(e){var t=this.requestQueue.first();if(t.saveResponseDelay(),0===e.status)return this.requestTimeout(e,"requestSuccess");u.networkProblem&&(u.networkProblem=!1,u.wasEditMode&&(u.wasEditMode=!1,App.toEditMode()),Message.hide()),u.repeatedQueue=0,e.responseText&&t.handleResponse(e.responseText),t.setResponseHeaders(e.getAllResponseHeaders()),this._postRequest(),u.pendingCode&&(u.pendingCode(),u.pendingCode=null)},requestFailure:function(e){if(this.requestQueue.first().saveResponseDelay(),408===e.status||e.status>12e3)return this.requestTimeout(e,"requestFailure");if(this.requestQueue.first().ignorable())return this._postRequest();var t="",n="";"undefined"!==typeof e.request&&e.request&&e.request&&(t=e.request.url,n=e.request.body);var i={url:t,body:n,statusText:e.status,responseText:e.responseText};MM.error.reportMapException({message:"AJAX Request failure",details:i})},requestException:function(e,t){if(this.requestQueue.first().saveResponseDelay(),this.requestQueue.first().ignorable())return this._postRequest();var n=e.transport,i="",o="";"undefined"!==typeof n.request&&n.request&&n.request&&(i=n.request.url,o=n.request.body);var s={url:i,body:o,statusText:n.status,responseText:n.responseText};MM.error.reportMapException({exception:t,message:"AJAX Request failure",details:s})},requestTimeout:function(e,t){if(t||(t="requestTimeout"),!this._leavingPage){var n=this.requestQueue.first(),i=this;n.saveResponseDelay(),u.repeatedQueue>=3&&u.networkIssues(),setTimeout((function(){u.repeatedQueue++,i.processQueue()}),1e4)}},initRequest:function(e){if(!App.config.persistent&&!App.config.liveUpdate)return this._postRequest();e.revision=tree.revision,this._preRequest(e),this.req_data={root:tree.root.id,rev:tree.revision,request_id:e.id,protocolVersion:u.protocolVersion,data:Object.toJSON(e.data)},new Ajax.Request(e.url,{requestHeaders:{Accept:"application/json"},parameters:this.req_data,timeoutDelay:u.timeoutDelay,onTimeOut:u._onRequestTimeout,onSuccess:u._onRequestSuccess,onFailure:u._onRequestFailure,onException:u._onRequestException})},processQueue:function(){this.isPending()&&setTimeout(function(){this.initRequest(this.requestQueue.first())}.bind(this),10)},queueRequest:function(e,t){t?this.requestQueue.unshift(e):this.requestQueue.add(e)},queueAndProcess:function(e){this.queueRequest(e),1===this.requestQueue.size()&&this.processQueue()},allQueuedDoRequests:function(){for(var e=this.requestQueue.toArray(),t=[],n=0,i=e.length;n<i;n++)e[n].constructor===h&&t.push(e[n]);return t},allImportantQueued:function(e){for(var t=this.allQueuedDoRequests(),n=[],i=0,o=t.length;i<o;i++)for(var s=t[i].data.changelists,r=0,a=s.length;r<a;r++)s[r].each((function(t){t.type===e&&n.push(t)}));return n},queuedDoRequest:function(){for(var e=this.requestQueue.toArray(),t=1,n=e.length;t<n;t++)if(e[t].constructor===h)return e[t];return null},isPending:function(){return!this.requestQueue.empty()},canQueueDoRequests:function(){var e=this.requestQueue.first(),t=!1;e&&(t=parseInt((new Date-new Date(e.timestamp))/1e3)>60);var n=this.queuedDoRequest(),i=n?n.countDos():0;return!u.networkProblem&&!t&&i<10},networkIssues:function(){Message.show(I18n.t("js.network_error",{v0:'<a href="#" onclick="MM.diagnostics.runDiagnostic(); return false">',v1:"</a>"}),Message.ERROR,-1),u.networkProblem=!0,App.config.editable&&(u.wasEditMode=!0,App.toViewMode())},fixQueuedChangesIds:function(e,t){for(var n=this.requestQueue.toArray(),i=[],o=1,s=n.length;o<s;o++)if(n[o].data){var r=n[o].data.changes||(n[o].data.changelists?n[o].data.changelists.flatten():null);r&&(i=i.concat(r))}for(o=0,s=i.length;o<s;o++){var a=i[o];a.idea_id==e&&(a.idea_id=t),a.new_data&&a.new_data.parent==e&&(a.new_data.parent=t),a.new_data&&a.new_data.from_id==e&&(a.new_data.from_id=t),a.new_data&&a.new_data.to_id==e&&(a.new_data.to_id=t),a.old_data&&a.old_data.from_id==e&&(a.old_data.from_id=t),a.old_data&&a.old_data.to_id==e&&(a.old_data.to_id=t)}},setPreference:function(e,t){var n={key:e,value:t};this.queueAndProcess(new d("/maps/save_map_preferences",n,null))},syncUndoRedo:function(){this.queueAndProcess(new d("/maps/undo_redo_status",null,this.handleSyncUndoRedo))},handleSyncUndoRedo:function(e){e.hasUndo?MM.ui.enableButton("btn_undo"):MM.ui.disableButton("btn_undo"),e.hasRedo?MM.ui.enableButton("btn_redo"):MM.ui.disableButton("btn_redo")},poll:function(){if(!u.isPending()){var e={};switch(mapView.hasMapFeature("selection")&&(e={idea_id:mapView.selected&&mapView.selected.node.id>0?mapView.selected.node.id:null,timestamp:this.timestamp}),App.config.shareMode){case App.SINGLE:if(!App.config.liveUpdate)return;e.with_data=!0,e.liveUpdate=!0,App.config.linkShare&&""!==App.config.linkShareToken&&(e.t=App.config.linkShareToken);break;case App.SHARED:break;case App.MULTI:if("undefined"!==typeof RevisionBrowser&&RevisionBrowser.on)return;"player"!==MM.utils.siteLocation.getLoc()&&(e.with_data=!0);break;default:return}if(!(e.with_data&&Math.round((new Date-this.lastRequestTime)/1e3)<5)){if("slideshow"===MM.utils.siteLocation.getLoc()&&(e.with_slides=1),"player"===MM.utils.siteLocation.getLoc()&&Presentation.on&&Presentation.presenter){var t=MM.utils.Url.getHashParams();if(t.hasOwnProperty("step")){var n=t.step;e.presentation_step=parseInt(n)}}this.queueAndProcess(new d("/maps/poll",e,this.handlePoll))}}},handlePoll:function(e){if(e.error)2===e.error.code?App.toSingleMode():4===e.error.code&&MM.utils.reloadPage();else{if(e.current_users&&users&&users.updateAfterPoll(e),e.changes&&e.changes.length>0&&(i.default.resetInterval(),u._checkQueuedChanges((function(){ChangeList.executeServerChanges(e.changes)}))),users&&users.updateUserSelection(),!mapView.hasMapFeature("presentation")||!e.slides||"undefined"===typeof App.ui.SlideShow||"undefined"!==typeof Presentation&&Presentation.on||App.ui.SlideShow.updateSlides(e.slides,e.updated_slides),e.drive_data&&(App.config.driveId=e.drive_data.gid,App.config.driveRevision=e.drive_data.drive_revision),e.chat&&e.chat.messages.map((function(e){o.default.receive(e)})),e.sharing){var t=e.sharing.link,n=t.linkShare,s=t.url,a=t.token;App.changeLinkSharing(n,s,a)}e.external_tasks&&e.external_tasks.each((function(e){var t=e.idea_id,n=r(e,["idea_id"]),i=tree.root.getChild(t);i&&i.__onSetProperty("externalTask",n)})),u.timestamp=e.timestamp}App.config.previousVisit=new Date},doChange:function(e){var t=new ChangeList;t.changes.push(e),this.doChanges(t)},doChanges:function(e){this.doChangelists([e])},doChangelists:function(e){i.default.resetInterval(),ChangeList.lastElasticChangeset&&ChangeList.lastElasticChangeset.changes.length>0&&(e.push(ChangeList.lastElasticChangeset),ChangeList.lastElasticChangeset=null);var t,n=[];if(t=this.queuedDoRequest())return t.append(e);for(var o=0;o<e.length;o++)n[o]=e[o].toJSON();var s={changelists:n};mapView.hasMapFeature("selection")&&mapView.selected&&(s=Object.extend(s,{idea_id:mapView.selected.node.id}));var r=new h("/maps/do",s,this.handleDoChanges.bind(this));r.changesets=e,this.queueAndProcess(r)},handleDoChanges:function(e){e.revision&&(tree.revision=e.revision),this._checkQueuedChanges((function(){var t=u.requestQueue.first(),n=t.changesets,i=[];if(e.changes&&e.changes.length>0&&(e.changes.each((function(e){n.each((function(t){t.changes.each((function(t){e.idea_id===t.change.idea_id&&i.push(t)}))}))})),i.each((function(e){e.undo("temporary")})),ChangeList.executeServerChanges(e.changes)),!e.error||10!==e.error.code&&11!==e.error.code){if(i.each((function(e){e.redo()})),e.changelists){for(var o=0,s=n.length;o<s;o++)e.changelists[o].error&&(n[o].undo(),10===e.changelists[o].error.code&&Message.show(e.changelists[o].error.message,Message.ERROR)),n[o].handleResponse(e.changelists[o]);App.config.shareMode!==App.MULTI&&0!==t.countDos()&&(MM.ui.enableButton("btn_undo"),MM.ui.disableButton("btn_redo"))}}else 10===e.error.code&&Message.show(e.error.message,Message.ERROR)}))},_checkQueuedChanges:function(e){for(var t=this.queuedDoRequest(),n=t?t.changesets:[],i=n.length-1;i>=0;i--)n[i].undo("temporary");e();for(i=0;i<n.length;i++)try{n[i].redo()||t.remove(n[i])}catch(o){t.remove(n[i])}ChangeList.autoLayoutChangeset()},copyExternal:function(e,t){t.each(function(t){this.queueAndProcess(new d("/maps/get_tree/"+t,null,this.handleCopyExternal.bind(this,e)))}.bind(this))},handleCopyExternal:function(e,t){t.changes?setTimeout((function(){Tree.utils.copyNodesExternal(tree.root.getChild(e),t.changes)}),10):t.error&&Message.show(t.error.message,Message.ERROR)},pasteAsMap:function(e,t,n,i){for(var o=new ChangeList,s=0,r=e.children.length;s<r;s++){var a=e.children[s];o.changes.push(new RemoveChange({idea_id:a.id,type:"Delete",new_data:{pos:a.pos}}))}var l="?preserve_permissions="+!!n+"&insert_back_link="+!!i;this.queueAndProcess(new d("/maps/paste_as_map/"+e.id+l,{},this.handlePasteAsMap.bind(this,o,t,e)))},handlePasteAsMap:function(e,t,n,i){if(i.error)Message.show(i.error.message,Message.ERROR);else if(i.location)window.location.href=i.location;else if(i.root_id){if(t){var o="topic:".concat(i.root_id);e.changes.push(Tree.utils.setPropertyChange("link",o,n)),Tree.utils.setLinkedMapPreview([n],o)}tree.notPainted=!0,e.changes.each((function(t,n){n===e.changes.length-1&&(tree.notPainted=!1),t.executeLocally()})),u.doChanges(e)}},toggleClosed:function(e){ChangeList.lastElasticChangeset&&(e.changes=ChangeList.lastElasticChangeset.toJSON(),ChangeList.lastElasticChangeset=null),this.queueAndProcess(new d("/maps/toggle_closed",e,null))},undo:function(){this.queueAndProcess(new d("/maps/undo",{},this.handleUndo.bind(this)))},handleUndo:function(e){if(e.error)switch(e.error.code){case 3:App.toMultiMode();break;case 10:Message.show(e.error.message,Message.ERROR),MM.ui.disableButton("btn_undo")}else App.config.shareMode!==App.MULTI&&(e.hasUndo?MM.ui.enableButton("btn_undo"):MM.ui.disableButton("btn_undo"),MM.ui.enableButton("btn_redo"),ChangeList.executeServerChanges(e.changes),ChangeList.autoLayoutChangeset(),ChangeList.lastElasticChangeset&&ChangeList.lastElasticChangeset.changes.length>0&&(this.doChanges(ChangeList.lastElasticChangeset),ChangeList.lastElasticChangeset=null))},redo:function(){this.queueAndProcess(new d("/maps/redo",{},this.handleRedo.bind(this)))},handleRedo:function(e){if(e.error)switch(e.error.code){case 3:App.toMultiMode();break;case 10:Message.show(e.error.message,Message.ERROR),MM.ui.disableButton("btn_redo")}else App.config.shareMode!==App.MULTI&&(e.hasRedo?MM.ui.enableButton("btn_redo"):MM.ui.disableButton("btn_redo"),MM.ui.enableButton("btn_undo"),ChangeList.executeServerChanges(e.changes),ChangeList.autoLayoutChangeset(),ChangeList.lastElasticChangeset&&ChangeList.lastElasticChangeset.changes.length>0&&(this.doChanges(ChangeList.lastElasticChangeset),ChangeList.lastElasticChangeset=null))},historyRevert:function(e){this.queueAndProcess(new d("/maps/revert",{revision:e},this.handleHistoryRevert))},handleHistoryRevert:function(e){e.error?10==e.error.code&&Message.show(e.error.message,Message.ERROR):(MM.ui.disableButton("btn_redo"),"undefined"!==typeof RevisionBrowser&&RevisionBrowser&&RevisionBrowser.revision===e.revision||ChangeList.executeServerChanges(e.changes),"undefined"!==typeof sideBar&&sideBar&&e.changes.filter((function(e){return"MapTheme"===e.type})).length>0&&(sideBar.styles.load(),sideBar.boundaries.load()),RevisionBrowser.changes=null)},cloneRevision:function(e){this.queueAndProcess(new d("/maps/clone_revision",{revision:e}))},autoNote:function(e,t){this.queueAndProcess(new d("/maps/auto_note",e,t))},setTaskNotify:function(e,t){this.queueAndProcess(new d("/maps/set_task_notify",{idea_id:e,value:t},this.handleTaskNotify))},handleTaskNotify:function(e){e.error&&Message.show(e.error.message,Message.ERROR)},other:{saveExternalChanges:function(e){new Ajax.Request("/external/save",{asynchronous:!0,parameters:{map_id:App.config.map_id,api_key:App.config.api_key},onSuccess:function(e){var t=e.responseText.evalJSON();Message.show(I18n.t("js.external_save_successful"),Message.INFO),App.config.externalMapRevision=t.map.revision},onFailure:function(e){var t=e.responseText.evalJSON().message||I18n.t("js.external_save_failed");Message.show(t,Message.ERROR)},onComplete:function(){e&&e()}})},saveBoxFile:function(e){new Ajax.Request("/external/box/save/"+e,{asynchronous:!0,onSuccess:function(e){var t=e.responseText.evalJSON();t.error?Message.show(t.error,Message.ERROR):(Message.show(I18n.t("js.external_save_successful"),Message.INFO),App.config.externalMapRevision=t.map.revision)},onFailure:function(e){var t=e.responseText.evalJSON().message||I18n.t("js.external_save_failed");Message.show(t,Message.ERROR)}})},saveExternalMap:function(){!ServerData.isLoggedIn||ServerData.user.isAnonymous?MM.utils.redirectToLogin():Message.show("The map is saved to your account.",Message.NOTICE)},getMapDiff:function(e,t,n){new Ajax.Request("/maps/get_map_diff/"+e,{parameters:t,onSuccess:function(e){try{n(e.responseText.evalJSON().changes)}catch(i){MM.error.reportException({exception:i,message:"History changes initialization failed",metaData:{params:t}})}}})}}};u.initialize(),u.uncommittedChanges=function(){var e=u.allImportantQueued("Insert"),t=u.allImportantQueued("Note"),n='<textarea style="width: 100%;" rows="11" cols="48" readonly="readonly">'+(e.length>0?I18n.t("js.new_topics")+":\n----------------\n"+e.map((function(e){return e.new_data.title})).join("\n")+"\n\n":"")+(t.length>0?I18n.t("js.new_notes")+":\n----------------\n"+t.map((function(e){return e.new_data.note})).join("\n"):"")+"\n\n</textarea>";(e.length>0||t.length>0)&&Dialog.alert("<div><h2>"+I18n.t("js.error_committing_changes")+'</h2><p class="warning small text subtle">'+I18n.t("js.error_committing_changes_text")+'</p></div><div style="margin-top: 20px;">'+n+"</div>",{okLabel:I18n.t("js.close"),buttonClass:"button default",windowParameters:{width:480,height:400}})},window.onbeforeunload=function(){return"undefined"!==typeof ChangeList&&u.isPending()&&u.queuedDoRequest()&&!u.forcedPageReload?(setTimeout(u.uncommittedChanges,1e3),I18n.t("js.confirm_leave_page")+" "+I18n.t("js.confirm_leave_page_extra")):"external"===App.config.viewMode&&tree.revision!==App.config.externalMapRevision?I18n.t("js.confirm_leave_page_for_external"):App.googleDrive()&&App.config.driveRevision<tree.revision?I18n.t("js.confirm_leave_page_for_gdrive"):("undefined"!==typeof Presentation&&Presentation.on&&Presentation.presenter&&Presentation.togglePresenter(!0),void(u._leavingPage=!0))},window.IgnorableRequests=l,window.SilentRequests=c,window.DoRequest=h,window.ServerConnection=u},hwfg:function(e,t,n){"use strict";n.r(t);var i=n("+29S"),o=n("qgXT"),s=n("WXko"),r=n("PiLb"),a=function(e,t,n){t.remove();var i=new Element("img",{src:n.src,className:"w-150px h-auto"});e.parent.insert(i),e.sizeAndPosition()},l={on:!1,presenter:!1,viewer:!1,togglePresenter:function(e){this.on?ServerData.isLoggedIn?new Ajax.Request("/presentation/present/",{asynchronous:!e,parameters:{map_id:App.config.map_id,presenter:"off"},onSuccess:function(e){e.responseText.evalJSON().error||l.onRemotePresenterEnd()}}):this.onRemotePresenterEnd():(App.config.shareMode===App.MULTI?Dialog.confirm("<h2>".concat(I18n.t("js.broadcast_presentation"),"</h2><p>").concat(I18n.t("js.broadcast_presentation_text"),"</p>"),{buttonClass:"button",okLabel:I18n.t("js.si"),cancelLabel:I18n.t("js.njet"),ok:this.startPresenterShared.bind(this,e),cancel:this.startPresenterSingle.bind(this),windowParameters:{height:100,width:360}}):this.startPresenterSingle(),Amplitude.logEvent("play_slideshow"),App.trigger(CustomEvents.PRESENTATION_STARTED))},startPresenterSingle:function(){this.on=!0,this.presenter=!1,this.viewer=!1,Dialog.closeInfo(),l.Slideshow.play({editable:!0,toolbar:["player","slideshow"].include(MM.utils.siteLocation.getLoc())?"slideshow":null,startAt:"undefined"===typeof App.ui.SlideShow?null:App.ui.SlideShow.selectedSlide})},startPresenterShared:function(e){Dialog.closeInfo();var t=null;"undefined"!==typeof App.ui.SlideShow&&App.ui.SlideShow.list&&App.ui.SlideShow.list.first&&(t=App.ui.SlideShow.list.indexOf(App.ui.SlideShow.selectedSlide)),new Ajax.Request("/presentation/present/",{asynchronous:!e,parameters:{map_id:App.config.map_id,presenter:"on",presentation_step:t},onSuccess:function(e){e.responseText.evalJSON().error||(i.default.resetInterval(),l.onRemotePresenterStart())}})},onRemotePresenterStart:function(){this.on=!0,this.presenter=!0,this.viewer=!1,l.Slideshow.play({editable:!0,toolbar:["player","slideshow"].include(MM.utils.siteLocation.getLoc())?"slideshow":null,startAt:"undefined"===typeof App.ui.SlideShow?null:App.ui.SlideShow.selectedSlide})},onRemotePresenterEnd:function(){this.on=!1,this.presenter=!1},toggleViewer:function(e){if(this.presenter=!1,this.on)this.on=!1,this.viewer=!1,Message.hideSticky(),App.player.exit();else{this.on=!0,this.viewer=!0,e||(e=users.currentUsers.find((function(e){return e.presenter}))),i.default.resetInterval(),l.Slideshow.play({editable:!1,toolbar:["player","slideshow"].include(MM.utils.siteLocation.getLoc())?"slideshow":null,startAt:e.presentation_step,onEnd:this.updateViewerMode.bind(this,e)});var t='<div row><div id="btn_toggleslideshow" class="icon-svg mh-20" data-icon="presentation-mode" data-color="blue" data-size="24"></div><div class="content" style="padding: 10px 20px">'+I18n.t("js.presentation_by",{v0:e.name})+"</div></div>";Message.showSticky(t)}},updateViewerMode:function(e){if(this.on&&!this.presenter&&"undefined"!==typeof App.player){e&&"undefined"!==typeof e||(e=users.currentUsers.find((function(e){return e.presenter})));var t=e.presentation_step,n=MM.utils.Url.getHashParams();if(n.hasOwnProperty("step"))var i=n.step;t!=i&&(App.player.gotoStep(t),MM.ui.Notification.show({title:I18n.t("js.new_presentation_slide"),type:"title"}))}}};l.Slideshow={previews:[],getSlides:function(e){new Ajax.Request("/presentation/slides",{asynchronous:!1,parameters:{map_id:App.config.map_id},onSuccess:function(t){try{var n=t.responseText.evalJSON();n.error?e.onFailure&&e.onFailure():this.buildSlidesList(n.slides,e.onSuccess,e)}catch(i){e.onFailure&&e.onFailure()}}.bind(this),onFailure:function(){e.onFailure&&e.onFailure()}.bind(null)})},buildSlidesList:function(e,t,n){var i=new s.a.Doubly;e.each(function(e){var t={id:e.id,position:e.position,nodes:e.nodes.map((function(e){return tree.root.getChild(e.id)})),padding:e.padding,transition:e.transition};n.ui?i.insertEnd(new App.ui.VSlide(t)):i.insertEnd(new App.ui.Slide(t))}.bind(null)),t&&t(i)},initControls:function(){App.ui.PlayerControls.init(),l.Slideshow.showControls(null,"hidden"),l.Slideshow.controlEnter=function(){mm$("map_controls")._hovered=!0},l.Slideshow.controlLeave=function(){mm$("map_controls")._hovered=!1},Event.observe("map_controls","mouseenter",l.Slideshow.controlEnter),Event.observe("map_controls","mouseleave",l.Slideshow.controlLeave),mm$("presentation-bar-logo").onclick=o.a.exit.bind(o.a)},prepare:function(e){"public"!==App.config.viewMode&&"embedded"!==App.config.viewMode&&(UI.Registry.toggleMode("view"),App.config.currentlyEditable=!1),"embedded"===App.config.viewMode&&canvas.onRecenter(null,!1,!0),canvas.disableMobileFullScreen(),e||App.ui.SlideShow.init(App.ui.Footer.enable.bind(App.ui.Footer))},exit:function(){"undefined"!==typeof App.ui.SlideShow&&App.ui.SlideShow.teardown(),"undefined"!==typeof Selections&&(Selections.teardown(),canvas.setupSelections()),canvas.enableMobileFullScreen(),App.config.editable&&(App.config.currentlyEditable=!0,UI.Registry.toggleMode("edit"))},showControls:function(e,t){if(e){if(Event.stop(e),this.lastX==e.clientX||this.lastY==e.clientY)return;this.lastX=e.clientX,this.lastY=e.clientY}App.ui.PlayerControls.show(!0,t||"faded"),l.Slideshow.controlsTimeout=setTimeout(l.Slideshow.hideControls,4e3),Event.stopObserving(document,"mousemove",l.Slideshow.showControls)},hideControls:function(){mm$("map_controls")._hovered?l.Slideshow.showControls():(App.ui.PlayerControls.hide(!0,"faded"),Event.observe(document,"mousemove",l.Slideshow.showControls))},handleFullScreenChange:function(){setTimeout((function(){canvas.onRecenter(null,!1,!0)}),500)},play:function(e){o.a.enter({skipFullScreenCheck:!MM.ua.touchEvents(),onChange:this.handleFullScreenChange.bind(this),skipBrowserUI:MM.utils.Url.getHashParams().hasOwnProperty("player")||"public"===App.config.viewMode||"embedded"===App.config.viewMode,skipAppUI:!0}),(e=Object.extend({toolbar:null},e)).toolbar&&e.toolbar===App.ui.Footer.activeBar||App.ui.Footer.activeBar&&App.ui.Footer.hideBar(App.ui.Footer.activeBar,!0),"undefined"!==typeof App.ui.SlideShow&&App.ui.SlideShow.list&&App.ui.SlideShow.list.first?this.doPlay(e,App.ui.SlideShow.list):this.getSlides({ui:!1,onSuccess:this.doPlay.bind(this,e)})},doPlay:function(e,t){var i=this;l.Slideshow.prepare(!0),addClassName(canvas.el,"presentation_play"),canvas.disableMobileFullScreen();var s=App.ui.Zoom.getCurrentZoomIndex();canvas.root.eachChild((function(e){e.dcontent.el._title=e.dcontent.el.title,e.dcontent.el.title=""})),canvas.onResize(),users&&users.currentUsers&&users.currentUsers.each(function(e){if(e.idea_id){var t=tree.root.getChild(e.idea_id);t&&t._listener.unSelectByUser(e)}}.bind(null)),App.ui.Zoom.zoomTo(App.ui.Zoom.getZoomIndex(1),!1),n.e(221).then(n.bind(null,"rhwI")).then((function(){App.player=App.ui.Player(null,{onExit:function(){removeClassName(canvas.el,"presentation_play"),e.editable&&(App.ui.PlayerControls.hide(!0,"hidden"),clearTimeout(l.Slideshow.controlsTimeout),Event.stopObserving("map_controls","mouseenter",l.Slideshow.controlEnter),Event.stopObserving("map_controls","mouseleave",l.Slideshow.controlLeave),Event.stopObserving(document,"mousemove",l.Slideshow.showControls)),e.toolbar?MM.utils.siteLocation.setLoc(e.toolbar):(MM.utils.siteLocation.reset(),l.Slideshow.exit()),o.a.exit(),o.a.showAppUI(),canvas.closeTemporarilyOpen(),l.on?l.presenter?l.togglePresenter():l.viewer?(l.on=!1,l.viewer=!1):l.on=!1:canvas.enableMobileFullScreen(),t.each((function(e){e.onExitPlay()})),$("slideshow_steps").remove(),"undefined"!==typeof App.ui.SlideShow&&App.ui.SlideShow.keyMap&&App.ui.SlideShow.keyMap.enable(),App.ui.Zoom.zoomTo(s,!1),App.ui.Preview.popover&&CSS.set(App.ui.Preview.popover.parent,{transform:CSS.scale(1)}),canvas.root.eachChild((function(e){e.dcontent.el.title=e.dcontent.el._title})),i.previews.each((function(e){e.parent.remove(),e.destroy()})),i.previews=[],i.handleFullScreenChange(),App.trigger(CustomEvents.PRESENTATION_STOPPED)},width:MM.ui.page.width,height:MM.ui.page.height}),o.a.hideAppUI(),setTimeout((function(){"undefined"!==typeof App.ui.SlideShow&&App.ui.SlideShow.keyMap&&App.ui.SlideShow.keyMap.disable(),App.player.init(t,{startAt:e.startAt?e.startAt:t.first}),MM.utils.siteLocation.setLoc("player"),e.editable||App.ui.Player.keyMap.disable()}),1e3),i.buildSlideShowSteps(e,t),e.editable&&(mm$("map_controls")?l.Slideshow.initControls():new Ajax.Request("/toolbar/slideshow_play/"+App.config.map_id)),e.onEnd&&e.onEnd()}))},buildSlideShowSteps:function(e,t){var n=this,i=new Element("div",{id:"slideshow_steps"}),o=new Element("ul");i.appendChild(o),canvas.container.parentNode.appendChild(i);var s=canvas.getMapSizeAndOffset();t.each((function(t,i){var l=new Element("li",{id:"slideshow_step"+t.id});if(l.innerHTML=e.editable?'<a href="#" onclick="App.player.gotoStep('+(i+1)+'); return false;"></a>':'<a href="#" onclick="return false;"></a>',"embedded"!==App.config.viewMode){var c=new Element("div",{className:"w-150px p-r ta-center"}).insert(MM.ui.LoadingSpinner(32,{className:"h-iblock"})),d=new Element("div",{id:"popover_slidespreview_".concat(t.id),className:"popover",style:"display: none"}).insert(c);canvas.container.parentNode.appendChild(d);var h=new Popover("slidespreview_".concat(t.id),null,{opener:l,observeEvent:"mouseover"});r.a.add({image:{src:t.getPreviewImageSrc(s)},onLoad:a.bind(n,h,c)}),n.previews.push(h)}o.appendChild(l)}))}},t.default=l},hypo:function(e,t,n){var i=n("O0oS");e.exports=function(e,t,n){"__proto__"==t&&i?i(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},i5FV:function(e,t,n){"use strict";n.r(t);var i=n("PYYe"),o=n.n(i),s=Class.create({id:null,size:[null,null],createdAt:null,owner:null,locally_stored:!1,mm_default:!1,file_id:null,initialize:function(e){this.id=e.id||s.generateFakeId(),this.download_link=e.url,this.secure_download_link=e.secure_url,"phantomjs"===App.config.environment&&e.secure_url.indexOf("http")<0&&(this.secure_download_link=ServerData.siteUrl+e.secure_url),"phantomjs"===App.config.environment&&e.url.indexOf("http")<0&&(this.download_link=ServerData.siteUrl+e.url),this.local_path=e.local_path,this.size=e.size?[e.size.width,e.size.height]:null,this.createdAt=e.createdAt,this.owner=e.owner,this.locally_stored=e.locally_stored,this.mm_default=e.mm_default,this.def_linked=e.def_linked,this.picture_file_id=e.picture_file_id,this.drawn=!!e.drawn&&e.drawn,this.id>0&&(s.all[this.id]=this)},resize:function(e,t){for(var n=this.width()/this.height(),i=this.width(),o=this.height();i>e||o>t;)i>e?(i-=1,o=parseInt(i/n)):o>t&&(o-=1,i=parseInt(o*n));return[i,o]},width:function(){return this.size[0]},height:function(){return this.size[1]},url:function(){if(this.locally_stored){var e=this.download_link;return s.downloadTokens?e+=(e.indexOf("?")>0?"&":"?")+s.downloadTokens:App.config.linkShare&&""!==App.config.linkShareToken&&(e+=(e.indexOf("?")>0?"&":"?")+"t="+App.config.linkShareToken),e}return s.useSecureLink()?this.secure_download_link:this.download_link},equals:function(e){return this.id==e.id},isLinkedMapPreview:function(){return/\/image\/medium\/\d+\/.+\.png$/.test(this.download_link)}});s.default_images=[],s.user_images=[],s.all=[],s.get=function(e){return s.all[e]||null},s.createDummy=function(e,t){return!Object.isUndefined(t)&&t||(t=null),new s({id:s.generateFakeId(),picture_file_id:null,url:e,secure_url:"/images/download_url?url=".concat(o()(e)),size:t,createdAt:null,owner:null,locally_stored:!1,mm_default:!1})},s.initDefault=function(){if("undefined"!=typeof IMAGES)for(var e=0,t=IMAGES.length;e<t;e++)s.default_images.push(new s(IMAGES[e]))},s.generateFakeId=function(){return this._fakeId?--this._fakeId:this._fakeId=-1},s.useSecureLink=function(){return"https:"===document.location.protocol&&"phantomjs"!==App.config.environment},t.default=s},iLPW:function(e,t,n){"use strict";n.r(t);var i=n("3WX/"),o=n.n(i),s=n("6qam"),r=n.n(s),a=n("syde"),l=n("rJb1");function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=Class.create({root:null,notPainted:!0,readyForConnections:!1,finishedInitialization:!1,revision:null,uncommitedId:-1e3,nodes:null,default_title:"",initialize:function(e){this.revision=e,this.nodes={}},autoLayout:function(e){if(e||!ServerConnection.isPending()){var t=new ChangeList;t.doAutoLayoutingChanges(),ServerConnection.doChanges(t)}},autoCondense:function(){var e=new ChangeList;e.doAutoCondenseChanges(),ServerConnection.doChanges(e)},changeLayout:function(e){if(App.config.layout!==e){if(null!==App.config.layout.orientation&&!e.orientation&&canvas.root.children.length>1)if(App.config.layout.orientation===App.Layouts.orientation.left)for(var t=canvas.root.children.sort((function(e,t){return e.node.pos[1]-t.node.pos[1]})),n=parseInt(t.length/2),i=t.length;n<i;n++)t[n].node.pos[0]=50;else if(App.config.layout.orientation===App.Layouts.orientation.right)for(t=canvas.root.children.sort((function(e,t){return e.node.pos[1]-t.node.pos[1]})),n=0,i=parseInt(t.length/2);n<i;n++)t[n].node.pos[0]=-50;else if(App.config.layout.orientation===App.Layouts.orientation.down)for(n=0,i=(t=canvas.root.children.sort((function(e,t){return e.node.pos[0]-t.node.pos[0]}))).length;n<i;n++)t[n].node.pos[1]=t[n].node.pos[0];var o=new ChangeList,s=new MapPropertiesChange({idea_id:this.root.id,type:"MapProperties",old_data:{layout:App.config.layout.id},new_data:{layout:e.id}});o.changes.push(s),e===App.Layouts.Default?App.config.layout===App.Layouts.Aligned?(o.doAutoAlignedChanges(),s.execute()):(canvas.root.destroy(),canvas.destroy(),canvas.buildFromModel(),removeClassName(canvas.el,"layout_"+App.config.layout.name),App.config.layout=App.Layouts.Aligned,addClassName(canvas.el,"layout_"+App.config.layout.name),canvas.root.paint(),o.doAutoAlignedChanges(),s.execute()):(s.execute(),o.doAutoAlignedChanges()),ServerConnection.doChanges(o)}},postInit:function(){this.paint(),this.finishedInitialization=!0;var e=canvas.size;canvas.checkBounds(),canvas.size===e&&canvas.changeSize()},paint:function(){rectangleLayouter.updateAll(),this.readyForConnections=!0;for(var e=0,t=this.root._listener.children.length;e<t;e++)this.root._listener.children[e].rc.redrawConnections();rectangleLayouter.elasticLayoutingEnabled=!0},destroy:function(){this.root.destroy()},totalNodes:function(){var e=0;for(var t in this.nodes)this.nodes.hasOwnProperty(t)&&this.nodes[t]&&e++;return e},totalConnections:function(){var e=0;for(var t in this.nodes)this.nodes.hasOwnProperty(t)&&this.nodes[t]&&(e+=this.nodes[t].outgoing_connections.length);return e},getNodes:function(){return o()(this.nodes,r.a)}});d.utils={removeNodes:function(e){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var t=[];e.each((function(n){if(n.isRoot())Message.show(I18n.t("js.cant_delete_root_note"),Message.WARNING);else if(!n.getAncestors().find((function(t){return!t.isRoot()&&e.indexOf(t)>=0}))){n.isFloating()&&t.push(new IdeaPropertiesChange({idea_id:n.id,type:"IdeaProperties",new_data:{floating:!1},old_data:{floating:!0}})),n.eachChild((function(e){e.boundary&&t.push(new RemoveBoundaryChange({idea_id:e.id,type:"RemoveBoundary",old_data:e.boundary.toJSON()})),e.idea_video&&t.push(new RemoveVideoChange({idea_id:e.id,type:"RemoveVideo",old_data:e.idea_video.toJSON()})),e.comments.length>0&&e.comments.each((function(n){t.push(new RemoveCommentChange({idea_id:e.id,type:"RemoveComment",old_data:{idea_comment_id:n.id}}))})),e.votes.length>0&&e.votes.each((function(n){t.push(new RemoveVoteChange({idea_id:e.id,type:"RemoveVote",old_data:n.toJSON()}))}))}));var i=new RemoveChange({idea_id:n.id,type:"Delete"});t.push(i)}})),tree.notPainted=!0,t.each((function(e,n){n===t.length-1&&(tree.notPainted=!1),e.executeLocally()}));var n=new ChangeList;n.changes=t,ServerConnection.doChanges(n)}}else ServerConnection.networkIssues()},connect:function(e){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var t=new ChangeList;e.each((function(e){if(e.isRootC()&&e.isFloating()){var n=new IdeaPropertiesChange({idea_id:e.id,type:"IdeaProperties",new_data:{floating:!1},old_data:{floating:!0}});t.changes.push(n),n.executeLocally()}})),ServerConnection.doChanges(t)}}else ServerConnection.networkIssues()},disconnect:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];e.each((function(e){e.isRootC()||n.push(new MoveChange({idea_id:e.id,type:"Move",old_data:{parent:e.parent.id,rank:e.parent.rank(e),pos:e.pos},new_data:{parent:tree.root.id,rank:0,pos:t[e.id]}}));var i=d.utils.floatingNodeChange(e,!0);i&&n.push(i)})),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},sortTopicsBreadthFirst:function(e){if(e.length>1){var t=[];tree.root.doBreadthFirstTraversal((function(e){t.push(e)})),e.sort((function(e,n){return t.indexOf(e)-t.indexOf(n)}))}},moveNodes:function(e,t,n,i,o){if(!ServerConnection.canQueueDoRequests())return ServerConnection.networkIssues(),!1;if(!App.config.editable||!App.config.currentlyEditable)return!1;var s=[];this.sortTopicsBreadthFirst(e),e.each((function(i){if(!(i==t||t.getAncestors().indexOf(i)>=0))if(t.isRoot()&&i.isRootC())o&&s.push(new RepositionChange({idea_id:i.id,type:"Reposition",old_data:{pos:i.pos},new_data:{pos:o}}));else{var r=d.utils.floatingNodeChange(i,!1);r&&s.push(r);var a=i.parent==t&&i.parent.rank(i)<n?n-1:n;a+=e.indexOf(i),(i.parent!==t||i.parent===t&&i.parent.rank(i)!==a)&&s.push(new MoveChange({idea_id:i.id,type:"Move",old_data:{parent:i.parent.id,rank:i.parent.rank(i),pos:i.pos},new_data:{parent:t.id,rank:a,pos:o}}))}})),ChangeList.layoutAlteringChangeset(s)},floatingNodeChange:function(e,t){if(t!==e.isFloating())return new IdeaPropertiesChange({idea_id:e.id,type:"IdeaProperties",new_data:{floating:t}})},copyNodes:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];Object.isArray(t)||(t=[t]),this.sortTopicsBreadthFirst(e),t.each((function(t){e.each((function(e){e.eachChild((function(e,i){var o=--tree.uncommitedId;n.push(new InsertChange({idea_id:o,type:"Insert",new_data:{id:o,parent:i,title:e.title,closed:e.closed,style:e.style,icon:e.icons.map((function(e){return e.fullName()})).join(","),note:e.note,link:e.link,task:e.task}})),e.idea_image&&n.push(new AddImageChange({idea_id:o,type:"AddImage",new_data:{idea_image_id:e.idea_image.id},old_data:{idea_image_id:null}})),e.idea_video&&n.push(new AddVideoChange({idea_id:o,type:"AddVideo",new_data:e.idea_video.toJSON()}));for(var s=0,r=e.attachments.length;s<r;s++){var a=e.attachments[s];n.push(new AddAttachmentChange({idea_id:o,type:"AddAttachment",new_data:{attachment_id:a.id}}))}return e.isFloating()&&t.isRoot()&&n.push(new IdeaPropertiesChange({idea_id:o,type:"IdeaProperties",new_data:{floating:!0}})),e.boundary&&n.push(new AddBoundaryChange({idea_id:o,type:"AddBoundary",new_data:e.boundary.toJSON()})),o}),t.id)}))})),ChangeList.layoutAlteringChangeset(n);var i=new ChangeList;i.doAutoAlignedChanges("NonPersistentReposition"),ServerConnection.doChanges(i)}}else ServerConnection.networkIssues()},addChildrenAsTree:function(e){var t=[];e.each((function(e){var n=e.title.escapeHTML();e.id>0?t.push(new RenameChange({idea_id:e.id,type:"Title",new_data:{title:n}})):t.push(new InsertChange({idea_id:e.id,type:"Insert",new_data:{id:e.id,parent:e.parent,title:n,style:null}}))})),ChangeList.layoutAlteringChangeset(t)},copyNodesExternal:function(e,t){if(App.config.editable&&App.config.currentlyEditable){t[0].new_data.parent=e.id,e.isRoot()&&(t[0].new_data.pos=null);for(var n=[],i=0,o=t.length;i<o;i++){var s=t[i];if("AddConnection"!==s.type){s.new_data.rank&&(s.new_data.rank=null);for(var r=--tree.uncommitedId,a=0,l=t.length;a<l;a++){var c=t[a];c.new_data.parent===s.new_data.id&&(c.new_data.parent=r),c.idea_id===s.new_data.id&&(c.idea_id=r)}n=n.concat(InsertChange.toChangeArray(s,r))}}ChangeList.layoutAlteringChangeset(n)}},setIconChange:function(e,t){var n=t.icons.map((function(e){return e.fullName()})).join(","),i=t.icons;e.each((function(e){var t=null;e.group()&&(t=i.detect((function(t){return t.group()===e.group()}))),t?i[i.indexOf(t)]=e:i.push(e)}));for(var o=(i=Icon.compactAndOrder(i)).map((function(e){return e.fullName()})).join(",");o.length>255;){var s=i.detect((function(t){return e.indexOf(t)<0}));if(!s)return null;o=(i=i.without(s)).map((function(e){return e.fullName()})).join(",")}return o!=n?new IconChange({idea_id:t.id,type:"Icon",old_data:{icon:n},new_data:{icon:o}}):null},setIcon:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each(function(t){var i=this.setIconChange([e],t);i&&n.push(i)}.bind(this)),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},removeIconChange:function(e,t){var n=t.icons.map((function(e){return e.fullName()})).join(","),i=t.icons;e.each((function(e){i=i.without(e)}));var o=i.map((function(e){return e.fullName()})).join(",");return o!=n?new IconChange({idea_id:t.id,type:"Icon",old_data:{icon:n},new_data:{icon:o}}):null},removeIcon:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each(function(t){var i=null;if("undefined"===typeof e){var o=t.icons.last();o&&(i=this.removeIconChange([o],t))}else i=this.removeIconChange([e],t);i&&n.push(i)}.bind(this)),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},removeIconGroup:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each(function(t){var i=t.icons.detect((function(t){return t.group()===e}));i&&n.push(this.removeIconChange([i],t))}.bind(this)),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},setStyle:function(e,t,n){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var i=[],o=canvas.selected.node.currentStyle();if("toggle"===t)t=!o[e];else if("fontSize"===e&&[-1,1].indexOf(t)>=0){var s=o.fontSize,r=[100,120,150],a=r.indexOf(s)+t;a<0&&(a=0),a>=r.length&&(a=r.length-1),t=r[a]}n.each((function(n){var o=n.currentStyle();o[e]=t,i.push(new TextStyleChange({idea_id:n.id,type:"TextStyle",new_data:{style:o.toJSON()},old_data:{style:n.style?n.style.toJSON():null}}))})),ChangeList.layoutAlteringChangeset(i)}}else ServerConnection.networkIssues()},setFullStyle:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each((function(t){!e||e.equals(t.defaultStyle())?t.style&&n.push(new TextStyleChange({idea_id:t.id,type:"TextStyle",new_data:{style:null},old_data:{style:t.style.toJSON()}})):t.style&&t.style.equals(e)||n.push(new TextStyleChange({idea_id:t.id,type:"TextStyle",new_data:{style:e.toJSON()},old_data:{style:t.style?t.style.toJSON():null}}))})),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},setProperty:function(e,t,n){var i=this;if(App.config.editable&&App.config.currentlyEditable){if("note"===e&&t.length>65e3)return Message.show(I18n.t("js.note_is_too_long"),Message.ERROR,5);if(ServerConnection.canQueueDoRequests()){var o=[];n.each((function(n){o.push(i.setPropertyChange(e,t,n))})),ChangeList.layoutAlteringChangeset(o),"link"===e&&0===t.indexOf("topic:")&&this.setLinkedMapPreview(n,t)}else ServerConnection.networkIssues()}},setPropertyChange:function(e,t,n){var i={idea_id:n.id,type:e.capitalize(),old_data:c({},e,n[e]),new_data:c({},e,t)};return new(window["".concat(i.type,"Change")])(i)},setLinkedMapPreview:function(e,t){l.a.get("topic_link_preview",(function(n){if(n&&n.value){var i=[];e.each((function(e){var n=e.id,o=e.idea_image,s=e.idea_video,r=t.replace(/[^\d]/g,"");s||o&&!o.isLinkedMapPreview()||tree.root.getChild(r)?o&&o.isLinkedMapPreview()&&i.push(new RemoveImageChange({idea_id:n,type:"RemoveImage",old_data:{idea_image_id:o.id}})):i.push(new AddImageChange({idea_id:n,type:"AddImage",new_data:{idea_image_id:-1,topic_id:r},old_data:{idea_image_id:o?o.id:null}}))})),ChangeList.layoutAlteringChangeset(i)}}))},setTask:function(e){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){App.trigger(CustomEvents.TASK_ADDED);var t=new ChangeList;e.each(function(e){var n,i=e.node,o=e.task,s=[],r=[];o&&"undefined"!=typeof o.complete&&o.complete>-1?s.push(Icon.fromFullName(a.TASK.complete[o.complete])):(n=i.icons.detect((function(e){return"task"===e.group()})))&&r.push(n);o&&"undefined"!=typeof o.priority&&o.priority>-1?s.push(Icon.fromFullName(a.TASK.priority[o.priority])):(n=i.icons.detect((function(e){return"priority"===e.group()})))&&r.push(n);s.length>0&&((c=this.setIconChange(s,i))&&t.changes.push(c));r.length>0&&((c=this.removeIconChange(r,i))&&t.changes.push(c));if(i.task!=o){var l={idea_id:i.id,type:"Task",old_data:{},new_data:{}};l.old_data.task=i.task,l.new_data.task=o;var c=new TaskChange(l);t.changes.push(c)}}.bind(this)),t.changes.size()>0&&(t.execute(),ServerConnection.doChanges(t))}}else ServerConnection.networkIssues()},removeTask:function(e){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var t=new ChangeList,n=[];e.each(function(e){var i=[],o=e.icons.detect((function(e){return"task"===e.group()}));o&&i.push(o);var s=e.icons.detect((function(e){return"priority"===e.group()}));(s&&i.push(s),i.length>0)&&((a=this.removeIconChange(i,e))&&t.changes.push(a));if(e.task&&(e.task.from||e.task.due||e.task.effort||e.task.resource)){var r={idea_id:e.id,type:"Task",old_data:{},new_data:{}};r.old_data.task=e.task,r.new_data.task=null;var a=new TaskChange(r);t.changes.push(a),e.task.from=null,e.task.due=null,e.task.resource=null,e.task.effort=null}e.externalTask&&n.push(e)}.bind(this)),t.changes.length>0&&(t.execute(),ServerConnection.doChanges(t))}}else ServerConnection.networkIssues()},getTextOutline:function(e,t){var n="",i=e.depth();return e.eachChild((function(e){if(t)for(var o=0;o<e.depth()-i;o++)n+="\t";n+=e.title.replace(/\n/g," ").replace(/\r/g," ")+"\n"})),n},setImage:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each((function(t){tree.root.getChild(t.id)&&(n.push(new AddImageChange({idea_id:t.id,type:"AddImage",new_data:{idea_image_id:e.id,details:{url:e.download_link,size:[e.width(),e.height()]}},old_data:{idea_image_id:t.idea_image?t.idea_image.id:null}})),t.idea_video&&n.push(new RemoveVideoChange({idea_id:t.id,type:"RemoveVideo",old_data:t.idea_video.toJSON()})))})),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},removeImage:function(e){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var t=[];e.each((function(e){tree.root.getChild(e.id)&&e.idea_image&&t.push(new RemoveImageChange({idea_id:e.id,type:"RemoveImage",old_data:{idea_image_id:e.idea_image.id}}))})),t.length>0?ChangeList.layoutAlteringChangeset(t):Message.show(I18n.t("js.node_has_no_image"),Message.NOTICE)}}else ServerConnection.networkIssues()},setVideo:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each((function(t){t.idea_video&&e?n.push(new EditVideoChange({idea_id:t.id,type:"EditVideo",new_data:e.toJSON(),old_data:t.idea_video.toJSON()})):t.idea_video&&!e?n.push(new RemoveVideoChange({idea_id:t.id,type:"RemoveVideo",old_data:t.idea_video.toJSON()})):e&&(t.idea_image&&n.push(new RemoveImageChange({idea_id:t.id,type:"RemoveImage",old_data:{idea_image_id:t.idea_image.id}})),n.push(new AddVideoChange({idea_id:t.id,type:"AddVideo",new_data:e.toJSON()})))})),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},setVote:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=IdeaVote.get(canvas.selected.node,users.selfUser.id),i=n&&n.vote===e,o=[];t.each((function(t){var n=IdeaVote.get(t,users.selfUser.id),s=new IdeaVote({idea_id:t.id,vote:e,user_id:users.selfUser.id,voted_at:new Date});(t===canvas.selected.node||t!==canvas.selected.node&&(n&&n.vote!==e||!n||i))&&(n?e===n.vote||i?o.push(new RemoveVoteChange({idea_id:t.id,type:"RemoveVote",old_data:s.toJSON()})):o.push(new EditVoteChange({idea_id:t.id,type:"EditVote",new_data:s.toJSON()})):o.push(new AddVoteChange({idea_id:t.id,type:"AddVote",new_data:s.toJSON()})))})),ChangeList.layoutAlteringChangeset(o)}}else ServerConnection.networkIssues()},setBoundary:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each((function(t){t.boundary&&e?t.boundary.style.equals(e)||n.push(new EditBoundaryChange({idea_id:t.id,type:"EditBoundary",new_data:e.toJSON(),old_data:t.boundary.toJSON()})):t.boundary&&!e?n.push(new RemoveBoundaryChange({idea_id:t.id,type:"RemoveBoundary",old_data:t.boundary.toJSON()})):e&&n.push(new AddBoundaryChange({idea_id:t.id,type:"AddBoundary",new_data:e.toJSON()}))})),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()},addAttachments:function(e,t){if(ServerConnection.canQueueDoRequests()){if(App.config.editable&&App.config.currentlyEditable){var n=[];t.each((function(t){tree.root.getChild(t.id)&&e.each((function(e){n.push(new AddAttachmentChange({idea_id:t.id,type:"AddAttachment",new_data:{attachment_id:e.id}}))}))})),ChangeList.layoutAlteringChangeset(n)}}else ServerConnection.networkIssues()}},t.default=d},iX0B:function(e,t,n){"use strict";n.r(t),function(e,t){var i=n("PYYe"),o=n.n(i),s=n("sEfC"),r=n.n(s),a=n("vpdt"),l=n("TFUZ"),c=n("P5KB"),d=function(e,t){if(!t)return IdeaVote.NONE;var n=IdeaVote.get(e,t.id);return n?n.vote:IdeaVote.NONE};App.ui.Preview={show:function(e,t){var n=this;if(!this.popover||!this.popover.visible){this.clearTimer(e);var i={type:t,alignElement:mm$("".concat(e.node.id,"_").concat(t))};switch(t){case"note":e.node.note.stripHTML().length>250&&MM.ui.page.height>600&&(i.klass="large"),this.doShow('<div class="note_content">'.concat(e.node.note,"</div>"),i),this.popover.parent.select("a").each((function(e){e.setAttribute("target","_blank"),e.onclick=n.doHide.bind(n)}));break;case"task":var o="-";if(e.node.task.effort){o=parseInt(e.node.task.effort);var s=e.node.task.effort.sub(o.toString(),"");o+=" "+I18n.t("js.helper_"+s)}var r="-";if(e.node.task.complete>=0){var a=e.node.icons.detect((function(e){return"task"===e.group()}));a&&(r=a.getTitle())}this.doShow("<h3>"+I18n.t("js.task_information")+'</h3><p class="first" style="margin-top:1em"><label class="mr-5">'+I18n.t("js.priority")+":</label>"+(e.node.task.priority>=0?e.node.task.priority+1:"-")+'</p><p><label class="mr-5">'+I18n.t("js.complete")+":</label>"+r+'</p><p><label class="mr-5">'+I18n.t("js.start_date")+"</label>"+(e.node.task.from?Date.fromUTC(e.node.task.toString("from")).toUIString(!0):"-")+'</p><p><label class="mr-5">'+I18n.t("js.due_date")+"</label>"+(e.node.task.due?Date.fromUTC(e.node.task.toString("due")).toUIString(!0):"-")+'</p><p><label class="mr-5">'+I18n.t("js.duration")+":</label>"+o+'</p><p><label class="mr-5">'+I18n.t("js.assigned_to")+"</label>"+e.node.task.toString("resource").escapeHTML()+"</p>",i);break;case"link":this._link(e,i);break;case"attachments":this._attachments(e,i);break;case"comments":this._comments(e,i);break;case"votes":this._votes(e,i)}}},initPopover:function(t){var n=this;if(!this.popover){var i=new Element("div",{id:"popover_extras",style:"display:none;"}).insert(new Element("div",{id:"msg_popup"}));document.body.insert(i),this.onMouseMoveListener=r()(this.onMove.bindAsEventListener(this),750),this.popover=new Popover("extras",null,{observeEvent:"none",closeOnSelect:!1,onShow:function(){return document.observe("mouseover",n.onMouseMoveListener)},onClose:function(){return document.stopObserving("mouseover",n.onMouseMoveListener)},onHide:function(){n.mounted&&e.unmountComponentAtNode(mm$("msg_popup")),n.mounted=!1}})}this.popover.parent.className="popover "+t.type,this.popover.opener=t.alignElement,t.klass&&addClassName(this.popover.parent,t.klass)},openPopover:function(){this.popover.show(),Presentation.on?(CSS.set(this.popover.parent,{transform:CSS.scale(MM.ui.getZoomScale(this.popover.parent.getDimensions(),{minScale:1,maxScale:5,paddingX:20,paddingY:20}))}),MM.ui.centerAndShow(this.popover.parent)):canvas.scrollToElement(this.popover.opener)},doShow:function(e,t){this.initPopover(t),mm$("msg_popup").innerHTML="",t.ajaxUrl?new Ajax.Updater("msg_popup",t.ajaxUrl,{asynchronous:!0,evalScripts:!0,onComplete:this.openPopover.bind(this)}):(mm$("msg_popup").innerHTML=e,this.openPopover())},doHide:function(){this.popover&&Element.visible(this.popover.parent)&&this.popover.close()},onHover:function(e,t){Presentation.on||(e._linktimeout=setTimeout(function(){this.show(e,t)}.bind(this),1e3))},onMove:function(e){var t=Event.element(e);this.popover.parent.contains(t)||this.popover.opener.contains(t)||this.doHide()},clearTimer:function(e){e._linktimeout&&(clearTimeout(e._linktimeout),e._linktimeout=null)},_link:function(e,t){var n=e.node.getLinkObj();switch(n.type){case"url":this.doShow("<h3>"+I18n.t("js.external_link")+'</h3><a rel="'+e.node.getLinkRel({link:e.node.link})+'" href="'+o()(e.node.link)+'" onclick="App.ui.Preview.doHide(); return true;" target="_blank" class="ta-center w-160 ellipsis">'+o()(e.node.link)+"</a>",t);break;case"email":this.doShow("<h3>"+I18n.t("js.email_link")+'</h3><a href="'+o()(e.node.link)+'" onclick="App.ui.Preview.doHide();"  class="ta-center w-180 ellipsis">'+o()(e.node.link).substring(7)+"</a>",t);break;case"topic":var i=mm$(n.link);if(i)this.doShow("<h3>"+I18n.t("js.link_to_topic")+'</h3><p><a href="#" class="map" onclick="mm$(\''+e.node.id+"')._listener.scrollToLinkTarget(mm$('"+n.link+"'));return false;\">"+i._listener.node.title.unescapeHTML().substring(0,28)+"</a></p><p>["+I18n.t("js.in_this_map")+"]</p>",t);else{var s="/dialog/get_topic_ajax/"+n.link+"?source_id="+e.node.id+("public"===App.config.viewMode?"&public=true":"")+(App.config.is_embedded?"&embedded=true&width="+App.config.embedWidth+"&height="+App.config.embedHeight+"&zoom="+App.config.zoomFactor:"");this.doShow("",Object.extend(t,{ajaxUrl:s}))}}},_attachments:function(e,t){var n="<h3>"+I18n.t("js.attachments")+"</h3>";if(App.config.showRevisions)n+="<ul>",e.node.attachments.each((function(e){n+="<li>"+e.filename.truncate(18)+" "+e.size.toHumanSize(1)+"</li>"})),n+="</ul>";else if(1==e.node.attachments.length&&e.node.attachments[0].isImage()){var i=e.node.attachments[0],o="tn_"+e.node.id;n+='<div align="center"><a href="'+i.downloadLink()+'" onclick="App.ui.Preview.showPopup('+i.id+", "+e.node.id+'); return false;" class="thumbnail" id="'+o+'" title="'+i.filename+'"><span style="background-image:url('+i.downloadLink()+(Presentation.on?"":"&thumb=true")+');"></span><a href="'+i.downloadLink()+'" onclick="App.ui.Preview.showPopup('+i.id+", "+e.node.id+'); return false;" class="inline">'+i.filename.truncate(18)+"</a> - "+i.size.toHumanSize(1)+"</div>",setTimeout('mm$("'+o+'").style.backgroundImage = "none"',i.loaded?10:1500),i.loaded=!0}else n+="<ul>",e.node.attachments.each((function(t){n+="<li>",n+='<a href="#" onclick="App.ui.Preview.showPopup('+t.id+", "+e.node.id+'); return false;" title="'+t.filename+" ("+t.size.toHumanSize(1)+')">'+t.filename.truncate(18)+"</a> - "+t.size.toHumanSize(1),n+="</li>"})),n+="</ul>";this.doShow(n,t)},_comments:function(e,t){var n=a.default.sort(e.node.comments),i=n.length-2,o="";n.slice(i,n.length).reverse().each((function(e){e.read=!0,o+='<row><cell class="w-40px">'+e.user.getAvatar("medium")+'</cell><cell><div row class="comment_date">'+e.createdAt.ago(!0)+(e.isEdited()?'<span class="ml-5" title="'+I18n.t("js.edited")+": "+e.updatedAt.ago(!0)+'">'+MM.ui.icon({name:"pen",size:8,color:"grey500",clickable:!1})+"</span>":"")+"</div><p>"+I18n.t("js.said",{v0:e.user.displayname})+'</p><div class="comment" style="height: auto;">'+EmojiArea.getHTMLContent(e.text)+"</div></cell></row>"})),o+='<div class="text-right">',App.config.editable&&"edit"===UI.Registry.mode&&sideBar&&sideBar.comments&&(o+='<a href="#" onclick="tree.root.getChild('+e.node.id+')._listener.select(); sideBar.show(true, true); sideBar.comments.expand({ savePreference: true }); return false;" style="text-decoration: underline">'+(i>0?I18n.t("js.more_d",{v0:i}):I18n.t("js.expand"))+"</a>"),o+="</div>",e.node._listener.__onSetProperty("comments",!0),this.doShow(o,t)},_votes:function(n,i){this.initPopover(i),function n(i){var o=i.node.votes,s=IdeaVote.getByVote(i.node,IdeaVote.UP);e.render(t.createElement(c.a,{votes:o,upVotes:s,downVotes:o.length-s.length,userVote:d(i.node,users.selfUser),editable:App.config.editable&&"edit"===UI.Registry.mode&&sideBar&&sideBar.comments,onVote:function(e,t){i.select(),sideBar.comments.onVote(e,t),setTimeout((function(){return n(i)}),0)},onExpand:function(){i.select(),sideBar.show(!0,!0),sideBar.comments.expand({savePreference:!0})}}),mm$("msg_popup"))}(n),this.mounted=!0,this.openPopover()},showPopup:function(e,t){return this.doHide(),this.attachmentViewer=new l.default({attachmentId:e,nodeId:t}),this.attachmentViewer.open(),!1}}}.call(this,n("i8i4"),n("q1tI"))},idmN:function(e,t,n){var i=n("ZWtO"),o=n("FZoo"),s=n("4uTw");e.exports=function(e,t,n){for(var r=-1,a=t.length,l={};++r<a;){var c=t[r],d=i(e,c);n(d,c)&&o(l,s(c,e),d)}return l}},iors:function(e,t,n){"use strict";n.r(t);var i={Macintosh:"Avenir",Windows:"Segoe UI"},o=function(){var e,t=i[ServerData.ua.platform]||"Avenir";return e=t,s.all.find((function(t){return t.name===e}))},s=Class.create({initialize:function(e){this.id=e.id,this.name=e.name,this.url=e.url,this.loading=!1,this.loaded=!this.isExternal()},isExternal:function(){return this.url&&""!==this.url},toJSON:function(){return{id:this.id,name:this.name,url:this.url}},equals:function(e){return this.id===e.id}});s.all=[],s.default=[],s.get=function(e){return s.all.find((function(t){return t.id===e}))},s.isDefault=function(e){return s.default.any((function(t){return t.equals(e)}))},s.fontFamilyString=function(e){return e.map((function(e){return e.name.indexOf(" ")<0?e.name:'"'+e.name+'"'})).join(", ")},s.loadExternal=function(e,t){var n={active:function(){e.each((function(e){e.loaded=!0,e.loading=!1})),t&&t()},inactive:function(){e.each((function(e){e.loading=!1})),t&&t()},timeout:2e3},i=[],o=[];e.each((function(e){e.loaded||e.loading||(e.loading=!0,/^\/fonts\//.test(e.url)?o.push(e.name):i.push(e.name))})),i.length>0&&(n.google={families:i}),o.length>0&&(n.custom={families:o}),(i.length>0||o.length>0)&&"undefined"!==typeof WebFont?WebFont.load(n):t&&t()},s.initFonts=function(e,t){e.each((function(e){return s.all.push(new s(e))})),t.each((function(e){var t=s.get(e.id);t||(t=new s(e)),s.default.push(t)})),s.platformDefault=o()},t.default=s},iyru:function(e,t,n){"use strict";n.r(t);var i=n("fK4Y");App.Layout={autoAlign:!0,elasticLayout:!0,rootChildrenPosition:!1,orientation:null,minOffset:[10,0],initialize:function(){},getLineStyle:function(){return App.config.mapTheme.line.style},paintRoot:function(){canvas.el.appendChild(canvas.root.dcontent.el),canvas.root.reposition(),canvas.root.dcontent.doMove()},paintRootChild:function(e,t){return canvas.el.appendChild(e.vnode.dcontainer.el),e.reposition(),!0},repositionRootChild:function(e,t){if(e.vnode.node.pos){if(t)var n=e.vnode.node.cloneWithPosition(e.vnode.dcontainer.el);e.vnode.dcontainer.move(e.domCoords()),e.orientation!==e.getOrientation()&&(e.orientation=e.getOrientation(),e.orientation===App.Layouts.orientation.left?addClassName(e.vnode.dcontainer.el,"left_pane"):removeClassName(e.vnode.dcontainer.el,"left_pane")),e.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),t&&"undefined"!==typeof i.default&&i.default&&i.default.highlightMovement(e.vnode,t,n)}},refreshRootChildLayout:function(e){var t=e.vnode.getContentOffset(),n=e.vnode.dcontent.pos;e.vnode.dcontainer.shift([n[0]-t[0],n[1]-t[1]]),e.vnode.dcontainer.doMove(),e.vnode.dcontent.move(t),e.redrawLines()},mapSize:function(){return rectangleLayouter.getTotalSize()},canvasBounds:function(){var e=0,t=0;if(this.autoAlign){var n=this.mapSize(),i=n.offset,o=n.width+(i?i[0]:0),s=n.height+(i?i[1]:0);this.orientation===App.Layouts.orientation.left||this.orientation===App.Layouts.orientation.right?o*=2:this.orientation===App.Layouts.orientation.down&&(s*=2)}else{var r=rectangleLayouter.getTotalSize(),a=r.centerOffset[0],l=r.width-r.centerOffset[0]+App.SIDEBAR_WIDTH,c=r.centerOffset[1],d=r.height-r.centerOffset[1];o=Math.max(2*a,2*l,r.width),s=Math.max(2*c,2*d,r.height)}return canvas.size[0]<o&&(e=o-canvas.size[0]),canvas.size[1]<s&&(t=s-canvas.size[1]),[e,t]},nextTopicPosition:function(e){return null}},App.Layouts={},App.Layouts.orientation={left:0,right:1,up:2,down:4},App.Layouts.Default=Object.extend(Object.clone(App.Layout),{id:0,name:"default",autoAlign:!1,rootChildrenPosition:!0}),App.Layouts.Aligned=Object.extend(Object.clone(App.Layout),{id:1,name:"aligned",rootChildrenPosition:!0,paintRoot:function(){var e=document.createElement("div");canvas.root._leftContainer=document.createElement("div"),canvas.root._rightContainer=document.createElement("div"),canvas.root._rootContainer=document.createElement("div"),e.id="tk_map",canvas.root._leftContainer.id="tk_rootchildren_left",canvas.root._leftContainer.className="tk_children",canvas.root._rightContainer.id="tk_rootchildren_right",canvas.root._rightContainer.className="tk_children",canvas.root._rootContainer.id="tk_rootcontainer",canvas.el.appendChild(e),e.appendChild(canvas.root._leftContainer),e.appendChild(canvas.root._rootContainer),e.appendChild(canvas.root._rightContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(e,t){e.orientation=e.getOrientation();var n=e.orientation===App.Layouts.orientation.left?canvas.root._leftContainer:canvas.root._rightContainer,i=e,o=canvas.root.children.filter((function(e){return e.rc.orientation===i.orientation&&e.rc!==i}));o.sort((function(e,t){return e.node.pos[1]-t.node.pos[1]}));for(var s=0;s<o.length&&!(o[s].node.pos[1]>=e.vnode.node.pos[1]);s++);return s<o.length?n.insertBefore(e.vnode.dcontainer.el,o[s].dcontainer.el):n.appendChild(e.vnode.dcontainer.el),canvas.root._refreshRootCAngles(),t||e.vnode.refreshLayout(),!0},repositionRootChild:function(e,t){if(e.vnode.node.pos){var n=e.orientation!==e.getOrientation();e.paint(),n&&canvas.root.children.each((function(e){e.rc.calculateLinePoints();var t=e.rc.graphics.translateLines();t&&e.rc.translateBoundaries({x:0,y:t})})),rectangleLayouter.updateAll()}},refreshRootChildLayout:function(e){canvas.root.reposition();for(var t=e,n=canvas.root.children.filter((function(e){return e.rc.orientation===t.orientation&&e.rc!==t})),i=0;i<n.length;i++){var o=n[i];o.rc.calculateLinePoints();var s=o.rc.graphics.translateLines();s&&o.rc.translateBoundaries({x:0,y:s})}},mapSize:function(){var e=canvas.root,t=e._leftContainer,n=e._rootContainer,i=e._rightContainer,o={width:t.clientWidth,height:t.clientHeight},s={width:n.clientWidth+100,height:n.clientHeight},r={width:i.clientWidth,height:i.clientHeight},a=t.cumulativeOffset();return{width:o.width+s.width+r.width,height:Math.max(o.height,s.height,r.height),offset:a,centerOffset:[o.width+s.width/2,n.cumulativeOffset().top+s.height/2-Math.min(a.top,i.cumulativeOffset().top)]}},nextTopicPosition:function(e){if(!e.isRoot())return null;var t,n,i=[],o=[];(e.children.each((function(e){e.pos[0]>0?i.push(e):o.push(e)})),i.length<2||i.length<o.length)?t=[100,(n=i.sort((function(e,t){return t.pos[1]-e.pos[1]}))[0])?n.pos[1]+75:0]:t=[-100,(n=o.sort((function(e,t){return t.pos[1]-e.pos[1]}))[0])?n.pos[1]+75:0];return t}}),App.Layouts.AutoAlignedLayout=Object.extend(Object.clone(App.Layout),{elasticLayout:!1,repositionRootChild:function(e,t){e.paint(),canvas.root._refreshRootCAngles()},refreshRootChildLayout:function(e){canvas.root.reposition();for(var t=e,n=canvas.root.children.filter((function(e){return e.rc!=t})),i=0;i<n.length;i++){var o=n[i];o.rc.calculateLinePoints();var s=o.rc.graphics.translateLines();s&&o.rc.translateBoundaries({x:0,y:s})}}}),App.Layouts.OrgChart=Object.extend(Object.clone(App.Layouts.AutoAlignedLayout),{id:2,name:"org_chart",orientation:App.Layouts.orientation.down,getLineStyle:function(){return MapTheme.lineStraightCorner},paintRoot:function(){var e=document.createElement("div");canvas.root._rootContainer=document.createElement("div"),canvas.root._rootChildrenContainer=document.createElement("div"),e.id="tk_map",canvas.root._rootContainer.id="tk_rootcontainer",canvas.root._rootChildrenContainer.id="tk_rootchildrencontainer",canvas.el.appendChild(e),e.appendChild(canvas.root._rootContainer),e.appendChild(canvas.root._rootChildrenContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(e,t){e.vnode.node.pos||(e.vnode.node.pos=[0,0]),e.orientation=App.Layouts.orientation.right;var n=canvas.root._rootChildrenContainer,i=canvas.root.children;i.sort((function(e,t){return e.node.pos[0]===t.node.pos[0]?e.node.pos[1]-t.node.pos[1]:e.node.pos[0]-t.node.pos[0]}));var o=i.indexOf(e.vnode)+1;return o<i.length&&mm$(i[o].dcontainer.el.id)?n.insertBefore(e.vnode.dcontainer.el,i[o].dcontainer.el):n.appendChild(e.vnode.dcontainer.el),t||e.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),!0},mapSize:function(){var e=mm$("tk_rootchildrencontainer"),t=e.scrollWidth,n=mm$("tk_rootcontainer").clientHeight+e.clientHeight+40,i=e.cumulativeOffset().left,o=canvas.root.getSize();return o[1]+=40,{width:t,height:n,offset:[i<this.minOffset[0]?this.minOffset[0]:0,0],centerOffset:[canvas.root.dcontent.el.cumulativeOffset().left+o[0]/2-i,o[1]/2]}},nextTopicPosition:function(e){if(!e.isRoot())return null;var t=e.children.sort((function(e,t){return t.pos[0]-e.pos[0]}))[0];return t?[t.pos[0]+75]:[100,0]}}),App.Layouts.LeftAligned=Object.extend(Object.clone(App.Layouts.AutoAlignedLayout),{id:3,name:"left_aligned",orientation:App.Layouts.orientation.left,paintRoot:function(){var e=document.createElement("div");canvas.root._leftContainer=document.createElement("div"),canvas.root._rootContainer=document.createElement("div"),e.id="tk_map",canvas.root._leftContainer.id="tk_rootchildren_left",canvas.root._leftContainer.className="tk_children",canvas.root._rootContainer.id="tk_rootcontainer",canvas.el.appendChild(e),e.appendChild(canvas.root._leftContainer),e.appendChild(canvas.root._rootContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(e,t){e.vnode.node.pos||(e.vnode.node.pos=[0,0]),e.orientation=this.orientation;var n=canvas.root._leftContainer,i=e,o=canvas.root.children.filter((function(e){return e.rc!=i}));o.sort((function(e,t){return e.node.pos[1]-t.node.pos[1]}));for(var s=0;s<o.length&&!(o[s].node.pos[1]>=e.vnode.node.pos[1]);s++);return s<o.length&&mm$(o[s].dcontainer.el.id)?n.insertBefore(e.vnode.dcontainer.el,o[s].dcontainer.el):n.appendChild(e.vnode.dcontainer.el),t||e.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),!0},mapSize:function(){var e=mm$("tk_rootcontainer").clientWidth+mm$("tk_rootchildren_left").clientWidth,t=mm$("tk_rootchildren_left").clientHeight;mm$("tk_rootcontainer").clientHeight>t&&(t=mm$("tk_rootcontainer").clientHeight);var n=[mm$("tk_rootcontainer").clientWidth,mm$("tk_rootcontainer").clientHeight];return{width:e,height:t,offset:[0,0],centerOffset:[mm$("tk_rootchildren_left").clientWidth+n[0]/2,mm$("tk_rootcontainer").cumulativeOffset().top+n[1]/2-mm$("tk_rootchildren_left").cumulativeOffset().top]}},nextTopicPosition:function(e){if(!e.isRoot())return null;var t=e.children.sort((function(e,t){return t.pos[1]-e.pos[1]}))[0];return t?[t.pos[0],t.pos[1]+75]:[-100,0]}}),App.Layouts.RightAligned=Object.extend(Object.clone(App.Layouts.AutoAlignedLayout),{id:4,name:"right_aligned",orientation:App.Layouts.orientation.right,paintRoot:function(){var e=document.createElement("div");canvas.root._rightContainer=document.createElement("div"),canvas.root._rootContainer=document.createElement("div"),e.id="tk_map",canvas.root._rightContainer.id="tk_rootchildren_right",canvas.root._rightContainer.className="tk_children",canvas.root._rootContainer.id="tk_rootcontainer",canvas.el.appendChild(e),e.appendChild(canvas.root._rootContainer),e.appendChild(canvas.root._rightContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(e,t){e.vnode.node.pos||(e.vnode.node.pos=[0,0]),e.orientation=this.orientation;var n=canvas.root._rightContainer,i=e,o=canvas.root.children.filter((function(e){return e.rc!==i}));o.sort((function(e,t){return e.node.pos[1]-t.node.pos[1]}));for(var s=0;s<o.length&&!(o[s].node.pos[1]>=e.vnode.node.pos[1]);s++);return s<o.length&&mm$(o[s].dcontainer.el.id)?n.insertBefore(e.vnode.dcontainer.el,o[s].dcontainer.el):n.appendChild(e.vnode.dcontainer.el),t||e.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),!0},mapSize:function(){var e=mm$("tk_rootcontainer").clientWidth+mm$("tk_rootchildren_right").clientWidth,t=mm$("tk_rootchildren_right").clientHeight;mm$("tk_rootcontainer").clientHeight>t&&(t=mm$("tk_rootcontainer").clientHeight);var n=[mm$("tk_rootcontainer").clientWidth,mm$("tk_rootcontainer").clientHeight];return{width:e,height:t,offset:[0,0],centerOffset:[n[0]/2,canvas.root.dcontent.el.cumulativeOffset().top+n[1]/2-mm$("tk_rootchildren_right").cumulativeOffset().top]}},nextTopicPosition:function(e){if(!e.isRoot())return null;var t=e.children.sort((function(e,t){return t.pos[1]-e.pos[1]}))[0];return t?[t.pos[0],t.pos[1]+75]:[100,0]}}),App.Layouts.get=function(e){switch(e){case 0:return App.Layouts.Default;case 1:return App.Layouts.Aligned;case 2:return App.Layouts.OrgChart;case 3:return App.Layouts.LeftAligned;case 4:return App.Layouts.RightAligned;default:return App.Layouts.Default}},App.Layouts.getAll=function(){return[App.Layouts.Default,App.Layouts.Aligned,App.Layouts.LeftAligned,App.Layouts.RightAligned,App.Layouts.OrgChart]}},jFDo:function(e,t,n){var i=n("lNia");function o(e,t,n,i,o){var r=s.apply(this,arguments);return e.addEventListener(n,r,o),{destroy:function(){e.removeEventListener(n,r,o)}}}function s(e,t,n,o){return function(n){n.delegateTarget=i(n.target,t),n.delegateTarget&&o.call(e,n)}}e.exports=function(e,t,n,i,s){return"function"===typeof e.addEventListener?o.apply(null,arguments):"function"===typeof n?o.bind(null,document).apply(null,arguments):("string"===typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return o(e,t,n,i,s)})))}},"jbM+":function(e,t,n){var i=n("R/W3");e.exports=function(e,t){return!!(null==e?0:e.length)&&i(e,t,0)>-1}},k8rv:function(e,t,n){"use strict";n.r(t);var i=n("DzJC"),o=n.n(i),s=n("sEfC");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l,c,d,h=300,u=1.45,p=.2,f=6,m=function(e){return+e.toFixed(10).replace(/^(\-)?(.*)\./,"$10.")},g=function(e,t,n,i,o){this.originX=e,this.originY=t,this.translateX=n,this.translateY=i,this.scale=+o.toFixed(1)},v=function(e){c=e},y=function(e,t,n){var i=1-n.scale,o=n.scale-1||1;A=n.originX*i,E=n.originY*i;var s=t.scrollLeft-A,r=t.scrollTop-E;M.x=m(s)/o,M.y=m(r)/o,CSS.set(e,{transformOrigin:M.x+"px "+M.y+"px"}),t.scrollLeft=s,t.scrollTop=r,I=!0},_=n.n(s)()((function(e){ServerConnection.setPreference("zoom_factor",k[e])}),250),b=function(e,t,n,i){clearTimeout(l),I&&(t.scrollLeft+=A,t.scrollTop+=E,I=!1);var o=n.originX+"px "+n.originY+"px",s=i?h:0;M.x=n.originX,M.y=n.originY,CSS.set(e,{transformOrigin:o,transform:"scale("+n.scale.toFixed(2)+")",transition:(MM.ua.isBrowser("Safari")?browserPrefix():"")+"transform "+s+"ms linear 0s"}),n.scale>=1&&(l=setTimeout(y.bind(null,e,t,n),s+200))},w=function(e,t,n,i,o,s,r,a){var l=C(e,c,n,i,e.offsetLeft,e.offsetTop,o,a.minScale,a.maxScale);if(l!==c){var h=k.indexOf(+l.scale.toFixed(1));b(e,t,l,s),function(e,t){e.scrollLeft-=t.translateX-c.translateX,e.scrollTop-=t.translateY-c.translateY}(t,l),v(l),d=h,App.config.persistent&&App.config.editable&&r&&_(d)}},C=function(e,t,n,i,o,s,r,a,l){var c=t.scale,d=c+r/10;d<a?d=a:d>l&&(d=l);var h=e.getBoundingClientRect(),u=n-o-h.left,p=i-s-h.top,f=u/c,m=p/c;if(c===d||f===t.originX&&m===t.originY&&(d===l||d===a))return t;var v=t.originX*c,y=t.originY*c,_=t.translateX,b=t.translateY;return(Math.abs(u-v)>1||Math.abs(p-y)>1)&&c<=l?(_+=(u-v)*(1-1/c),b+=(p-y)*(1-1/c)):(1!==c||u!==v&&p!==y)&&(f=v/c,m=y/c),new g(f,m,_,b,d)},x=o()(w,50),S=o()(w,h+100),k=[],A=0,E=0,M={x:0,y:0},I=!1;t.default={init:function(e,t,n){this.el=e,this.scrollingContainer=t,this.opts=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(n,!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({minScale:p,maxScale:f},n);for(var i=this.opts.minScale;i<=this.opts.maxScale;i+=.1)k.push(+i.toFixed(1));d=this.getZoomIndex(1),v(new g(0,0,0,0,1)),this.initialized=!0},canZoomOut:function(){return d>0},canZoomIn:function(){return d<k.length-1},zoomIn:function(e,t,n){if(this.canZoomIn()){var i=Math.ceil(d*u)||1;this.zoomTo(i,e,t,n)}},zoomOut:function(e,t,n){if(this.canZoomOut()){var i=Math.floor(d/u);this.zoomTo(i,e,t,n)}},getScaleAvg:function(){return(this.opts.minScale+this.opts.maxScale)/2},getZoomFactor:function(e){return k[e||d]},getCurrentZoomIndex:function(){return d},getZoomIndex:function(e){return k.indexOf(e)},zoomTo:function(e,t,n,i){if(!i){var o=document.body.getBoundingClientRect(),s=UI.Registry.viewportOffset;i={left:(o.width-s.left-s.right)/2,top:o.height/2}}n?S(this.el,this.scrollingContainer,i.left,i.top,e-d,n,t,this.opts):w(this.el,this.scrollingContainer,i.left,i.top,e-d,n,t,this.opts)},onWheel:function(e,t){e.preventDefault(),e.stopPropagation();var n=this.getZoomFactor()>1?this.getZoomFactor():1;x(this.el,this.scrollingContainer,e.pageX,e.pageY,t*n,!1,!0,this.opts)},zoomToFit:function(){if(tree.finishedInitialization){var e=Math.max(.2,Math.min(1,parseFloat((MM.ui.page.width/App.config.layout.mapSize().width).toFixed(1))));this.getZoomIndex(e)>=0&&this.zoomTo(this.getZoomIndex(e),!1,!1)}},transformCssZoomValue:function(e,t){return t?e*this.getZoomFactor():e/this.getZoomFactor()},transformCssZoomCoordinate:function(e,t,n){var i=M[t],o=e-i;return i+this.transformCssZoomValue(o,n)}}},lBGc:function(e,t,n){"use strict";n.r(t);var i=n("mbwg"),o=Class.create(i.default,{initialize:function($super,e,t){$super("styles",e,t),Element.bindOnClick("btn_remove_style",this.setValue.bind(this)),Element.bindOnClick("btn_customize_style",this.showDialog)},load:function($super){this.list=this.el.select("grid")[0],this.list.innerHTML="",this.styles=[],App.config.mapTheme.styles.concat(Style.teamStyles).each(function(e){this.addStyle(e)}.bind(this)),$super()},addStyle:function(e){this.styles.push(e);var t=new Element("div",{href:"#",className:"tk_label"}).update("Abc");Style.applyToElement(e,t);var n=new Element("a",{id:"style_"+e.id,href:"#",className:"tooltip item"}).setStyle({backgroundColor:"#"+App.config.mapTheme.background.color}).insert(t);n.observe("click",this.setValue.bindAsEventListener(this,e)),e.name&&(n.title=e.name),this.list.insert(new Element("cell",{className:"topic-preview"}).insert(n))},setValue:function(e,t){if(Event.stop(e),t){var n=canvas.allSelected,i=n.filter((function(e){var n=e.node;return n.style&&n.style.equals(t)}));n.length===i.length&&(t=null)}canvas.onSetFullStyle(t),this._setSelected(t)},_setSelected:function(e){if(this.list.select(".selected").invoke("removeClassName","selected"),e){var t=mm$("style_"+e.id);t&&addClassName(t,"selected")}},showDialog:function(){MM.ui.dialogs.dialogCustomizeTopic({themeId:App.config.mapTheme.id})},onSelectNode:function(){if(this.list.select(".selected").invoke("removeClassName","selected"),canvas.selected&&canvas.selected.node.style){var e=this.styles.find((function(e){return e.equals(canvas.selected.node.style)}));e&&mm$("style_"+e.id)&&addClassName(mm$("style_"+e.id),"selected")}}});t.default=o},lH83:function(e,t,n){(e.exports=n("JPst")(!0)).push([e.i,".v-attachment-viewer{z-index:1010}.evernote-content{border:none;overflow:auto;width:calc(60vw - 40px);height:calc(70vh - 40px)}\n","",{version:3,sources:["/home/mindmeister/server/mymind/releases/20200115114804/webpack/css/app/ui/attachment-viewer.scss"],names:[],mappings:"AAAA,qBACE,YAAa,CACd,kBAGC,WAAY,CACZ,aAAc,CACd,uBAAwB,CACxB,wBAAyB",file:"attachment-viewer.scss",sourcesContent:[".v-attachment-viewer {\n  z-index: 1010; /* widget tag is on 1000 */\n}\n\n.evernote-content {\n  border: none;\n  overflow: auto;\n  width: calc(60vw - 40px);\n  height: calc(70vh - 40px);\n}\n"]}])},lLo4:function(e,t,n){"use strict";(function(e){var i=n("17x9"),o=n.n(i),s=n("Y+p1"),r=n.n(s);function a(e){return(a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){return(p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==a(t)&&"function"!==typeof t?u(e):t}(this,h(n).call(this,e))).state={active:e.active,visible:e.visible,offset:{horizontal:0,vertical:0},position:e.position},t.sizeAndPosition=t.sizeAndPosition.bind(u(t)),t._toggle=t._toggle.bind(u(t)),t._handleDocumentClick=t._handleDocumentClick.bind(u(t)),t._close=t._close.bind(u(t)),t}var i,o,s;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}(n,t),i=n,(o=[{key:"sizeAndPosition",value:function(){if(this.state.active&&this.props.canAutoPosition){var e=this.container.getBoundingClientRect(),t=this.popover.getBoundingClientRect(),n=document.body.getBoundingClientRect(),i=UI.Registry.viewportOffset,o=this.state.position;e.top+e.height+t.height<n.height-i.bottom?o="bottom":e.top-t.height>i.top?o="above":e.left-t.width>i.left?o="onleft":e.left+e.width+t.width<n.width-i.right&&(o="onright");var s=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(n,!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.state.offset);if("bottom"===o||"above"===o){for(var a=this.container;!1===/auto|scroll/.test(getComputedStyle(a,null).getPropertyValue("overflow-y"))&&a!==document.documentElement;)a=a.parentNode;var d=a.getBoundingClientRect();d.right<t.right&&(s.horizontal=Math.ceil(t.right-d.right)+a.offsetWidth-a.clientWidth)}o===this.state.position&&!1!==r()(s,this.state.offset)||this.setState({position:o,offset:s})}}},{key:"_toggle",value:function(e){e.preventDefault(),this.props.disabled||(this.state.active?this._close(e):this._show(e))}},{key:"_handleDocumentClick",value:function(e){var t=e.target;(!Element.ancestors(t).include(this.container)||e.closePopover&&GeneralPopover.getLastOpened()===this)&&this._close(e)}},{key:"_show",value:function(e){var t=this;clearTimeout(this.timer),window.addEventListener("click",this._handleDocumentClick),window.addEventListener("resize",this.sizeAndPosition),this.setState({active:!0,visible:!0});var n=GeneralPopover.getLastOpened();n&&n.close&&n.close(),GeneralPopover.opened.push(this),this.keymap.enable(),this.timer=setTimeout((function(){t.props.onShow(e),"undefined"!==typeof canvas&&canvas&&canvas.removeFocus()}),300)}},{key:"_close",value:function(e){var t=this;clearTimeout(this.timer),this.setState({active:!1}),this.keymap.disable(),this.timer=setTimeout((function(){t.props.onClose(e),t.setState({visible:!1})}),300),this._onClose()}},{key:"_onClose",value:function(){window.removeEventListener("click",this._handleDocumentClick),window.removeEventListener("resize",this.sizeAndPosition),GeneralPopover.remove(this,!0)}},{key:"componentDidMount",value:function(){this.keymap=new MM.utils.KeyMap(document,"keymap_popover",[{key:MM.utils.KeyEvent.ESC,fn:this._close}]),this.keymap.disable()}},{key:"componentWillUnmount",value:function(){this.keymap=null,clearTimeout(this.timer),this.state.active&&this._onClose()}},{key:"componentDidUpdate",value:function(){this.sizeAndPosition()}},{key:"render",value:function(){var t=this,n=this.state,i=n.active,o=n.offset,s=n.position,r=n.visible,a="popover content ".concat(s," ").concat(this.props.className).concat(i?" active":""),l=r?this.props.children:null,c={};return o.horizontal&&(c.arrow={left:"calc(50% + ".concat(o.horizontal,"px")},c.popover={left:"calc(50% - ".concat(o.horizontal,"px")}),e.createElement("div",{ref:function(e){return t.container=e},className:"p-r"},e.createElement("span",{onClick:this._toggle},this.props.opener),e.createElement("div",{ref:function(e){return t.popover=e},className:a,style:c.popover},e.createElement("span",{className:"arrow",style:c.arrow}),l))}}])&&d(i.prototype,o),s&&d(i,s),n}(e.Component);f.propTypes={className:o.a.string,opener:o.a.node.isRequired,children:o.a.node,position:o.a.oneOf(["above","bottom","onleft","onright"]),canAutoPosition:o.a.bool,onShow:o.a.func,onClose:o.a.func},f.defaultProps={position:"bottom",canAutoPosition:!0,className:"",onShow:function(){},onClose:function(){}},t.a=f}).call(this,n("q1tI"))},lNia:function(e,t){var n=9;if("undefined"!==typeof Element&&!Element.prototype.matches){var i=Element.prototype;i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector}e.exports=function(e,t){for(;e&&e.nodeType!==n;){if("function"===typeof e.matches&&e.matches(t))return e;e=e.parentNode}}},lQqw:function(e,t,n){var i=n("MMmD");e.exports=function(e,t){return function(n,o){if(null==n)return n;if(!i(n))return e(n,o);for(var s=n.length,r=t?s:-1,a=Object(n);(t?r--:++r<s)&&!1!==o(a[r],r,a););return n}}},"lm/5":function(e,t,n){var i=n("fmRc"),o=n("wF/u"),s=1,r=2;e.exports=function(e,t,n,a){var l=n.length,c=l,d=!a;if(null==e)return!c;for(e=Object(e);l--;){var h=n[l];if(d&&h[2]?h[1]!==e[h[0]]:!(h[0]in e))return!1}for(;++l<c;){var u=(h=n[l])[0],p=e[u],f=h[1];if(d&&h[2]){if(void 0===p&&!(u in e))return!1}else{var m=new i;if(a)var g=a(p,f,u,e,t,m);if(!(void 0===g?o(f,p,s|r,a,m):g))return!1}}return!0}},mNz5:function(e,t,n){var i=n("dt0z"),o=0;e.exports=function(e){var t=++o;return i(e)+t}},mTTR:function(e,t,n){var i=n("b80T"),o=n("QcOe"),s=n("MMmD");e.exports=function(e){return s(e)?i(e,!0):o(e)}},mbwg:function(e,t,n){"use strict";n.r(t);var i=Class.create({visible:!1,expandable:!1,onExpand:function(){return null},initialize:function(e,t,n){this.id=e,this.sidebar=t,this.el=$(e),this.parent=n,this.expandable&&(this.expandedEl=$(e+"_expanded")),this.animationHide&&this.expandedEl&&CSS.set(this.expandedEl,{transform:this.animationHide})},show:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){this.visible||(this.visible=!0,e&&this.sidebar.expandedWidget&&!this.expandable&&this.sidebar.expandedWidget.contract(),show(this.el),this.loaded||this.load(),canvas.selected&&this.onSelectNode(),UI.Registry.notify(this.sidebar,"onResize"),this.parent&&this.parent.onShow(this))})),hide:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){hide(this.el),this.visible=!1,UI.Registry.notify(this.sidebar,"onResize")})),toggle:function(){this.visible?this.hide():this.show()},load:function(){this.loaded=!0},toViewMode:function(){},toEditMode:function(){},onSelectNode:function(){},expand:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.expandable&&!this.expanded){var t=e.savePreference;this.sidebar.expandedWidget=this,this.expanded=!0,this.positionExpandedEl(this.expandedEl),t&&App.setPreference("sidebar_extended",this.id),this.onExpand()}},contract:function(){this.expandable&&(App.setPreference("sidebar_extended",null),this.sidebar.expandedWidget=null,this.expanded=!1,this.positionExpandedEl(this.sidebar.toolbar))},positionExpandedEl:function(e){this.sidebar.hide(!0,!1,this.animationHide,this.animationFunction),this.sidebar.expandedElement=e,this.sidebar.show(!0,!1,this.animationShow,this.animationFunction)}});t.default=i},mc0g:function(e,t){e.exports=function(e){return function(t,n,i){for(var o=-1,s=Object(t),r=i(t),a=r.length;a--;){var l=r[e?a:++o];if(!1===n(s[l],l,s))break}return t}}},moWC:function(e,t,n){"use strict";(function(e){var i=n("s7eh");function o(e){return(o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var c=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==o(t)&&"function"!==typeof t?a(e):t}(this,r(n).call(this,e)))._onMouseEnter=t._onMouseEnter.bind(a(t)),t._onMouseLeave=t._onMouseLeave.bind(a(t)),t}var c,d,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),c=n,(d=[{key:"_onMouseEnter",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.onMouseEnter(this.props.index)}},{key:"_onMouseLeave",value:function(e){e.stopPropagation(),e.preventDefault(),this.props.onMouseLeave(this.props.index)}},{key:"componentDidUpdate",value:function(){if(this.props.highlighted){for(var e=this.el,t=e.getBoundingClientRect(),n=e.parentElement;(0===n.clientHeight||!Object(i.a)(n))&&n!==document.body;)n=n.parentElement;var o=n.getBoundingClientRect();(t.top+t.height<o.top||t.top+10>o.top+o.height)&&e.scrollIntoView(!1)}}},{key:"render",value:function(){var t=this,n="item "+this.props.className+(this.props.title?" tooltip":"");return(this.props.selected||this.props.highlighted)&&(n+=" selected"),e.createElement("a",{ref:function(e){return t.el=e},href:"#",onMouseEnter:this._onMouseEnter,onMouseLeave:this._onMouseLeave,className:n,title:this.props.title,onClick:this.props.onClick},this.props.element)}}])&&s(c.prototype,d),h&&s(c,h),n}(e.Component);c.defaultProps={className:"",title:""},t.a=c}).call(this,n("q1tI"))},mwIZ:function(e,t,n){var i=n("ZWtO");e.exports=function(e,t,n){var o=null==e?void 0:i(e,t);return void 0===o?n:o}},nYGJ:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("QjzQ"),r=n("39z+"),a=n("fh04"),l=n("syde"),c=n("s2fJ");function d(e){return(d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var h=Class.create(o.default,{effort_units:["hours","days","weeks","months"],initialize:function($super,e,t){$super("tasks",e,t),this.buildPopovers(),Element.bindOnClick("btn_removetask",this.removeTask.bind(this)),Element.bindOnClick("btn_autotask",this.setAutoTask.bind(this)),this.setupPromotion()},load:function($super){$super()},setupPromotion:function(){MM.utils.getCookie("ignore_mt_task_promotion")&&mm$("mt_task_promotion")&&(mm$("tasks_content").removeClassName("h-hidden"),mm$("mt_task_promotion").addClassName("h-hidden"))},buildPopovers:function(){this.buildDatePickers(),this.priorityPopover&&!this.advancedOn||(this.priorityPopover=this.buildPopover("priority")),this.completePopover&&!this.advancedOn||(this.completePopover=this.buildPopover("complete")),this.resourcePopover&&!this.advancedOn||(this.resourcePopover=this.buildPopover("resource"),this.renderResourcePopover()),this.advancedOn&&(this.effortPopover=this.buildPopover("effort_units"))},renderResourcePopover:function(){var t=this;if(canvas.selected){var n=canvas.selected.node,o=n.task?n.task.resource:null;e.render(i.createElement(s.a,{users:users.allUsers,assignee:o,isExternalTask:!!n.externalTask,setResource:function(e){return t.setPopoverValue("resource",e)}}),this.resourcePopover.widgetContainer)}},buildPopover:function(t){var n,i=this;if("resource"===t)return new r.c(t,{onShow:this.renderResourcePopover.bind(this),onHide:function(){return e.unmountComponentAtNode(i.resourcePopover.widgetContainer)}});switch(t){case"priority":n=[-1,1,2,3,4,5,6,7].collect((function(e){return"priority_0"+e}));break;case"complete":n=[-1,1,2,3,4,5].collect((function(e){return"task_"+e}));break;case"effort_units":n=this.effort_units}var o=[];n.each(function(e){o.push(this.getEntryForType(e,t))}.bind(this));var s=new Popover(t,this.setPopoverValue.bind(this,t),{offset:[0,0]});return s.addElements(o),s},_getIconElement:function(e){var t=null;e&&(t=Icon.fromFullName(e));var n=new Element("a",{class:"iconized library ellipsis"+(t?"":" empty"),href:"#"});return t&&(n.id=t.id,n.title=t.getTitle()),n.innerHTML=t?t.getTitle():I18n.t("js.none"),n.style.backgroundImage=t?'url("'+t.url()+'")':"none",n},getEntryForType:function(e,t){switch(t){case"priority":case"complete":return this._getIconElement(e);case"resource":if((e=this.getUserFromResource(e))&&"object"==d(e))(n=new Element("a",{href:"#",className:"h-flex-row"})).insert(e.getAvatar("small mr-5")),n.insert(new Element("span").update(e.name));else(n=new Element("a")).update(e?e.escapeHTML():I18n.t("js.not_assigned"));return n;case"effort_units":return e=e.replace("effort_",""),(n=new Element("a",{id:"effort_"+e,href:"#"})).update(I18n.t("js.helper_"+e)),n;case"startdate":return(n=new Element("a")).update(e||I18n.t("js.not_started")),n;case"duedate":case"enddate":var n;return(n=new Element("a")).update(e||I18n.t("js.not_due")),n}},setPopoverValue:function(e,t){switch("none"===t&&(t=null),e){case"priority":case"complete":if(this.advancedOn)this[e+"_advanced_cache"]=t?l.TASK[e].indexOf(t):-1;else if(t)canvas.onSetIcon(Icon.get(t));else{var n=canvas.allSelected.map((function(e){return e.node}));Tree.utils.removeIconGroup("complete"===e?"task":e,n)}break;case"resource":this.resourcePopover.close(),this.setResource(t);var i=canvas.selected.node.task;i&&i.resource&&i.resource.id===t&&(t=null);break;case"duedate":t=this.getFormattedDate(this.getDateFromField("duedate"));break;case"enddate":case"startdate":var o=this.getDateFromField("startdate"),s=this.getDateFromField("enddate"),r="enddate"===e?s:o;o&&s&&o>s?MM.ui.dialogs.showError(I18n.t("js.start_date_is_set_after_due_date")):r&&-1!==r.toString().indexOf("Invalid Date")?(MM.ui.dialogs.showError(I18n.t("js.invalid_task_date")),t=null):MM.ui.dialogs.hideError(),t=this.getFormattedDate(r);break;case"effort_units":this.setEffort(t)}this.updateDropdown(t,e),this.advancedOn||this.setFieldValue(e)},updatePopover:function(e){for(var t=0;t<l.TASK[e].length;t++)mm$(e+"_"+l.TASK[e][t]).className=canvas.selected.node["task_"+e]==t?"selected":""},updateDropdown:function(e,t){mm$("btn_"+t)&&$("btn_"+t).select("span")[0].update(this.getEntryForType(e,t))},getUserFromResource:function(e){if("object"==d(e))return e;var t=e;"string"==typeof t&&(t=parseInt(t.substring(9)));var n=users.findByID(t,!0);return"object"==d(n)?n:e},buildDatePickers:function(){this.advancedOn?(this.startdatepicker=new c.a({relative:"fld_startdate",opener:"btn_startdate",parent:"popover_startdate",language:I18n.locale,keepFieldEmpty:!0,ignore:["fld_startdate"],cellCallback:this.setPopoverValue.bind(this,"startdate")}),this.startdatepicker.load(),this.duedatepicker=new c.a({relative:"fld_enddate",opener:"btn_enddate",parent:"popover_enddate",language:I18n.locale,keepFieldEmpty:!0,ignore:["fld_enddate"],cellCallback:this.setPopoverValue.bind(this,"enddate")}),this.duedatepicker.load()):this.datepicker||(this.datepicker=new c.a({relative:"fld_duedate",opener:"btn_duedate",parent:"popover_date",language:I18n.locale,keepFieldEmpty:!0,ignore:["fld_duedate"],cellCallback:this.setPopoverValue.bind(this,"duedate")}),this.datepicker.load())},setResource:function(e){mm$("fld_resourceid").value="",mm$("fld_resource").value=e,users.allUsers.each((function(t){t.id===e&&(mm$("fld_resourceid").value=e,mm$("fld_resource").value=t.name)}))},setEffort:function(e){mm$("fld_effort_units").value=I18n.t("js.helper_"+e.split("effort_")[1]),this.task_effort_key=e.split("effort_")[1],this.updateDropdown(e,"effort_units")},checkEffort:function(){var e=parseInt(mm$("fld_effort").value);return isNaN(e)?"":(e>999&&(e=999),e.toString()+this.task_effort_key)},setFieldValue:function(e){if(canvas.selected){switch(e){case"resource":var t=""!=mm$("fld_resource").value?mm$("fld_resource").value:null,n=""!=mm$("fld_resourceid").value?parseInt(mm$("fld_resourceid").value):null;break;case"duedate":var i=this.getDateFromField(e)}var o=[];canvas.allSelected.each(function(s){var r=s.node.task,l=-1,c=-1,d=t,h=n,u=i,p=null;r&&(l=r.priority,c=r.complete,"duedate"!==e&&(u=r.due),"resource"===e?r.resource&&r.resource.id&&r.resource.id===n&&(h=null,d=null):d=r.resource),(u||h||d||l>-1||c>-1)&&(p=new a.default({due:u,resource:d,resource_id:h,priority:l,complete:c})),r&&p&&r.equals(p)||o.push({node:s.node,task:p})}.bind(this)),Tree.utils.setTask(o)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSelectNode:function(){canvas.selected.node.updateTaskFromIcons(canvas.selected.node.icons),["priority","complete"].each((function(e){this.updateDropdown(canvas.selected.node.task?l.TASK[e][canvas.selected.node.task[e]]:null,e)}),this);var e=null;canvas.selected.node.task&&canvas.selected.node.task.due?(e=canvas.selected.node.task.due,mm$("fld_duedate").value=e.toUIString(!0),mm$("fld_duedate").setAttribute("date",this.datePickerDateFormat(e)),mm$("fld_enddate")&&(mm$("fld_enddate").value=e.toUIString(!0),mm$("fld_enddate").setAttribute("date",this.datePickerDateFormat(e)))):(mm$("fld_duedate").value="",mm$("fld_duedate").removeAttribute("date"),mm$("fld_enddate")&&(mm$("fld_enddate").value="",mm$("fld_enddate").removeAttribute("date"))),this.updateDropdown(this.getFormattedDate(e),"duedate");var t=null;if(canvas.selected.node.task&&canvas.selected.node.task.resource?(t=mm$("fld_resource").value=canvas.selected.node.task.resource.name||"",canvas.selected.node.task.resource.id?(mm$("fld_resourceid").value=canvas.selected.node.task.resource.id,users.findByID(canvas.selected.node.task.resource.id,!0)&&(t=canvas.selected.node.task.resource.id)):mm$("fld_resourceid").value=""):(mm$("fld_resource").value="",mm$("fld_resourceid").value=""),this.updateDropdown(t,"resource"),this.advancedOn){this.updateDropdown(this.getFormattedDate(e),"enddate");var n=null;if(canvas.selected.node.task&&canvas.selected.node.task.from&&(n=canvas.selected.node.task.from,mm$("fld_startdate").value=n.toUIString(!0),mm$("fld_startdate").setAttribute("date",this.datePickerDateFormat(n))),this.updateDropdown(this.getFormattedDate(n),"startdate"),canvas.selected.node.task&&canvas.selected.node.task.effort){mm$("fld_effort").value=parseInt(canvas.selected.node.task.effort)||"";var i=canvas.selected.node.task.effort.sub(parseInt(canvas.selected.node.task.effort).toString(),"");mm$("fld_effort_units").value=i,mm$("effort_"+i).parentNode.className+=(mm$("effort_"+i).parentNode.className?" ":"")+"selected",this.setEffort("effort_"+i)}else mm$("fld_effort_units")&&(mm$("fld_effort_units").value=I18n.t("js.helper_hours"),this.setEffort("effort_hours"))}},showDialog:function(){canvas.selected?(this.datepicker.disable(),canvas.removeFocus(),this.advancedOn=!0,MM.ui.dialogs.show("task",{height:350,width:640,action:"task_details_ajax/"+canvas.selected.node.id,onClose:function(){canvas.addFocus(),this.advancedOn=!1,this.buildPopovers()}.bind(this)}),this.task_notification=null,this.priority_advanced_cache=canvas.selected.node.task?canvas.selected.node.task.priority:-1,this.complete_advanced_cache=canvas.selected.node.task?canvas.selected.node.task.complete:-1):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetNotification:function(e){this.task_notification=e},beforeSetTask:function(){this.startdatepicker&&this.duedatepicker&&(this.startdatepicker.disable(),this.duedatepicker.disable())},saveAdvancedTask:function(e){if(this.beforeSetTask(),e){var t=new a.default({from:this.getDateFromField("startdate"),due:this.getDateFromField("enddate"),resource:""!==mm$("fld_resource").value?mm$("fld_resource").value:null,resource_id:""!==mm$("fld_resourceid").value?parseInt(mm$("fld_resourceid").value):null,effort:this.checkEffort(),priority:this.priority_advanced_cache,complete:this.complete_advanced_cache}),n=[];canvas.allSelected.each(function(e){e.node.task&&e.node.task.equals(t)||n.push({node:e.node,task:t})}.bind(this)),n.length>0&&Tree.utils.setTask(n),setTimeout(this.onSelectNode.bind(this),500),this.task_notification&&canvas.selected.node.setTaskNotify(this.task_notification)}},saveTaskNotification:function(){canvas.selected.node.setTaskNotify(this.task_notification),Windows.close("task"),this.datepicker.enable()},onCloseDialog:function(e){Windows.close("task"),this.saveAdvancedTask(e),this.datepicker.enable()},removeTask:function(){canvas.selected?(canvas.onRemoveTask(),this.onSelectNode()):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},setAutoTask:function(){if(canvas.selected){var e=Math.floor(6*Math.random()),t=Math.floor(4*Math.random()),n=new Date;if(n.setHours(12),n.setMinutes(0),n.setSeconds(0),n.setDate(n.getDate()+7),n=Date.toUTC(n.getTime()),"undefined"===typeof this.user_advanced_cache||this.user_advanced_cache===users.allUsers.length-1?this.user_advanced_cache=0:this.user_advanced_cache++,users.allUsers[this.user_advanced_cache])var i=new a.default({from:null,due:n,effort:null,priority:e,complete:t,resource:users.allUsers[this.user_advanced_cache].name,resource_id:users.allUsers[this.user_advanced_cache].id});else i=new a.default({from:null,due:n,effort:null,priority:e,complete:t,resource:null});var o=[];canvas.allSelected.each((function(e){o.push({node:e.node,task:i})})),Tree.utils.setTask(o),this.onSelectNode(),Amplitude.logEvent("wunder_task")}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},getFormattedDate:function(e){return e?Date.fromUTC(e).toUIString(!0):e},datePickerDateFormat:function(e){return e?e.getMonth()+1+"/"+e.getDate()+"/"+e.getFullYear():e},prepareDate:function(e){if(!e)return e;var t=new Date(e);return t.setHours(12),t.setMinutes(0),t.setSeconds(0),t.setTime(t.getTime()-60*t.getTimezoneOffset()*1e3),t=Date.toUTC(t.getTime())},getDateFromField:function(e){var t=this.prepareDate(mm$("fld_"+e).getAttribute("date"));return t&&-1!==t.toString().indexOf("Invalid Date")?null:t}});t.default=h}.call(this,n("i8i4"),n("q1tI"))},nmnc:function(e,t,n){var i=n("Kz5y").Symbol;e.exports=i},nyiR:function(e,t,n){"use strict";n.r(t),n.d(t,"Graphics",(function(){return s})),n.d(t,"VGraphics",(function(){return r}));var i=n("uvak"),o=n("J4oq");Element.prototype.triggerEvent=function(e){if(document.createEvent){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),this.dispatchEvent(t)}if(this.fireEvent)return this.fireEvent("on"+e)};var s={raphael:null,graphicscontainer:null,connectionstack:new Hash,allBoundaries:new Hash,initialize:function(e,t){"undefined"!=typeof Raphael&&(this.graphicscontainer=document.getElementById("graphics_container"),this.raphael=new Raphael(this.graphicscontainer,parseInt(e),parseInt(t)))},resize:function(e,t){e=parseInt(e),t=parseInt(t),this.raphael&&this.graphicscontainer&&(this.raphael.setSize(e,t),this.graphicscontainer.style.width=e+"px",this.graphicscontainer.style.height=t+"px")},drawPath:function(e,t,n){if(this.raphael){var i=r.COLOR,o="none",s=App.config.mapTheme.lineStrokeWidth();return n=n||1,t&&(o=i),this.raphael.path(e).attr({stroke:i,"stroke-width":s,fill:o,"stroke-linecap":"round",opacity:n})}},drawConnection:function(e,t,n,i,o,r,a,l,c,d){if(this.raphael){var h="#"+d,u={fill:"#FF0000",stroke:"#FF0000",opacity:"0.1"},p=this.raphael.set(this.raphael.circle(o,r,30).attr(u).hide(),this.raphael.circle(a,l,30).attr(u).hide()),f=[["M",o,r],["C",e,t,n,i,a,l]],m=[["M",o,r],["L",e,t],["M",n,i],["L",a,l]],g=App.config.mapTheme.lineStrokeWidth(),v=this.raphael.path(f).attr({stroke:h,"stroke-width":g,"stroke-linecap":"round"});v.click((function(){s.selectConnection(c)}));var y=v.getPointAtLength(v.getTotalLength()/2),_=this.raphael.set(this.raphael.path(m).attr({stroke:"#777777","stroke-opacity":.5}).hide(),this.raphael.circle(o,r,2).attr({stroke:h}).hide(),this.raphael.circle(e,t,2).attr({stroke:"#777777"}).hide(),this.raphael.circle(n,i,2).attr({stroke:"#777777"}).hide()),b=s.getConnectionArrow(_[0]),w=this.raphael.path(b).attr({fill:h,stroke:h});w.click((function(){s.selectConnection(c)})),_[4]=w;var C=this.connectionstack.get(c)||[];return C.push(v,_,p),this.connectionstack.set(c,C),_[1].update=function(e,t){e=parseInt(e),t=parseInt(t);var n=this.attr("cx")+e,i=this.attr("cy")+t;this.attr({cx:n,cy:i}),f[0][1]=n,f[0][2]=i,m[0][1]=n,m[0][2]=i,_[2].update(e,t)},_[2].update=function(e,t){e=parseInt(e),t=parseInt(t);var n=this.attr("cx")+e,i=this.attr("cy")+t;this.attr({cx:n,cy:i}),m[1][1]=n,m[1][2]=i,_[0].attr({path:m});var o=s.getConnectionArrow(_[0]);_[4].attr({path:o}),f[1][1]=n,f[1][2]=i,v.attr({path:f})},_[2].updateAbsolute=function(e,t){var n=e=parseInt(e),i=t=parseInt(t);this.attr({cx:n,cy:i}),m[1][1]=n,m[1][2]=i,_[0].attr({path:m});var o=s.getConnectionArrow(_[0]);_[4].attr({path:o}),f[1][1]=n,f[1][2]=i,v.attr({path:f})},_[3].update=function(e,t){e=parseInt(e),t=parseInt(t);var n=this.attr("cx")+e,i=this.attr("cy")+t;this.attr({cx:n,cy:i}),m[2][1]=n,m[2][2]=i,_[0].attr({path:m});var o=s.getConnectionArrow(_[0]);_[4].attr({path:o}),f[1][3]=n,f[1][4]=i,f[1][5]=o[1][1],f[1][6]=o[1][2],v.attr({path:f})},_[3].updateAbsolute=function(e,t){var n=e=parseInt(e),i=t=parseInt(t);this.attr({cx:n,cy:i}),m[2][1]=n,m[2][2]=i,_[0].attr({path:m});var o=s.getConnectionArrow(_[0]);_[4].attr({path:o}),f[1][3]=n,f[1][4]=i,f[1][5]=o[1][1],f[1][6]=o[1][2],v.attr({path:f})},y}},getConnectionArrow:function(e){if(this.raphael){var t=e.attr("path")[3][1],n=e.attr("path")[3][2],i=e.attr("path"),o=Raphael.angle(i[2][1],i[2][2],i[3][1],i[3][2]),s=Raphael.rad(o),r=[["M",t,n],["L",parseInt(t+-50*Math.cos(s-Math.PI)),parseInt(n+-50*Math.sin(s-Math.PI))]],a=this.raphael.path(r).attr({stroke:"#777777","stroke-dasharray":"."}),l=a.getPointAtLength(18);l.x=parseInt(l.x),l.y=parseInt(l.y);var c=parseInt(l.x+12*Math.cos(s+Math.PI/2)/2),d=parseInt(l.y+12*Math.sin(s+Math.PI/2)/2),h=parseInt(l.x+12*Math.cos(s-Math.PI/2)/2),u=parseInt(l.y+12*Math.sin(s-Math.PI/2)/2),p=[["M",c,d],["L",l.x,l.y],["L",h,u],["L",t,n],["L",c,d,"Z"]];return a.remove(),p}},selectConnection:function(e){var t=mm$("connection_handler_"+e+"_2"),n=mm$("connection_handler_"+e+"_3");t&&n&&(removeClassName(t,"hidden"),removeClassName(n,"hidden"),s.connectionstack.get(e)[1].show())},deselectConnections:function(){$$(".connection_handle").each((function(e){e.addClassName("hidden")})),s.connectionstack.each((function(e){e&&e[1][1].hide()}))},drawBoundaryPreview:function(e,t,n){"undefined"==typeof n&&(n=1),e._raphael=new Raphael(e,72*n,46*n);var i=s.drawBoundary(t.r1,t.r2,t.style,{shape:t.style.shape,orientation:App.Layouts.orientation.right,raphael:e._raphael,cornerRadius:4,cloudSize:10});return 1!=n&&i.scale(n,n,0,0),i},drawBoundary:function(e,t,n,s){var r=s.raphael||this.raphael;if(r){var a=s.shape||n.shape,l={stroke:n.stroke_color?"#"+n.stroke_color:"none","stroke-opacity":null!=n.stroke_opacity?n.stroke_opacity:1,"stroke-width":null!=n.stroke_width?n.stroke_width:0,"stroke-linecap":"round",fill:n.fill_color?"#"+n.fill_color:"none","fill-opacity":null!=n.fill_opacity?n.fill_opacity:1};l["stroke-width"]>0&&(n.stroke_style==o.default.STROKE_DASHED?l["stroke-dasharray"]="-":n.stroke_style==o.default.STROKE_DOTTED&&(l["stroke-dasharray"]=","));var c=e.coords(),d=t.coords();if(a==o.default.SHAPE_BOX||a==o.default.SHAPE_BOX_ROUND)if(s.orientation==App.Layouts.orientation.left)var h=[new Point(d[0].x,Math.min(c[0].y,d[0].y)),new Point(c[1].x,Math.min(c[1].y,d[1].y)),new Point(c[2].x,Math.max(c[2].y,d[2].y)),new Point(d[3].x,Math.max(c[3].y,d[3].y))];else h=[new Point(c[0].x,Math.min(c[0].y,d[0].y)),new Point(d[1].x,Math.min(c[1].y,d[1].y)),new Point(d[2].x,Math.max(c[2].y,d[2].y)),new Point(c[3].x,Math.max(c[3].y,d[3].y))];else if(s.orientation==App.Layouts.orientation.left)h=[c[2],new Point(d[2].x,Math.max(c[2].y,d[2].y)),d[3],d[0],new Point(d[1].x,Math.min(c[1].y,d[1].y)),c[1]];else h=[c[0],new Point(d[0].x,Math.min(c[1].y,d[0].y)),d[1],d[2],new Point(d[3].x,Math.max(c[2].y,d[3].y)),c[3]];var u=r.path(),p=0;switch(a){case o.default.SHAPE_BOX_ROUND:p=s.cornerRadius||10;case o.default.SHAPE_BOX:u=r.rect(h[0].x,h[0].y,h[2].x-h[0].x,h[2].y-h[0].y,p);break;case o.default.SHAPE_CONE:u.moveTo(h[h.length-1].x,h[h.length-1].y);for(var f=0;f<h.length;f++)u.lineTo(h[f].x,h[f].y);break;case o.default.SHAPE_CONE_ROUND:var m,g,v=h;h=[];for(p=s.cornerRadius?2*s.cornerRadius:20,f=0;f<v.length;f++){var y=v[f],_=f>0?v[f-1]:v[v.length-1],b=f<v.length-1?v[f+1]:v[0];m||(m=r.path().moveTo(_.x,_.y).lineTo(y.x,y.y).hide());var w=m.getPointAtLength(m.getTotalLength()-p),C=(g=r.path().moveTo(y.x,y.y).lineTo(b.x,b.y).hide()).getPointAtLength(p);m=g,h.push(w),h.push(C)}u.moveTo(h[0].x,h[0].y);for(f=0;f<v.length;f++){var x=v[f],S=h[2*f],k=h[2*f+1];u.lineTo(S.x,S.y),u.curveTo(x.x,x.y,x.x,x.y,k.x,k.y)}break;case o.default.SHAPE_CLOUD:u.moveTo(h[0].x,h[0].y);var A=t.size();A=Math.max(A.x,A.y);var E=s.cloudSize||25+25*A/1e3;for(f=0;f<h.length;f++){var M=f<h.length-1?h[f+1]:h[0],I=new i.Line(h[f],M).pointsAtInterval(E);I.unshift(h[f]),I.push(M);for(var O=1;O<I.length;O++)u.arcTo(E,E,0,1,I[O].x,I[O].y,0)}}return u.attr(l),u.node.setAttribute("class","tk_boundary"),u}},drawDonutChart:function(e,t,n,i){if(e){e._raphael=e._raphael||new Raphael(e,i.width,i.height),e._raphael.clear();for(var o=0,s=270,r=Math.PI/180,a=i.width/2.5,l=i.width/2,c=0;c<t.length;c++)if(t[c]>0){var d=t[c]/n*360;s+=d;var h="M "+(l+a*Math.cos((270+o)*r))+" "+(l+a*Math.sin((270+o)*r)),u=" A"+a+" "+a+" 0,"+(d>180?1:0)+",1 "+(l+a*Math.cos(s*r)-9e-4)+" "+(l+a*Math.sin(s*r));if(o+=d,i.animate)(p=e._raphael.path("M "+l+" "+l)).animate({path:h+u},500);else var p=e._raphael.path(h+u);p.attr({stroke:i.colors&&i.colors[c]?i.colors[c]:"#00aaff","stroke-width":i.strokeWidth||10,"stroke-opacity":i.strokeOpacity||1})}}}},r=Class.create({rc:null,livePath:null,rootPath:null,childrenPath:null,childrenPathRoot:null,_partialChildrenPath:"",initialize:function(e){this.rc=e},destroy:function(){this.livePath&&this.livePath.remove(),this.rootPath&&this.rootPath.remove(),this.childrenPath&&this.childrenPath.remove(),this.childrenPathRoot&&(this.childrenPathRoot=null),this.rc=null},roundNumber:function(e){return parseInt(e)},redrawLines:function(){this.rc.vnode.node.isVisible()&&(this._redrawLinesForNode(this.rc.vnode),this.redrawRootLine())},translateLines:function(){if(this.childrenPathRoot){var e=this.rc.vnode.getContainerRCOffset(),t=this.rc.vnode._horizontalLine,n=Math.offset(t[0],e),i=this.rc.vnode.dcontainer.el.cumulativeOffset()[1]+n[1]-this.childrenPathRoot.y;this.childrenPath&&this.childrenPath.translate(0,i),this.childrenPathRoot.y+=i}return this.rootPath&&(this.rootPath.remove(),this.rootPath=null),this.redrawRootLine(),i},_redrawLinesForNode:function(e){for(var t=e;"undefined"!==typeof t&&t&&!t.node.isRootC()&&t.parent;)t=t.parent;var n,i,o,r,a,l=t.node.id,c=e.node.id,d=e.getContainerRCOffset(),h=e._horizontalLine,u=Math.offset(h[0],d),p=Math.offset(h[1],d),f=e.dopener.size()[0]/2,m=this.rc.vnode.dcontainer.el.cumulativeOffset(),g=0;switch(e.node.currentStyle().boxStyle){case Style.boxStraight:g=0;break;case Style.boxRound:g=8;break;case Style.boxVRound:g=12}if(a=m[0]+u[0],r=m[1]+p[1],o=p[0]-u[0],this.rc.orientation===App.Layouts.orientation.left?(n=u,i=p,0===e.children.length&&e.node.currentStyle().backgroundColor&&(a+=g,o-=g),t===e&&e.node.isFloating()&&"org_chart"!==App.config.layout.name&&(o-=g)):(n=App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up?u:p,i=u,!e.node.isRootC()||0!==e.children.length||App.config.layout.orientation!==App.Layouts.orientation.down&&App.config.layout.orientation!==App.Layouts.orientation.up||(a+=f,o-=f),t===e&&e.node.isFloating()&&"org_chart"!==App.config.layout.name&&(a+=f,o-=f)),a=this.roundNumber(a),r=this.roundNumber(r),o=this.roundNumber(o),this._partialChildrenPath+="M"+a+" "+r+" l"+o+" 0 ",!e.node.closed)for(var v=0,y=e.children.length;v<y;v++){var _=e.children[v],b=this._redrawLinesForNode(_),w=this.roundNumber(m[0]+b[0]),C=this.roundNumber(m[1]+b[1]),x=this.roundNumber(.8*(n[0]-b[0])),S=this.roundNumber(.2*(n[1]-b[1])),k=this.roundNumber(n[0]-b[0]),A=this.roundNumber(n[1]-b[1]);switch(App.config.layout.getLineStyle()){case MapTheme.lineStraight:this._partialChildrenPath+="M"+w+" "+C+" l"+k+" "+A+" ";break;case MapTheme.lineOrganicCurve:case MapTheme.lineCurve:this._partialChildrenPath+="M"+w+" "+C+" q"+x+" "+S+" "+k+" "+A+" ";break;case MapTheme.lineStraightCorner:this._partialChildrenPath+="M"+w+","+C+"l"+k+",0l0,"+A+" "}}return c===l&&(this.childrenPath&&this.childrenPath.remove(),this.childrenPath=s.drawPath(this._partialChildrenPath,!1),this.childrenPath.node.setAttribute("class","tk_line"),this.childrenPathRoot={y:r},this._partialChildrenPath=""),i},redrawRootLine:function(e,t){this.livePath&&(this.livePath.remove(),this.livePath=null),this.rootPath&&this.rootPath.remove();var n=this.rc.vnode.node;if("undefined"===typeof t&&n.isFloating()||t)this.rootPath=null;else{var o=this.rc.vnode.dcontent.getPosition(),r=this.rc.vnode.node.pos?this.rc.vnode.node.pos[0]:0,a=this.rc.vnode.lineCoordinates(e),l=this.rc.vnode.dcontainer.el.cumulativeOffset(),c=canvas.el.cumulativeOffset(),d=Math.negativeOffset(l,c);d=Math.offset(d,a);var h=canvas.root.getCenter(),u=[0,0],p=[h[0]-d[0],h[1]-d[1]],f=[Math.abs(d[0]-h[0]),Math.abs(d[1]-h[1])],m=[];d[0]>h[0]||App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up?(u[0]=d[0]-h[0],p[0]=0,d[0]=h[0],m[0]=parseInt(.2*f[0])):m[0]=-parseInt(.2*f[0]),d[1]>h[1]||App.config.layout.orientation===App.Layouts.orientation.down?(u[1]=d[1]-h[1],p[1]=0,d[1]=h[1],m[1]=f[1]):m[1]=-f[1];var g=[h[0],h[1]],v=[d[0]+u[0]-h[0],d[1]+u[1]-h[1]],y=[m[0],m[1]];if("live"===e){var _=this.rc.vnode.dcontent.el.clientWidth,b=0;(r+o[0]+_>=0&&r+o[0]+_/2<=0||r+o[0]<0&&r+o[0]+_/2>=0)&&(b=(r+o[0]+_)/-1,v[0]+=b)}var w=this.roundNumber(y[0]),C=this.roundNumber(y[1]),x=this.roundNumber(v[0]),S=this.roundNumber(v[1]),k=this.roundNumber(g[0]),A=this.roundNumber(g[1]);"undefined"!=App.config.is_embedded&&App.config.is_embedded&&MM.ua.isBrowser("Firefox")&&(S-=1);var E="M"+k+" "+A+" q"+w+" "+C+" "+x+" "+S+" ",M=!1,I=App.config.layout.getLineStyle();if(I===MapTheme.lineOrganicCurve){if("live"==e)return this.livePath&&this.livePath.remove(),this.livePath=s.drawPath(E,!1,.5),void this.livePath.node.setAttribute("class","tk_line live");M=!0;var O,P=new i.Line(new Point(u),new Point(p)).slope(),T=App.ui.Zoom.getZoomFactor(),L="M"+k+" "+A+" q"+w+" "+C+" "+x+" "+S+"  Q"+(k+w)+" "+(A+C)+" "+(k-(O=null==P||Math.abs(P)>2?[[1,0],[2,0],[3,0],[5,0]]:Math.abs(P)<.5?[[0,1],[0,2],[0,3],[0,5]]:P<0?[[-1,-1],[1,1],[2,1],[3,2]]:[[1,-1],[-1,1],[-2,1],[-3,2]])[3][0]*T)+" "+(A-O[3][1]*T)+" "}else if(I===MapTheme.lineStraight)L="M"+k+" "+A+" l"+x+" "+S+" ";else if(I===MapTheme.lineCurve)L=E;else{if(I!==MapTheme.lineStraightCorner)return;var N=canvas.root.dcontent.el.offsetHeight,R=parseInt(N/2+15);x+=parseInt(this.rc.vnode.dcontent.el.offsetWidth/2),[App.Layouts.orientation.down,App.Layouts.orientation.up].indexOf(App.config.layout.orientation)>=0&&(S-=this.rc.vnode.dcontent.el.offsetHeight,x+=8);L="M"+k+","+A+"l0,"+R+"l"+x+",0l0,"+(S-R)+" "}this.rootPath=s.drawPath(L,M),this.rootPath.node.setAttribute("class","tk_line root")}}});r.ZOOM_LINE_WIDTH=2,r.COLOR="#d6dbde"},"o8/4":function(e,t,n){"use strict";n.r(t);var i=n("7XaY"),o=(n("YIZm"),n("zYya")),s=n("nyiR"),r=n("Avrk"),a=n("4AML"),l=n("ZlCP"),c=n("qgXT"),d=n("ClT6"),h=n("fvY9"),u=n("uE/J"),p=n("x+1z"),f=n("+29S"),m=n("TxdS"),g=n("A4Hc"),v=n("0s9k");function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var b=function(){return a.default.disable()},w=function(){return a.default.enable()},C=Class.create(r.default,{selected:null,allSelected:[],containerSize:null,_marked:null,_index:null,_ghost:null,_scrolling:null,_scrolled:null,features:["graphics","selection","style","icons","images","attachments","connections","presentation"],initialize:function($super){Position.includeScrollOffsets=!0,this.size=[1e4,6e3],this.el=$("canvas"),this.container=this.el.up(),this.clearSelection(),this.initSize(),this.enableCssZoom(),this.el.style.left=Math.max(0,(MM.ui.page.width-this.width-(App.config.hasUI?300:0))/2)+"px",this.el.style.top=Math.max(0,(MM.ui.page.height-this.height)/2)+"px",this.el.style.position="relative",this.containerSize=[this.container.offsetWidth,this.container.offsetHeight],App.ui.Zoom.initialized||App.ui.Zoom.init(this.el,this.container),"phantomjs"!==App.config.environment&&(this._onMD=this._onScrollMouseDown.bindAsEventListener(this),this._onMM=this._onScrollMouseMove.bindAsEventListener(this),this._onMU=this._onScrollMouseUp.bindAsEventListener(this),v.default.init({container:this.el,onScroll:this.onWheelScroll.bind(this),onZoom:App.ui.Zoom.onWheel.bind(App.ui.Zoom)}),v.default.enable(),MM.utils.File.Droppables.add(this.el,{hoverclass:"drop_label",getElement:function(e){var t=d.default.dropWidget.getNode(e);return t?t._listener.dcontent.el:null},dropEffect:"copy",onDrop:this.onFileDrop.bind(this)})),this.initConnections(),this.el.innerHTML='<div id="graphics_container"></div>',s.Graphics.initialize(this.width,this.height),"phantomjs"!==App.config.environment&&(this.createGhost(),this.createMTGhost(),Event.observe(this.container,"scroll",(function(){GeneralPopover.getLastOpened()&&GeneralPopover.getLastOpened().sizeAndPosition()})),this.onStartSelectionRectangleListener=this.onStartSelectionRectangle.bind(this),this.onDragSelectionRectangleListener=this.onDragSelectionRectangle.bind(this),this.onEndDragSelectionsListener=this.onEndDragSelectionRectangle.bind(this),this.setupSelections(),a.default.init()),UI.Registry.add(this),UI.Registry.notify(this,"show"),$super()},postLoad:function(){(App.tree.postInit(),App.config.editable&&sideBar.toEditMode(),App.config.editable?App.toEditMode():App.toViewMode(),ChangeList.autoLayoutChangeset(),App.config.targetId)&&tree.root.getChild(App.config.targetId).toggleAllClosed();if("embedded"===App.config.viewMode){var e=window.location.search.toQueryParams().z;e&&"auto"===e||!e?App.ui.Zoom.zoomToFit():1!==App.config.zoomFactor&&App.ui.Zoom.zoomTo(App.ui.Zoom.getZoomIndex(App.config.zoomFactor),!1,!1),this.onRecenter()}else{if(1!==App.config.zoomFactor&&App.ui.Zoom.zoomTo(App.ui.Zoom.getZoomIndex(App.config.zoomFactor),!1),App.config.targetId)tree.root.getChild(App.config.targetId).toggleAllClosed(!0),this.centerOnElement($(App.config.targetId.toString()));else this.onRecenter()}App.config.isNew&&App.config.editable&&canvas.root.dcontent.toEditing(null,"rename");var t=MM.status.params.query;mm$("fld_filter")&&t&&g.default.setText(t),Event.observe(window,"unload",App.destroy.bindAsEventListener(App)),f.default.initialize(App.config.websockets),App.driveInterval=null,App.googleDrive()&&(App.driveInterval=setInterval(App.driveSave.bind(App),1e4)),App.trigger(CustomEvents.POST_LOAD)},initUI:function(){App.config.hasUI&&(["public","embedded"].include(App.config.viewMode)?(App.ui.Sidebar.init(),App.ui.Footer.init()):(u.default.init(),App.ui.Footer.init(),App.config.editable&&(m.default.init(),sideBar=new p.default),this.enableMobileFullScreen()));for(var e=document.querySelectorAll(".icon-svg"),t=0;t<e.length;t++)MM.ui.svgIcons(e[t]);"phantomjs"!==App.config.environment&&KR.listenTo("icon-svg",MM.ui.svgIcons),App.ui.Options.init({zoomIn:this.onZoomIn.bind(this),zoomOut:this.onZoomOut.bind(this)})},enableMobileFullScreen:function(){MM.ua.isMobile&&(canvas._mobileFullScreen=!0,Event.observe(canvas.el,"click",this.toggleMobileFullScreen))},disableMobileFullScreen:function(){MM.ua.isMobile&&(canvas._mobileFullScreen=null,Event.stopObserving(canvas.el,"click",this.toggleMobileFullScreen))},toggleMobileFullScreen:function(e){var t=Event.element(e);("svg"==t.tagName.toLowerCase()||hasClassName(t,"tk_container")||t==canvas.el)&&c.a.toggle({skipBrowserUI:1})},enableCssZoom:function(){Element.originalCumulativeScrollOffset||(Element.originalCumulativeScrollOffset=Element.cumulativeScrollOffset),Element.cumulativeScrollOffset=function(e){return e.ancestors().include(canvas.container)||e==canvas.container?[canvas.getScrollLeft(),canvas.getScrollTop()]:Element.originalCumulativeScrollOffset(e)},Event.originalPointerX||(Event.originalPointerX=Event.pointerX),Event.pointerX=function(e){var t=e.element(),n=Event.originalPointerX(e);return Element.ancestors(t).include(canvas.container)?App.ui.Zoom.transformCssZoomValue(n,!1):n},Event.originalPointerY||(Event.originalPointerY=Event.pointerY),Event.pointerY=function(e){var t=e.element(),n=Event.originalPointerY(e);return Element.ancestors(t).include(canvas.container)?App.ui.Zoom.transformCssZoomValue(n,!1):n}},disableCssZoom:function(){Element.originalCumulativeScrollOffset&&(Element.cumulativeScrollOffset=Element.originalCumulativeScrollOffset),Event.originalPointerX&&(Event.pointerX=Event.originalPointerX),Event.originalPointerY&&(Event.pointerY=Event.originalPointerY)},createGhost:function(){this._ghost=document.createElement("div"),this._ghost.id="tk_ghost",this._ghost.style.display="none",this.el.appendChild(this._ghost)},createMTGhost:function(){this._mtGhost=new Element("div",{id:"mt_ghost",style:"display: none;"}),this.container.parentNode.appendChild(this._mtGhost)},enableFileDrop:function(){var e=MM.utils.File.Droppables.get(this.el.id);e&&MM.utils.File.Droppables.enable(e)},disableFileDrop:function(){var e=MM.utils.File.Droppables.get(this.el.id);e&&MM.utils.File.Droppables.disable(e)},onFileDrop:function(e,t){var n,i=d.default.dropWidget.getNode(e);if(i._listener.setLoadingOnDrop(),1===t.images.length&&t.images[0].type&&App.config.fileTypes.image.include(t.images[0].type)&&0===t.files.length){if(!App.hasFeature("attachments"))return MM.ui.dialogs.dialogUpgrade({feature:"map_attachments",s:"map_".concat(App.config.map_id)}),void i._listener.removeLoadingFromDrop();n=MM.utils.File.uploadImageFile([i],t.images[0],{successCallback:function(e,t){Tree.utils.setImage(new IdeaImage(e),t)}})}else t.images.length>0||t.files.length>0?sideBar.attachments.upload(t.images.concat(t.files),!1,i)||i._listener.removeLoadingFromDrop():t.imageLinks.length>0?d.default.dropWidget.uploadImageUrl(i,t.imageLinks[0]):t.links.length>0?d.default.dropWidget.uploadLink(i,t.links[0]):n={error:I18n.t("js.unsupported_file_type")};n&&n.error&&(i._listener.removeLoadingFromDrop(),Message.show(n.error,Message.ERROR))},_onDblClick:function(e){var t=Event.element(e);if(t&&"text"!=t.type&&!hasClassName(t,"tk_title")&&!hasClassName(t,"tk_image")&&(!t.up||!t.up(".note_content"))){var n=this._getCursorPosition(e);this.root.node&&this.root.node.addChild([n.x-canvas.root.pcenter[0],n.y-canvas.root.pcenter[1]])}},__onSetMapProperties:function(e){removeClassName(canvas.el,"layout_"+App.config.layout.name);var t=App.Layouts.get(e.layout);App.config.layout=t,addClassName(canvas.el,"layout_"+App.config.layout.name),App.reloadViewSynchronously()},getCenter:function(){return[parseInt(this.size[0]/2),parseInt(this.size[1]/2)]},getScrollCenter:function(e,t){return t||(Position.prepare(),t=e.cumulativeOffset()),[this._centerHorizontalPosition(e,t[0]),this._centerVerticalPosition(e,t[1])]},getScrollLeft:function(){return App.ui.Zoom.transformCssZoomCoordinate(this.container.scrollLeft,"x",!1)},getScrollTop:function(){return App.ui.Zoom.transformCssZoomCoordinate(this.container.scrollTop,"y",!1)},setScrollLeft:function(e){this.container.scrollLeft=App.ui.Zoom.transformCssZoomCoordinate(e,"x",!0)},setScrollTop:function(e){this.container.scrollTop=App.ui.Zoom.transformCssZoomCoordinate(e,"y",!0)},getContainerSize:function(){return{width:App.ui.Zoom.transformCssZoomValue(this.container.offsetWidth,!1),height:App.ui.Zoom.transformCssZoomValue(this.container.offsetHeight,!1)}},getElementOffset:function(e){var t=0,n=0;do{t+=e.offsetTop||0,n+=e.offsetLeft||0,e=e.offsetParent}while(e&&e!==canvas.el);return[n,t]},getNodesFromRectangle:function(e){var t=[],n=canvas.root.dcontent.el.toRectangle();return e.overlaps(n)&&t.push(canvas.root.node),canvas.root.children.map((function(e){return e.dcontainer})).findAll((function(t){var n=t.el.toRectangle();return e.overlaps(n)})).each((function(n){descendants(n.el,(function(e){return hasClassName(e,"tk_label")})).each((function(n){var i=n.toRectangle();e.overlaps(i)&&t.push(tree.root.getChild(parseInt(n.id)))}))})),t},getRectangleFromNodes:function(e){if(0===e.length)return null;var t=e.map((function(e){return e._listener.dcontent.el.toRectangle()}));return t.inject(t[0],(function(e,t){return Rectangle.max(e,t)}))},scrollTo:function(e,t,n){e[0]=e[0]||this.getScrollLeft(),e[1]=e[1]||this.getScrollTop(),t?(e[0]=App.ui.Zoom.transformCssZoomCoordinate(e[0],"x",!0),e[1]=App.ui.Zoom.transformCssZoomCoordinate(e[1],"y",!0),n=Object.extend({x:e[0],y:e[1],duration:Math.abs(e[0]-this.getScrollLeft())>200||Math.abs(e[1]-this.getScrollTop())>200?.5:.2},n||{}),new Effect.Scroll(this.container,n)):(this.setScrollLeft(e[0]),this.setScrollTop(e[1]))},scrollToElement:function(e,t,n,i){t=t||e.cumulativeOffset(),null===n&&(n=!0);var o,s,r=this.getScrollTop(),a=this.getScrollLeft(),l=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.top),c=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.right),d=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.bottom),h=App.ui.Zoom.transformCssZoomValue(15),u=e.getDimensions(),p=this.getContainerSize();i&&(u.height>p.height-l-d||u.width>p.width-h-c)||(a+h>t[0]?o=t[0]-h:a+p.width-c<t[0]+u.width&&(o=t[0]-p.width+u.width+c+10),r+l>t[1]?s=t[1]-l-10:r+p.height-d<t[1]+u.height&&(s=t[1]-p.height+u.height+d+10),(o||s)&&this.scrollTo([o,s],n))},scrollToNode:function(e,t){if(e&&!e.isVisible()){var n=this.getNodeCanvasOffset(e);!n||0===n[0]&&0===n[1]||this.scrollToElement(e.dcontent.el,n,t)}},liveUpdateHighlight:function(e){App.config.liveUpdate&&!ServerData.isLoggedIn&&tree.finishedInitialization&&["embedded","embedded_full","public"].include(App.config.viewMode)&&(canvas.scrollToNode(e._listener,!0),e._listener.highlight("#ffb347"))},_centerVerticalPosition:function(e,t){var n=this.getContainerSize(),i=UI.Registry.viewportOffset;return t+=e.offsetHeight/2,t-=(n.height+App.ui.Zoom.transformCssZoomValue(i.top-i.bottom))/2},_centerHorizontalPosition:function(e,t){var n=this.getContainerSize(),i=UI.Registry.viewportOffset;return t+=e.offsetWidth/2,t-=(n.width-App.ui.Zoom.transformCssZoomValue(i.right))/2},centerOnElement:function(e,t){var n=this.getScrollCenter(e);this.scrollTo(n,!1,t)},enableScrollByDrag:function(){MM.ua.observeTouchSafe(this.el,"mousedown",this._onMD)},disableScrollByDrag:function(){MM.ua.stopObservingTouchSafe(this.el,"mousedown",this._onMD),MM.ua.stopObservingTouchSafe(document,"mousemove",this._onMM),MM.ua.stopObservingTouchSafe(document,"mouseup",this._onMU)},_onScrollMouseDown:function(e){MM.ua.observeTouchSafe(document,"mousemove",this._onMM),MM.ua.observeTouchSafe(document,"mouseup",this._onMU),this._scrolling=!0,this._originalPosition=[e.clientX,e.clientY]},_onScrollMouseMove:function(e){if(this._scrolled=!0,this._scrolling){e.preventDefault();var t=Event.getTouchsafeCoordinates(e),n=[this.getScrollLeft()+App.ui.Zoom.transformCssZoomValue(this._originalPosition[0]-t[0]),this.getScrollTop()+App.ui.Zoom.transformCssZoomValue(this._originalPosition[1]-t[1])];this.scrollTo(n),this._originalPosition=t}},_onScrollMouseUp:function(){this._scrolled=this._scrolling=!1,MM.ua.stopObservingTouchSafe(document,"mousemove",this._onMM),MM.ua.stopObservingTouchSafe(document,"mouseup",this._onMU)},toEditMode:function($super){$super(),removeClassName(this.el,"viewonly"),this._onDC=this._onDblClick.bindAsEventListener(this),Element.observe(this.el,"dblclick",this._onDC)},toViewMode:function($super){$super(),addClassName(this.el,"viewonly"),this._onDC&&Element.stopObserving(this.el,"dblclick",this._onDC)},initEditMode:function($super){$super(),l.default.all.each((function(e){e.view.toEditMode()}));var e=MM.utils.KeyEvent;this._navigationKeyMap.addBinding([{key:[e.TAB,e.INSERT],notCtrl:!0,fn:this.onAdd.bind(this)},{key:e.ENTER,notShift:!0,notCtrl:!0,fn:this.onAddSibling.bind(this)},{key:e.ENTER,shift:!0,fn:this.onAddSibling.bind(this,!0)},{key:e.ENTER,ctrl:!0,fn:this.onEdit},{key:e.F2,notCtrl:!0,fn:this.onEdit},{key:[e.DELETE,e.BACKSPACE],fn:this.onRemove.bind(this)},{key:"c",alt:!0,fn:this.onAddConnection.bind(this)},{key:[e.F1,e.QUESTION_MARK],fn:MM.ui.dialogs.dialogHelp},{key:[e.F6,e.HOME,e.END],notCtrl:!0,fn:this.onRecenter.bindAsEventListener(this,!0)},{key:e.LEFT,fn:this.onSelectLeft.bindAsEventListener(this),withEvent:!0},{key:e.RIGHT,fn:this.onSelectRight.bindAsEventListener(this),withEvent:!0},{key:e.UP,notCtrl:!0,notAlt:!0,fn:this.onSelectUp.bindAsEventListener(this),withEvent:!0},{key:e.DOWN,notCtrl:!0,notAlt:!0,fn:this.onSelectDown.bindAsEventListener(this),withEvent:!0},{key:e.UP,ctrl:!0,notShift:!0,fn:this.onMoveUpDown.bind(this,!1)},{key:e.DOWN,ctrl:!0,notShift:!0,fn:this.onMoveUpDown.bind(this,!0)},{key:e.UP,shift:!0,alt:!0,fn:this.onSetStyle.bind(this,"fontSize",1)},{key:e.DOWN,shift:!0,alt:!0,fn:this.onSetStyle.bind(this,"fontSize",-1)},{key:"a",ctrl:!0,fn:this.onSelectAll.bindAsEventListener(this),withEvent:!0},{key:e.F8,fn:function(){tree.autoCondense()}},{key:e.F8,shift:!0,fn:this.onBeautifyMap.bind(this)},{key:e.SPACE,notShift:!0,fn:this.onToggleClosed.bind(this)},{key:"v",ctrl:!0,shift:!0,fn:a.default.onPasteStyle.bind(a.default)},{key:"z",ctrl:!0,fn:this.onUndo.bind(this)},{key:"y",ctrl:!0,fn:this.onRedo.bind(this)},{key:"f",ctrl:!0,fn:this.onFind.bind(this)},{key:"f",ctrl:!0,alt:!0,fn:this.onToggleFullscreen.bind(this)},{key:"o",fn:function(){App.mapsPopover&&App.mapsPopover.show()}},{key:"m",withEvent:!0,fn:function(e){m.default.initialized&&canvas.selected&&m.default.show(e,{opener:canvas.selected.dcontent.el})}},{key:"b",ctrl:!0,fn:this.onSetStyle.bind(this,"bold","toggle")},{key:"i",ctrl:!0,fn:this.onSetStyle.bind(this,"italic","toggle")},{key:"p",shift:!0,alt:!0,fn:this.onToggleSidebar.bind(this)},{key:"n",shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"notes")},{key:229,shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"notes")},{key:"l",shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"links")},{key:"t",shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"tasks")},{key:"0",alt:!0,fn:this.onShowDetail.bind(this,99)},{key:"1",alt:!0,fn:this.onShowDetail.bind(this,1)},{key:"2",alt:!0,fn:this.onShowDetail.bind(this,2)},{key:"3",alt:!0,fn:this.onShowDetail.bind(this,3)},{key:"4",alt:!0,fn:this.onShowDetail.bind(this,4)},{key:e.NINE_FIX,alt:!0,fn:this.onShowDetail.bind(this,99)},{key:e.F2,ctrl:!0,fn:function(){sideBar.notes.focus()}},{key:e.PLUS,notCtrl:!0,fn:this.onZoomIn.bind(this)},{key:e.MINUS,notCtrl:!0,fn:this.onZoomOut.bind(this)},{key:e.ESC,notCtrl:!0,fn:this.onCancelConnection.bind(this)}]),this._editKeyMap.addBinding([{key:e.ENTER,notShift:!0,fn:function(){canvas.selected.select(null,null,!0)}},{key:e.ESC,fn:function(){canvas.selected.select()}},{key:[e.TAB,e.INSERT],notCtrl:!0,fn:function(){canvas.selected.select(null,null,!0),canvas.onAdd()}},{key:MM.ua.isBrowser("Internet Explorer")?[e.LEFT,e.RIGHT]:[],alt:!0,fn:Prototype.emptyFunction}]),Draggables.removeObserver(this.el),Draggables.addObserver({element:this.el,onStart:function(e,t,n){canvas.onStart(t.element,n)},onEnd:function(e,t,n){canvas.onEnd(t.element,n)},onDrag:function(e,t,n){canvas.onDrag(t.element,n)}}),this.shiftKeyPressListener=this.onShiftKeyPress.bindAsEventListener(this),this.shiftKeyReleaseListener=this.onShiftKeyRelease.bindAsEventListener(this),document.observe("keydown",this.shiftKeyPressListener),document.observe("keyup",this.shiftKeyReleaseListener),Modernizr.draganddrop&&this.enableFileDrop(),a.default.enable(),this.contextMenu=new h.default(b,w)},initViewOnlyMode:function($super){$super(),l.default.all.each((function(e){e.view.toViewMode()}));var e=MM.utils.KeyEvent;this._viewOnlyKeyMap.addBinding([{key:e.PLUS,notCtrl:!0,fn:this.onZoomIn.bind(this)},{key:e.MINUS,notCtrl:!0,fn:this.onZoomOut.bind(this)},{key:[e.F6,e.HOME,e.END],notCtrl:!0,fn:this.onRecenter.bindAsEventListener(this,!0)},{key:"0",alt:!0,fn:this.onShowDetail.bind(this,99)},{key:"1",alt:!0,fn:this.onShowDetail.bind(this,1)},{key:"2",alt:!0,fn:this.onShowDetail.bind(this,2)},{key:"3",alt:!0,fn:this.onShowDetail.bind(this,3)},{key:"4",alt:!0,fn:this.onShowDetail.bind(this,4)},{key:e.NINE_FIX,alt:!0,fn:this.onShowDetail.bind(this,99)}]),Modernizr.draganddrop&&this.disableFileDrop(),this._onDC&&this.el.stopObserving("dblclick",this._onDC),a.default.disable()},disableEditMode:function(){this.el.stopObserving("dblclick",this._onDC),this._ghost&&mm$(this._ghost.id)&&Element.remove(this._ghost)},disableViewOnlyMode:function(){this.el.observe("dblclick",this._onDC)},onShiftKeyPress:function(e){this.shiftPressed||16==(e.keyCode||e.charCode)&&(this.shiftPressed=!0,this.selected&&this.selected.image&&this.selected.image.dcontainer.onShiftPressed())},onShiftKeyRelease:function(e){16===(e.keyCode||e.charCode)&&(this.shiftPressed=!1,this.selected&&this.selected.image&&this.selected.image.dcontainer.onShiftReleased())},checkBounds:function(){if(!tree.notPainted&&!App.config.fullScreenExport&&tree.finishedInitialization)for(var e=App.config.layout.canvasBounds(),t=0;(e[0]>0||e[1]>0)&&t<5;){var n=e[0]+200,i=e[1]+200;this.size=Math.offset(this.size,[n,i]),this.changeSize(),this.container.scrollLeft+=n/2,this.container.scrollTop+=i/2,e=App.config.layout.canvasBounds(),t++}},getMapLeftSize:function(){for(var e=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],t=rectangleLayouter.rectangles(),n=0,i=0,o=t.length;i<o;i++){var s=t[i];s.p1.x<n&&(n=s.p1.x)}return Math.max(-n,e[0]/2)},getMapRightSize:function(){for(var e=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],t=rectangleLayouter.rectangles(),n=0,i=0,o=t.length;i<o;i++){var s=t[i];s.p2.x>n&&(n=s.p2.x)}return Math.max(n,e[0]/2)},getMapUpperSize:function(){for(var e=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],t=rectangleLayouter.rectangles(),n=0,i=0,o=t.length;i<o;i++){var s=t[i];s.p1.y<n&&(n=s.p1.y)}return Math.max(-n,e[1]/2)},getMapLowerSize:function(){for(var e=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],t=rectangleLayouter.rectangles(),n=0,i=0,o=t.length;i<o;i++){var s=t[i];s.p2.y>n&&(n=s.p2.y)}return Math.max(n,e[1]/2)},getMapSizeAndOffset:function(e){if(App.config.layout.autoAlign){var t=mm$("tk_map").offsetLeft,n=mm$("tk_map").offsetTop,i=App.config.layout.mapSize();if(e){var o=i.centerOffset;o[0]<i.width/2?(t-=2*(i.width-o[0])-i.width,i.width=2*(i.width-o[0])):i.width=2*o[0],o[1]<i.height/2?(n-=2*(i.height-o[1])-i.height,i.height=2*(i.height-o[1])):i.height=2*o[1]}var r={left:t,top:n,width:canvas.el.clientWidth,height:canvas.el.clientHeight,realWidth:i.width,realHeight:i.height}}else{var a=canvas.getCenter(),l=canvas.getMapLeftSize(),c=canvas.getMapRightSize(),d=canvas.getMapUpperSize(),h=canvas.getMapLowerSize(),u=c+l,p=d+h;t=a[0]-l,n=a[1]-d;e&&(l<u/2?(t-=2*c-u,u=2*c):u=2*l,d<p/2?(n-=2*h-p,p=2*h):p=2*d);r={left:t,top:n,width:canvas.el.clientWidth,height:canvas.el.clientHeight,realWidth:u,realHeight:p}}var f=[];s.Graphics.connectionstack.values().each((function(e){e.each((function(e){"path"===e.type&&f.push(e.node)}))})),s.Graphics.allBoundaries.values().each((function(e){f.push(e.node)})),f.each((function(e){var t=e.getBBox();t.x<r.left&&(r.realWidth+=r.left-t.x+5,r.left=t.x-5),t.y<r.top&&(r.realHeight+=r.top-t.y+5,r.top=t.y-5),t.x+t.width>r.left+r.realWidth&&(r.realWidth+=t.x+t.width-r.left-r.realWidth+5),t.y+t.height>r.top+r.realHeight&&(r.realHeight+=t.y+t.height-r.top-r.realHeight+5)}));for(var m=document.getElementsByClassName("connection_label"),g=0,v=m.length;g<v;g++){var y=m[g];y.offsetLeft<r.left&&(r.realWidth+=r.left-y.offsetLeft+5,r.left=y.offsetLeft-5),y.offsetTop<r.top&&(r.realHeight+=r.top-y.offsetTop+5,r.top=y.offsetTop-5),y.offsetLeft+y.clientWidth>r.left+r.realWidth&&(r.realWidth+=y.offsetLeft+y.clientWidth-r.left-r.realWidth+5),y.offsetTop+y.clientHeight>r.top+r.realHeight&&(r.realHeight+=y.offsetTop+y.clientHeight-r.top-r.realHeight+5)}return r},initSize:function(){this.width=this.size[0],this.height=this.size[1],(this.width<MM.ui.page.width||this.height<MM.ui.page.height)&&(this.width=MM.ui.page.width,this.height=MM.ui.page.height,this.size=[this.width,this.height]),this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",s.Graphics.resize(this.width,this.height)},changeSize:function(){this.initSize(),tree.notPainted||(canvas.root.reposition(),canvas.root.children.each((function(e){App.config.layout.rootChildrenPosition&&e.rc.reposition()})),rectangleLayouter.updateAll())},destroy:function($super){$super(),Draggables.removeObserver(this.el),this.disableConnections(),this.disableScrollByDrag(),this.disableCssZoom(),a.default.disable(),this.contextMenu&&(this.contextMenu.stopObserving(),this.contextMenu=null),this.clearSelection(),this.disableSelections()},getNodeCanvasOffset:function(e){return this.getElementOffset(e.dcontent.el)},isSelected:function(e){return canvas.selected==e},onSelect:function(e,t,n,i){if(!e.dcontent||document.body.contains(e.dcontent.el))if(canvas.addFocus(),n||this.scrollToNode(e),canvas.isSelected(e))canvas.allSelected.indexOf(e)<0&&canvas.allSelected.push(e);else{var o=!1,s=!1;if(t&&(o=MM.ua.isPlatform("Macintosh")?t.metaKey:t.ctrlKey,s=t.shiftKey),e.image&&e.image.dcontainer.toSelected(),canvas.allSelected.length>0&&(o||s||i?canvas.allSelected.each((function(t){e!=t&&t.dcontent.toPartiallySelected(!0)})):(canvas.allSelected.each((function(t){e!=t&&(t.dcontent.toInactive(!0),t.image&&t.image.dcontainer.toInactive())})),canvas.allSelected=[])),s&&canvas.selected&&e.node.parent&&canvas.selected.node.parent==e.node.parent&&!e.node.isRootC()){for(var r=canvas.selected.node.parent.children,a=r.indexOf(canvas.selected.node),l=r.indexOf(e.node),c=[],d=0,h=r.length;d<h;d++)d>Math.min(a,l)&&d<Math.max(l,a)&&c.push(r[d]);a>l&&c.reverse(),c.each((function(e){e._listener.dcontent.toPartiallySelected(!0),canvas.allSelected.push(e._listener)}))}canvas.selected=e,canvas.allSelected.indexOf(e)<0&&canvas.allSelected.push(e),sideBar&&sideBar.onSelectNode(),canvas.selected.node.connections.each((function(e){e.view.showConnectionHandlers()}))}},onUnselect:function(e){this.allSelected=this.allSelected.reject((function(t){return t.node==e.node})),e.node.connections.each((function(e){e.view.hideConnectionHandlers()}))},onSelectAll:function(e){this.scrollToNode(this.root),this.selected=this.root,this.allSelected=[this.root],this.root.eachChild(function(e){e!==this.root&&(this.allSelected.push(e),e.dcontent.toPartiallySelected(!0))}.bind(this)),this.root.select(e,!1,!0,!0)},__onStopEdit:function($super){sideBar&&sideBar.onSelectNode(canvas.selected),$super()},editMode:function($super){$super(),this.disableScrollByDrag(),this._navigationKeyMap.disable(),this._editKeyMap.enable()},navigationMode:function($super){$super(),this.addFocus(),this.enableScrollByDrag(),App.config.editable&&App.config.currentlyEditable&&(this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.enable())},markDropTarget:function(e,t,n,i,o){if(!n){canvas._ghost&&!mm$(canvas._ghost.id)&&canvas.createGhost();var s=e.getGhostPosition(t,i,o);canvas._ghost.style.left=s.pos[0]+"px",canvas._ghost.style.top=s.pos[1]+"px",canvas._ghost.style.backgroundPosition=s.offset[0]+"px "+s.offset[1]+"px",Element.show(canvas._ghost)}canvas._index=t,canvas._marked!=e&&(canvas._marked&&canvas._marked.unmark(),e.mark(),canvas._marked=e)},unmarkDropTarget:function(){canvas._marked&&(canvas._marked.unmark(),canvas._marked=null,canvas._index=null,Element.hide(canvas._ghost))},onToggleClosed:function(){this.selected.node.toggleClosed()},onSelectLeft:function(e){var t=this.allSelected,n=e.shiftKey;t.each((function(t){if(t.node.isRoot()){if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up)return;if(n)t.getLeftChildren().each((function(t){t.dcontent.isPartiallySelected()||t.dcontent.isSelected()||t.select(e)}));else!(i=canvas.root.getChildAtAngle(180))||i.dcontent.isPartiallySelected()||i.dcontent.isSelected()||i.select(e)}else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var i=null;t.node.isRootC()?(o=t.node.getPrevSibling())&&(i=o._listener):i=t.getLeftCounterpart(),!i||i.dcontent.isPartiallySelected()||i.dcontent.isSelected()||i.select(e)}else if(t.rc.orientation==App.Layouts.orientation.left)if(n)t.children.each((function(n){n.dcontent.isPartiallySelected()||n.dcontent.isSelected()||n.select(e,t.node.depth()+1)}));else{var o=t.node.getMiddleChild();!o||o._listener.dcontent.isPartiallySelected()||o._listener.dcontent.isSelected()||o._listener.select(e,t.node.depth()+1)}else t.parent?t.parent.dcontent.isPartiallySelected()||t.parent.dcontent.isSelected()||t.parent.select(e,t.node.depth()-1):canvas.root.dcontent.isPartiallySelected()||canvas.root.dcontent.isSelected()||canvas.root.select(e)}))},onSelectRight:function(e){var t=this.allSelected,n=e.shiftKey;t.each((function(t){if(t.node.isRoot()){if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up)return;if(n)t.getRightChildren().each((function(t){t.dcontent.isPartiallySelected()||t.dcontent.isSelected()||t.select(e)}));else!(i=canvas.root.getChildAtAngle(0))||i.dcontent.isPartiallySelected()||i.dcontent.isSelected()||i.select(e)}else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var i=null;t.node.isRootC()?(o=t.node.getNextSibling())&&(i=o._listener):i=t.getRightCounterpart(),!i||i.dcontent.isPartiallySelected()||i.dcontent.isSelected()||i.select(e)}else if(t.rc.orientation==App.Layouts.orientation.right)if(n)t.children.each((function(n){n.dcontent.isPartiallySelected()||n.dcontent.isSelected()||n.select(e,t.node.depth()+1)}));else{var o=t.node.getMiddleChild();!o||o._listener.dcontent.isPartiallySelected()||o._listener.dcontent.isSelected()||o._listener.select(e,t.node.depth()+1)}else t.parent?t.parent.dcontent.isPartiallySelected()||t.parent.dcontent.isSelected()||t.parent.select(e,t.node.depth()-1):canvas.root.dcontent.isPartiallySelected()||canvas.root.dcontent.isSelected()||canvas.root.select(e)}))},onSelectUp:function(e){var t=this.selected,n=null,i=null;if(t.node.isRoot())App.config.layout.orientation!==App.Layouts.orientation.down&&(i=null,(n=canvas.root.getChildAtAngle(90))&&(n=n.node));else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var o=t.node;if(o.isRootC())n=o.parent;else{var s=o.getPrevSibling();if(s)if(s.children.length>0){for(;s.children.length>0&&!s.isRootC();)s=s.children[s.children.length-1];n=s}else n=s;else n=o.parent}}else(n=t.node.getPrevSiblingExtended(canvas._rememberedDepth))&&(n=n.getVisibleParent()),n&&canvas._rememberedDepth?i=canvas._rememberedDepth:n&&t.node.depth()>n.depth()&&(i=t.node.depth());n&&((n._listener.dcontent.isSelected()||n._listener.dcontent.isPartiallySelected())&&(t.dcontent.toInactive(),n._listener.dcontent.toInactive()),n._listener.select(e,i))},onSelectDown:function(e){var t=this.selected,n=null,i=null;if(t.node.isRoot())App.config.layout.orientation!==App.Layouts.orientation.up&&(i=null,(n=canvas.root.getChildAtAngle(270))&&(n=n.node));else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var o=t.node;if(o.children.length>0)n=o.children[0];else{var s=o.getNextSibling();if(s)n=s;else{for(var r=o.parent;r&&!r.getNextSibling()&&!r.isRootC();)r=r.parent;r&&!r.isRootC()&&(n=r.getNextSibling())}}}else(n=t.node.getNextSiblingExtended(canvas._rememberedDepth))&&(n=n.getVisibleParent()),n&&canvas._rememberedDepth?i=canvas._rememberedDepth:n&&t.node.depth()>n.depth()&&(i=t.node.depth());n&&((n._listener.dcontent.isSelected()||n._listener.dcontent.isPartiallySelected())&&(t.dcontent.toInactive(),n._listener.dcontent.toInactive()),n._listener.select(e,i))},onMoveUpDown:function(e){var t,n=this.selected;n.node.isRoot()||n.node.isRootC()||(t=e?n.node.getNextSibling():n.node.getPrevSibling())&&Tree.utils.moveNodes([n.node],n.node.parent,n.node.parent.indexOf(t)+(e?1:0))},onAdd:function(e){e||(e=this.selected),e.node.addChild(App.config.layout.nextTopicPosition(e.node)),App.trigger(CustomEvents.CHILD_ADDED)},onAddSibling:function(e){if(this.selected.node.isRoot())this.selected.node.addChild();else if(this.selected.parent){var t=this.selected.parent.node,n=App.config.layout.nextTopicPosition(t);e?t.addChild(n,t.rank(this.selected.node),this.selected.node.style):t.addChild(n,t.rank(this.selected.node)+1,this.selected.node.style)}else this.root.node.addChild(null,null,this.selected.node.style)},onAddFloating:function(){if(mm$("tk_openerghost")&&this.root.node){var e=mm$("tk_openerghost").cumulativeOffset(),t=[e.left-this.root.pcenter[0],e.top-this.root.pcenter[1]];this.root.node.addChild(t,null,null,!0)}},onRemove:function(){var e=this.allSelected.map((function(e){return e.node})).reject((function(e){return e.isRoot()}));e=e.reject((function(t){return e.any((function(e){return t.getAncestors().include(e)}))})),Tree.utils.removeNodes(e)},onConnect:function(){var e=canvas.allSelected.map((function(e){return e.node})).reject((function(e){return!e.isRootC()||!e.isFloating()}));Tree.utils.connect(e)},onDisconnect:function(){var e=canvas.allSelected,t=[],n={};e.each(function(e){var i=e.node;if(!i.isRoot()&&!i.isFloating()&&(t.push(i),!i.isRootC())){var o=this.getCenter(),s=this.getNodeCanvasOffset(e);n[i.id]=[s[0]-o[0]+(e.rc.orientation?15:-25),s[1]-o[1]]}}.bind(this)),Tree.utils.disconnect(t,n),this.scrollToNode(this.selected,!0)},onEdit:function(){canvas.selected.dcontent.toEditing(null,"rename")},highlightTopics:function(){this.allSelected.each((function(e){e.highlight("#ffb347")}))},onSetGroupIcon:function(e,t,n){Event.stop(e);var i=n.nextInGroup();i&&(t._listener.select(),sideBar&&sideBar.icons.setIcon(i.fullName()))},onSetIcon:function(e){if(canvas.selected){var t=canvas.allSelected.map((function(e){return e.node}));Tree.utils.setIcon(e,t)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onRemoveIcon:function(e){if(canvas.selected){var t=canvas.allSelected.map((function(e){return e.node}));Tree.utils.removeIcon(e,t)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetStyle:function(e,t){if(canvas.selected){var n=canvas.allSelected.map((function(e){return e.node}));Tree.utils.setStyle(e,t,n)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetFullStyle:function(e){if(canvas.selected){var t=canvas.allSelected.map((function(e){return e.node}));Tree.utils.setFullStyle(e,t)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetBoundary:function(e){if(canvas.selected){var t=canvas.allSelected.map((function(e){return e.node}));Tree.utils.setBoundary(e,t)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetVideo:function(e,t){if(canvas.allSelected.length>0){var n=t?[t]:canvas.allSelected.map((function(e){return e.node}));Tree.utils.setVideo(e,n)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetVote:function(e){if(canvas.selected){var t=canvas.allSelected.map((function(e){return e.node}));Tree.utils.setVote(e,t)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetProperty:function(e,t,n){if(canvas.selected){n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(n,!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({onOk:function(){return null},onCancel:function(){return null}},n);var i=canvas.allSelected.map((function(e){return e.node})),o=function(){Tree.utils.setProperty(e,t,i),n.onOk()};i.length>10?Dialog.confirm("<h2>"+I18n.t("js.edit_multiple")+"</h2><p>"+I18n.t("js.edit_multiple_text",{v0:i.length+1})+"</p>",{windowParameters:{height:120,width:400},ok:function(){o(),this.close()},cancel:function(){n.onCancel(),this.close()}}):o()}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onRemoveTask:function(){if(canvas.selected){var e=canvas.allSelected.map((function(e){return e.node}));Tree.utils.removeTask(e)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onAddConnection:function(e){e&&e.stop&&e.stop(),this._nodeToConnect=this.selected,document.observe("click",this._onConnectToListener),document.observe("mousemove",this._onConnectionDragListener)},initConnections:function(){this._onConnectToListener=this.onConnectTo.bind(this),this._onConnectionDragListener=this.onConnectionDrag.bind(this),this._dragConnectionCanvas=new o.default},disableConnections:function(){document.stopObserving("click",this._onConnectToListener),document.stopObserving("mousemove",this._onConnectionDragListener),this._dragConnectionCanvas&&this._dragConnectionCanvas.destroy()},onCancelConnection:function(){this._nodeToConnect&&(document.stopObserving("click",this._onConnectToListener),document.stopObserving("mousemove",this._onConnectionDragListener),this._dragConnectionCanvas.clear(),this._nodeToConnect=null)},onConnectTo:function(e){if(this._nodeToConnect){var t=e.findElement(".tk_label");if(t){document.stopObserving("click",this._onConnectToListener),document.stopObserving("mousemove",this._onConnectionDragListener),this._dragConnectionCanvas.clear();try{var n=this._nodeToConnect.node,i=t._listener.node;if(this._nodeToConnect=null,n===i)return Message.show(I18n.t("js.connect_node_to_itself"),Message.NOTICE);if(l.default.get(n.id,i.id))return Message.show(I18n.t("js.connection_already_exists"),Message.NOTICE);n.connectTo(i)}catch(o){MM.error.reportException({exception:o,message:"Connection drawing problem in onConnectTo: ",metaData:{from:n,to:i,event:e}})}}}},onConnectionDrag:function(e){this.onConnectionDrag.start||(this.onConnectionDrag.start=this.onConnectionDrag.previous=[Event.pointerX(e),Event.pointerY(e)],this.onConnectionDrag.previousTs=new Date);var t=new Date;if(!(t-this.onConnectionDrag.previousTs<200)){this.onConnectionDrag.previousTs=t;var n=this._getCursorPosition(e),i=this.onConnectionDrag.previous;this.onConnectionDrag.previous=n,Math.abs(n.x-i.x)<3&&Math.abs(n.y-i.y)<3||this._dragConnectionCanvas.drawTemporaryConnection(this._nodeToConnect,n)}},_getCursorPosition:function(e){var t=0,n=0;return e&&(t=e.clientX,n=e.clientY),new Point([App.ui.Zoom.transformCssZoomCoordinate(t+this.container.scrollLeft,"x",!1),App.ui.Zoom.transformCssZoomCoordinate(n+this.container.scrollTop,"y",!1)])},_findAffectedRootChild:function(e,t,n){var i,o=t[0]-this.getCenter()[0];(i=this.root.children.filter((function(t){var n=t.node.pos[0]*o>0&&t!=e._listener;return n&&(t._positionOnCanvas=canvas.getNodeCanvasOffset(t)),n}))).sort((function(e,n){var i=e._positionOnCanvas[1]-t[1],o=n._positionOnCanvas[1]-t[1];return Math.abs(i)-Math.abs(o)}));var s=i[0];if(i.length>0){var r=null;if(s._positionOnCanvas[1]<t[1]){for(var a=1;a<i.length;a++)if(t[1]<i[a]._positionOnCanvas[1]){r=i[a];break}n[1]=r?(r.node.pos[1]-s.node.pos[1])/2:10+s.dcontent.size()[1]}else{for(a=1;a<i.length;a++)if(t[1]>i[a]._positionOnCanvas[1]){r=i[a];break}n[1]=r?(r.node.pos[1]-s.node.pos[1])/2:-25}}else n[0]=o>0?100:-100,n[1]=-50;return s},onStart:function(e){var t=e._listener;if(t){if(this.disableScrollByDrag(),addClassName(document.body,"unselectable"),addClassName(e,"dragging"),this._scrolling=!1,t.image&&t.image.dcontainer.toInactive(),t.video&&t.video.showPlaceholder(),canvas._originalPosition=canvas.getElementOffset(e),(t.isSelected()||t.isPartiallySelected())&&(t.dcontent.disableSelecting(),canvas.allSelected.length>1)){var n=e.offsetWidth,i=e.offsetHeight;addClassName(e,"multiple"),e.setStyle({width:n+"px",height:i+"px"})}t.dcontainer.oldZ=t.dcontainer.el.style.zIndex,t.dcontainer.el.style.zIndex=e.style.zIndex}},onDrag:function(e,t){var n=e._listener;if(n){canvas.disableScrollByDrag(),this._scrolling=!1,n.node.isRootC()||n._tempRc||(n._tempRc=new i.default(n));var o=n._tempRc||n.rc;if(this._mtGhost||this.createMTGhost(),App.ui.Footer.activeBar&&"meistertask"===App.ui.Footer.activeBar&&MM.utils.Meistertask.overlapsFooter(t))return canvas._mt_drop=!0,canvas.unmarkDropTarget(),o.graphics.livePath&&(o.graphics.livePath.remove(),o.graphics.livePath=null),o.graphics.rootPath&&(o.graphics.rootPath.remove(),o.graphics.rootPath=null),e.style.opacity=0,MM.utils.Meistertask.onHover(n,t),void(n.node.isRootC()?(removeClassName(n.dcontent.el,"node"),addClassName(n.dcontent.el,"root_child")):(removeClassName(n.dcontent.el,"root_child"),addClassName(n.dcontent.el,"node")));canvas._mt_drop=!1,hide(this._mtGhost),e.style.opacity="",(!n.dcontent.isSelected()&&!n.dcontent.isPartiallySelected()||(n.dcontent.isSelected()||n.dcontent.isPartiallySelected())&&1==canvas.allSelected.length)&&(canvas._canvasDrop||canvas._marked===canvas.root?(removeClassName(n.dcontent.el,"node"),addClassName(n.dcontent.el,"root_child"),o.redrawRootLine("live")):canvas._marked?canvas._marked.node.isRoot()&&App.config.layout.name.indexOf("aligned")>=0?(removeClassName(n.dcontent.el,"node"),addClassName(n.dcontent.el,"root_child"),o.redrawRootLine("live")):(o.redrawRootLine("live",!0),removeClassName(n.dcontent.el,"root_child"),addClassName(n.dcontent.el,"node")):(n._tempRc&&n._tempRc.redrawRootLine("live",!0),n.node.isRootC()?o.redrawRootLine("live"):(removeClassName(n.dcontent.el,"root_child"),addClassName(n.dcontent.el,"node"))))}},getDroppingNodes:function(e){if(removeClassName(e,"multiple"),e._listener.dcontent.isSelected()||e._listener.dcontent.isPartiallySelected())var t=canvas.allSelected;else t=[e._listener];return t=t.reject((function(e){return e.node.isRoot()}))},onEnd:function(e,t){var n=e._listener;if(n){if(canvas.enableScrollByDrag(),removeClassName(document.body,"unselectable"),removeClassName(e,"dragging"),e.style.opacity="",n.node.isRootC()&&(removeClassName(e,"node"),addClassName(e,"root_child")),n._tempRc&&(n._tempRc.redrawRootLine("live",!0),n._tempRc=null),canvas._mt_drop)(i=this.getDroppingNodes(e)).each((function(e){e.dcontainer.resetPosition(),e.dcontent.resetPosition(),e.node.isRootC()&&e.rc.redrawRootLine()})),MM.utils.Meistertask.onDrop(i),canvas._mt_drop=!1,App.trigger(CustomEvents.EXTERNAL_TASK_CREATED);else if(canvas._canvasDrop)this.onCanvasDrop(e);else if(canvas._marked)this.onLblDrop(e),App.trigger(CustomEvents.TOPIC_DROPPED);else{var i;(i=this.getDroppingNodes(e)).each((function(e){e.dcontent.resetPosition(),e.node.isRootC()&&e.rc.redrawRootLine()}))}setTimeout((function(){n.isSelected()?n.dcontent.enableSelecting():n.select(t,null,null,!0,n.isPartiallySelected()),n.image&&n.image.dcontainer.toSelected(),n.video&&n.video.removePlaceholder()}),0),n.dcontainer.el.style.zIndex=e._listener.dcontainer.oldZ}},onCanvasDrop:function(e){if(this._canvasDrop){var t=this.getDroppingNodes(e),n=e._listener,i=[parseInt(e.style.left),parseInt(e.style.top)];if(n.rc.orientation===App.Layouts.orientation.left&&(i[0]-=n.dopener.size()[0]+6),"org_chart"!==App.config.layout.name){var o;if(n.node.isRootC())o=Math.offset(n.node.pos,i);else{var s=canvas.getCenter();o=Math.negativeOffset(Math.offset(canvas._originalPosition,i),s)}if(t.each((function(e){e.dcontent.resetPosition()})),!n.node.isRootC())if(Math.diagonal([i[0]-e.offsetLeft,i[1]-e.offsetTop])<12)return;var r=t.map((function(e){return e.node}));t.each((function(e){e.rc.graphics&&e.rc.graphics.livePath&&e.rc.graphics.livePath.remove()})),Tree.utils.moveNodes(r,canvas.root.node,0,null,o)}else this.reOrderRootChildren(t,i)}},onLblDrop:function(e){if(e&&removeClassName(e,"multiple"),e._listener.dcontent.isSelected()||e._listener.dcontent.isPartiallySelected())var t=canvas.allSelected;else t=[e._listener];(t=t.reject((function(e){return e.node.isRoot()}))).each((function(e){e.dcontent.resetPosition()}));var n=t.map((function(e){return e.node}));canvas._marked.node.isRoot()?Tree.utils.moveNodes(n,canvas._marked.node,0,null,canvas._dropPosition):Tree.utils.moveNodes(n,canvas._marked.node,canvas._index),canvas.unmarkDropTarget()},findAffected:function(e,t){var n=this._getCursorPosition();e=Math.offset(e,[n.x,n.y]);var i=this.root.findAffected(e);if(i)return this._canvasDrop=!1,i;if(App.config.layout.name.indexOf("aligned")>=0){this._canvasDrop=!1;var o=[0,0],s=this._findAffectedRootChild(t,e,o);return this.markDropTarget(this.root,null,null,o,s),this.root.el}return this._canvasDrop=!0,this.unmarkDropTarget(),this.el},onLblHover:function(e,t,n){if(!canvas._mt_drop){var i,o,s,r=t._listener,a=e._listener;if(r.node===a.node||r.node.isChild(a.node))return this._canvasDrop=!App.config.layout.autoAlign&&a.node.isRootC()&&(Math.abs(e.offsetTop)>20||Math.abs(e.offsetLeft)>20),void this.unmarkDropTarget();if(n=1-n,!r.node.isRootC()||App.config.layout.autoAlign&&"org_chart"!==App.config.layout.name){var l=1-Position.overlap("horizontal",t);n>=0&&n<=1&&(r.rc.orientation==App.Layouts.orientation.left&&l<.4||r.rc.orientation==App.Layouts.orientation.right&&l>.6)?(i=r,o=n>.5?r.node.children.length:0):(i=r.parent).node.isRoot()?(s=[0,0])[1]+=n>.5?10+r.dcontent.size()[1]:-25:(o=i.node.indexOf(r.node),n>.5&&o++)}else i=r,o=n>.5?r.node.children.length:0;i==canvas._marked&&o==canvas._index||canvas.markDropTarget(i,o,null,s,r)}},reOrderRootChildren:function(e,t){e.each((function(e){e.dcontent.resetPosition()})),t[0]+=e[0].rc.vnode.dcontainer.el.offsetLeft,t[1]=e[0].dcontent.el.cumulativeOffset()[1]-canvas.getCenter()[1];var n=canvas.root.children.sort((function(e,t){return e.dcontainer.el.offsetLeft-t.dcontainer.el.offsetLeft})),i=(n=n.reject((function(t){return e.indexOf(t)>=0}))).map((function(e){return[e,[e.dcontainer.el.offsetLeft,e.node.pos[1]]]})),o=n.detect((function(e){return e.dcontainer.el.offsetLeft>t[0]}));if(o)var s=n.indexOf(o);else s=n.length;e.each((function(e){i.insert([e,[t[0],t[1]]],s)}));var r=[];i.each((function(e){var t=e[0].node;t.isRootC()?r.push(new RepositionChange({idea_id:t.id,type:"Reposition",old_data:{pos:t.pos},new_data:{pos:e[1]}})):r.push(new MoveChange({idea_id:t.id,type:"Move",old_data:{parent:t.parent.id,rank:t.parent.rank(t),pos:t.pos},new_data:{parent:canvas.root.node.id,rank:s+i.indexOf(e),pos:e[1]}}))})),ChangeList.layoutAlteringChangeset(r)},onWheelScroll:function(e,t){e.preventDefault(),e.stopPropagation();var n=Math.max(App.ui.Zoom.getZoomFactor(),1)*App.ui.Zoom.getScaleAvg(),i=t.deltaX/n,o=t.deltaY/n;this.scrollTo([this.getScrollLeft()+i,this.getScrollTop()+o])},getZoomPosition:function(){return this.selected&&this.selected.isVisible()?this.selected.getCentralPosition():null},onZoomIn:function(){return App.ui.Zoom.zoomIn(!0,!0,this.getZoomPosition()),App.config.currentlyEditable||this.disableEditMode(),!1},onZoomOut:function(){return App.ui.Zoom.zoomOut(!0,!0,this.getZoomPosition()),App.config.currentlyEditable||this.disableEditMode(),!1},onFind:function(){g.default.activate()},onToggleSidebar:function(){sideBar&&sideBar.toggle(!0)},onShowDetail:function(e,t){(t&&canvas.selected?canvas.selected:canvas.root).node.toggleClosedDetail(e)},onAlphabetize:function(){var e=this.selected.alphabetizeChildren();App.config.layout.autoAlign||e.changes.each((function(t){e.doNodeLayoutingChanges(t.node())})),ServerConnection.doChanges(e)},numberIt:function(e,t){var n=new ChangeList;canvas.selected.eachChildWithCounter((function(t,i){if(0!=i){var o,s=t.node.getRawTitle(),r=/^(\d)+\. ([\s\S]*)/.exec(s);o=e?r?r[2]:s:r?i+". "+r[2]:i+". "+s,n.changes.push(new RenameChange({idea_id:t.node.id,type:"Title",old_data:{title:s.title},new_data:{title:t.node.escapeTitle(o)}}))}}),0,!1,!t),n.changes.each((function(e){e.execute(),App.config.layout.elasticLayout&&n.doNodeLayoutingChanges(e.node())})),ServerConnection.doChanges(n)},onNumbering:function(){var e=!1;canvas.selected.eachChild((function(t){if(!e){var n=t.node.title;/^(\d)+\. (.*)/.exec(n)&&(e=!0)}})),e?Dialog.confirm("<h2>"+I18n.t("js.numbering_heading")+'</h2><p class="hint">'+I18n.t("js.numbering_hint")+" "+I18n.t("js.what_to_do")+'</p><p class="clear nomargin"><input type="radio" value="true" name="renumber" id="renumber_nodes" class="radio" style="line-height:20px; margin:5px 5px 0 3px" checked="checked"/><label for="renumber_nodes" class="radio" style="line-height:20px">'+I18n.t("js.numbering_renumber")+'</label></p><p class="mb5"><input type="radio" value="false" name="renumber" id="clear_nodes" class="radio" style="line-height:20px; margin:5px 5px 0 3px"/><label for="clear_nodes" class="radio" style="line-height:20px">'+I18n.t("js.numbering_clear")+'</label></p><p><label for="number_recursive" class="radio" style="font-weight:normal;margin-left:3px"><input type="checkbox" id="number_recursive" class="checkbox" />Number all subtopics recursively</label></p>',{buttonClass:"button",okLabel:I18n.t("js.ok"),windowParameters:{height:160,width:280},ok:function(){canvas.numberIt(!mm$("renumber_nodes").checked,mm$("number_recursive").checked),Dialog.cancelCallback()}}):this.numberIt()},onSplit:function(e){var t,n=!1;canvas.selected.dcontent.isEditing()?(canvas.selected.dcontent._discardChanges=!0,t=canvas.selected.dcontent.getWrappedValue(),n=canvas.selected.node.id<0):t=canvas.selected.node.getRawTitle();var i=e?/^[\xb7\u2022-]+/:/^[\s\xb7\u2022-]+/,o=t.split("\n").collect((function(e){return e.replace(i,"")}));return{inserting:n,lines:o=o.reject((function(e){return e.empty()||e.blank()}))}},onSplitLines:function(){var e=this.onSplit(!1),t=e.lines.shift(),n=[];e.inserting?n.push({title:t}):n.push({id:canvas.selected.node.id,title:t});for(var i=0;i<e.lines.length;i++)n.push({title:e.lines[i]});(canvas.selected.node.isRoot()?canvas.selected.node:canvas.selected.node.parent).addChildren(n),e.inserting&&canvas.selected.select()},onSplitTree:function(){var e=this.onSplit(!0),t=e.lines.shift(),n=[];e.inserting?n.push({id:--tree.uncommitedId,title:t,parent:canvas.selected.node.parent.id,indent:0}):n.push({id:canvas.selected.node.id,title:t});for(var i=0,o=e.lines.length;i<o;i++){for(var s=e.lines[i].replace(/\s+$/,"").gsub(/^\t/," "),r=s.replace(/^\s*/,""),a=s.length-r.length,l=n.length,c=(e.inserting||0===a&&!canvas.selected.node.isRoot()?canvas.selected.node.parent:canvas.selected.node).id;l--;)if(n[l].indent<a){c=n[l].id;break}n.push({id:--tree.uncommitedId,title:r,parent:c,indent:a})}e.inserting&&canvas.selected.select(),Tree.utils.addChildrenAsTree(n)},onBeautifyMap:function(){n.e(26).then(n.t.bind(null,"zg/X",7)).then((function(){return MM.plugins.WunderMap.beautify()}))},hasCustomStyles:function(){try{tree.root.eachChild((function(e){if(e.style)throw"Custom Style"}))}catch(e){if("Custom Style"==e)return!0;throw e}return!1},onDoSetTheme:function(e,t){var n=[];if(n.push(new MapThemeChange({idea_id:canvas.root.node.id,type:"MapTheme",new_data:e.toJSON(),old_data:App.config.mapTheme.toJSON()})),t){canvas.root.node.style&&n.push(new TextStyleChange({idea_id:canvas.root.node.id,type:"TextStyle",new_data:{style:null},old_data:{style:canvas.root.node.style.toJSON()}}));for(var i=canvas.root.children,o=i.length;o>0;)i[--o].node.style&&n.push(new TextStyleChange({idea_id:i[o].node.id,type:"TextStyle",new_data:{style:null},old_data:{style:i[o].node.style.toJSON()}}));tree.root.eachChildWithoutSelf((function(e){e.isRootC()||e.style&&n.push(new TextStyleChange({idea_id:e.id,type:"TextStyle",new_data:{style:null},old_data:{style:e.style.toJSON()}}))}))}else tree.root.eachChild((function(t){if(t.style){var i=e.styles.detect((function(e){return e.equals(t.style)})),o=null;i&&(o=e.styles.detect((function(e){return e.name===i.name}))),o&&n.push(new TextStyleChange({idea_id:t.id,type:"TextStyle",new_data:{style:o.toJSON()},old_data:{style:t.style.toJSON()}}))}}));tree.root.eachChild((function(t){if(t.boundary){var i=App.config.mapTheme.boundary_styles.detect((function(e){return t.boundary.style.equals(e)})),o=null;i&&(o=e.boundary_styles.detect((function(e){return e.name===i.name}))),o&&n.push(new EditBoundaryChange({idea_id:t.id,type:"EditBoundary",new_data:o.toJSON(),old_data:t.boundary.toJSON()}))}})),ChangeList.layoutAlteringChangeset(n),Amplitude.logEvent("change_map_theme",{theme:e.name})},onSetTheme:function(e){this.hasCustomStyles()?canvas.checkOverrideTheme(e):this.onDoSetTheme(e)},checkOverrideTheme:function(e){Dialog.confirm("<h2>"+I18n.t("js.override_theme")+"</h2><p>"+I18n.t("js.override_theme_text")+'</p><p class="hint" style="width:100%">'+I18n.t("js.you_can_undo_afterwards")+"</p>",{buttonClass:"button",okLabel:I18n.t("js.override"),cancelLabel:I18n.t("js.keep"),windowParameters:{height:120,width:400},ok:function(){this.close(),canvas.onDoSetTheme(e,!0)},cancel:function(){this.close(),canvas.onDoSetTheme(e)}})},applyThemeDetails:function(){var e=App.config.mapTheme;if(e.background.image){var t=e.background.image.url;"phantomjs"===App.config.environment&&e.background.image.url.indexOf("http")<0&&(t=ServerData.siteUrl+t),IdeaImage.downloadTokens&&(t+=(t.indexOf("?")>0?"&":"?")+IdeaImage.downloadTokens),this.el.style.backgroundImage="url("+t+")"}else this.el.style.backgroundImage="";e.background.color&&""!==e.background.color&&(this.el.style.backgroundColor="#"+e.background.color,this.container.style.backgroundColor="#"+e.background.color),e.background.repeat?this.el.style.backgroundRepeat="repeat":(this.el.style.backgroundRepeat="no-repeat",this.el.style.backgroundPosition="center center"),s.VGraphics.COLOR="#"+e.line.color},removeTheme:function(e){this.el.removeClassName(e.singleName()+(e.is_template?"":e.id)),!e.is_template&&mm$("theme_css_"+e.id)&&remove(mm$("theme_css_"+e.id))},applyTheme:function(e){if(App.config.mapTheme=e,e.is_template)this.loadThemeFonts(e,this.finalizeTheme.bind(this));else{var t=mm$("theme_css_"+e.id);t?this.loadThemeFonts(e,this.finalizeTheme.bind(this)):((t=document.createElement("link")).setAttribute("id","theme_css_"+e.id),t.setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),t.setAttribute("href","/themes/css/"+e.id),t.setAttribute("media","screen"),document.head.appendChild(t),t.onload=this.loadThemeFonts.bind(this,e,this.finalizeTheme.bind(this)))}return"undefined"===typeof sideBar||!sideBar||"undefined"!==typeof RevisionBrowser&&(RevisionBrowser.on||RevisionBrowser.painted)||(sideBar.styles.load(),sideBar.boundaries.load()),t},finalizeTheme:function(){if(this.el.addClassName(App.config.mapTheme.singleName()+(App.config.mapTheme.is_template?"":App.config.mapTheme.id)),this.applyThemeDetails(),tree&&!tree.notPainted)for(var e=this.root.children,t=0,n=e.length;t<n;t++)e[t].rc.redrawRootLine(),e[t].rc.redrawLines();MapTheme.closeActivity(500)},loadExternalFonts:function(e){var t=App.config.mapTheme.externalFonts();"phantomjs"===App.config.environment&&(t=t.concat(Font.all.filter((function(e){return e.isExternal()}))).uniqBy((function(e,t){return e.id===t.id}))),0===t.length?e():Font.loadExternal(t,e)},loadThemeFonts:function(e,t){e.hasExternalFonts()?Font.loadExternal(e.externalFonts(),t):t()},onResize:function(){var e=MM.ui.page,t=e.width,n=e.height;this.container.style.width="".concat(t,"px"),this.container.style.height="".concat(n,"px")},centeringCoordinates:function(e,t){var n=this.root.dcontent.el,i=n.cumulativeOffset(),o=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.top,!1),s=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.right,!1),r=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.bottom,!1),a=0,l=App.ui.Zoom.transformCssZoomValue(20,!1),c=e.height-o-r,d=e.width-s-a,h=App.config.layout.mapSize(),u=h.width,p=h.height,f=[n.offsetWidth,n.offsetHeight],m="center",g="center",v=[i[0]-(e.width+(a-s))/2+f[0]/2,i[1]-(e.height+(o-r))/2+f[1]/2];if(App.config.layout.orientation!==App.Layouts.orientation.down||t)if(App.config.layout.orientation!==App.Layouts.orientation.left||t)if(App.config.layout.orientation!==App.Layouts.orientation.right||t){if(u<=d&&p<=c&&!t){var y=canvas.getMapSizeAndOffset(!1);v=[y.left-(d-u)/2-a,y.top-(c-p)/2-o]}}else v[0]=u<=d?i[0]-(d-u)/2:i[0]-a-l,m=v[0]+l+"px";else v[0]=u<=d?i[0]+f[0]-u-(d-u)/2:i[0]-d+f[0]+l,m=v[0]+d+"px";else v[1]=i[1]-o-l,p<=c&&(v[1]-=(c-p)/2,v[1]+=f[1]/2),g=v[1]+l+"px";return{left:v[0],top:v[1],transformLeft:m,transformTop:g}},onRecenter:function(e,t,n){var i=this.getContainerSize();Position.prepare();var o=this.centeringCoordinates(i,n);this.scrollTo([o.left,o.top],t)},closeTemporarilyOpen:function(e){if(this.tempOpen&&0!==this.tempOpen.length){var t=[],n=null;e&&(n=e.getAncestors()),this.tempOpen.each((function(e){!n||n.indexOf(e)<0?e.toggleClosed(!0):t.push(e)})),this.tempOpen=t}},getSelectedNodes:function(){return canvas.allSelected.map((function(e){return e.node}))},clearSelection:function(){this.selected=null,this.allSelected=[]},setupSelections:function(){"undefined"!==typeof Selections&&(Selections.setup("canvas"),Event.observe(this.el,"mousedown",this.onStartSelectionRectangleListener),Event.observe(this.el,"mouseup",this.onEndDragSelectionsListener))},disableSelections:function(){Event.stopObserving(this.el,"mousedown",this.onStartSelectionRectangleListener),Event.stopObserving(this.el,"mouseup",this.onEndDragSelectionsListener)},teardownSelections:function(){Selections.teardown(),this.disableSelections()},onStartSelectionRectangle:function(e){(!e||e.ctrlKey||e.metaKey)&&this.el.observe("mousemove",this.onDragSelectionRectangleListener)},onDragSelectionRectangle:function(e){if(!this.selectionRectangle){var t={onStartDrag:this.disableScrollByDrag.bind(this),onDrag:Prototype.emptyFunction,onEndDrag:this.selectNodesFromSelectionRectangle.bind(this,e),captureKeys:!1,displayOnInit:!0,label:!1,initialEvent:e};this.selectionRectangle=new Selection.Base("canvas",t)}},onEndDragSelectionRectangle:function(){Event.stopObserving(this.el,"mousemove",this.onDragSelectionRectangleListener)},selectNodesFromSelectionRectangle:function(e){canvas.enableScrollByDrag();var t=this.getNodesFromRectangle(new Rectangle(new Point(this.selectionRectangle.areaCoords.x1,this.selectionRectangle.areaCoords.y1),new Point(this.selectionRectangle.areaCoords.x2,this.selectionRectangle.areaCoords.y2)));if(t.length>0){canvas.allSelected.each((function(e){e.dcontent.toInactive(!0),e.image&&e.image.dcontainer.toInactive()})),canvas.allSelected=[];for(var n=t.length;n--;)t[n]._listener.select(e)}this.selectionRectangle.remove(),delete this.selectionRectangle}});t.default=C},"oCl/":function(e,t,n){var i=n("CH3K"),o=n("LcsW"),s=n("MvSz"),r=n("0ycA"),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)i(t,s(e)),e=o(e);return t}:r;e.exports=a},oEzx:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var i=function(e){var t=!1;return{promise:new Promise((function(n,i){e.then((function(e){return t?i({isCanceled:!0}):n(e)}),(function(e){return i(t?{isCanceled:!0}:e)}))})),cancel:function(){t=!0}}}},oKwy:function(e,t){var n="Expected a function";e.exports=function(e){if("function"!=typeof e)throw new TypeError(n);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},pFRH:function(e,t,n){var i=n("cvCv"),o=n("O0oS"),s=n("zZ0H"),r=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:i(t),writable:!0})}:s;e.exports=r},pddD:function(e,t,n){"use strict";n.r(t);var i=Class.create({shape:null,fill_color:null,stroke_color:null,stroke_width:null,stroke_style:null,fill_opacity:1,stroke_opacity:1,initialize:function(e){e&&this.update(e)},update:function(e){this.id=e.id||null,this.name=e.name||null,this.shape=e.shape,this.fill_color=e.fill_color,this.stroke_color=e.stroke_color,this.stroke_width=e.stroke_width,this.stroke_style=e.stroke_style,this.fill_opacity=parseFloat(e.fill_opacity),this.stroke_opacity=parseFloat(e.stroke_opacity)},equals:function(e){return!!e&&(this.shape===e.shape&&this.fill_color===e.fill_color&&this.stroke_color===e.stroke_color&&this.stroke_width===e.stroke_width&&this.stroke_style===e.stroke_style&&this.fill_opacity===e.fill_opacity&&this.stroke_opacity===e.stroke_opacity)},toJSON:function(){return{shape:this.shape,fill_color:this.fill_color,fill_opacity:this.fill_opacity,stroke_color:this.stroke_color,stroke_width:this.stroke_width,stroke_style:this.stroke_style,stroke_opacity:this.stroke_opacity}}});t.default=i},pfjc:function(e,t,n){"use strict";(function(e){t.a=function(t){var n="input flyout "+(t.className||"");return e.createElement("a",{href:"#",className:n,style:t.style},t.icon,e.createElement("span",null,t.label))}}).call(this,n("q1tI"))},qgXT:function(e,t,n){"use strict";var i=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],o={enter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.options=e,this.onChangeListener=this.onChange.bind(this),Modernizr.fullscreen&&!this.options.skipBrowserUI&&this.hideBrowserUI(),this.options.skipAppUI||(this.hideAppUI(),!this.options.skipBrowserUI&&this.browserUIHidden&&(this.uberInterval=setInterval(function(){this.isFullScreen()&&!this.options.skipFullScreenCheck&&(this.interval=setInterval(this.checkFullScreen.bind(this),500),clearInterval(this.uberInterval))}.bind(this),200))),"undefined"===typeof this.keyMap){var t=MM.utils.KeyEvent;this.keyMap=new MM.utils.KeyMap(document,"fullscreen_keymap",[{key:t.ESC,fn:this.exit.bind(this)}])}if(this.keyMap.enable(),MM.ua.touchEvents())if(mm$("btn_close_fullscreen"))show(mm$("btn_close_fullscreen"));else{var n=new Element("div",{id:"btn_close_fullscreen",className:"p-a at-20 ar-15 bg-white bs-small p-8 rad-7px"}).update(MM.ui.icon({name:"arrows-diagonal-closer",size:16,color:"blue"}));Element.bindOnClick(n,this.exit.bind(this)),canvas.container.parentNode.appendChild(n)}this.fullScreen=!0},onChange:function(){this.options&&"function"===typeof this.options.onChange&&this.options.onChange(),this.isFullScreen()||this.exit()},exit:function(){var e=this;this.fullScreen&&(this.options.skipBrowserUI||this.showBrowserUI(),this.options.skipAppUI||this.showAppUI(),this.keyMap.disable(),MM.ua.touchEvents()&&hide(mm$("btn_close_fullscreen")),this.fullScreen=!1,this.options&&"function"===typeof this.options.onExit&&this.options.onExit(),i.each((function(t){return document.removeEventListener(t,e.onChangeListener)})))},toggle:function(e){this.fullScreen?this.exit(e):this.enter(e)},isFullScreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},checkFullScreen:function(){this.isFullScreen()||(this.exit(),clearInterval(this.interval))},hideBrowserUI:function(){var e=this,t=document.documentElement;t.requestFullscreen?(t.requestFullscreen(),this.browserUIHidden=!0):t.mozRequestFullScreen?(t.mozRequestFullScreen(),this.browserUIHidden=!0):t.webkitRequestFullScreen?(t.webkitRequestFullScreen(),this.browserUIHidden=!0):t.msRequestFullscreen&&(t.msRequestFullscreen(),this.browserUIHidden=!0),i.each((function(t){return document.addEventListener(t,e.onChangeListener)}))},showBrowserUI:function(){this.isFullScreen()&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.browserUIHidden=!1)},hideAppUI:function(){UI.Registry.toggleFullScreen(!0);var e=$$(".postit")[0];e&&addClassName(e,"hidden")},showAppUI:function(){UI.Registry.toggleFullScreen(!1);var e=$$(".postit")[0];e&&removeClassName(e,"hidden")}};t.a=o},quyA:function(e,t){var n=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return n.test(e)}},r44v:function(e,t,n){"use strict";(function(e){var i=n("AGWK"),o=n("ERGR"),s=n("Pqld"),r=n("rW35"),a=n("GlCk");function l(e){return(l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var p=[],f=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==l(t)&&"function"!==typeof t?h(e):t}(this,d(n).call(this,e))).state={isLoading:!0,items:p},t._createNewMap=t._createNewMap.bind(h(t)),t}var f,m,g;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&u(e,t)}(n,t),f=n,(m=[{key:"_createNewMap",value:function(e){e.preventDefault(),MM.ui.disableButton(this.newMapBtn),document.location.href=document.location.protocol+"//"+document.location.host+"/maps/new?template_id=0"}},{key:"UNSAFE_componentWillMount",value:function(){var e=this;new Ajax.Request("/maps/get_user_maps",{onSuccess:function(t){var n=t.responseText.evalJSON();p=[],n.each((function(e){p.push({label:e.title,className:"ellipsis",style:{whiteSpace:"pre"},onClick:function(t){return function(e,t){t&&(e.metaKey||e.ctrlKey||e.shiftKey?window.open("/"+t):window.location.href="/"+t)}(t,e.id)}})})),e.setState({isLoading:!1,items:p})}})}},{key:"render",value:function(){var t=this;return this.state.isLoading?e.createElement("div",{className:"ta-center"},e.createElement(i.a,{size:48,opts:{className:"h-iblock m-10"}})):e.createElement("div",{className:""},e.createElement(s.a,{title:I18n.t("js.my_maps"),className:"ph-15 fs-l pb-10",titleClassName:"mv-5 c-grey700 fw-medium"}),e.createElement(a.a,{autofocus:!0,inputClassName:"mh-15 mb-10",filterableAttribute:"label"},e.createElement(r.a,null,e.createElement(o.a,{items:this.state.items,className:"maxh-300px h-overflow-y"}))),e.createElement("a",{ref:function(e){return t.newMapBtn=e},className:"button default m-10",onClick:this._createNewMap},I18n.t("js.new_mind_map")))}}])&&c(f.prototype,m),g&&c(f,g),n}(e.Component);t.a=f}).call(this,n("q1tI"))},r5HS:function(e,t,n){"use strict";n.r(t),n.d(t,"COLORS",(function(){return i})),n.d(t,"Editor",(function(){return o}));var i={red:"d93651",orange:"ff9f1a",grassGreen:"8acc47",turquoise:"30bfbf",blue:"00aaff",lightPurple:"dfcef2",greyDark:"98aab3",greyLight:"e0e4e6"},o=Class.create({el:null,pos:null,connection:null,initialize:function(e,t,n,i){this.pos={x:e.x-6,y:e.y-6},this.connection=t,this.el=new Element("div",{id:"edit_".concat(this.connection.raphael_id),className:"connection_edit",style:"border: 2px solid #".concat(this.connection.color)}),this._onclickListener=this._onClick.bind(this),this._onMouseOverListener=n,this._onMouseOutListener=i,this.toEditMode(),this.hide(),this.move(this.pos),canvas.el.appendChild(this.el)},_onClick:function(e){e.stop(),this.connection.from._listener.select(),App.connectionPopover&&this.destroyPopover(),App.connectionPopover=new Popover("connection",this.doActions.bind(this),{opener:this.el});var t=[],n=new Element("a",{href:"#",className:"subitem"}).update(I18n.t("js.connection_color")),o=new Element("ul",{className:"popover menu submenu",style:"display: none"});for(var s in i){var r=i[s],a=new Element("a",{href:"#",className:"color",id:"btn_menu_connection_color_"+r}).insert(new Element("span",{style:"background-color: #"+r}));o.insert(new Element("li").insert(a))}n.insert(o),t.push(n),t.push(new Element("a",{href:"#",id:"btn_menu_connection_label"}).update(this.connection.label?I18n.t("js.connection_label_edit"):I18n.t("js.connection_label_add"))),this.connection.label&&t.push(new Element("a",{href:"#",id:"btn_menu_connection_label_delete"}).update(I18n.t("js.connection_label_delete"))),t.push(new Element("a",{href:"#",id:"btn_menu_connection_delete"}).update(I18n.t("js.connection_delete"))),App.connectionPopover.addElements(t),App.connectionPopover.show()},doActions:function(e){switch(e=e.replace("btn_menu_","")){case"connection_label":this.connection.view.updateLabel(),this.connection.view.label.toEditing();break;case"connection_label_delete":this.connection.view.deleteLabel();break;case"connection_delete":this.connection.from.disconnectFrom(this.connection.to);break;default:var t=e.replace("connection_color_","");t&&this.connection.setProperties({color:t})}},move:function(e){this.pos=e,this.el.style.left="".concat(e.x,"px"),this.el.style.top="".concat(e.y,"px")},show:function(){this.el.removeClassName("hidden")},hide:function(){this.el.addClassName("hidden")},toEditMode:function(){removeClassName(this.el,"h-hidden"),this.el.observe("click",this._onclickListener),this.el.observe("mouseover",this._onMouseOverListener),this.el.observe("mouseout",this._onMouseOutListener)},toViewMode:function(){addClassName(this.el,"h-hidden"),this.el.stopObserving("click",this._onclickListener),this.el.stopObserving("mouseover",this._onMouseOverListener),this.el.stopObserving("mouseout",this._onMouseOutListener)},destroyPopover:function(){App.connectionPopover.removeElements(),App.connectionPopover.destroy(),App.connectionPopover=null},destroy:function(){this.toViewMode(),Element.discard(this.el),this.connection=this.pos=null,App.connectionPopover&&(App.connectionPopover.close(),this.destroyPopover())}})},rJb1:function(e,t,n){"use strict";t.a={get:function(e,t){new Ajax.Request("/user_preferences/"+e,{method:"GET",onSuccess:function(e){t(e.responseJSON)},onFailure:function(){return t(null)}})},save:function(e){new Ajax.Request("/user_preferences",{parameters:e})}}},rW35:function(e,t,n){"use strict";(function(e){function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return(l=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,"a",(function(){return c}));var c=function(t){function n(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),(t=function(e,t){return!t||"object"!==i(t)&&"function"!==typeof t?a(e):t}(this,r(n).call(this,e))).index=-1,t.renderIndex=0,t.state={allItems:t._getAllItems(t.props.children)},t.unselectAll=t.unselectAll.bind(a(t)),t.onMouseLeave=t.onMouseLeave.bind(a(t)),t.updateSelection=t.updateSelection.bind(a(t)),t.disableKeyMap=t.disableKeyMap.bind(a(t)),t.enableKeyMap=t.enableKeyMap.bind(a(t)),t.onEnter=t.onEnter.bind(a(t)),t.onKeyNavigate=t.onKeyNavigate.bind(a(t)),t}var c,d,h;return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&l(e,t)}(n,t),c=n,(d=[{key:"_getAllItems",value:function(t){var n=this,i=[];return e.Children.forEach(t,(function(e){e.props&&(i=[].concat(o(i),o(e.props.items||[]),o(n._getAllItems(e.props.children))))})),i}},{key:"unselectAll",value:function(){var e=this.state.allItems;return e[this.index]&&(e[this.index].highlighted=!1),e}},{key:"onMouseLeave",value:function(){this.updateSelection(-1)}},{key:"updateSelection",value:function(e){var t=this.unselectAll();this.index=e,t[this.index]&&(t[this.index].highlighted=!0),this.setState({allItems:t})}},{key:"disableKeyMap",value:function(){this.keymap.disable()}},{key:"enableKeyMap",value:function(){this.keymap.enable()}},{key:"onEnter",value:function(e){var t=this.state.allItems[this.index];t&&t.onClick&&(t.onClick(e),document.body.click())}},{key:"onKeyNavigate",value:function(e){var t=this.index+e;t<0&&(t=this.state.allItems.length-1),t>this.state.allItems.length-1&&(t=0),this.updateSelection(t)}},{key:"componentDidMount",value:function(){this.keymap=new MM.utils.KeyMap(document,"component_keymap_"+(new Date).getTime(),[{key:MM.utils.KeyEvent.UP,fn:this.onKeyNavigate.bind(this,-1)},{key:MM.utils.KeyEvent.DOWN,fn:this.onKeyNavigate.bind(this,1)},{key:MM.utils.KeyEvent.ENTER,fn:this.onEnter,withEvent:!0,stopEvent:!1}])}},{key:"UNSAFE_componentWillReceiveProps",value:function(){this.shouldUpdateChildren=!0,this.updateSelection(-1)}},{key:"componentDidUpdate",value:function(){if(this.shouldUpdateChildren){var e=this._getAllItems(this.props.children);e[this.index]&&(e[this.index].highlighted=!0),this.setState({allItems:e}),this.shouldUpdateChildren=!1}}},{key:"componentWillUnmount",value:function(){this.keymap.disable(),this.keymap=null,this.updateSelection(-1)}},{key:"renderChildren",value:function(t){var n=this;return e.Children.map(t,(function(t){var i={};if(t.props.items){var o=n.state.allItems.slice(n.renderIndex,n.renderIndex+t.props.items.length),s=n.renderIndex;n.renderIndex=n.renderIndex+t.props.items.length,i={key:s,items:o,indexStart:s,onMouseEnter:n.updateSelection,onMouseLeave:n.onMouseLeave,disableParentKeyMap:n.disableKeyMap,enableParentKeyMap:n.enableKeyMap}}return i.children=n.renderChildren(t.props.children),e.cloneElement(t,i)}))}},{key:"render",value:function(){return this.renderIndex=0,e.createElement("div",{className:this.props.className},this.renderChildren(this.props.children,this.renderIndex))}}])&&s(c.prototype,d),h&&s(c,h),n}(e.Component)}).call(this,n("q1tI"))},s2fJ:function(module,__webpack_exports__,__webpack_require__){"use strict";function _typeof(e){return(_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(e){e=e.toUpperCase();var t=this.NODEMAP[e]||"div",n=document.createElement(t);try{n.innerHTML="<"+e+"></"+e+">"}catch(s){}var i=n.firstChild||null;if(i&&i.tagName.toUpperCase()!=e&&(i=i.getElementsByTagName(e)[0]),i||(i=document.createElement(e)),i){if(arguments[1])if(this._isStringOrNumber(arguments[1])||arguments[1]instanceof Array||arguments[1].tagName)this._children(i,arguments[1]);else{var o=this._attributes(arguments[1]);if(o.length){try{n.innerHTML="<"+e+" "+o+"></"+e+">"}catch(s){}if(!(i=n.firstChild||null))for(attr in i=document.createElement(e),arguments[1])i["class"==attr?"className":attr]=arguments[1][attr];i.tagName.toUpperCase()!=e&&(i=n.getElementsByTagName(e)[0])}}return arguments[2]&&this._children(i,arguments[2]),i}},_text:function(e){return document.createTextNode(e)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(e){var t=[];for(var n in e)t.push((n in this.ATTR_MAP?this.ATTR_MAP[n]:n)+'="'+e[n].toString().escapeHTML().gsub(/"/,"&quot;")+'"');return t.join(" ")},_children:function(e,t){t.tagName?e.appendChild(t):"object"==_typeof(t)?t.flatten().each((function(t){"object"==_typeof(t)?e.appendChild(t):Builder._isStringOrNumber(t)&&e.appendChild(Builder._text(t))})):Builder._isStringOrNumber(t)&&e.appendChild(Builder._text(t))},_isStringOrNumber:function(e){return"string"==typeof e||"number"==typeof e},build:function(e){var t=this.node("div");return $(t).update(e.strip()),t.down()},dump:function(e){"object"!=_typeof(e)&&"function"!=typeof e&&(e=window),"A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR".split(/\s+/).each((function(t){e[t]=function(){return Builder.node.apply(Builder,[t].concat($A(arguments)))}}))}},DatePicker=Class.create();DatePicker.prototype={Version:"0.9.2",_relative:null,_div:null,_zindex:1,_keepFieldEmpty:!1,_daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],_callback:null,_ignoreElements:[],_language:"en",_language_month:$H({fr:["Janvier","F&#233;vrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","D&#233;cembre"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],it:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],de:["Januar","Februar","M&#228;rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],pt:["Janeiro","Fevereiro","Mar&#231;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ja:["\u5e741\u6708","\u5e742\u6708","\u5e743\u6708","\u5e744\u6708","\u5e745\u6708","\u5e746\u6708","\u5e747\u6708","\u5e748\u6708","\u5e749\u6708","\u5e7410\u6708","\u5e7411\u6708","\u5e7412\u6708"]}),_language_day:$H({fr:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],en:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],es:["Lun","Mar","Mie","Jue","Vie","S&#224;b","Dom"],it:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],de:["Mon","Die","Mit","Don","Fre","Sam","Son"],pt:["Seg","Ter","Qua","Qui","Sex","S&#225;","Dom"],ja:["\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f","\u65e5"]}),_language_close:$H({fr:"fermer",en:"close",es:"cierre",it:"fine",de:"schliessen",pt:"fim",ja:"\u9589\u3058\u308b"}),_languages_reverse_m_y:["ja"],_todayDate:new Date,_date_regexp:/^(\d{1,2})(\/|\.|\-)(\d{1,2})(?:\/|\.|\-)(\d{4})$/,_current_date:null,_clickCallback:Prototype.emptyFunction,_cellCallback:Prototype.emptyFunction,_date_separator:"/",_id_datepicker:null,_topOffset:16,_leftOffset:-73,_isPositionned:!1,_relativePosition:!0,getMonthLocale:function(e){return this._language_month.get(this._language)[e]},getMonthYearOrder:function(e,t,n){return this._languages_reverse_m_y.include(this._language)?t+n+e:e+n+t},getLocaleClose:function(){return this._language_close.get(this._language)},_initCurrentDate:function(){var e=$(this._relative).getAttribute("date");if(e&&""!=e?this._current_date=e:this._startDate?(this._current_date=this._startDate,$(this._relative).setAttribute("date",this._current_date)):this._current_date=null,!this._date_regexp.test(this._current_date)){var t=new Date,n=this._leftpad_zero(t.getDate(),2),i=this._leftpad_zero(t.getMonth()+1,2);this._current_date?(this._current_date=i+"/"+n+"/"+t.getFullYear(),$(this._relative).setAttribute("date",this._current_date)):this._current_date=i+"/"+n+"/"+t.getFullYear(),this._keepFieldEmpty||$(this._relative).setAttribute("value",this._current_date)}var o=this._current_date.match(this._date_regexp);this._date_separator=String(o[2]),this._saved_mon=this._current_mon=Number(o[1])-1,this._saved_day=this._current_day=Number(o[3]),this._saved_year=this._current_year=Number(o[4])},initialize:function(e){this._relative=e.relative,e.language&&(this._language=e.language),e.opener&&(this._opener=e.opener),e.parent&&(this._parent=e.parent),this._zindex=e.zindex?parseInt(Number(e.zindex)):1,"undefined"!=typeof e.keepFieldEmpty&&(this._keepFieldEmpty=e.keepFieldEmpty),"function"==typeof e.clickCallback&&(this._clickCallback=e.clickCallback),Object.isFunction(e.cellCallback)&&(this._cellCallback=e.cellCallback),"undefined"!=typeof e.leftOffset&&(this._leftOffset=parseInt(e.leftOffset)),"undefined"!=typeof e.topOffset&&(this._topOffset=parseInt(["topOffset"])),"undefined"!=typeof e.relativePosition&&(this._relativePosition=e.relativePosition),"undefined"!=typeof e.startDate&&(this._startDate=e.startDate),"undefined"!=typeof e.ignore&&(this._ignoreElements=e.ignore),this._id_datepicker="datepicker-"+this._relative,this._id_datepicker_prev=this._id_datepicker+"-prev",this._id_datepicker_next=this._id_datepicker+"-next",this._id_datepicker_hdr=this._id_datepicker+"-header",this._id_datepicker_ftr=this._id_datepicker+"-footer",this._div=Builder.node("div",{id:this._id_datepicker,className:"datepicker",style:"z-index: "+this._zindex},[Builder.node("div",{className:"h-flex-row justify-sb datepicker-header"},[Builder.node("div",{id:this._id_datepicker_prev},""),Builder.node("div",{id:this._id_datepicker_hdr}),Builder.node("div",{id:this._id_datepicker_next},"")]),Builder.node("div",{className:"datepicker-calendar"},[Builder.node("table",{id:this._id_datepicker+"-table"})]),Builder.node("div",{id:this._id_datepicker_ftr,className:"datepicker-footer"},I18n.t("js.remove"))]),this.clickListener=this.click.bindAsEventListener(this),Event.observe(this._opener,"click",this.clickListener),this.blurListener=this.hide.bindAsEventListener(this),this._language_month.get(this._language)||(this._language_month.set(this._language,[I18n.t("js.january"),I18n.t("js.february"),I18n.t("js.march"),I18n.t("js.april"),I18n.t("js.may"),I18n.t("js.june"),I18n.t("js.july"),I18n.t("js.august"),I18n.t("js.september"),I18n.t("js.october"),I18n.t("js.november"),I18n.t("js.december")]),this._language_day.set(this._language,[I18n.t("js.monday_short"),I18n.t("js.tuesday_short"),I18n.t("js.wednesday_short"),I18n.t("js.thursday_short"),I18n.t("js.friday_short"),I18n.t("js.saturday_short"),I18n.t("js.sunday_short")]))},load:function(){var e=$(this._parent)||document.getElementsByTagName("body").item(0);e&&(this._arrow=new Element("span",{class:"arrow"}),e.appendChild(this._arrow),e.appendChild(this._div),e.style.opacity=0),$(this._id_datepicker_prev).update(MM.ui.icon({name:"arrow-left",size:14,color:"grey300"})),$(this._id_datepicker_next).update(MM.ui.icon({name:"arrow-right",size:14,color:"grey300"})),this._initCurrentDate(),Event.observe(this._id_datepicker_prev,"click",this.prevMonth.bindAsEventListener(this),!1),Event.observe(this._id_datepicker_next,"click",this.nextMonth.bindAsEventListener(this),!1),Event.observe(this._id_datepicker_ftr,"click",this.removeDate.bindAsEventListener(this),!1)},show:function(){clearTimeout(this._hideTimer),$(this._opener)&&$(this._opener).addClassName("selected"),$(this._relative)&&$(this._relative).addClassName("selected");var e=$(this._parent);e.show(),this._initCurrentDate(),this._redrawCalendar(),!this._isPositionned&&this._relativePosition&&this.position(),document.observe("click",this.blurListener),e.style.opacity=1,"undefined"!==typeof GeneralPopover&&GeneralPopover.closeOpenPopover()},position:function(e){MM.ui.positionPopover({parent:$(this._parent),opener:$(this._opener),arrow:$(this._arrow),options:{}})},click:function click(e){$(this._parent).visible()?this.close():this.show(),eval(this._clickCallback()),Event.stop(e)},disable:function(){$(this._opener)&&Event.stopObserving(this._opener,"click",this.clickListener)},enable:function(){$(this._opener)&&Event.observe(this._opener,"click",this.clickListener)},hide:function(e){for(var t=Event.element(e);t.id!=this._id_datepicker&&t.id!=this._opener&&t.parentNode&&!this._ignoreElements.include(t.id);)t=t.parentNode;t.id==this._id_datepicker||t.id==this._opener||this._ignoreElements.include(t.id)||this.close(),Event.stop(e)},close:function(){$(this._opener)&&$(this._opener).removeClassName("selected"),$(this._relative)&&$(this._relative).removeClassName("selected"),document.stopObserving("click",this.blurListener);var e=$(this._parent);e.style.opacity=0,this._hideTimer=setTimeout(Element.hide.bind(null,e),300)},removeDate:function(){$(this._relative).setAttribute("date",""),$(this._relative).setAttribute("value",""),this._cellCallback&&this._cellCallback(),this.close()},setPosition:function(e,t){var n={top:"0px",left:"0px"};"undefined"!=typeof e&&(n.top=Number(e)+this._topOffset+"px"),"undefined"!=typeof t&&(n.left=Number(t)+this._leftOffset+"px"),$(this._id_datepicker).setStyle(n),this._isPositionned=!0},_leftpad_zero:function(e,t){for(var n="",i=0;i<t-String(e).length;i++)n+="0";return n+e},_getMonthDays:function(e,t){return 0!=e%4||0==e%100&&0!=e%400||1!=t?this._daysInMonth[t]:29},_buildCalendar:function(){var e=this,t=document.createElement("tbody"),n=document.createElement("tr");this._language_day.get(this._language).each((function(e){var t=document.createElement("td");t.innerHTML=e,t.className="wday",n.appendChild(t)})),t.appendChild(n);for(var i=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],o=new Date(this._current_year,this._current_mon,1,12),s=o.getDay()?o.getDay()-1:6,r=this._getMonthDays(this._current_year,this._current_mon),a=1,l=s;l<7;l++)i[0][l]={d:a,m:this._current_mon,y:this._current_year,c:a==this._todayDate.getDate()&&this._current_mon==this._todayDate.getMonth()&&this._current_year==this._todayDate.getFullYear()?"today":a==this._saved_day&&this._current_mon==this._saved_mon&&this._current_year==this._saved_year?"selday":null},a++;var c=this._prevMonthYear(),d=this._getMonthDays(c[1],c[0]);for(l=0;l<s;l++)i[0][l]={d:Number(d-s+l+1),m:Number(c[0]),y:c[1],c:"outbound"};for(var h=!1,u=this._current_mon,p=this._current_year,f=1;f<6;f++)for(l=0;l<7;l++)i[f][l]={d:a,m:u,y:p,c:h?"outbound":a==this._todayDate.getDate()&&this._current_mon==this._todayDate.getMonth()&&this._current_year==this._todayDate.getFullYear()?"today":a==this._saved_day&&this._current_mon==this._saved_mon&&this._current_year==this._saved_year?"selday":null},++a>r&&(a=1,h=!0,this._current_mon+1>11?(u=0,p+=1):u+=1);for(f=0;f<6;f++){var m=document.createElement("tr");for(l=0;l<7;l++){var g=i[f][l],v=document.createElement("td"),y=$A([this._relative,this._leftpad_zero(g.m+1,2),this._leftpad_zero(g.d,2),g.y]).join("-");v.setAttribute("id",y),g.c&&(v.className=g.c),v.onclick=function(){var t=String($(this).id).split("-");$(e._relative).setAttribute("date",t[1]+"/"+t[2]+"/"+t[3]),$(e._relative).value=Date.fromUTC(t[1]+"/"+t[2]+"/"+t[3]).toUIString(!0),e._cellCallback&&e._cellCallback(),e.close()},v.innerHTML=g.d,m.appendChild(v)}t.appendChild(m)}return t},_nextMonthYear:function(){var e=this._current_mon,t=this._current_year;return e+1>11?(e=0,t+=1):e+=1,[e,t]},nextMonth:function(){var e=this._nextMonthYear();this._current_mon=e[0],this._current_year=e[1],this._redrawCalendar()},_prevMonthYear:function(){var e=this._current_mon,t=this._current_year;return e-1<0?(e=11,t-=1):e-=1,[e,t]},prevMonth:function(){var e=this._prevMonthYear();this._current_mon=e[0],this._current_year=e[1],this._redrawCalendar()},_redrawCalendar:function(){this._setLocaleHdr();var e=$(this._id_datepicker+"-table");try{for(;e.hasChildNodes();)e.removeChild(e.childNodes[0])}catch(t){}e.appendChild(this._buildCalendar())},_setLocaleHdr:function(){var e=this._nextMonthYear();$(this._id_datepicker_next).setAttribute("title",this.getMonthLocale(e[0])+" "+e[1]);var t=this._prevMonthYear();$(this._id_datepicker_prev).setAttribute("title",this.getMonthLocale(t[0])+" "+t[1]),$(this._id_datepicker_hdr).update("&nbsp;&nbsp;&nbsp;"+this.getMonthYearOrder(this.getMonthLocale(this._current_mon),this._current_year,"&nbsp;")+"&nbsp;&nbsp;&nbsp;")}},__webpack_exports__.a=DatePicker},s7eh:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=/(auto|scroll)/,o=function(e,t){return window.getComputedStyle(e,null).getPropertyValue(t)},s=function(e){return i.test(function(e){return o(e,"overflow")+o(e,"overflow-y")}(e))}},sEfC:function(e,t,n){var i=n("GoyQ"),o=n("QIyF"),s=n("tLB3"),r="Expected a function",a=Math.max,l=Math.min;e.exports=function(e,t,n){var c,d,h,u,p,f,m=0,g=!1,v=!1,y=!0;if("function"!=typeof e)throw new TypeError(r);function _(t){var n=c,i=d;return c=d=void 0,m=t,u=e.apply(i,n)}function b(e){var n=e-f;return void 0===f||n>=t||n<0||v&&e-m>=h}function w(){var e=o();if(b(e))return C(e);p=setTimeout(w,function(e){var n=t-(e-f);return v?l(n,h-(e-m)):n}(e))}function C(e){return p=void 0,y&&c?_(e):(c=d=void 0,u)}function x(){var e=o(),n=b(e);if(c=arguments,d=this,f=e,n){if(void 0===p)return function(e){return m=e,p=setTimeout(w,t),g?_(e):u}(f);if(v)return clearTimeout(p),p=setTimeout(w,t),_(f)}return void 0===p&&(p=setTimeout(w,t)),u}return t=s(t)||0,i(n)&&(g=!!n.leading,h=(v="maxWait"in n)?a(s(n.maxWait)||0,t):h,y="trailing"in n?!!n.trailing:y),x.cancel=function(){void 0!==p&&clearTimeout(p),m=0,c=f=d=p=void 0},x.flush=function(){return void 0===p?u:C(o())},x}},sfJZ:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("PYYe"),s=n.n(o),r=n("mbwg"),a=n("ERGR"),l=n("B01C"),c=n("yQ/X"),d=n("HmSg"),h=n("rJb1"),u=n("39z+"),p=Class.create(r.default,{recentImages:[],searchers:["url","google","iconfinder"],initialize:function($super,e,t){$super("images",e,t)},load:function($super){Element.bindOnClick("btn_remove_image",this.removeImage.bindAsEventListener(this)),Element.bindOnClick("btn_auto_image",this.setAutoImage.bind(this)),$("btn_add_image").update(I18n.t("js.add_image")),this.recentImages=MM.utils.getCookie("recentImages")?MM.utils.getCookie("recentImages").split(",").concat(this.recentImages).slice(0,6):[],0==IdeaImage.default_images.length&&IdeaImage.initDefault(),this.defaultImages=c.default.getElements(IdeaImage.default_images,{idPrefix:"image_",containerClassName:"item recent",width:28,height:28}),this.recentImages.length<=0&&(this.recentImages=this.defaultImages.slice(0,6)),ServerData.isLoggedIn&&ServerData.user.unilogin&&this.searchers.push("skoletube"),this.buildRecentImages(),this.buildPopover(),this.uploadBtn=mm$("btn_upload_local_img"),this.uploadBtn.observe("change",this.onLocalFileChosen.bind(this)),$super()},buildRecentImages:function(){this.list=mm$("recent_images"),this.list.select(".recent").each((function(e){e.remove()})),this.recentImages.each(function(e){var t=new Element("cell");t.insert(e),t.observe("click",this.setDefaultImage.bindAsEventListener(this,e.id)),this.list.insert(t)}.bind(this))},save:function(e,t){},buildPopover:function(){this.imagePopover=new u.c("add_image",{offset:[0,-5]});var t=[{label:I18n.t("js.upload_new_image"),onClick:this.dialogUploadImage.bind(this)},{label:I18n.t("js.use_an_image_from_the_web"),onClick:this.dialogWebImage.bind(this)},{label:I18n.t("js.draw_image"),onClick:this.dialogDrawImage.bind(this)}];App.config.anonymousUser||t.push({label:I18n.t("js.browse_image_library"),onClick:this.dialogImageLibrary.bind(this)}),e.render(i.createElement(a.a,{items:t}),this.imagePopover.widgetContainer)},setDefaultImage:function(e,t){if(e.stop(),canvas.selected){var n=parseInt(t.split("_")[1]),i=IdeaImage.get(n);i?this.uploadImage(i):Message.show(I18n.t("js.image_could_not_be_found"),Message.NOTICE)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onLocalFileChosen:function(e){e.stop();var t=this.uploadBtn.files[0];t&&(MM.utils.File.uploadImageFile(this._getSelectedTopics(),t,{onProgress:this.onImageUpload.bind(this),successCallback:function(e,t){Tree.utils.setImage(new IdeaImage(e),t)}}),mm$("frm_upload_local_img")&&mm$("frm_upload_local_img").reset())},dialogUploadImage:function(){App.hasFeature("attachments")?this.uploadBtn.click():MM.ui.dialogs.dialogUpgrade({feature:"map_attachments",s:"map_".concat(App.config.map_id)})},dialogWebImage:function(){canvas.selected?(canvas.removeFocus(),this.selectedImage=null,this.googleSearch=null,this.iconFinderSearch=null,ServerData.isLoggedIn&&ServerData.user.unilogin&&(this.skoletubeSearch=null),MM.ui.dialogs.show("image_web",{dlg_name:"image_web",action:"image_web_ajax/"+App.config.map_id,param:"idea_id="+canvas.selected.node.id,width:710,keymap:new MM.utils.KeyMap(document,"image_web_keymap",[]),onComplete:this.onDialogWebImageShow.bind(this),onClose:function(){this.selectedImage=null,this.linkImageUrl=null,ServerData.isLoggedIn&&ServerData.user.unilogin&&MM.external.Skoletube.Groups&&MM.external.Skoletube.Groups.destroy()}.bind(this)})):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},dialogDrawImage:function(e){var t=this;App.hasFeature("attachments")?canvas.selected?(canvas.removeFocus(),MM.ui.dialogs.show("image_draw",{dlg_name:"image_draw",width:550,noHelp:!0,onComplete:function(){n.e(220).then(n.bind(null,"PkDF")).then((function(n){t.doodling=n.default,t.doodling.init(300,300,"000000",e?canvas.selected.node.idea_image:null)}))},onClose:function(){t.doodling&&(t.doodling.destroy(),t.doodling=null)}})):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE):MM.ui.dialogs.dialogUpgrade({feature:"map_attachments",s:"map_".concat(App.config.map_id)})},dialogImageLibrary:function(){canvas.removeFocus(),IdeaImage.user_images=[],MM.ui.dialogs.show("image_library",{dlg_name:"image_library",height:380,width:676})},onDialogWebImageShow:function(){var e=this;h.a.get("image_searcher",(function(t){var n=t&&e.searchers.indexOf(t.value.toLowerCase())>=0?t.value.toLowerCase():null;e._renderSourceDropdown(n),mm$("idea_image_url").onkeyup=e.previewImage.bind(e),mm$("set_image_button").onclick=function(){return e.addImage(),!1}}))},_renderSourceDropdown:function(t){e.render(i.createElement(d.a,{sources:this.searchers,selectedSource:t||"google",onChange:this.setImageType.bind(this)}),mm$("btn-source-container"))},onSkoletubeLogin:function(){MM.external.Skoletube.Groups&&MM.external.Skoletube.Groups.load("images",this.searchSkoletube.bind(this))},onCancelSkoletubeLogin:function(){MM.ui.dialogs.close("skoletubelogin"),this._renderSourceDropdown("iconfinder")},setImageType:function(e){var t=this,i=e.value;if(canvas.selected){if(hide(mm$("img_copyright")),this.searchers.indexOf(i)>-1){switch(this.searchers.without(i).each((function(e){hide(mm$(e+"_search")),hide(mm$(e+"_imgs"))})),show(mm$(i+"_search")),show(mm$(i+"_imgs")),this.selectedImage=null,MM.ui.dialogs.hideError(),i){case"google":this.searchGoogle();break;case"iconfinder":this.searchIconFinder();break;case"skoletube":n.e(14).then(n.bind(null,"2lpU")).then((function(){return MM.external.Skoletube.Groups.load("images",t.searchSkoletube.bind(t))}));break;case"url":$("preview_image").select("img")[0]&&(this.selectedImage=IdeaImage.createDummy($("preview_image").select("img")[0].src))}var o={google:"Google",iconfinder:"Iconfinder",url:"URL"}[i]||i;h.a.save({name:"image_searcher",value:o})}}else this.showInvalidImage(I18n.t("js.please_select_an_idea_first"))},previewImage:function(){var e=mm$("idea_image_url").value;if(e!==this.linkImageUrl){this.linkImageUrl=e;var t=mm$("preview_image"),n=t.select(".preview")[0],i=t.select(".loading-spinner-48")[0],o=t.select("img")[0];o||(o=new Element("img",{class:"maxw-225px h-a-center",alt:I18n.t("js.image_unavailable")}),t.appendChild(o)),hide(n),hide(o),i||(i=MM.ui.LoadingSpinner(48),t.appendChild(i)),o.onload=function(){i.remove(),show(o),this.selectedImage=IdeaImage.createDummy(this.linkImageUrl)}.bind(this),o.onerror=function(){i.remove(),this.selectedImage=null,hide(o),show(n),n.select("cell")[0].innerHTML=I18n.t("js.image_unavailable")}.bind(this),o.src="/images/download_url?url=".concat(s()(this.linkImageUrl))}},initGoogleSearch:function(e){if(!this.googleSearch){if(!App.hasFeature("google_cse"))var t={limitRequests:!0};this.googleSearch=new l.default({element:mm$("gsc_field"),searcher:"google",searcherOpts:t,onSearch:function(){this.selectedImage=null}.bind(this)}),e||(this.googleSearch.options.element.value=canvas.selected.node.getSingleLineTitle())}},searchGoogle:function(){this.initGoogleSearch(),this.googleSearch.search.options.disablePages=!1,this.googleSearch.ui=!0,this.googleSearch.query(this.googleSearch.options.element.value)},autoSearchGoogle:function(e){this.initGoogleSearch(!0),this.googleSearch.search.options.disablePages=!0,this.googleSearch.ui=!1;var t=this.doSetAutoImage.bind(this,e);this.googleSearch.query(e.getSingleLineTitle(),{onComplete:t,onError:t})},searchIconFinder:function(){this.iconFinderSearch||(this.iconFinderSearch=new l.default({element:mm$("icf_field"),searcher:"iconfinder",onSearch:function(){this.selectedImage=null}.bind(this)}),this.iconFinderSearch.options.element.value=canvas.selected.node.getSingleLineTitle()),this.iconFinderSearch.query(this.iconFinderSearch.options.element.value)},searchSkoletube:function(e){this.skoletubeSearch||(this.skoletubeSearch=new l.default({element:mm$("skoletube_field"),searcher:"skoletube",caching:!1,onSearch:function(){this.selectedImage=null}.bind(this)}),this.skoletubeSearch.options.element.value=canvas.selected.node.getSingleLineTitle()),this.skoletubeSearch.query(this.skoletubeSearch.options.element.value,{group_id:e.toString()})},onSelectLibEl:function(e){for(var t=e.select("img")[0],n=getDataSet(t,"url")||t.src,i=$$(".imgpanel .grid .selected"),o=0,s=i.length;o<s;o++)removeClassName(i[o],"selected");return addClassName(e,"selected"),n},onSelectImage:function(e,t,n){e.stop();var i=parseInt(t.id.split("_")[1]),o=this.onSelectLibEl(t);n?(IdeaImage.useSecureLink()&&o.include("download_url?url=")&&(o=o.split("download_url?url=")[1]),this.selectedImage=IdeaImage.createDummy(o)):this.selectedImage=IdeaImage.get(i),c.default.checkLicense(t)},onDblClickImage:function(e,t,n){e.stop(),this.googleSearch&&(this.googleSearch.search.options.disablePages=!0);var i=parseInt(t.id.split("_")[1]),o=this.onSelectLibEl(t);n?(IdeaImage.useSecureLink()&&o.include("download_url?url=")&&(o=o.split("download_url?url=")[1]),this.selectedImage=IdeaImage.createDummy(o)):this.selectedImage=IdeaImage.get(i),this.addImage()},imageLibraryTab:function(e,t){for(var n=mm$(t+"_container"),i=0,o=e.length;i<o;i++){var s=e[i];s=IdeaImage.get(s.id)||new IdeaImage(s);var r=new Element("cell"),a=c.default.getElements([s],{idPrefix:"libimage_",containerClassName:"item rad-3"})[0];a.observe("click",this.onSelectImage.bindAsEventListener(this,a)),a.observe("dblclick",this.onDblClickImage.bindAsEventListener(this,a)),r.appendChild(a),n.appendChild(r)}mm$(t+"_counter").innerHTML=I18n.t("js.images_s",{v0:e.length})},setImageLibraryContent:function(){this.selectedImage=null,this.imageLibraryTab(IdeaImage.default_images,"default")},setUserImagesLibrary:function(){this.imageLibraryTab(IdeaImage.user_images,"personal")},getUserImages:function(e){var t={map_id:App.config.map_id};new Ajax.Request("/dialog/user_images",{parameters:t,asynchronous:!0,onSuccess:function(t){IdeaImage.user_images=t.responseText.evalJSON(),sideBar.images.setUserImagesLibrary(),e&&e()}})},uploadImage:function(e,t){var n={};e.id>0?(n.def_image_id=e.id,n.idea_image_url=""):(n.def_image_id="",n.idea_image_url=e.download_link),(t=this._getSelectedTopics(t)).each((function(e){e._listener.setLoadingOnDrop()})),MM.utils.File.uploadImage(t,n,{successCallback:function(e,t){Tree.utils.setImage(new IdeaImage(e),t)},errorCallback:this.showInvalidImage.bind(this)})},onImageUpload:function(e){this.progressActivity||(this.progressActivity=new MM.ui.Activity(I18n.t("js.uploading"),{progress:!0,autoUpdate:!1})),e>this.progressActivity.progress&&(this.progressActivity.update(e),100===e&&setTimeout(function(){this.progressActivity.close(),this.progressActivity=null,canvas.addFocus()}.bind(this),500))},addImage:function(){canvas.selected&&this.selectedImage?(this.uploadImage(this.selectedImage),Windows.closeAll(),App.trigger(CustomEvents.WEB_IMAGE_ADDED)):this.showInvalidImage(this.selectedImage?I18n.t("js.please_select_an_idea_first"):I18n.t("js.no_image_selected"))},showInvalidImage:function(e){if(Windows.getWindow("image_library")||Windows.getWindow("image_web")){var t=mm$("img_copyright");t&&hide(t),mm$("library_message").innerHTML=e,new Effect.Appear("library_message",{duration:2}),setTimeout((function(){mm$("library_message")&&Effect.Fade("library_message",{duration:1})}),4e3),setTimeout((function(){t&&show(t)}),5e3)}else Message.show(e,Message.ERROR,5)},setAutoImage:function(){canvas.selected?(Element.addClassName("btn_auto_image","fx-wiggle fx-infinite fx-none"),App.trigger(CustomEvents.WUNDERBILD_ADDED),this._getSelectedTopics().each(function(e){var t=p.autoImages[e.id];if(t&&0!==t.photos.length&&t.title===e.getSingleLineTitle()){for(var n=t.photos,i=n[0],o=0,s=n.length-1;o<s;o++)n[o]=n[o+1];n[n.length-1]=i,this.doSetAutoImage(e,t.photos)}else this.autoSearchGoogle(e)}.bind(this)),Amplitude.logEvent("wunder_image")):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},doSetAutoImage:function(e,t){p.autoImages[e.id]={title:e.getSingleLineTitle(),photos:t},$("btn_auto_image").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),0!==t.length?this.uploadImage(IdeaImage.createDummy(t[0].url),e):Message.show(I18n.t("js.no_auto_image_was_found",{v0:e.title}),Message.NOTICE)},onSelectNode:function(){},editImage:function(){this.dialogDrawImage(!0)},removeImage:function(e,t){e&&e.stop(),0!==(t=this._getSelectedTopics(t)).length?Tree.utils.removeImage(t):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},_getSelectedTopics:function(e){return e?Array.isArray(e)?e:[e]:canvas.getSelectedNodes()}});p.autoImages={},t.default=p}.call(this,n("i8i4"),n("q1tI"))},syde:function(e,t,n){"use strict";n.r(t),n.d(t,"COLORS",(function(){return i})),n.d(t,"TASK",(function(){return o})),n.d(t,"isRetina",(function(){return s})),window.name||(window.name="mindmeister");var i=["ffffff","dce2e6","c4c9cc","abb0b3","939799","626566","454a4c","000000","a6433a","736250","80774d","468c52","408080","38628c","5e4d80","804d66","e67c73","e69545","ffe180","a7cc5c","6bb3b3","33bbff","987db3","b36b8f","e6d0cf","e6d4c3","e6e0c3","dae6c3","c3e6e6","c2e2f2","d4c3e6","e6b8cf"],o={priority:["priority_01","priority_02","priority_03","priority_04","priority_05","priority_06","priority_07"],complete:["task_1","task_2","task_3","task_4","task_5"]},s="devicePixelRatio"in window&&window.devicePixelRatio>1},tLB3:function(e,t,n){var i=n("GoyQ"),o=n("/9aa"),s=NaN,r=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,d=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return s;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(r,"");var n=l.test(e);return n||c.test(e)?d(e.slice(2),n?2:8):a.test(e)?s:+e}},tYPA:function(e,t,n){"use strict";(function(e){var i=n("2L+8"),o=n("Pqld"),s=n("Y1fO"),r=n("ERGR"),a=n("rW35"),l=n("lLo4"),c=n("uE/J"),d=n("/K9o");function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var p=function(e){return e?" o-40":""},f=function(t){var n=t.user,o=t.mapId;return"embedded_full"===t.viewMode?[]:[{icon:e.createElement(i.a,{opts:{name:"information",size:12,consize:20,color:"white",parentClasses:"bg-blue rad-100% mr-8"}}),label:I18n.t("js.map_properties"),className:"to-ellipsis",onClick:function(){n.anonymous?MM.ui.dialogs.dialogLogin(n):MM.ui.dialogs.dialogSharing(o)}}]},m=function(t){return{icon:e.createElement(i.a,{opts:{name:"layout-".concat(t.name.replace("_","-")),size:16,consize:20,color:"blue",classes:"h-a-center",parentClasses:"p-r mr-8"}}),label:I18n.t("js.layout.".concat(t.name))}},g=function(e){var t=e.layouts,n=e.currentLayout,i=e.viewOnly,o=m(n);return i||(o.subMenu={selectable:!0,items:t.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(n,!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},m(e),{onClick:c.default.changeLayout.bind(c.default,e),selected:n===e})}))}),[o]},v=function(t){var n=t.title,i=t.items,o=t.className,r=n?{titleClassName:"c-grey700 fs-s fw-100",title:n,className:"ml-5"}:null;return e.createElement(s.a,{header:r,className:"w-220 ml-15 mt-10 map-themes image-grid-widget "+o,elementsInRow:3,items:i,tooltips:!0})},y=function(t){var n=t.themes,o=t.viewOnly;return n.map((function(t){var n,s;return o?(n=function(){},s=I18n.t("js.you_are_in_view_only_mode")):(n=function(){return canvas.onSetTheme(t)},s=t.displayName()),{element:e.createElement(d.a,{width:"66",height:"66",className:"bg-grey200 rad-5px",image:t.thumbnail_asset_url,placeholder:e.createElement(i.a,{opts:{name:"layout-right-aligned",parentClasses:"h-a-center",color:"grey500",size:32}})}),title:s,onClick:n}}))},_=function(t){var n=t.isExternal,i=t.viewOnly;return n?null:e.createElement("a",{href:"#",className:"fs-s".concat(i?" disabled":""),onClick:function(e){return function(e){var t=e.event,n=e.viewOnly;t.preventDefault(),n||(t.nativeEvent.closePopover=!0,MM.ui.dialogs.dialogCustomizeTheme({themeId:App.config.mapTheme.id}))}({event:e,viewOnly:i})}},"".concat(I18n.t("js.customize"),"..."))};t.a=function(t){var n=t.user,s=t.mapId,c=t.layouts,d=t.currentLayout,h=t.teamTemplates,u=t.templates,m=t.isExternal,b=t.viewOnly,w=t.viewMode;return e.createElement(l.a,{position:"bottom",canAutoPosition:!1,className:"sections bg-white w-260",opener:e.createElement(i.a,{id:"btn_properties",opts:{name:"information",size:12,consize:22,color:"white",parentClasses:"rad-100 b-1 bc-white"}})},e.createElement(a.a,null,e.createElement(r.a,{items:f({user:n,mapId:s,viewMode:w})}),e.createElement(r.a,{header:{title:I18n.t("js.alignment")},items:g({layouts:c,currentLayout:d,viewOnly:b}),className:"mt-10".concat(p(b))}),e.createElement(o.a,{title:I18n.t("js.themes"),className:"ph-20 mt-10",elementRight:_({isExternal:m,viewOnly:b})}),function(t){t.user;var n=t.teamTemplates,i=t.templates,o=t.viewOnly,s=p(o),r=y({themes:n,viewOnly:o}),a=v({title:r.length>0?I18n.t("js.default"):null,items:y({themes:i,viewOnly:o}),className:s}),l=r.length>0?v({title:I18n.t("js.saved"),items:r,className:"mt-10".concat(s)}):e.createElement("div",null);return e.createElement("div",{style:{position:"relative",overflowY:"auto",maxHeight:240}},a,l)}({user:n,teamTemplates:h,templates:u,viewOnly:b})))}}).call(this,n("q1tI"))},"uE/J":function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("r44v"),s=n("tYPA"),r=n("39z+"),a=n("A4Hc"),l={init:function(){this.el=$("map_header"),Element.bindOnClick("btn_add",(function(){canvas.onAdd()})),Element.bindOnClick("btn_remove",(function(){canvas.onRemove()})),Element.bindOnClick("btn_undo",(function(){canvas.onUndo()})),Element.bindOnClick("btn_redo",(function(){canvas.onRedo()})),Element.bindOnClick("btn_connect",(function(){canvas.onAddConnection()})),a.default.init("fld_filter",{onBlur:canvas.addFocus.bind(canvas)}),MM.ui.ToolTips.touchSafe({el:this.el}),this.viewportSpace={top:this.el.getHeight()},UI.Registry.add(this),UI.Registry.notify(this,"show"),this._renderMapPropertiesPopover(),App.subscribe(CustomEvents.THEME_CHANGED,this._renderMapPropertiesPopover),ServerData.isLoggedIn&&document.body.clientWidth>=680&&(App.mapsPopover=new r.c("maps",{onShow:function(){e.render(i.createElement(o.a,null),App.mapsPopover.widgetContainer)},onHide:function(){e.unmountComponentAtNode(App.mapsPopover.widgetContainer)}}))},changeLayout:function(e){e!==App.config.layout&&(App.showMapLoading(),setTimeout(function(){tree.changeLayout(e),App.hideMapLoading(),this._renderMapPropertiesPopover()}.bind(this),100))},_renderMapPropertiesPopover:function(){e.render(i.createElement(s.a,{user:users.selfUser,mapId:App.config.map_id,viewMode:App.config.viewMode,viewOnly:!App.config.editable,isExternal:App.config.is_external,layouts:App.Layouts.getAll(),currentLayout:App.config.layout,teamTemplates:MapTheme.team(),templates:MapTheme.templates}),mm$("properties-container"))},show:function(e){CSS.set(this.el,{top:"0px",transitionDuration:e?"500ms":"0ms"}),UI.Registry.notify(this,"show")},hide:function(e){CSS.set(this.el,{top:-this.el.offsetHeight+"px",transitionDuration:e?"500ms":"0ms"}),UI.Registry.notify(this,"hide")},toEditMode:function(){MM.ui.enableButton("btn_add","btn_remove","btn_connect"),App.config.shareMode!=App.MULTI&&MM.ui.enableButton("btn_undo","btn_redo")},toViewMode:function(){MM.ui.disableButton("btn_add","btn_remove","btn_connect","btn_undo","btn_redo"),MM.ui.disableButton("btn_undo","btn_redo")}};t.default=l}.call(this,n("i8i4"),n("q1tI"))},"ut/Y":function(e,t,n){function i(e){return(i="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=n("ZCpW"),s=n("GDhZ"),r=n("zZ0H"),a=n("Z0cm"),l=n("+c4W");e.exports=function(e){return"function"==typeof e?e:null==e?r:"object"==i(e)?a(e)?s(e[0],e[1]):o(e):l(e)}},uvCM:function(e,t,n){"use strict";n.r(t);var i=n("mbwg"),o=Class.create(i.default,{initialize:function($super,e,t,n){$super(e,n),this.tabs=[],this.widgets={},t.each(function(e){var t=new e(n,this);n[t.id]=t,this.tabs.push(t.id),this.widgets[t.id]=t,n.widgets.push(t),this.el.select("#btn_"+t.id)[0].observe("click",this.handleTabClick.bindAsEventListener(this,t.id))}.bind(this)),this.showWidget(this.activeTab())},handleTabClick:function(e,t){e.stop(),this.showWidget(this.widgets[t]);var n=this.tabs.indexOf(t);App.setPreference("tab_"+this.el.id,n),App.trigger(CustomEvents["WIDGET_"+t.toUpperCase()+"_SELECTED"])},showWidget:function(e){e.visible||(this.hidePreviousWidget(e),this.setWidget(e),e.show())},hidePreviousWidget:function(e){this.active&&this.active!==e&&(this.active.hide(),this.el.select("#btn_"+this.active.id)[0].removeClassName("selected"))},setWidget:function(e){this.el.select("#btn_"+e.id)[0].addClassName("selected"),this.active=e},show:function($super){$super();var e=MM.utils.Url.getHashParams();this.tabs.each(function(t){e.hasOwnProperty(t)&&App.setPreference("tab_"+this.id,this.tabs.indexOf(t))}.bind(this)),this.activeTab().show()},onShow:function(e){this.hidePreviousWidget(e),this.setWidget(e)},hide:function($super){$super(),this.activeTab().hide()},toggle:function($super){$super(),ServerConnection.setPreference("bar_"+this.id,!this.visible)},activeTab:function(){return this.active||this.sidebar[this.tabs[App.config["tab_"+this.id]]||this.tabs[0]]}});t.default=o},uvak:function(e,t,n){"use strict";n.r(t),n.d(t,"Point",(function(){return i})),n.d(t,"Line",(function(){return o})),n.d(t,"Rectangle",(function(){return s})),Object.extend(Math,{constrain:function(e,t,n){return e>n?n:e<t?t:e},slopeAngle:function(e){var t=e[0],n=-e[1],i=Math.atan(n/t);return t<0&&n>=0?i+=Math.PI:t<0&&n<0?i+=Math.PI:t>0&&n<0&&(i+=2*Math.PI),180/Math.PI*i},sqr:function(e){return e*e},diagonal:function(e){return parseInt(Math.sqrt(Math.sqr(e[0])+Math.sqr(e[1])))},offset:function(e,t){return[e[0]+t[0],e[1]+t[1]]},negativeOffset:function(e,t){return[e[0]-t[0],e[1]-t[1]]}});var i=Class.create({x:null,y:null,initialize:function(e,t){this.x="number"==typeof e?e:e[0],this.y="number"==typeof e?t:e[1],this.validate()},doOffset:function(e){this.x+=e.x,this.y+=e.y,this.validate()},validate:function(){var e=!1,t="";("number"!=typeof this.x||isNaN(this.x))&&(e=!0,t+=" x was not valid: "+this.x,this.x=100),("number"!=typeof this.y||isNaN(this.y))&&(e=!0,t+=" y was not valid: "+this.y,this.y=100),e&&MM.error.reportException({message:"Point validity failed: ".concat(t)})},getOffsetWith:function(e){return new i(this.x+e.x,this.y+e.y)},getOffsetFrom:function(e){return new i(this.x-e.x,this.y-e.y)},toArray:function(){return[this.x,this.y]},equals:function(e){return this.x==e.x&&this.y==e.y},toString:function(){return[this.x,this.y].toString()}});i.isValid=function(e){return!!e&&"number"==typeof e[0]&&!isNaN(e[0])&&"number"==typeof e[1]&&!isNaN(e[1])};var o=Class.create({p1:null,p2:null,initialize:function(e,t){this.p1=e,this.p2=t instanceof i?t:null==t?new i(this.p1.x,this.p1.y-1):new i(this.p1.x+1,this.p1.y+t)},length:function(){return Math.sqrt(Math.sqr(this.p1.x-this.p2.x)+Math.sqr(this.p1.y-this.p2.y))},slope:function(){return this.p2.x==this.p1.x?null:(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)},angle:function(){return Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x)},intersection:function(e){var t,n,o=this.slope(),s=e.slope();if(o==s)return null;if(null!=o)null!=s?n=o*((t=(o*this.p1.x-s*e.p1.x-this.p1.y+e.p1.y)/(o-s))-this.p1.x)+this.p1.y:(t=e.p1.x,n=o*(e.p1.x-this.p1.x)+this.p1.y);else{if(null==s)return null;t=this.p1.x,n=s*(this.p1.x-e.p1.x)+e.p1.y}return new i(t,n)},onOppositeSides:function(e,t){var n=new o(e,t),i=this.intersection(n);return!i||n.isOnSegment(i)},isOnSegment:function(e){return[this.p1.x,this.p2.x].max()>=e.x-.02&&e.x>=[this.p1.x,this.p2.x].min()-.02&&[this.p1.y,this.p2.y].max()>=e.y-.02&&e.y>=[this.p1.y,this.p2.y].min()-.02},toString:function(){return[this.p1,this.p2].toString()},pointsAtDistance:function(e,t){var n=this.slope();if(null==n)return[new i(e.x,e.y-t),new i(e.x,e.y+t)];var o=t/Math.sqrt(1+Math.sqr(n));return[new i(e.x+o,e.y+n*o),new i(e.x-o,e.y-n*o)]},pointsAtInterval:function(e){for(var t,n=this.angle(),o=Math.cos(n),s=Math.sin(n),r=this.length(),a=0,l=[];a+e<r;)t=new i(o*(a+=e)+this.p1.x,s*a+this.p1.y),l.push(t);return l}}),s=Class.create({p1:null,p2:null,initialize:function(e,t){this.p1=e||new i(0,0),this.p2=t||new i(0,0)},isValid:function(){return this.p1.x<this.p2.x&&this.p1.y<this.p2.y},move:function(e){this.p2=this.size(),this.p2.doOffset(e),this.p1=e},shift:function(e){this.p1.doOffset(e),this.p2.doOffset(e)},mirror:function(){var e=this.p1;this.p1=this.p2,this.p2=e},size:function(){return new i(Math.abs(this.p2.x-this.p1.x),Math.abs(this.p2.y-this.p1.y))},dimensions:function(){return{width:Math.abs(this.p1.x-this.p2.x),height:Math.abs(this.p1.y-this.p2.y)}},center:function(){return new i(parseInt((this.p2.x+this.p1.x)/2),parseInt((this.p2.y+this.p1.y)/2))},within:function(e){return e.x>=this.p1.x&&e.x<=this.p2.x&&e.y>=this.p1.y&&e.y<=this.p2.y},intersection:function(e){var t=[],n=null;return this.sides().each((function(i){(n=e.intersection(i))&&i.isOnSegment(n)&&t.push(n)})),t},radialIntersection:function(e){var t=new o(e,this.center()),n=null;return this.sides().each((function(e){if((n=t.intersection(e))&&t.isOnSegment(n)&&e.isOnSegment(n))throw $break})),n},coords:function(){return[new i(this.p1.x,this.p1.y),new i(this.p2.x,this.p1.y),new i(this.p2.x,this.p2.y),new i(this.p1.x,this.p2.y)]},sides:function(){var e=this.coords();return[new o(e[0],e[1]),new o(e[1],e[2]),new o(e[2],e[3]),new o(e[3],e[0])]},overlaps:function(e){return!(this.p2.x<e.p1.x||this.p1.x>e.p2.x||this.p2.y<e.p1.y||this.p1.y>e.p2.y)},toString:function(){return[this.p1,this.p2].toString()},enlarge:function(e){this.p1.x-=e,this.p1.y-=e,this.p2.x+=e,this.p2.y+=e},addPadding:function(e){this.p1.x-=e.left||0,this.p1.y-=e.top||0,this.p2.x+=e.right||0,this.p2.y+=e.bottom||0}});s.fromPosSize=function(e,t){return new s(e,e.getOffsetWith(t))},s.max=function(e,t){return new s(new i(Math.min(e.p1.x,t.p1.x),Math.min(e.p1.y,t.p1.y)),new i(Math.max(e.p2.x,t.p2.x),Math.max(e.p2.y,t.p2.y)))}},"vN+2":function(e,t){e.exports=function(){}},vTq2:function(e,t,n){"use strict";n.r(t),function(e,i){var o=n("mbwg"),s=n("eAEe"),r=n("rJb1"),a=Class.create(o.default,{cache:{},recentIcons:["smilie_1","smilie_2","smilie_3","status_ok","status_error","heart","star","idea","priority_01","priority_02","priority_03","flag_red","flag_green","sign_warning","sign_info"],expandable:!0,animationShow:CSS.translate({x:"0",y:0}),animationHide:CSS.translate({x:"100%",y:0}),animationFunction:"ease",initialize:function($super,e,t){$super("icons",e,t)},load:function($super){var e=this;Element.bindOnClick("btn_clearicon",(function(){return e.removeIcon()})),r.a.get("recent_icons",(function(t){t&&t.value&&(e.recentIcons=t.value.split(",").concat(e.recentIcons).slice(0,15)),e.buildRecentIcons()})),this.renderExpansion(),$super()},buildRecentIcons:function(){this.list=mm$("recent_icons"),this.list.innerHTML="";for(var e=0,t=this.recentIcons.length;e<t;e++){var n=Icon.fromFullName(this.recentIcons[e]);if(n){var i=n.isDefault()?n.getSpriteElement("span"):n.getElement({className:"h-a-center"}),o=new Element("a",{id:"rec_"+n.fullName(),href:"#",title:n.getTitle(),className:"item recent tooltip"}).insert(i);Element.bindOnClick(o,this.toggleIcon.bind(this,n)),this.list.insert(new Element("cell").insert(o))}}this.buildExpandButton(),MM.ui.ToolTips.destroyTouchSafe(this._tooltips),this._tooltips=MM.ui.ToolTips.touchSafe({el:this.list})},buildExpandButton:function(){var e=new Element("a",{href:"#",className:"tooltip",title:"Choose icon"});e.insert(MM.ui.icon({name:"arrow-right",color:"grey500",size:12,iconSize:28,classes:"h-a-center"})),Element.bindOnClick(e,this.expand.bind(this)),this.list.insert(new Element("cell").insert(e))},toggleIcon:function(e){canvas.selected.node.icons.find((function(t){return t===e}))?this.removeIcon(e.fullName()):this.setIcon(e.fullName())},updateRecentIconsSelection:function(){this.recentIcons.each((function(e){canvas.selected.node.icons.detect((function(t){return t.fullName()===e}))?addClassName(mm$("rec_"+e),"selected"):mm$("rec_"+e)&&removeClassName(mm$("rec_"+e),"selected")}))},onSelectIcon:function(e,t){e&&Event.stop(e),this.selectedIcon&&removeClassName(mm$("icon_library_"+this.selectedIcon.fullName()).parentNode,"selected"),this.selectedIcon=t,addClassName(mm$("icon_library_"+this.selectedIcon.fullName()).parentNode,"selected")},removeIcon:function(e){if("undefined"===typeof e)canvas.onRemoveIcon();else{var t=Icon.get(e);t&&canvas.onRemoveIcon(t)}this.sidebar.tasks.visible&&this.sidebar.tasks.onSelectNode(),App.trigger(CustomEvents.ICON_CHANGED,{iconName:e}),this.onSelectNode()},setIcon:function(e){var t=null;if(e&&(t=Icon.get(e.replace(/icon_default_/,""))),t){var n=t.fullName();canvas.onSetIcon(t),this.addRecentIcon(n),this.sidebar.tasks.visible&&this.sidebar.tasks.onSelectNode(),App.trigger(CustomEvents.ICON_CHANGED,{iconName:n}),this.onSelectNode()}},addRecentIcon:function(e){this.recentIcons.indexOf(e)<0&&(this.recentIcons.pop(),this.recentIcons.unshift(e),r.a.save({name:"recent_icons",value:this.recentIcons.join(",")}),this.buildRecentIcons())},onSelectNode:function(){this.updateRecentIconsSelection(),this.expansion&&this.expanded&&this.expansion.update()},onExpand:function(){this.expansion||this.renderExpansion()},renderExpansion:function(){var t=this,n=[];Object.keys(Icon.libraries).without("silk").map((function(e){var t=Icon.getSections(e);t?t.map((function(t){return n.push({lib:e,section:t})})):n.push({lib:e,section:null})})),this.expansion=e.render(i.createElement(s.default,{libs:n,onBack:this.contract.bind(this),onSelectIcon:this.toggleIcon.bind(this),onClose:function(){return t.sidebar.hide(!0,!0)}}),this.expandedEl)}});t.default=a}.call(this,n("i8i4"),n("q1tI"))},vpdt:function(e,t,n){"use strict";n.r(t);var i=Class.create({id:null,user:null,text:null,createdAt:null,updatedAt:null,initialize:function(e){e&&(this.id=e.id||e.idea_comment_id,this.user=users.findByID(e.user_id,!0),this.text=e.text,this.createdAt=e.created_at?new Date(e.created_at):new Date,this.updatedAt=e.updated_at?new Date(e.updated_at):new Date,this.read=App.config.previousVisit>this.createdAt,i.all.push(this))},update:function(e){this.text=e,this.updatedAt=new Date},equals:function(e){return this.id===e.id},isUnsaved:function(){return this.id<=0},isEdited:function(){return this.updatedAt-this.createdAt>0},toJSON:function(){return{id:this.id,user_id:this.user.id,text:this.text,createdAt:this.createdAt,updatedAt:this.updatedAt}},getElement:function(){return this.el||(this.el=new Element("div",{class:"comment"}).update(this.text)),this.el}});i.all=[],i.get=function(e){for(var t=i.all.length;t>0;)if(i.all[--t].id===e)return i.all[t];return null},i.sort=function(e){return e.sort((function(e,t){return e.createdAt-t.createdAt}))},i.getUnread=function(e){if(!users.selfUser)return[];for(var t=e.length,n=[];t>0;){var i=e[--t];i.user.id===users.selfUser.id||i.read||n.push(i)}return n},i.uncommitedId=0,t.default=i},"wK+5":function(e,t,n){"use strict";n.r(t);var i=n("P0TD"),o=n("Tqv9"),s=n("YIZm"),r=n("H+JK"),a=n("vpdt"),l=n("fK4Y"),c=n("nyiR"),d=n("uvak"),h=Class.create({node:null,parent:null,children:null,image:null,icons:[],dcontent:null,refreshLayout:function(){},mark:function(){},unmark:function(){},__onRename:function(e){if(e&&App.config.editable&&App.config.currentlyEditable&&this.dcontent.isEditing())var t=window.getSelection().getRangeAt(0),n=t.startOffset,i=t.endOffset;if(this.dcontent.updateTitle(),t&&this.dcontent.setCursor&&this.dcontent.setCursor(n,i),this.image&&(this.dcontent.childrenLength=null),tree.notPainted||(this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine()),this.node.isRoot()){var o=this.node.getSingleLineTitle();document.title="".concat(o," -").concat(document.title.split("-")[1]),mm$("map-title")&&(mm$("map-title").textContent=o),canvas.root.reposition()}l.default&&e&&l.default.highlightNode(this,e),canvas.selected===this&&sideBar&&sideBar.onSelectNode()},__onSetIcon:function(e,t){!(e=e||tree.notPainted)&&this.image&&(this.dcontent.children[1].el.style.marginLeft="0");for(var n=this.icons.length,i=!1;n--;)if(this.node.icons.indexOf(this.icons[n].icon)<0){var o=this.icons[n];!tree.finishedInitialization||o.icon.group()&&this.node.icons.detect(function(e){return e.group()===this.group()}.bind(o.icon))?this.dcontent.removeChild(o):(i=!0,o.animateDeletion({onFinish:function(e){this.dcontent.removeChild(e)}.bind(this)})),this.icons=this.icons.without(o)}n=0;for(var s=this.node.icons.length;n<s;n++){if(-1===this.icons.collect((function(e){return e.icon})).indexOf(this.node.icons[n])){var a=new r.default(this,this.node.icons[n]);this.icons.push(a),tree.finishedInitialization&&a.animate()}}App.config.inline_tasks&&this.updateTaskLayer(),e||(i?setTimeout(function(){this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine()}.bind(this),350):(this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine())),l.default&&users&&t&&l.default.highlightNode(this,t)},__onSetStyle:function(e,t){e=e||tree.notPainted,this.node.style?Style.applyToElement(this.node.style,this.dcontent.el):e||Style.removeFromElement(this.dcontent.el),e||(this.refreshLayout(),this.node.isRootC()?this.rc.redrawRootLine():this.node.isRoot()&&canvas.root.reposition()),l.default&&t&&l.default.highlightNode(this,t),sideBar&&canvas.selected==this&&sideBar.format.onSelectNode()},__onSetIdeaProperty:function(e,t){if((e=e||tree.notPainted)||(this.refreshLayout(),this.node.isRootC()?this.rc.redrawRootLine():this.node.isRoot()&&canvas.root.reposition()),(t&&"undefined"!=typeof users&&users.selfUser&&t===users.selfUser.id||"undefined"==typeof t)&&this.node.ideaProperty&&this.node.ideaProperty.floating&&!MM.utils.getCookie("saw_floatingwarning"))return Message.show(I18n.t("js.floating_nodes_warning",{v0:'<a href="#" onclick="return MM.ui.openHelp(\'/218493487-Edit-your-map\')">',v1:"</a>"}),Message.INFO,30),MM.utils.setCookie("saw_floatingwarning","1",365),!0;l.default&&t&&l.default.highlightNode(this,t)},openLink:function(){if(!this.node.link)return!1;var e=this.node.getLinkObj();if("topic"!==e.type)return this.doOpenLink(this.node.link.unescapeHTML(),e.type),!1;var t=mm$(e.link);if(t)App.ui.Preview.clearTimer(this),this.scrollToLinkTarget(t);else{var n=this.doOpenLink("",e.type);new Ajax.Request("/maps/get_topic_target/"+e.link,{onSuccess:function(t){var i="/"+e.link;t.responseJSON&&t.responseJSON.link&&(i=t.responseJSON.link),n.location.href=i}.bind(this)})}return!1},_updateLink:function(e){e.rel=this.node.getLinkRel({link:this.node.link});var t=this.node.getLinkObj(),n=t.type,i=t.link;switch(n){case"url":e.href=this.node.link.unescapeHTML();break;case"email":e.href="mailto:".concat(i);break;default:"phantomjs"===App.config.environment?e.href="https://mindmeister.com/".concat(i):(e.href="#",Element.bindOnClickNoBubble(e,this.openLink.bind(this)))}},scrollToLinkTarget:function(e){var t=e._listener,n=t.node;n.isVisible()||n.toggleAllClosed(!0),canvas.centerOnElement(e),t.select(null,null,null,!0)},doOpenLink:function(e,t){if("email"!==t)return window.open(e);window.location.href=e},openExternalTask:function(){return!!this.node.externalTask&&("embedded"!==App.config.viewMode?(App.trigger(CustomEvents.EXTERNAL_TASK_OPENED),window.open(ServerData.keys.mtDomain+"/app#task/"+this.node.externalTask.external_token),!1):void window.open("https://www.mindmeister.com/mind-map-project-management"))},__onSetProperty:function(e,t,n){t=t||tree.notPainted;var s=mm$(this.node.id+"_"+e);if("image"===e)this.node.idea_image?(s&&this.image&&(this.dcontent.removeChild({el:s}),i.default.removeImage(this.image),t||this.dcontent.onImageRemoved()),this.image=new i.default(this,this.node.idea_image),this.image.show(),this.dcontent.insertChild(this.image.dcontainer,0),this.dcontent.isSelected&&this.isSelected()&&this.image.dcontainer.toSelected()):s&&(this.dcontent.removeChild({el:s}),this.image=null,t||this.dcontent.onImageRemoved());else if("video"===e)this.node.idea_video?(this.video?this.video.updateVideo(this.node.idea_video):this.video=new o.default(this,this.node.idea_video),this.dcontent.insertChild(this.video,0),"phantomjs"===App.config.environment&&this.video.showPlaceholder()):(this.dcontent.removeChild(this.video),this.video=null),"undefined"!==typeof sideBar&&sideBar&&canvas.selected===this&&sideBar.onSelectNode();else if("externalTask"===e)s&&this.dcontent.removeChild({el:s}),this.node.externalTask&&(s=new Element("div",{id:this.node.id+"_"+e,className:"tk_tail"}),"embedded"!==App.config.viewMode&&(s.title=I18n.t("js.click_to_view_task_in_meistertask")),Element.bindOnClickNoBubble(s,this.openExternalTask.bind(this)),this._updatePropertyIcon(s,e),this._appendPropertyIcon(s));else if("attachments"===e&&this.node.attachments.length>0||"task"===e&&this.node.task&&!this.node.task.iconsOnly()&&!this.node.task.empty()||"comments"===e&&this.node.comments.length>0||"votes"===e&&this.node.votes.length>0||"attachments"!==e&&"task"!==e&&"comments"!==e&&"votes"!==e&&this.node[e])if(s)switch(e){case"comments":this._updatePropertyIcon(s,e);break;case"task":App.config.inline_tasks&&this.updateTaskLayer();break;case"votes":s.update(this.updateVotesLayer({animate:!1}));break;case"link":this._updateLink(s)}else"votes"===e?((s=new Element("div",{id:this.node.id+"_"+e,class:"tk_tail",style:"position: relative;"})).update(this.updateVotesLayer({animate:tree.finishedInitialization})),this._appendPropertyIcon(s)):"link"===e?(s=new Element("a",{id:this.node.id+"_"+e,className:"tk_tail",target:"_blank"}),this._updateLink(s),this._updatePropertyIcon(s,e),this._appendPropertyIcon(s)):(s=new Element("div",{id:this.node.id+"_"+e,className:"tk_tail"}),this._updatePropertyIcon(s,e),this._appendPropertyIcon(s),"task"===e&&App.config.inline_tasks&&(this.dtasklayer=new Element("div",{id:this.node.id+"_task_layer",className:"h-flex-row justify-sb tk_task"}),this.updateTaskLayer(),this.dcontent.appendChild({el:this.dtasklayer}))),"link"!==e&&Element.bindOnClickNoBubble(s,App.ui.Preview.show.bind(App.ui.Preview,this,e)),Event.observe(s,"mouseover",App.ui.Preview.onHover.bind(App.ui.Preview,this,e)),Event.observe(s,"mouseout",App.ui.Preview.clearTimer.bind(App.ui.Preview,this));else{if(!s)return;this.dcontent.removeChild({el:mm$(this.node.id+"_"+e)}),"task"==e&&this.dtasklayer&&App.config.inline_tasks&&(this.dcontent.removeChild({el:this.dtasklayer}),this.dtasklayer=null)}t||(this.refreshLayout(),this.node.isRootC()?this.rc.redrawRootLine():this.node.isRoot()&&canvas.root.reposition()),App.ui.Users&&n&&App.ui.Users.highlightNode(this,n)},__onResizeImage:function(e){this.image&&this.image.dcontainer.setSize([this.node.idea_image.width(),this.node.idea_image.height()]),tree.notPainted||(this.node.isRoot()?this.reposition():this.refreshLayout()),l.default&&e&&l.default.highlightNode(this,e)},_updatePropertyIcon:function(e,t){var n={name:{attachments:"widget-attachment",task:"checkmark-thin",externalTask:"products-meistertask-icon",comments:"widget-comment",link:"link"}[t]||"widget-"+t,color:"grey500",size:12,consize:16};"comments"===t&&(a.default.getUnread(this.node.comments).length>0?(addClassName(e,"bg-orange"),n.color="white"):removeClassName(e,"bg-orange")),e.update(MM.ui.icon(n))},_appendPropertyIcon:function(e){this.dtasklayer?this.dcontent.el.insertBefore(e,this.dtasklayer):this.dcontent.appendChild({el:e})},updateTaskLayer:function(){if(this.dtasklayer&&this.node.task){var e="",t={size:this.node.isRoot()?14:10,color:"grey500"};if(this.node.task.due)e='<div row class="rounded due'+(this.node.task.due<=new Date&&this.node.task.complete<4?' overdue" title="'+I18n.t("js.overdue")+'">':'">')+MM.ui.icon(Object.extend({name:"date"},t))+"<div>"+this.node.task.due.toUIString(!0)+"</div></div>";if(this.node.task.resource){e+="<div row>";var n=users.findByID(this.node.task.resource.id,!0);e+=n?n.getAvatar(this.node.isRoot()?"small":"tiny"):MM.ui.icon(Object.extend({name:"user"},t)),e+="<div>"+this.node.task.resource.name.escapeHTML()+"</div></div>"}this.dtasklayer.innerHTML=e}},updateVotesLayer:function(e){var t=this.node.votes.length,n=IdeaVote.getByVote(this.node,IdeaVote.UP).length,i=IdeaVote.maxVotes,o=new Element("span",{class:"h-14px w-14px lh-0 h-a-center"});return e=Object.extend(e,{width:14,height:14,colors:["#8ACC47","#FF5319","#e0e4e6"],strokeWidth:2.5}),c.Graphics.drawDonutChart(o,[n,t-n,i-t],i,e),o},__onAddConnection:function(e){tree.readyForConnections&&e.view.redraw()},__onRemoveConnection:function(e){e&&e.view.clear()},__onChangeId:function(e,t){this.dcontent.el.id=t;for(var n=this.dcontent.children,i=n.length;i>0;){var o=n[--i].el;-1==o.className.indexOf("tk_tail")&&-1==o.className.indexOf("tk_image_container")||(o.id=o.id.gsub(e.toString(),t.toString()))}},buildFromModel:function(){for(var e=this.node.children,t=0;t<e.length;t++){var n=new s.default(e[t]);e[t]._listener=n,this.__onAddChild(n,e[t].parent.rank(e[t]),!0),n.buildFromModel()}},setLoadingOnDrop:function(){var e=this.node.id+"_loading";if(!mm$(e)){var t=new Element("div",{id:e,class:"tk_tail p-r"});t.appendChild(MM.ui.LoadingSpinner(12)),this._appendPropertyIcon(t),this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine()}},removeLoadingFromDrop:function(){var e=mm$(this.node.id+"_loading");e&&(this.dcontent.removeChild({el:e}),this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine())},getTextPosition:function(){var e=canvas.getElementOffset(this.dcontent.el);return e[0]+=this.node.icons.length*(Icon.default_width+4),this.image&&(e[1]+=this.image.dcontainer.el.clientHeight),this.video&&(e[1]+=this.video.el.clientHeight),e},getGhostPosition:function(e,t,n){var i,o,s=[0,0],r=[Math.round(App.GHOST_SIZE[0]),Math.round(App.GHOST_SIZE[1])];if(this.node.hasChildren())if(i=[0,0],t){var a=canvas.getCenter();t[1]>0&&(s[1]=-56),n?((i=Math.offset(t,canvas.getNodeCanvasOffset(n)))[0]>a[0]?s[0]=-136:i[0]+=n.dcontent.size()[0]-r[0]-21,canvas._dropPosition=Math.offset(n.node.pos,t)):(i=Math.offset(a,t),t[0]>0?s[0]=-136:i[0]-=r[0]+21,canvas._dropPosition=t)}else if(this.rc.orientation===App.Layouts.orientation.left?i[0]=canvas.getElementOffset(this.dchildren.el)[0]+this.dchildren.size()[0]-r[0]-this.dopener.el.clientWidth:(s[0]=-136,i[0]=canvas.getElementOffset(this.dchildren.el)[0],"org_chart"!==App.config.layout.name&&(i[0]-=this.dopener.el.clientWidth/2)),0===e)o=this.children[0],i[1]=canvas.getNodeCanvasOffset(o)[1]-(o.dcontent.size()[1]+r[1]/2)/2;else if(e==this.children.length){s[1]=-56;var l=(o=this.children[this.children.length-1]).dcontainer.size()[1]+o.dcontent.size()[1]-o.dcontent.pos[1]-r[1];"org_chart"!==App.config.layout.name&&(l/=2),i[1]=canvas.getNodeCanvasOffset(o)[1]+l}else{s[1]=-28;var c=this.children[e-1],d=this.children[e],h=canvas.getNodeCanvasOffset(c),u=canvas.getNodeCanvasOffset(d);i[1]=(h[1]+c.dcontent.size()[1]+u[1]-r[1])/2}else{var p=this.dcontent.size(),f=this.dcontent.el.offsetWidth-p[0],m=this.dcontent.el.offsetHeight-p[1];i=canvas.getNodeCanvasOffset(this),this.rc.orientation==App.Layouts.orientation.left?i[0]-=r[0]+24:(s[0]=-136,i[0]+=p[0]),i[0]+=f/2,i[1]+=p[1]/2+m/2-r[1]}return{pos:i,offset:s}},getCentralPosition:function(){var e=this.dcontent.el.getBoundingClientRect();return{left:e.left+e.width/2,top:e.top+e.height/2}},isVisible:function(){var e=this.dcontent.el;if(!e)return!1;var t=e.getBoundingClientRect(),n=document.body.getBoundingClientRect(),i=UI.Registry.viewportOffset;return t.left>=i.left&&n.right-i.right>=t.right&&t.top>=i.top&&n.bottom-i.bottom>=t.bottom},isSelected:function(){return this.dcontent&&this.dcontent.isSelected&&this.dcontent.isSelected()},isPartiallySelected:function(){return this.dcontent&&this.dcontent.isPartiallySelected&&this.dcontent.isPartiallySelected()},isEditing:function(){return this.dcontent&&this.dcontent.isEditing&&this.dcontent.isEditing()},eachChild:function(e,t,n){if(t||e(this),!n)for(var i=0,o=this.children.length;i<o;i++)this.children[i].eachChild(e,t);t&&e(this)},eachChildWithCounter:function(e,t,n,i){n||e(this,t);for(var o=0;o<this.children.length;o++)i?e(this.children[o],o+1):this.children[o].eachChildWithCounter(e,o+1);n&&e(this,t)},highlight:function(e,t){if(e){var n=null;this.node.style&&this.node.style.backgroundColor&&(n="#"+this.node.style.backgroundColor),new Effect.Highlight(this.dcontent.el,{startcolor:"#ffffff",endcolor:e||"#cccccc",restorecolor:t?e:n,duration:.7,afterFinish:function(){!n&&this.dcontent&&removeStyle(this.dcontent.el,"background-color")}.bind(this)})}else this.node.style&&(e=this.node.style.backgroundColor)?this.dcontent.el.style.backgroundColor="#"+e:removeStyle(this.dcontent.el,"background")},blur:function(){addClassName(this.dcontent.el,"blured")},unBlur:function(){removeClassName(this.dcontent.el,"blured")},selectByUser:function(e,t){var n=this,i=e.color||"#cccccc",o=$("collaborators_for_"+this.node.id);o||(o=new Element("div",{id:"collaborators_for_"+this.node.id,className:"tk_author_name_container"}),this.dcontent.el.appendChild(o)),this.dcontent.el.addClassName("user_selected"),this.dcontent.el.style.borderColor=i;var s=$("node_"+this.node.id+"_selected_by_"+e.id);s?show(s):(s=new Element("div",{id:"node_"+this.node.id+"_selected_by_"+e.id,className:"tk_author_name",style:"display: none; background-color: "+i}),o.appendChild(s),o.setStyle({left:"0",bottom:"100%"}),new Effect.Appear(s,{duration:.7,afterFinish:function(){t&&n.unSelectByUser(e)}})),s.innerHTML!==e.displayname&&(s.innerHTML=e.displayname)},unSelectByUser:function(e){var t=mm$("node_"+this.node.id+"_selected_by_"+e.id);this.node.style&&this.node.style.borderColor?this.dcontent.el.style.borderColor="#"+this.node.style.borderColor:(removeStyle(this.dcontent.el,"border-color"),this.dcontent.el.removeClassName("user_selected")),t&&hide(t)},distanceFromCenter:function(){var e=canvas.root.getCenter(),t=this.dcontent.el.cumulativeOffset(),n=new Point(e[0],e[1]),i=new Point(t[0],t[1]);return new d.Line(n,i).length()}});h.naturalCompare=function(e,t){return String.naturalCompare(e.node.getRawTitle().toLowerCase(),t.node.getRawTitle().toLowerCase())},t.default=h},wOJ8:function(e,t){function n(){}n.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){var i=this;function o(){i.off(e,o),t.apply(n,arguments)}return o._=t,this.on(e,o,n)},emit:function(e){for(var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,o=n.length;i<o;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],o=[];if(i&&t)for(var s=0,r=i.length;s<r;s++)i[s].fn!==t&&i[s].fn._!==t&&o.push(i[s]);return o.length?n[e]=o:delete n[e],this}},e.exports=n,e.exports.TinyEmitter=n},wclG:function(e,t,n){var i=n("pFRH"),o=n("88Gu")(i);e.exports=o},wy8a:function(e,t,n){var i=n("KxBF");e.exports=function(e,t,n){var o=e.length;return n=void 0===n?o:n,!t&&n>=o?e:i(e,t,n)}},"x+1z":function(e,t,n){"use strict";n.r(t);var i=n("Zu2b"),o=n("uvCM"),s=n("R8jl"),r=n("1aen"),a=n("lBGc"),l=n("vTq2"),c=n("sfJZ"),d=n("5ehg"),h=n("1tAg"),u=n("3Uto"),p=n("Vq2u"),f=n("3cgG"),m=n("nYGJ"),g=CSS.scale(1),v=CSS.scale(0),y=Class.create({el:null,toolbar:null,scaleFactor:1,visible:!1,viewportSpace:{right:0},initialize:function(){var e=this;this.el=$("sidebar"),this.toggleBtn=mm$("btn-show-sidebar"),this.toolbar=mm$("toolbar_sidebar"),this.expandedElement=this.toolbar,this.widgets=[],this.sections=[],this.format=new i.default(this),this.widgets.push(this.format),this.sections.push(this.format);var t=new o.default("design",[r.default,a.default,s.default],this),n=new o.default("media",[l.default,c.default,d.default],this),g=new o.default("extras",[h.default,u.default,p.default,f.default,m.default],this);this.sections.push(t),this.sections.push(n),this.sections.push(g),Element.bindOnClick(this.toggleBtn,(function(){return e.show(!0,!0)})),Element.bindOnClick("btn-hide-sidebar",(function(){return e.hide(!0,!0)})),UI.Registry.add(this),App.subscribe(CustomEvents.POST_LOAD,this.expandWidgetOnLoad.bind(this)),this.tooltips=MM.ui.ToolTips.touchSafe({el:this.el})},show:function(e,t,n,i){var o=App.config,s=o.hide_sidebar,r=o.sidebar_extended;s&&!t||(this._doShow({animation:n,animationFunction:i,expandedWidgetId:r,useEffect:e}),t&&App.setPreference("hide_sidebar",!1))},hide:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:v,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"cubic-bezier(1, 0, 0, 1)";if(this.visible){var o=e?500:0;CSS.set(this.expandedElement,{transitionDuration:o+"ms",opacity:0,transform:n,transitionTimingFunction:i}),this._doAnimation(n),this.showToggleBtn(),this.scaleFactor=0,App.SIDEBAR_WIDTH=0,App.SIDEBAR_HEIGHT=0,t&&App.setPreference("hide_sidebar",!0),UI.Registry.notify(this,"hide"),this._updateViewportSpace()}},toggle:function(e){this.visible?this.hide(!0,e):this.show(!0,e)},showToggleBtn:function(){removeClassName(this.toggleBtn,"hidden")},hideToggleBtn:function(){addClassName(this.toggleBtn,"hidden")},expandWidget:function(e){var t=this.widgets.find((function(t){return t.id===e}));t&&t!==this.expandedWidget&&t.expand()},expandWidgetOnLoad:function(){var e=MM.utils.Url.getHashParams(),t=this.widgets.find((function(t){return t.id===e.sidebar_extended}));if(t){var n=t.id;this.visible?this.expandWidget(n):this._doShow({expandedWidgetId:n})}},toViewMode:function(){this.toggleBtn.addClassName("h-hidden"),this.hide(!0)},toEditMode:function(){this.show(!0),this.toggleBtn.removeClassName("h-hidden")},onSelectNode:function(){canvas.selected&&this.visible&&this.widgets.each((function(e){(e.visible||e.expanded)&&e.onSelectNode()}))},onResize:function(){var e=UI.Registry.viewportOffset,t=e.top,n=e.bottom,i=MM.ui.page.height-(t+n+30),o=this.expandedElement.getHeight(),s=i<o?Math.max(.75,i/o):1;this.scaleTo(s),this._updateViewportSpace()},scaleTo:function(e){this.scaleFactor!==e&&(this.scaleFactor=e,this._doAnimation(CSS.scale(e)))},_doAnimation:function(e){CSS.set(this.expandedElement,{transform:e})},_doShow:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=App.config,i=n.viewMode,o=n.editable,s=n.currentlyEditable;if(!("external"===i&&!o||this.visible&&s)){var r=t.animation,a=void 0===r?g:r,l=t.animationFunction,c=void 0===l?"cubic-bezier(1, 0, 0, 1)":l,d=t.useEffect,h=t.expandedWidgetId,u={right:App.SCROLLBAR_SIZE+15+"px",opacity:1,transitionTimingFunction:c};if(d&&(u.transitionDuration="".concat(500,"ms")),this.expandWidget(h),CSS.set(this.expandedElement,u),this.visible=!0,this._doAnimation(a),this.onResize(),d){var p=CSS.whichTransitionEvent();Event.observeOnce(this.expandedElement,p,(function(){UI.Registry.notify(e,"show")}))}else UI.Registry.notify(this,"show");this.hideToggleBtn(),this.sections.each((function(e){e.show()}),this),this.onSelectNode(),App.SIDEBAR_WIDTH=this.expandedElement.getWidth()+parseInt(this.expandedElement.getStyle("right")),App.SIDEBAR_HEIGHT=this.expandedElement.getHeight()}},_updateViewportSpace:function(){var e=parseInt(this.expandedElement.style.right),t=(this.expandedElement.getWidth()+e)*this.scaleFactor;t!==this.viewportSpace.right&&(this.viewportSpace={right:t})}});t.default=y},"x6O/":function(e,t,n){"use strict";n.r(t);var i=n("UfWW"),o=n.n(i),s=n("/Fw/"),r=n.n(s),a=Class.create({initialize:function(){this.chats={}},getChat:function(e){var t=this.chats[e];return t||(t={messages:[],olderMessagesLoaded:!1,notifyObservers:function(e){App.trigger(CustomEvents.CHAT_UPDATE+"_"+e)},loading:!1},this.chats[e]=t),t},send:function(e,t){var n=this.chats[t];e.failed||this.push(e,t),new Ajax.Request("/chat_messages",{parameters:{target_id:t,text:e.text,map_id:App.config.map_id,timestamp:ServerConnection.timestamp},onSuccess:function(t){var n=t.responseJSON;e.timestamp=n.timestamp,e.id=n.chat.id,e.failed=!1},onFailure:function(i){e.failed=!0,n.notifyObservers(t)}})},push:function(e,t){var n=this.getChat(t),i=n.messages;-1===o()(i,(function(t){return!!e.id&&(t.id===e.id&&!t.failed)}))&&(i.push(e),n.notifyObservers(t))},getUnreadMessages:function(e){return this.getChat(e).messages.filter((function(e){return!e.received&&e.user_id!==users.selfUser.id}))},markAsRead:function(e){var t=[],n=this.getChat(e);n.messages=n.messages.map((function(e){return e.received||e.user_id===users.selfUser.id||(e.received=!0,t.push(e.id)),e})),new Ajax.Request("/chat_messages/read/",{method:"post",contentType:"application/json",parameters:JSON.stringify({ids:t})}),n.notifyObservers(e)},receive:function(e){e.target_id?this.push(e,e.user_id):this.push(e),this.postBrowserNotification(e)},getOlderMessages:function(e){var t=this.getChat(e),n=t.messages,i=null;return!t.olderMessagesLoaded&&(n[0]&&(i=n[0].timestamp),t.loading=!0,new Ajax.Request("/chat_messages",{method:"get",parameters:{older_than:i,map_id:App.config.map_id,target_id:e},onSuccess:function(i){var o=i.responseJSON;t.loading=!1,t.messages=o.messages.concat(n),o.messages.length<25&&(t.olderMessagesLoaded=!0),t.notifyObservers(e)}}),!0)},postBrowserNotification:function(e){if(window.Notification&&"denied"!==Notification.permission){var t=users.findByID(e.user_id);if(!t)return;if(e.user_id===users.selfUser.id)return;Notification.requestPermission((function(n){new Notification(t.name,{body:e.text,icon:r.a})}))}}});t.default=new a},xV1c:function(e,t,n){var i=n("gP1L");"string"===typeof i&&(i=[[e.i,i,""]]);var o={insert:"head",singleton:!1};n("LboF")(i,o);i.locals&&(e.exports=i.locals)},xkGU:function(e,t,n){e.exports=n("bNQv")},yLpj:function(e,t){function n(e){return(n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(o){"object"===("undefined"===typeof window?"undefined":n(window))&&(i=window)}e.exports=i},"yQ/X":function(e,t,n){"use strict";n.r(t);var i={getElements:function(e,t){var n=[],i=[],o=!1;t=Object.extend({idPrefix:"",containerClassName:""},t);for(var s=0;s<e.length;s++){var r=e[s];if(r.thumbnail&&(o=!0),-1===i.indexOf(r.url())){var a=new Element("a",{id:t.idPrefix+r.id,href:"#",className:t.containerClassName}),l=new Element("img");if(r.mm_default&&r.local_path?l.src=r.local_path:r.thumbnail?(l.src=r.thumbnail,l.setAttribute("data-url",r.url())):l.src=r.url(),!r.thumbnail&&!isNaN(t.width)&&!isNaN(t.height)){var c=o?[t.width,t.height]:r.resize(t.width,t.height);o||(l.style.width=c[0]+"px"),l.style.height=c[1]+"px"}a.appendChild(l),n.push(a),i.push(r.url(!0))}}return n},checkLicense:function(e){var t=$("img_copyright");if(t){var n=parseInt(e.getAttribute("google_id"));if(n){var i=sideBar.images.googleSearch.items[n];t.innerHTML=I18n.t("js.this_image_may_be_subject_to_copyright")+'. <a class="plainlink" href="'+i.contextUrl+'" target="_blank">'+I18n.t("js.open_source_page")+"</a>",t.addClassName("info"),t.show()}}},insertIntoLibrary:function(e,t,n){var o=IdeaImage.createDummy(t.url,t.width&&t.height?[t.width,t.height]:null);o.thumbnail=t.thumbnailUrl;var s=i.getElements([o],{idPrefix:e+"img_",containerClassName:"item rad-3"})[0],r=s.select("img")[0],a=MM.ui.LoadingSpinner(48),l=new Element("cell");s.setAttribute(e+"_id",n),addClassName(s,"loading"),s.insert(a),s.onclick=function(){return!1},r.onerror=function(){a.remove(),s.innerHTML='<span class="h-a-center text-center">'+I18n.t("js.image_not_available")+"</span>"},r.onload=function(){removeClassName(s,"loading"),a.remove(),l.observe("click",sideBar.images.onSelectImage.bindAsEventListener(sideBar.images,s,!0)),l.observe("dblclick",sideBar.images.onDblClickImage.bindAsEventListener(sideBar.images,s,!0))},l.appendChild(s),mm$(e+"_imgs_container")&&mm$(e+"_imgs_container").appendChild(l)}};t.default=i},"z4/t":function(e,t,n){"use strict";n.r(t);var i=Class.create({initialize:function(e){e&&(this.floating=e.floating)},toJSON:function(){return{floating:this.floating}}});t.default=i},zYya:function(e,t,n){"use strict";n.r(t),n.d(t,"VConnection",(function(){return d})),n.d(t,"DEFAULT_COLOR",(function(){return c}));var i=n("uvak"),o=n("nyiR"),s=n("Wd7y"),r=n("1Hvr"),a=n("r5HS");function l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if(!(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e)))return;var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!t||n.length!==t);i=!0);}catch(l){o=!0,s=l}finally{try{i||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var c=a.COLORS.grassGreen,d=Class.create({connection:null,start:null,end:null,visible:!1,visibleHandlers:!1,labelPoint:{x:0,y:0,angle:0},initialize:function(e){this.connection=e},redraw:function(e){var t=this.connection.from._listener,n=this.connection.to._listener,i=t.node.id,o=n.node.id;e=e||this.shallSelect();if(t.node.isVisible()&&n.node.isVisible()){var s=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(t)),new Point(t.dcontent.size())),r=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(n)),new Point(n.dcontent.size())),a=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(canvas.root)),new Point(canvas.root.dcontent.size()));this.toViewMode();var l=null;(l=canvas.root==t?this._getBezierCoordinatesToRoot(a,r):canvas.root==n?this._getBezierCoordinatesToRoot(s,a):this._getBezierCoordinates(a,s,r)).p1&&l.p2&&l.cp1&&l.cp2&&(this.drawConnection(l,!1,i,o,this.connection.color,e),this.connection.label?this.updateLabel():this.label&&this.deleteLabel())}},shallSelect:function(){var e=this.connection.from._listener,t=this.connection.to._listener;return e.isEditing()||t.isEditing()||e.isSelected()||t.isSelected()||e.isPartiallySelected()||t.isPartiallySelected()},updateLabel:function(){this.label||(this.label=new s.default("connection_label",{onEnterEditMode:function(){canvas.removeFocus(),canvas.disableScrollByDrag()},onLeaveEditMode:function(){canvas.addFocus(),canvas.enableScrollByDrag()},saveCallback:this.saveLabel.bind(this)}),canvas.el.appendChild(this.label.el)),this.connection.label&&this.label.setValue(this.connection.label),this.positionLabel()},positionLabel:function(){var e=Object.clone(this.labelPoint);e.x-=this.label.getWidth()/2,e.y-=this.label.getHeight()/2,this.label.el.setStyle({top:e.y+"px",left:e.x+"px",backgroundColor:"#"+this.connection.color})},saveLabel:function(e){if(e.length>255)return this.connection.label?this.label.setValue(this.connection.label):this._removeLabel(),Message.show(I18n.t("js.connection_label_is_too_long"),Message.ERROR,5);this.connection.setProperties({label:e})},deleteLabel:function(){this.connection.label&&this.saveLabel(""),this._removeLabel()},_removeLabel:function(){this.label&&(this.label.el.remove(),this.label=null)},_getBezierCoordinates:function(e,t,n){var o,s,r,a,l,c,d,h=e.center(),u=t.center(),p=n.center(),f=new i.Line(h,u),m=new i.Line(h,p),g=new i.Line(u,p);if(!e.isValid()||!t.isValid()||!n.isValid())return{};try{o=new i.Line(u,m.slope()),(a=(r=t.intersection(o)).find((function(e){return g.onOppositeSides(h,e)})))||(a=r[0]),c=(r=o.pointsAtDistance(a,100)).find((function(e){return g.onOppositeSides(h,e)})),s=new i.Line(p,f.slope()),(l=(r=n.intersection(s)).find((function(e){return g.onOppositeSides(h,e)})))||(l=r[0]),d=(r=s.pointsAtDistance(l,100)).find((function(e){return g.onOppositeSides(h,e)}))}catch(v){MM.error.reportException({exception:v,message:"Connection drawing problem"})}return{p1:a,p2:l,cp1:c,cp2:d}},_getBezierCoordinatesToRoot:function(e,t){var n=e.radialIntersection(t.center()),o=t.radialIntersection(e.center()),s=new i.Line(n,o),r=new Point((n.x+o.x)/2,(n.y+o.y)/2),a=l(s.pointsAtDistance(r,10),2);return{p1:n,p2:o,cp1:a[0],cp2:a[1]}},_overrideControlPoints:function(){this.coords.cp1.x=this.coords.p1.x+this.connection.cp_from_x,this.coords.cp1.y=this.coords.p1.y+this.connection.cp_from_y,this.coords.cp2.x=this.coords.p2.x+this.connection.cp_to_x,this.coords.cp2.y=this.coords.p2.y+this.connection.cp_to_y},_deleteLinesForConnection:function(e){var t=o.Graphics.connectionstack.get(e);if(t){for(var n=t.length-1;n>=0;n--)if("set"==t[n].type)for(var i=t[n],s=0;s<=i.length;s++)i[s]&&i[s].remove();else t[n].remove();o.Graphics.connectionstack.unset(e)}},drawTemporaryConnection:function(e,t){var n=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(e)),new Point(e.dcontent.size())),i=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(canvas.root)),new Point(canvas.root.dcontent.size())),o=Rectangle.fromPosSize(new Point(t.x-25,t.y-25),new Point(50,50)),s=null;(s=e==canvas.root?this._getBezierCoordinatesToRoot(i,o):this._getBezierCoordinates(i,n,o)).p1&&s.p2&&s.cp1&&s.cp2&&this.drawConnection(s,!0)},drawConnection:function(e,t,n,i){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:c,r=arguments.length>5?arguments[5]:void 0;this.coords=e;var a=t?"0-0":this.connection.raphael_id;o.Graphics.connectionstack.get(a)&&this._deleteLinesForConnection(a),!t&&this.connection.cp_to_x&&this._overrideControlPoints(),this.labelPoint=o.Graphics.drawConnection(this.coords.cp1.x,this.coords.cp1.y,this.coords.cp2.x,this.coords.cp2.y,this.coords.p1.x,this.coords.p1.y,this.coords.p2.x,this.coords.p2.y,a,s);var l=o.Graphics.connectionstack.get(a);l&&l[1][3].updateAbsolute(this.coords.cp2.x,this.coords.cp2.y),this.visible=!0,App.config.editable&&App.config.currentlyEditable&&!t&&(this.toEditMode(),r&&this.showConnectionHandlers())},toViewMode:function(){this._editIcon&&this._editIcon.toViewMode(),this.visibleHandlers&&this.hideConnectionHandlers()},toEditMode:function(){this.visible&&(this.coords.p1.x&&this.coords.p1.y&&(this._editIcon&&this._editIcon.destroy(),this._editIcon=new a.Editor(this.coords.p1,this.connection,this._onMouseOver.bind(this),this._onMouseOut.bind(this))),this.coords.cp1.x&&this.coords.cp1.y&&this.coords.cp2.x&&this.coords.cp2.y&&(this._handlerIcon1&&this._handlerIcon1.destroy(),this._handlerIcon2&&this._handlerIcon2.destroy(),this._handlerIcon1=new r.default(this.coords.cp1,2,this.connection),this._handlerIcon2=new r.default(this.coords.cp2,3,this.connection)))},destroy:function(){this.connection&&(this._deleteLinesForConnection(this.connection.raphael_id),this._handlerIcon1&&this._handlerIcon1.destroy(),this._handlerIcon2&&this._handlerIcon2.destroy(),this._editIcon&&this._editIcon.destroy()),this.label&&this._removeLabel()},clear:function(){this.toViewMode(),this.start=this.end=null,this.visible=!1,this._deleteLinesForConnection("0-0"),this.destroy()},showConnectionHandlers:function(){if(this.visible){if(o.Graphics.connectionstack.get(this.connection.raphael_id)){var e=o.Graphics.connectionstack.get(this.connection.raphael_id)[1];e[0].show(),e[2].show(),e[3].show();var t={x:e[2].attrs.cx,y:e[2].attrs.cy},n={x:e[3].attrs.cx,y:e[3].attrs.cy}}this._handlerIcon1&&this._handlerIcon2&&t&&n?(this._handlerIcon1.move(t),this._handlerIcon2.move(n),this._handlerIcon1.show(),this._handlerIcon2.show()):this.toEditMode(),this.visibleHandlers=!0}},hideConnectionHandlers:function(){if(this.visibleHandlers&&!this.shallSelect()&&!this._handlerIcon1.dragging&&!this._handlerIcon2.dragging){if(o.Graphics.connectionstack.get(this.connection.raphael_id)){var e=o.Graphics.connectionstack.get(this.connection.raphael_id)[1];e[0].hide(),e[2].hide(),e[3].hide()}this._handlerIcon1.hide(),this._handlerIcon2.hide(),this.visibleHandlers=!1}},_onMouseOver:function(){this._editIcon.show()},_onMouseOut:function(){this._editIcon.hide()}});t.default=d},zZ0H:function(e,t){e.exports=function(e){return e}},zoYe:function(e,t,n){var i=n("nmnc"),o=n("eUgh"),s=n("Z0cm"),r=n("/9aa"),a=1/0,l=i?i.prototype:void 0,c=l?l.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(s(t))return o(t,e)+"";if(r(t))return c?c.call(t):"";var n=t+"";return"0"==n&&1/t==-a?"-0":n}},zqxM:function(e,t,n){var i=n("LqpT"),o=n("XGnz"),s=n("EA7m"),r=n("3L66"),a=s((function(e,t){return r(e)?i(e,o(t,1,r,!0)):[]}));e.exports=a}},[["fhuu",5,0,1]]]);